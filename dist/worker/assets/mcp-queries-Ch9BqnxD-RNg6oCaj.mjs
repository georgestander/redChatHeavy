import{h as s,al as i,am as t,P as a,an as l,ao as h,ap as w,aq as p,ar as y,as as b,at as I,m as c}from"./index-CPesPnUn.mjs";import"node:events";import"cloudflare:workers";import"async_hooks";import"node:os";import"node:diagnostics_channel";import"fs";import"events";import"util";import"path";import"assert";import"node:stream";import"module";import"node:path";import"url";import"buffer";import"crypto";import"node:crypto";async function C({userId:e}){try{return await s.select().from(i).where(b(a(i.userId,e),p(i.userId))).orderBy(w(i.createdAt))}catch(r){throw console.error("Failed to get MCP connectors from database",r),r}}async function S({id:e}){try{const[r]=await s.select().from(i).where(a(i.id,e));return r}catch(r){throw console.error("Failed to get MCP connector by id from database",r),r}}async function g({userId:e,nameId:r,excludeId:o}){try{const n=[a(i.nameId,r),e===null?p(i.userId):a(i.userId,e)],d=o?l(...n,y`${i.id} != ${o}::uuid`):l(...n),[u]=await s.select().from(i).where(d);return u}catch(n){throw console.error("Failed to get MCP connector by nameId from database",n),n}}async function B({userId:e,name:r,nameId:o,url:n,type:d,oauthClientId:u,oauthClientSecret:f}){try{const[m]=await s.insert(i).values({userId:e,name:r,nameId:o,url:n,type:d,oauthClientId:u??null,oauthClientSecret:f??null}).returning();return m}catch(m){throw console.error("Failed to create MCP connector in database",m),m}}async function M({id:e,updates:r}){try{await s.update(i).set({...r,updatedAt:new Date}).where(a(i.id,e))}catch(o){throw console.error("Failed to update MCP connector in database",o),o}}async function q({id:e}){try{await s.delete(i).where(a(i.id,e))}catch(r){throw console.error("Failed to delete MCP connector from database",r),r}}async function A({mcpConnectorId:e}){const[r]=await s.select().from(t).where(l(a(t.mcpConnectorId,e),h(t.tokens))).orderBy(w(t.updatedAt)).limit(1);return r}async function O({state:e}){if(!e)return;const[r]=await s.select().from(t).where(a(t.state,e));return r}async function P({mcpConnectorId:e,serverUrl:r,state:o,codeVerifier:n,clientInfo:d}){const[u]=await s.insert(t).values({mcpConnectorId:e,serverUrl:r,state:o,codeVerifier:n,clientInfo:d}).returning();return u}async function k({state:e,codeVerifier:r}){const[o]=await s.update(t).set({codeVerifier:r}).where(l(a(t.state,e),p(t.codeVerifier))).returning();if(o)return o;const[n]=await s.select().from(t).where(a(t.state,e));if(!n)throw new Error(`Session with state ${e} not found`);return n}async function v({state:e,clientInfo:r}){const[o]=await s.update(t).set({clientInfo:r}).where(l(a(t.state,e),p(t.clientInfo))).returning();if(o)return o;const[n]=await s.select().from(t).where(a(t.state,e));if(!n)throw new Error(`Session with state ${e} not found`);return n}async function F({state:e,updates:r}){const o=Object.fromEntries(Object.entries(r).filter(([d,u])=>u!==void 0));if(Object.keys(o).length===0){const[d]=await s.select().from(t).where(a(t.state,e));if(!d)throw new Error(`Session with state ${e} not found`);return d}const[n]=await s.update(t).set(o).where(a(t.state,e)).returning();if(!n)throw new Error(`Session with state ${e} not found`);return n}async function $({state:e,mcpConnectorId:r,tokens:o}){const[n]=await s.update(t).set({tokens:o}).where(a(t.state,e)).returning();if(!n)throw new Error(`Session with state ${e} not found`);return await s.delete(t).where(l(a(t.mcpConnectorId,r),p(t.tokens),I(t.state,e))),n}async function E({state:e}){await s.delete(t).where(a(t.state,e))}async function V({mcpConnectorId:e}){await s.delete(t).where(a(t.mcpConnectorId,e))}c(C,"/lib/db/mcp-queries.ts","getMcpConnectorsByUserId");c(S,"/lib/db/mcp-queries.ts","getMcpConnectorById");c(g,"/lib/db/mcp-queries.ts","getMcpConnectorByNameId");c(B,"/lib/db/mcp-queries.ts","createMcpConnector");c(M,"/lib/db/mcp-queries.ts","updateMcpConnector");c(q,"/lib/db/mcp-queries.ts","deleteMcpConnector");c(A,"/lib/db/mcp-queries.ts","getAuthenticatedSession");c(O,"/lib/db/mcp-queries.ts","getSessionByState");c(P,"/lib/db/mcp-queries.ts","createOAuthSession");c(k,"/lib/db/mcp-queries.ts","setOAuthCodeVerifierOnceByState");c(v,"/lib/db/mcp-queries.ts","setOAuthClientInfoOnceByState");c(F,"/lib/db/mcp-queries.ts","updateSessionByState");c($,"/lib/db/mcp-queries.ts","saveTokensAndCleanup");c(E,"/lib/db/mcp-queries.ts","deleteSessionByState");c(V,"/lib/db/mcp-queries.ts","deleteSessionsByConnectorId");export{B as createMcpConnector,P as createOAuthSession,q as deleteMcpConnector,E as deleteSessionByState,V as deleteSessionsByConnectorId,A as getAuthenticatedSession,S as getMcpConnectorById,g as getMcpConnectorByNameId,C as getMcpConnectorsByUserId,O as getSessionByState,$ as saveTokensAndCleanup,v as setOAuthClientInfoOnceByState,k as setOAuthCodeVerifierOnceByState,M as updateMcpConnector,F as updateSessionByState};
//# sourceMappingURL=mcp-queries-Ch9BqnxD-RNg6oCaj.mjs.map
