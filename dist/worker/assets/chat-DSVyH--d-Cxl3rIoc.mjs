import{i as k,s as ce,p as gt,e as ue,Z as yt,o as vt,j as wt,Q as bt,k as De,l as It,K as Pt,q as At,Y as _t,u as de,w as kt,v as St,y as Ct,x as Et,c as m,W as p,R as Mt,n as xt,z as Tt,J as $t,G as Ot,A as Rt,a as Zt,E as Be,C as he,D as jt,H as M,F as v,I as Ue,L as W,M as F,N as Ht,O as qe,T as Y,U as Lt,V as se,$ as J,a0 as Vt,a1 as Ft,a2 as d,a3 as ne,a4 as $,m as P,a5 as Nt}from"./index-CPesPnUn.mjs";import ze from"node:path";import"node:events";import"cloudflare:workers";import"async_hooks";import"node:os";import"node:diagnostics_channel";import"fs";import"events";import"util";import"path";import"assert";import"node:stream";import"module";import"url";import"buffer";import"crypto";import"node:crypto";var Dt=ze.join(process.cwd(),".devtools");ze.join(Dt,"generations.json");process.env.AI_SDK_DEVTOOLS_PORT&&parseInt(process.env.AI_SDK_DEVTOOLS_PORT);function Q(...e){return e.reduce((t,a)=>({...t,...a??{}}),{})}function U(e){return Object.fromEntries([...e.headers])}var Bt=({prefix:e,size:t=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const s=()=>{const n=a.length,o=new Array(t);for(let i=0;i<t;i++)o[i]=a[Math.random()*n|0];return o.join("")};if(e==null)return s;if(a.includes(r))throw new Nt({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${e}${r}${s()}`};Bt();function N(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}var Ut=["fetch failed","failed to fetch"];function Ge({error:e,url:t,requestBodyValues:a}){if(N(e))return e;if(e instanceof TypeError&&Ut.includes(e.message.toLowerCase())){const r=e.cause;if(r!=null)return new v({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:a,isRetryable:!0})}return e}function Ke(e=globalThis){var t,a,r;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(r=(a=e.process)==null?void 0:a.versions)!=null&&r.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function qt(e){if(e==null)return{};const t={};if(e instanceof Headers)e.forEach((a,r)=>{t[r.toLowerCase()]=a});else{Array.isArray(e)||(e=Object.entries(e));for(const[a,r]of e)r!=null&&(t[a.toLowerCase()]=r)}return t}function le(e,...t){const a=new Headers(qt(e)),r=a.get("user-agent")||"";return a.set("user-agent",[r,...t].filter(Boolean).join(" ")),Object.fromEntries(a.entries())}var We="4.0.1",zt=()=>globalThis.fetch,me=async({url:e,headers:t={},successfulResponseHandler:a,failedResponseHandler:r,abortSignal:s,fetch:n=zt()})=>{try{const o=await n(e,{method:"GET",headers:le(t,`ai-sdk/provider-utils/${We}`,Ke()),signal:s}),i=U(o);if(!o.ok){let c;try{c=await r({response:o,url:e,requestBodyValues:{}})}catch(u){throw N(u)||v.isInstance(u)?u:new v({message:"Failed to process error response",cause:u,statusCode:o.status,url:e,responseHeaders:i,requestBodyValues:{}})}throw c.value}try{return await a({response:o,url:e,requestBodyValues:{}})}catch(c){throw c instanceof Error&&(N(c)||v.isInstance(c))?c:new v({message:"Failed to process successful response",cause:c,statusCode:o.status,url:e,responseHeaders:i,requestBodyValues:{}})}}catch(o){throw Ge({error:o,url:e,requestBodyValues:{}})}};function G({settingValue:e,environmentVariableName:t}){if(typeof e=="string"||!(e!=null||typeof process>"u")&&(e=process.env[t],!(e==null||typeof e!="string")))return e}var Gt=/"__proto__"\s*:/,Kt=/"constructor"\s*:/;function ge(e){const t=JSON.parse(e);return t===null||typeof t!="object"||Gt.test(e)===!1&&Kt.test(e)===!1?t:Wt(t)}function Wt(e){let t=[e];for(;t.length;){const a=t;t=[];for(const r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const s in r){const n=r[s];n&&typeof n=="object"&&t.push(n)}}}return e}function Ye(e){const{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return ge(e)}try{return ge(e)}finally{Error.stackTraceLimit=t}}function K(e){if(e.type==="object"){e.additionalProperties=!1;const t=e.properties;if(t!=null)for(const a in t)t[a]=K(t[a])}return e.type==="array"&&e.items!=null&&(Array.isArray(e.items)?e.items=e.items.map(t=>K(t)):e.items=K(e.items)),e}var Yt=Symbol("Let zodToJsonSchema decide on which parser to use"),ye={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Jt=e=>typeof e=="string"?{...ye,name:e}:{...ye,...e};function b(){return{}}function Qt(e,t){var a,r,s;const n={type:"array"};return(a=e.type)!=null&&a._def&&((s=(r=e.type)==null?void 0:r._def)==null?void 0:s.typeName)!==d.ZodAny&&(n.items=f(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(n.minItems=e.minLength.value),e.maxLength&&(n.maxItems=e.maxLength.value),e.exactLength&&(n.minItems=e.exactLength.value,n.maxItems=e.exactLength.value),n}function Xt(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"min":a.inclusive?t.minimum=a.value:t.exclusiveMinimum=a.value;break;case"max":a.inclusive?t.maximum=a.value:t.exclusiveMaximum=a.value;break;case"multipleOf":t.multipleOf=a.value;break}return t}function ea(){return{type:"boolean"}}function Je(e,t){return f(e.type._def,t)}var ta=(e,t)=>f(e.innerType._def,t);function Qe(e,t,a){const r=a??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>Qe(e,t,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return aa(e)}}var aa=e=>{const t={type:"integer",format:"unix-time"};for(const a of e.checks)switch(a.kind){case"min":t.minimum=a.value;break;case"max":t.maximum=a.value;break}return t};function ra(e,t){return{...f(e.innerType._def,t),default:e.defaultValue()}}function sa(e,t){return t.effectStrategy==="input"?f(e.schema._def,t):b()}function na(e){return{type:"string",enum:Array.from(e.values)}}var oa=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function ia(e,t){const a=[f(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),f(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(oa(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:o,...i}=s;n=i}r.push(n)}}),r.length?{allOf:r}:void 0}function ca(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}var te=void 0,A={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(te===void 0&&(te=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),te),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Xe(e,t){const a={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(t.emailStrategy){case"format:email":_(a,"email",r.message,t);break;case"format:idn-email":_(a,"idn-email",r.message,t);break;case"pattern:zod":y(a,A.email,r.message,t);break}break;case"url":_(a,"uri",r.message,t);break;case"uuid":_(a,"uuid",r.message,t);break;case"regex":y(a,r.regex,r.message,t);break;case"cuid":y(a,A.cuid,r.message,t);break;case"cuid2":y(a,A.cuid2,r.message,t);break;case"startsWith":y(a,RegExp(`^${ae(r.value,t)}`),r.message,t);break;case"endsWith":y(a,RegExp(`${ae(r.value,t)}$`),r.message,t);break;case"datetime":_(a,"date-time",r.message,t);break;case"date":_(a,"date",r.message,t);break;case"time":_(a,"time",r.message,t);break;case"duration":_(a,"duration",r.message,t);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":{y(a,RegExp(ae(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&_(a,"ipv4",r.message,t),r.version!=="v4"&&_(a,"ipv6",r.message,t);break}case"base64url":y(a,A.base64url,r.message,t);break;case"jwt":y(a,A.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&y(a,A.ipv4Cidr,r.message,t),r.version!=="v4"&&y(a,A.ipv6Cidr,r.message,t);break}case"emoji":y(a,A.emoji(),r.message,t);break;case"ulid":{y(a,A.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{_(a,"binary",r.message,t);break}case"contentEncoding:base64":{a.contentEncoding="base64";break}case"pattern:zod":{y(a,A.base64,r.message,t);break}}break}case"nanoid":y(a,A.nanoid,r.message,t)}return a}function ae(e,t){return t.patternStrategy==="escape"?da(e):e}var ua=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function da(e){let t="";for(let a=0;a<e.length;a++)ua.has(e[a])||(t+="\\"),t+=e[a];return t}function _(e,t,a,r){var s;e.format||(s=e.anyOf)!=null&&s.some(n=>n.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...a&&r.errorMessages&&{errorMessage:{format:a}}})):e.format=t}function y(e,t,a,r){var s;e.pattern||(s=e.allOf)!=null&&s.some(n=>n.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:ve(t,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):e.pattern=ve(t,r)}function ve(e,t){var a;if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},s=r.i?e.source.toLowerCase():e.source;let n="",o=!1,i=!1,c=!1;for(let u=0;u<s.length;u++){if(o){n+=s[u],o=!1;continue}if(r.i){if(i){if(s[u].match(/[a-z]/)){c?(n+=s[u],n+=`${s[u-2]}-${s[u]}`.toUpperCase(),c=!1):s[u+1]==="-"&&(a=s[u+2])!=null&&a.match(/[a-z]/)?(n+=s[u],c=!0):n+=`${s[u]}${s[u].toUpperCase()}`;continue}}else if(s[u].match(/[a-z]/)){n+=`[${s[u]}${s[u].toUpperCase()}]`;continue}}if(r.m){if(s[u]==="^"){n+=`(^|(?<=[\r
]))`;continue}else if(s[u]==="$"){n+=`($|(?=[\r
]))`;continue}}if(r.s&&s[u]==="."){n+=i?`${s[u]}\r
`:`[${s[u]}\r
]`;continue}n+=s[u],s[u]==="\\"?o=!0:i&&s[u]==="]"?i=!1:!i&&s[u]==="["&&(i=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function et(e,t){var a,r,s,n,o,i;const c={type:"object",additionalProperties:(a=f(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))!=null?a:t.allowedAdditionalProperties};if(((r=e.keyType)==null?void 0:r._def.typeName)===d.ZodString&&(s=e.keyType._def.checks)!=null&&s.length){const{type:u,...l}=Xe(e.keyType._def,t);return{...c,propertyNames:l}}else{if(((n=e.keyType)==null?void 0:n._def.typeName)===d.ZodEnum)return{...c,propertyNames:{enum:e.keyType._def.values}};if(((o=e.keyType)==null?void 0:o._def.typeName)===d.ZodBranded&&e.keyType._def.type._def.typeName===d.ZodString&&(i=e.keyType._def.type._def.checks)!=null&&i.length){const{type:u,...l}=Je(e.keyType._def,t);return{...c,propertyNames:l}}}return c}function la(e,t){if(t.mapStrategy==="record")return et(e,t);const a=f(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||b(),r=f(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||b();return{type:"array",maxItems:125,items:{type:"array",items:[a,r],minItems:2,maxItems:2}}}function fa(e){const t=e.values,a=Object.keys(e.values).filter(s=>typeof t[t[s]]!="number").map(s=>t[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function pa(){return{not:b()}}function ha(){return{type:"null"}}var oe={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ma(e,t){const a=e.options instanceof Map?Array.from(e.options.values()):e.options;if(a.every(r=>r._def.typeName in oe&&(!r._def.checks||!r._def.checks.length))){const r=a.reduce((s,n)=>{const o=oe[n._def.typeName];return o&&!s.includes(o)?[...s,o]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=a.reduce((s,n)=>{const o=typeof n._def.value;switch(o){case"string":case"number":case"boolean":return[...s,o];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];default:return s}},[]);if(r.length===a.length){const s=r.filter((n,o,i)=>i.indexOf(n)===o);return{type:s.length>1?s:s[0],enum:a.reduce((n,o)=>n.includes(o._def.value)?n:[...n,o._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return ga(e,t)}var ga=(e,t)=>{const a=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,s)=>f(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function ya(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[oe[e.innerType._def.typeName],"null"]};const a=f(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function va(e){const t={type:"number"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"int":t.type="integer";break;case"min":a.inclusive?t.minimum=a.value:t.exclusiveMinimum=a.value;break;case"max":a.inclusive?t.maximum=a.value:t.exclusiveMaximum=a.value;break;case"multipleOf":t.multipleOf=a.value;break}return t}function wa(e,t){const a={type:"object",properties:{}},r=[],s=e.shape();for(const o in s){let i=s[o];if(i===void 0||i._def===void 0)continue;const c=Ia(i),u=f(i._def,{...t,currentPath:[...t.currentPath,"properties",o],propertyPath:[...t.currentPath,"properties",o]});u!==void 0&&(a.properties[o]=u,c||r.push(o))}r.length&&(a.required=r);const n=ba(e,t);return n!==void 0&&(a.additionalProperties=n),a}function ba(e,t){if(e.catchall._def.typeName!=="ZodNever")return f(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function Ia(e){try{return e.isOptional()}catch{return!0}}var Pa=(e,t)=>{var a;if(t.currentPath.toString()===((a=t.propertyPath)==null?void 0:a.toString()))return f(e.innerType._def,t);const r=f(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:b()},r]}:b()},Aa=(e,t)=>{if(t.pipeStrategy==="input")return f(e.in._def,t);if(t.pipeStrategy==="output")return f(e.out._def,t);const a=f(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=f(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",a?"1":"0"]});return{allOf:[a,r].filter(s=>s!==void 0)}};function _a(e,t){return f(e.type._def,t)}function ka(e,t){const a={type:"array",uniqueItems:!0,items:f(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(a.minItems=e.minSize.value),e.maxSize&&(a.maxItems=e.maxSize.value),a}function Sa(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((a,r)=>f(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:f(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((a,r)=>f(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function Ca(){return{not:b()}}function Ea(){return b()}var Ma=(e,t)=>f(e.innerType._def,t),xa=(e,t,a)=>{switch(t){case d.ZodString:return Xe(e,a);case d.ZodNumber:return va(e);case d.ZodObject:return wa(e,a);case d.ZodBigInt:return Xt(e);case d.ZodBoolean:return ea();case d.ZodDate:return Qe(e,a);case d.ZodUndefined:return Ca();case d.ZodNull:return ha();case d.ZodArray:return Qt(e,a);case d.ZodUnion:case d.ZodDiscriminatedUnion:return ma(e,a);case d.ZodIntersection:return ia(e,a);case d.ZodTuple:return Sa(e,a);case d.ZodRecord:return et(e,a);case d.ZodLiteral:return ca(e);case d.ZodEnum:return na(e);case d.ZodNativeEnum:return fa(e);case d.ZodNullable:return ya(e,a);case d.ZodOptional:return Pa(e,a);case d.ZodMap:return la(e,a);case d.ZodSet:return ka(e,a);case d.ZodLazy:return()=>e.getter()._def;case d.ZodPromise:return _a(e,a);case d.ZodNaN:case d.ZodNever:return pa();case d.ZodEffects:return sa(e,a);case d.ZodAny:return b();case d.ZodUnknown:return Ea();case d.ZodDefault:return ra(e,a);case d.ZodBranded:return Je(e,a);case d.ZodReadonly:return Ma(e,a);case d.ZodCatch:return ta(e,a);case d.ZodPipeline:return Aa(e,a);case d.ZodFunction:case d.ZodVoid:case d.ZodSymbol:return;default:return(r=>{})()}},Ta=(e,t)=>{let a=0;for(;a<e.length&&a<t.length&&e[a]===t[a];a++);return[(e.length-a).toString(),...t.slice(a)].join("/")};function f(e,t,a=!1){var r;const s=t.seen.get(e);if(t.override){const c=(r=t.override)==null?void 0:r.call(t,e,t,s,a);if(c!==Yt)return c}if(s&&!a){const c=$a(s,t);if(c!==void 0)return c}const n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);const o=xa(e,e.typeName,t),i=typeof o=="function"?f(o(),t):o;if(i&&Oa(e,t,i),t.postProcess){const c=t.postProcess(i,e,t);return n.jsonSchema=i,c}return n.jsonSchema=i,i}var $a=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Ta(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((a,r)=>t.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),b()):t.$refStrategy==="seen"?b():void 0}},Oa=(e,t,a)=>(e.description&&(a.description=e.description),a),Ra=e=>{const t=Jt(e),a=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}},Za=(e,t)=>{var a;const r=Ra(t);let s=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[l,g])=>{var E;return{...u,[l]:(E=f(g._def,{...r,currentPath:[...r.basePath,r.definitionPath,l]},!0))!=null?E:b()}},{}):void 0;const n=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,o=(a=f(e._def,n===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1))!=null?a:b(),i=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;i!==void 0&&(o.title=i);const c=n===void 0?s?{...o,[r.definitionPath]:s}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...s,[n]:o}};return c.$schema="http://json-schema.org/draft-07/schema#",c},ie=Symbol.for("vercel.ai.schema");function Z(e){let t;return()=>(t==null&&(t=e()),t)}function ee(e,{validate:t}={}){return{[ie]:!0,_type:void 0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}function ja(e){return typeof e=="object"&&e!==null&&ie in e&&e[ie]===!0&&"jsonSchema"in e&&"validate"in e}function Ha(e){return e==null?ee({properties:{},additionalProperties:!1}):ja(e)?e:"~standard"in e?e["~standard"].vendor==="zod"?T(e):La(e):e()}function La(e){return ee(()=>e["~standard"].jsonSchema.input({target:"draft-07"}),{validate:async t=>{const a=await e["~standard"].validate(t);return"value"in a?{success:!0,value:a.value}:{success:!1,error:new F({value:t,cause:a.issues})}}})}function Va(e,t){var a;const r=(a=void 0)!=null?a:!1;return ee(()=>Za(e,{$refStrategy:r?"root":"none"}),{validate:async s=>{const n=await e.safeParseAsync(s);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function Fa(e,t){var a;const r=(a=void 0)!=null?a:!1;return ee(()=>K(Ft(e,{target:"draft-7",io:"input",reused:r?"ref":"inline"})),{validate:async s=>{const n=await Vt(e,s);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function Na(e){return"_zod"in e}function T(e,t){return Na(e)?Fa(e):Va(e)}async function Da({value:e,schema:t}){const a=await D({value:e,schema:t});if(!a.success)throw F.wrap({value:e,cause:a.error});return a.value}async function D({value:e,schema:t}){const a=Ha(t);try{if(a.validate==null)return{success:!0,value:e,rawValue:e};const r=await a.validate(e);return r.success?{success:!0,value:r.value,rawValue:e}:{success:!1,error:F.wrap({value:e,cause:r.error}),rawValue:e}}catch(r){return{success:!1,error:F.wrap({value:e,cause:r}),rawValue:e}}}async function Ba({text:e,schema:t}){try{const a=Ye(e);return t==null?a:Da({value:a,schema:t})}catch(a){throw W.isInstance(a)||F.isInstance(a)?a:new W({text:e,cause:a})}}async function tt({text:e,schema:t}){try{const a=Ye(e);return t==null?{success:!0,value:a,rawValue:a}:await D({value:a,schema:t})}catch(a){return{success:!1,error:W.isInstance(a)?a:new W({text:e,cause:a}),rawValue:void 0}}}function Ua({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new Lt).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await tt({text:a,schema:t}))}}))}var qa=()=>globalThis.fetch,X=async({url:e,headers:t,body:a,failedResponseHandler:r,successfulResponseHandler:s,abortSignal:n,fetch:o})=>za({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(a),values:a},failedResponseHandler:r,successfulResponseHandler:s,abortSignal:n,fetch:o}),za=async({url:e,headers:t={},body:a,successfulResponseHandler:r,failedResponseHandler:s,abortSignal:n,fetch:o=qa()})=>{try{const i=await o(e,{method:"POST",headers:le(t,`ai-sdk/provider-utils/${We}`,Ke()),body:a.content,signal:n}),c=U(i);if(!i.ok){let u;try{u=await s({response:i,url:e,requestBodyValues:a.values})}catch(l){throw N(l)||v.isInstance(l)?l:new v({message:"Failed to process error response",cause:l,statusCode:i.status,url:e,responseHeaders:c,requestBodyValues:a.values})}throw u.value}try{return await r({response:i,url:e,requestBodyValues:a.values})}catch(u){throw u instanceof Error&&(N(u)||v.isInstance(u))?u:new v({message:"Failed to process successful response",cause:u,statusCode:i.status,url:e,responseHeaders:c,requestBodyValues:a.values})}}catch(i){throw Ge({error:i,url:e,requestBodyValues:a.values})}};async function S(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}var O=({errorSchema:e,errorToMessage:t,isRetryable:a})=>async({response:r,url:s,requestBodyValues:n})=>{const o=await r.text(),i=U(r);if(o.trim()==="")return{responseHeaders:i,value:new v({message:r.statusText,url:s,requestBodyValues:n,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:a?.(r)})};try{const c=await Ba({text:o,schema:e});return{responseHeaders:i,value:new v({message:t(c),url:s,requestBodyValues:n,statusCode:r.status,responseHeaders:i,responseBody:o,data:c,isRetryable:a?.(r,c)})}}catch{return{responseHeaders:i,value:new v({message:r.statusText,url:s,requestBodyValues:n,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:a?.(r)})}}},Ga=e=>async({response:t})=>{const a=U(t);if(t.body==null)throw new Ht({});return{responseHeaders:a,value:Ua({stream:t.body,schema:e})}},B=e=>async({response:t,url:a,requestBodyValues:r})=>{const s=await t.text(),n=await tt({text:s,schema:e}),o=U(t);if(!n.success)throw new v({message:"Invalid JSON response",cause:n.error,statusCode:t.status,responseHeaders:o,responseBody:s,url:a,requestBodyValues:r});return{responseHeaders:o,value:n.value,rawValue:n.rawValue}};function Ka(e){return e?.replace(/\/$/,"")}var Wa="vercel.ai.gateway.error",re=Symbol.for(Wa),we,be,I=class at extends(be=Error,we=re,be){constructor({message:t,statusCode:a=500,cause:r}){super(t),this[we]=!0,this.statusCode=a,this.cause=r}static isInstance(t){return at.hasMarker(t)}static hasMarker(t){return typeof t=="object"&&t!==null&&re in t&&t[re]===!0}},rt="GatewayAuthenticationError",Ya=`vercel.ai.gateway.error.${rt}`,Ie=Symbol.for(Ya),Pe,Ae,st=class nt extends(Ae=I,Pe=Ie,Ae){constructor({message:t="Authentication failed",statusCode:a=401,cause:r}={}){super({message:t,statusCode:a,cause:r}),this[Pe]=!0,this.name=rt,this.type="authentication_error"}static isInstance(t){return I.hasMarker(t)&&Ie in t}static createContextualError({apiKeyProvided:t,oidcTokenProvided:a,message:r="Authentication failed",statusCode:s=401,cause:n}){let o;return t?o=`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:a?o=`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:o=`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new nt({message:o,statusCode:s,cause:n})}},ot="GatewayInvalidRequestError",Ja=`vercel.ai.gateway.error.${ot}`,_e=Symbol.for(Ja),ke,Se,Qa=class extends(Se=I,ke=_e,Se){constructor({message:e="Invalid request",statusCode:t=400,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[ke]=!0,this.name=ot,this.type="invalid_request_error"}static isInstance(e){return I.hasMarker(e)&&_e in e}},it="GatewayRateLimitError",Xa=`vercel.ai.gateway.error.${it}`,Ce=Symbol.for(Xa),Ee,Me,er=class extends(Me=I,Ee=Ce,Me){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[Ee]=!0,this.name=it,this.type="rate_limit_exceeded"}static isInstance(e){return I.hasMarker(e)&&Ce in e}},ct="GatewayModelNotFoundError",tr=`vercel.ai.gateway.error.${ct}`,xe=Symbol.for(tr),ar=Z(()=>T(m({modelId:p()}))),Te,$e,rr=class extends($e=I,Te=xe,$e){constructor({message:e="Model not found",statusCode:t=404,modelId:a,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[Te]=!0,this.name=ct,this.type="model_not_found",this.modelId=a}static isInstance(e){return I.hasMarker(e)&&xe in e}},ut="GatewayInternalServerError",sr=`vercel.ai.gateway.error.${ut}`,Oe=Symbol.for(sr),Re,Ze,je=class extends(Ze=I,Re=Oe,Ze){constructor({message:e="Internal server error",statusCode:t=500,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[Re]=!0,this.name=ut,this.type="internal_server_error"}static isInstance(e){return I.hasMarker(e)&&Oe in e}},dt="GatewayResponseError",nr=`vercel.ai.gateway.error.${dt}`,He=Symbol.for(nr),Le,Ve,or=class extends(Ve=I,Le=He,Ve){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:a,validationError:r,cause:s}={}){super({message:e,statusCode:t,cause:s}),this[Le]=!0,this.name=dt,this.type="response_error",this.response=a,this.validationError=r}static isInstance(e){return I.hasMarker(e)&&He in e}};async function Fe({response:e,statusCode:t,defaultMessage:a="Gateway request failed",cause:r,authMethod:s}){const n=await D({value:e,schema:ir});if(!n.success)return new or({message:`Invalid error response format: ${a}`,statusCode:t,response:e,validationError:n.error,cause:r});const o=n.value,i=o.error.type,c=o.error.message;switch(i){case"authentication_error":return st.createContextualError({apiKeyProvided:s==="api-key",oidcTokenProvided:s==="oidc",statusCode:t,cause:r});case"invalid_request_error":return new Qa({message:c,statusCode:t,cause:r});case"rate_limit_exceeded":return new er({message:c,statusCode:t,cause:r});case"model_not_found":{const u=await D({value:o.error.param,schema:ar});return new rr({message:c,statusCode:t,modelId:u.success?u.value.modelId:void 0,cause:r})}case"internal_server_error":return new je({message:c,statusCode:t,cause:r});default:return new je({message:c,statusCode:t,cause:r})}}var ir=Z(()=>T(m({error:m({message:p(),type:p().nullish(),param:J().nullish(),code:qe([p(),se()]).nullish()})})));function x(e,t){var a;return I.isInstance(e)?e:v.isInstance(e)?Fe({response:cr(e),statusCode:(a=e.statusCode)!=null?a:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):Fe({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}function cr(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var lt="ai-gateway-auth-method";async function R(e){const t=await D({value:e[lt],schema:ur});return t.success?t.value:void 0}var ur=Z(()=>T(qe([Y("api-key"),Y("oidc")]))),Ne=class{constructor(e){this.config=e}async getAvailableModels(){try{const{value:e}=await me({url:`${this.config.baseURL}/config`,headers:await S(this.config.headers()),successfulResponseHandler:B(dr),failedResponseHandler:O({errorSchema:M(),errorToMessage:t=>t}),fetch:this.config.fetch});return e}catch(e){throw await x(e)}}async getCredits(){try{const e=new URL(this.config.baseURL),{value:t}=await me({url:`${e.origin}/v1/credits`,headers:await S(this.config.headers()),successfulResponseHandler:B(lr),failedResponseHandler:O({errorSchema:M(),errorToMessage:a=>a}),fetch:this.config.fetch});return t}catch(e){throw await x(e)}}},dr=Z(()=>T(m({models:$(m({id:p(),name:p(),description:p().nullish(),pricing:m({input:p(),output:p(),input_cache_read:p().nullish(),input_cache_write:p().nullish()}).transform(({input:e,output:t,input_cache_read:a,input_cache_write:r})=>({input:e,output:t,...a?{cachedInputTokens:a}:{},...r?{cacheCreationInputTokens:r}:{}})).nullish(),specification:m({specificationVersion:Y("v3"),provider:p(),modelId:p()}),modelType:Be(["language","embedding","image"]).nullish()}))}))),lr=Z(()=>T(m({balance:p(),total_used:p()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),fr=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){const{abortSignal:t,...a}=e;return{args:this.maybeEncodeFileParts(a),warnings:[]}}async doGenerate(e){const{args:t,warnings:a}=await this.getArgs(e),{abortSignal:r}=e,s=await S(this.config.headers());try{const{responseHeaders:n,value:o,rawValue:i}=await X({url:this.getUrl(),headers:Q(s,e.headers,this.getModelConfigHeaders(this.modelId,!1),await S(this.config.o11yHeaders)),body:t,successfulResponseHandler:B(M()),failedResponseHandler:O({errorSchema:M(),errorToMessage:c=>c}),...r&&{abortSignal:r},fetch:this.config.fetch});return{...o,request:{body:t},response:{headers:n,body:i},warnings:a}}catch(n){throw await x(n,await R(s))}}async doStream(e){const{args:t,warnings:a}=await this.getArgs(e),{abortSignal:r}=e,s=await S(this.config.headers());try{const{value:n,responseHeaders:o}=await X({url:this.getUrl(),headers:Q(s,e.headers,this.getModelConfigHeaders(this.modelId,!0),await S(this.config.o11yHeaders)),body:t,successfulResponseHandler:Ga(M()),failedResponseHandler:O({errorSchema:M(),errorToMessage:i=>i}),...r&&{abortSignal:r},fetch:this.config.fetch});return{stream:n.pipeThrough(new TransformStream({start(i){a.length>0&&i.enqueue({type:"stream-start",warnings:a})},transform(i,c){if(i.success){const u=i.value;if(u.type==="raw"&&!e.includeRawChunks)return;u.type==="response-metadata"&&u.timestamp&&typeof u.timestamp=="string"&&(u.timestamp=new Date(u.timestamp)),c.enqueue(u)}else c.error(i.error)}})),request:{body:t},response:{headers:o}}}catch(n){throw await x(n,await R(s))}}isFilePart(e){return e&&typeof e=="object"&&"type"in e&&e.type==="file"}maybeEncodeFileParts(e){for(const t of e.prompt)for(const a of t.content)if(this.isFilePart(a)){const r=a;if(r.data instanceof Uint8Array){const s=Uint8Array.from(r.data),n=Buffer.from(s).toString("base64");r.data=new URL(`data:${r.mediaType||"application/octet-stream"};base64,${n}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},pr=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:a,providerOptions:r}){var s;const n=await S(this.config.headers());try{const{responseHeaders:o,value:i,rawValue:c}=await X({url:this.getUrl(),headers:Q(n,t??{},this.getModelConfigHeaders(),await S(this.config.o11yHeaders)),body:{values:e,...r?{providerOptions:r}:{}},successfulResponseHandler:B(hr),failedResponseHandler:O({errorSchema:M(),errorToMessage:u=>u}),...a&&{abortSignal:a},fetch:this.config.fetch});return{embeddings:i.embeddings,usage:(s=i.usage)!=null?s:void 0,providerMetadata:i.providerMetadata,response:{headers:o,body:c},warnings:[]}}catch(o){throw await x(o,await R(n))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},hr=Z(()=>T(m({embeddings:$($(se())),usage:m({tokens:se()}).nullish(),providerMetadata:ne(p(),ne(p(),J())).optional()}))),mr=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.maxImagesPerCall=Number.MAX_SAFE_INTEGER}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:a,aspectRatio:r,seed:s,providerOptions:n,headers:o,abortSignal:i}){var c;const u=await S(this.config.headers());try{const{responseHeaders:l,value:g,rawValue:E}=await X({url:this.getUrl(),headers:Q(u,o??{},this.getModelConfigHeaders(),await S(this.config.o11yHeaders)),body:{prompt:e,n:t,...a&&{size:a},...r&&{aspectRatio:r},...s&&{seed:s},...n&&{providerOptions:n}},successfulResponseHandler:B(yr),failedResponseHandler:O({errorSchema:M(),errorToMessage:w=>w}),...i&&{abortSignal:i},fetch:this.config.fetch});return{images:g.images,warnings:(c=g.warnings)!=null?c:[],providerMetadata:g.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:l}}}catch(l){throw x(l,await R(u))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":"2","ai-model-id":this.modelId}}},gr=m({images:$(J()).optional()}).catchall(J()),yr=m({images:$(p()),warnings:$(m({type:Y("other"),message:p()})).optional(),providerMetadata:ne(p(),gr).optional()});async function vr(){var e;return(e=Ue.getContext().headers)==null?void 0:e["x-vercel-id"]}var wr="3.0.2",br="0.0.1";function Ir(e={}){var t,a;let r=null,s=null;const n=(t=e.metadataCacheRefreshMillis)!=null?t:1e3*60*5;let o=0;const i=(a=Ka(e.baseURL))!=null?a:"https://ai-gateway.vercel.sh/v3/ai",c=async()=>{const h=await Ar(e);if(h)return le({Authorization:`Bearer ${h.token}`,"ai-gateway-protocol-version":br,[lt]:h.authMethod,...e.headers},`ai-sdk/gateway/${wr}`);throw st.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},u=()=>{const h=G({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),H=G({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),L=G({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const V=await vr();return{...h&&{"ai-o11y-deployment-id":h},...H&&{"ai-o11y-environment":H},...L&&{"ai-o11y-region":L},...V&&{"ai-o11y-request-id":V}}}},l=h=>new fr(h,{provider:"gateway",baseURL:i,headers:c,fetch:e.fetch,o11yHeaders:u()}),g=async()=>{var h,H,L;const V=(L=(H=(h=e._internal)==null?void 0:h.currentDate)==null?void 0:H.call(h).getTime())!=null?L:Date.now();return(!r||V-o>n)&&(o=V,r=new Ne({baseURL:i,headers:c,fetch:e.fetch}).getAvailableModels().then(z=>(s=z,z)).catch(async z=>{throw await x(z,await R(await c()))})),s?Promise.resolve(s):r},E=async()=>new Ne({baseURL:i,headers:c,fetch:e.fetch}).getCredits().catch(async h=>{throw await x(h,await R(await c()))}),w=function(h){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return l(h)};w.specificationVersion="v3",w.getAvailableModels=g,w.getCredits=E,w.imageModel=h=>new mr(h,{provider:"gateway",baseURL:i,headers:c,fetch:e.fetch,o11yHeaders:u()}),w.languageModel=l;const q=h=>new pr(h,{provider:"gateway",baseURL:i,headers:c,fetch:e.fetch,o11yHeaders:u()});return w.embeddingModel=q,w.textEmbeddingModel=q,w}var Pr=Ir();async function Ar(e){const t=G({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{return{token:await Ue.getVercelOidcToken(),authMethod:"oidc"}}catch{return null}}const _r=async e=>{const t=await Tt(e),a=Pr(t.id),r=[];return t.reasoning&&t.owned_by==="xai"&&(console.log("Wrapping reasoning middleware for",t.id),r.push($t({tagName:"think"}))),r.length===0?a:Ot({model:a,middleware:r})};function kr(e,t){const a=new Map;for(const s of e)a.set(s.id,ue());const r=[];for(const s of e){const n=a.get(s.id);if(!n)throw new Error(`Message ID ${s.id} not found in mapping`);let o=null;if(s.parentMessageId){const c=a.get(s.parentMessageId);if(!c)throw new Error(`Parent message ID ${s.parentMessageId} not found in mapping`);o=c}const i={...s,id:n,chatId:t,parentMessageId:o};r.push(i)}return r}function Sr(e){const t=new Map;for(const a of e)t.set(a.id,ue());return t}function fe(e,t){const a=t.get(e);if(!a)throw new Error(`Document ID ${e} not found in mapping`);return a}function Cr(e,t){if(e.type!=="tool-deepResearch"||e.state!=="output-available"||e.output?.format!=="report"||e.output.status!=="success")return e;const a=e.output.documentId,r=fe(a,t);return{...e,output:{...e.output,documentId:r}}}function ft(e){return e.type==="tool-editTextDocument"||e.type==="tool-editCodeDocument"||e.type==="tool-editSheetDocument"}function pt(e){return e.type==="tool-createTextDocument"||e.type==="tool-createCodeDocument"||e.type==="tool-createSheetDocument"}function Er(e,t){if(!ft(e)||e.state!=="output-available"||e.output.status!=="success")return e;const a=e.output.documentId,r=fe(a,t);return{...e,output:{...e.output,documentId:r}}}function Mr(e,t){if(!pt(e)||e.state!=="output-available"||e.output.status!=="success")return e;const a=e.output.documentId,r=fe(a,t);return{...e,output:{...e.output,documentId:r}}}function xr(e,t){return e.type==="tool-deepResearch"?Cr(e,t):ft(e)?Er(e,t):pt(e)?Mr(e,t):e}function Tr(e,t){return e.map(a=>{const r=a.parts;let s=[];return Array.isArray(r)&&(s=r.map(n=>xr(n,t))),{...a,parts:s}})}function $r(e,t,a,r){const s=[];for(const n of e){const o=t.get(n.id),i=a.get(n.messageId);if(!o)throw new Error(`Document ID ${n.id} not found in mapping`);if(!i)throw new Error(`Message ID ${n.messageId} not found in mapping`);const c={...n,id:o,messageId:i,userId:r};s.push(c)}return s}async function Or(e){try{if(!e.url)return console.warn("Attachment has no URL, skipping clone"),e;if(!Rr(e.url))return console.warn("Attachment is not managed by local file storage, skipping clone:",e.url),e;const t=await fetch(Zr(e.url));if(!t.ok)throw new Error(`Failed to fetch attachment: ${t.statusText}`);const a=await t.blob();let r=e.filename||"attachment";r.includes("/")&&(r=r.split("/").pop()||"attachment"),r.startsWith(he)&&(r=r.replace(he,""));const s=await jt(r,Buffer.from(await a.arrayBuffer()),{contentType:a.type||void 0});return{...e,url:s.url}}catch(t){return console.error("Failed to clone attachment:",t),e}}function Rr(e){if(e.startsWith("/api/files/")||e.includes("blob.vercel-storage.com"))return!0;try{return new URL(e).pathname.startsWith("/api/files/")}catch{return!1}}function Zr(e){return e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?new URL(e,jr()).toString():e}function jr(){return process.env.APP_URL?.trim()||"http://localhost:5173"}async function Hr(e){const t=[];for(const a of e)if(a.parts&&Array.isArray(a.parts)){const r=[];for(const n of a.parts)if(n.type==="file"){const o=await Or(n);r.push(o)}else r.push(n);const s={...a,parts:r};t.push(s)}else t.push(a);return t}function Lr(e,t,a,r){const s=kr(e,a),n=new Map;for(let l=0;l<e.length;l++)n.set(e[l].id,s[l].id);const o=s.map((l,g)=>{const E=e[g].metadata?.parentMessageId??null;if(E===null)return l.metadata?{...l,metadata:{...l.metadata,parentMessageId:null}}:l;const w=n.get(E);if(!w)throw new Error(`Parent message ID ${E} from metadata not found in mapping`);const q=l.metadata??{parentMessageId:null};return{...l,metadata:{...q,parentMessageId:w}}}),i=Sr(t),c=Tr(o,i),u=$r(t,i,n,r);return{clonedMessages:c,clonedDocuments:u,messageIdMap:n,documentIdMap:i}}const Vr=5e4,Fr=Vr*3,Nr=m({projectId:Rt().optional().nullable()}).optional(),j=m({chatId:p().uuid()}),Dr=m({chatId:p().uuid(),title:p().min(1).max(255)}),ht=m({messageId:p().uuid()}),Br=m({chatId:p().uuid(),visibility:Be(["private","public"])}),Ur=m({chatId:p().uuid(),isPinned:Zt()}),qr=m({message:p().min(1).max(Fr)});function pe(e){return{...e,createdAt:e.createdAt instanceof Date?e.createdAt.toISOString():e.createdAt,updatedAt:e.updatedAt instanceof Date?e.updatedAt.toISOString():e.updatedAt}}function mt(e){return{...e,metadata:{...e.metadata,createdAt:e.metadata.createdAt instanceof Date?e.metadata.createdAt.toISOString():e.metadata.createdAt}}}async function C(){const e=(await Mt.api.getSession({headers:xt.request.headers}))?.user?.id;if(!e)throw new Error("UNAUTHORIZED");return e}async function zr(e){const t=Nr.parse(e),a=await C(),r=await _t({id:a,projectId:t?.projectId});return r.sort((s,n)=>s.isPinned&&!n.isPinned?-1:!s.isPinned&&n.isPinned?1:new Date(n.updatedAt).getTime()-new Date(s.updatedAt).getTime()),r.map(s=>pe(de(s)))}async function Gr(e){const t=j.parse(e),a=await C(),r=await k({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found");return pe(de(r))}async function Kr(e){const t=j.parse(e),a=await C(),r=await k({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found");return(await ce({chatId:t.chatId})).map(mt)}async function Wr(e){const t=Dr.parse(e),a=await C(),r=await k({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found or access denied");await kt({chatId:t.chatId,title:t.title})}async function Yr(e){const t=ht.parse(e),a=await C(),[r]=await De({id:t.messageId});if(!r)throw new Error("Message not found");const s=await k({id:r.chatId});if(!s||s.userId!==a)throw new Error("Access denied");await It({chatId:r.chatId,messageId:t.messageId})}async function Jr(e){const t=ht.parse(e),a=await C(),[r]=await De({id:t.messageId});if(!r)throw new Error("Message not found");const s=await k({id:r.chatId});if(!s||s.userId!==a)throw new Error("Chat not found or access denied");return await Et({messageId:t.messageId,canceledAt:new Date}),{success:!0}}async function Qr(e){const t=Br.parse(e),a=await C(),r=await k({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found or access denied");return await Ct({chatId:t.chatId,visibility:t.visibility}),{success:!0}}async function Xr(e){const t=Ur.parse(e),a=await C(),r=await k({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found or access denied");return await St({chatId:t.chatId,isPinned:t.isPinned}),{success:!0}}async function es(e){const t=j.parse(e),a=await C(),r=await k({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found or access denied");return await bt({id:t.chatId}),{success:!0}}async function ts(e){const t=qr.parse(e),{text:a}=await Pt({model:await _r(At.models.defaults.title),system:`

        - you will generate a short title based on the first message a user begins a conversation with
        - ensure it is not more than 80 characters long
        - the title should be a summary of the user's message
        - do not use quotes or colons`,prompt:t.message,experimental_telemetry:{isEnabled:!0}});return{title:a}}async function as(e){const t=j.parse(e),a=await k({id:t.chatId});if(!a||a.visibility!=="public")throw new Error("Public chat not found");return pe(de(a))}async function rs(e){const t=j.parse(e),a=await k({id:t.chatId});if(!a||a.visibility!=="public")throw new Error("Public chat not found");return(await ce({chatId:t.chatId})).map(mt)}async function ss(e){const t=j.parse(e),a=await C(),r=await k({id:t.chatId});if(!r||r.visibility!=="public")throw new Error("Public chat not found");const s=await ce({chatId:t.chatId});if(s.length===0)throw new Error("Source chat has no messages to copy");const n=s.map(g=>g.id),o=await gt({messageIds:n}),i=ue();await yt({id:i,userId:a,title:`${r.title}`});const{clonedMessages:c,clonedDocuments:u}=Lr(s.map(g=>({...g,chatId:t.chatId})),o,i,a),l=await Hr(c);return await vt({messages:l.map(g=>({id:g.id,chatId:i,message:g}))}),u.length>0&&await wt({documents:u}),{chatId:i}}P(zr,"/src/server/actions/chat.ts","getAllChats");P(Gr,"/src/server/actions/chat.ts","getChatById");P(Kr,"/src/server/actions/chat.ts","getChatMessages");P(Wr,"/src/server/actions/chat.ts","renameChat");P(Yr,"/src/server/actions/chat.ts","deleteTrailingMessages");P(Jr,"/src/server/actions/chat.ts","stopStream");P(Qr,"/src/server/actions/chat.ts","setVisibility");P(Xr,"/src/server/actions/chat.ts","setIsPinned");P(es,"/src/server/actions/chat.ts","deleteChat");P(ts,"/src/server/actions/chat.ts","generateTitle");P(as,"/src/server/actions/chat.ts","getPublicChat");P(rs,"/src/server/actions/chat.ts","getPublicChatMessages");P(ss,"/src/server/actions/chat.ts","cloneSharedChat");export{ss as cloneSharedChat,es as deleteChat,Yr as deleteTrailingMessages,ts as generateTitle,zr as getAllChats,Gr as getChatById,Kr as getChatMessages,as as getPublicChat,rs as getPublicChatMessages,Wr as renameChat,Xr as setIsPinned,Qr as setVisibility,Jr as stopStream};
//# sourceMappingURL=chat-DSVyH--d-Cxl3rIoc.mjs.map
