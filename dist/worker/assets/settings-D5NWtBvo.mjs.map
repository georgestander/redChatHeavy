{"version":3,"file":"settings-D5NWtBvo.mjs","sources":["../../../src/lib/schemas/settings.ts","../../../src/server/actions/settings.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const setModelEnabledInputSchema = z.object({\n  modelId: z.string(),\n  enabled: z.boolean(),\n});\n","\"use server\";\n\nimport { requestInfo } from \"rwsdk/worker\";\nimport { auth } from \"@/lib/auth\";\nimport {\n  getUserModelPreferences,\n  upsertUserModelPreference,\n} from \"@/lib/db/queries\";\nimport { setModelEnabledInputSchema } from \"@/lib/schemas/settings\";\n\nasync function requireUserId() {\n  const session = await auth.api.getSession({\n    headers: requestInfo.request.headers,\n  });\n  const userId = session?.user?.id;\n  if (!userId) {\n    throw new Error(\"UNAUTHORIZED\");\n  }\n  return userId;\n}\n\nfunction serializePreference<\n  T extends { createdAt: unknown; updatedAt: unknown },\n>(preference: T) {\n  return {\n    ...preference,\n    createdAt:\n      preference.createdAt instanceof Date\n        ? preference.createdAt.toISOString()\n        : preference.createdAt,\n    updatedAt:\n      preference.updatedAt instanceof Date\n        ? preference.updatedAt.toISOString()\n        : preference.updatedAt,\n  };\n}\n\nexport async function getModelPreferences() {\n  const userId = await requireUserId();\n  const preferences = await getUserModelPreferences({ userId });\n  return preferences.map((preference) => serializePreference(preference));\n}\n\nexport async function setModelEnabled(input: unknown) {\n  const userId = await requireUserId();\n  const parsed = setModelEnabledInputSchema.parse(input);\n\n  await upsertUserModelPreference({\n    userId,\n    modelId: parsed.modelId,\n    enabled: parsed.enabled,\n  });\n\n  return { success: true };\n}\n"],"names":["setModelEnabledInputSchema","z.object","z.string","z.boolean","requireUserId","userId","auth","requestInfo","serializePreference","preference","getModelPreferences","getUserModelPreferences","setModelEnabled","input","parsed","upsertUserModelPreference"],"mappings":"qoBAEO,MAAMA,EAA6BC,EAAS,CACjD,QAASC,EAAE,EACX,QAASC,EAAE,CACb,CAAC,ECKD,eAAeC,GAAgB,CAI7B,MAAMC,GAHU,MAAMC,EAAK,IAAI,WAAW,CACxC,QAASC,EAAY,QAAQ,OAAA,CAC9B,IACuB,MAAM,GAC9B,GAAI,CAACF,EACH,MAAM,IAAI,MAAM,cAAc,EAEhC,OAAOA,CACT,CAEA,SAASG,EAEPC,EAAe,CACf,MAAO,CACL,GAAGA,EACH,UACEA,EAAW,qBAAqB,KAC5BA,EAAW,UAAU,cACrBA,EAAW,UACjB,UACEA,EAAW,qBAAqB,KAC5BA,EAAW,UAAU,YAAA,EACrBA,EAAW,SAAA,CAErB,CAEA,eAAsBC,GAAsB,CAC1C,MAAML,EAAS,MAAMD,EAAA,EAErB,OADoB,MAAMO,EAAwB,CAAE,OAAAN,EAAQ,GACzC,IAAKI,GAAeD,EAAoBC,CAAU,CAAC,CACxE,CAEA,eAAsBG,EAAgBC,EAAgB,CACpD,MAAMR,EAAS,MAAMD,EAAA,EACfU,EAASd,EAA2B,MAAMa,CAAK,EAErD,aAAME,EAA0B,CAC9B,OAAAV,EACA,QAASS,EAAO,QAChB,QAASA,EAAO,OAAA,CACjB,EAEM,CAAE,QAAS,EAAA,CACpB"}