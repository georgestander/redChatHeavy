{"version":3,"file":"chat-DSVyH--d.mjs","sources":["../../../node_modules/.pnpm/@ai-sdk+devtools@0.0.1/node_modules/@ai-sdk/devtools/dist/index.js","../../../node_modules/.pnpm/@ai-sdk+provider-utils@4.0.1_zod@4.3.6/node_modules/@ai-sdk/provider-utils/dist/index.mjs","../../../node_modules/.pnpm/@ai-sdk+gateway@3.0.2_zod@4.3.6/node_modules/@ai-sdk/gateway/dist/index.mjs","../../../lib/ai/providers.ts","../../../lib/clone-messages.ts","../../../lib/limits/tokens.ts","../../../src/lib/schemas/chat.ts","../../../src/server/actions/chat.ts"],"sourcesContent":["// src/db.ts\nimport path from \"node:path\";\nimport fs from \"node:fs\";\nvar DB_DIR = path.join(process.cwd(), \".devtools\");\nvar DB_PATH = path.join(DB_DIR, \"generations.json\");\nvar DEVTOOLS_PORT = process.env.AI_SDK_DEVTOOLS_PORT ? parseInt(process.env.AI_SDK_DEVTOOLS_PORT) : 4983;\nvar notifyServer = (event) => {\n  notifyServerAsync(event);\n};\nvar notifyServerAsync = async (event) => {\n  try {\n    await fetch(`http://localhost:${DEVTOOLS_PORT}/api/notify`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ event, timestamp: Date.now() })\n    });\n  } catch {\n  }\n};\nvar ensureGitignore = () => {\n  const gitignorePath = path.join(process.cwd(), \".gitignore\");\n  if (!fs.existsSync(gitignorePath)) {\n    return;\n  }\n  const content = fs.readFileSync(gitignorePath, \"utf-8\");\n  const lines = content.split(\"\\n\");\n  const alreadyIgnored = lines.some(\n    (line) => line.trim() === \".devtools\" || line.trim() === \".devtools/\"\n  );\n  if (!alreadyIgnored) {\n    const newContent = content.endsWith(\"\\n\") ? `${content}.devtools\n` : `${content}\n.devtools\n`;\n    fs.writeFileSync(gitignorePath, newContent);\n  }\n};\nvar readDb = () => {\n  try {\n    if (fs.existsSync(DB_PATH)) {\n      const content = fs.readFileSync(DB_PATH, \"utf-8\");\n      return JSON.parse(content);\n    }\n  } catch {\n  }\n  return { runs: [], steps: [] };\n};\nvar writeDb = (db) => {\n  const isFirstRun = !fs.existsSync(DB_DIR);\n  if (isFirstRun) {\n    fs.mkdirSync(DB_DIR, { recursive: true });\n    ensureGitignore();\n  }\n  fs.writeFileSync(DB_PATH, JSON.stringify(db, null, 2));\n};\nvar dbCache = null;\nvar getDb = () => {\n  if (!dbCache) {\n    dbCache = readDb();\n  }\n  return dbCache;\n};\nvar saveDb = (db) => {\n  dbCache = db;\n  writeDb(db);\n};\nvar createRun = async (id) => {\n  const db = getDb();\n  const started_at = (/* @__PURE__ */ new Date()).toISOString();\n  const existing = db.runs.find((r) => r.id === id);\n  if (existing) {\n    return existing;\n  }\n  const run = { id, started_at };\n  db.runs.push(run);\n  saveDb(db);\n  notifyServer(\"run\");\n  return run;\n};\nvar createStep = async (step) => {\n  const db = getDb();\n  const newStep = {\n    ...step,\n    duration_ms: null,\n    output: null,\n    usage: null,\n    error: null,\n    raw_request: null,\n    raw_response: null,\n    raw_chunks: null\n  };\n  db.steps.push(newStep);\n  saveDb(db);\n  notifyServer(\"step\");\n};\nvar updateStepResult = async (stepId, result) => {\n  const db = getDb();\n  const step = db.steps.find((s) => s.id === stepId);\n  if (step) {\n    step.duration_ms = result.duration_ms;\n    step.output = result.output;\n    step.usage = result.usage;\n    step.error = result.error;\n    step.raw_request = result.raw_request ?? null;\n    step.raw_response = result.raw_response ?? null;\n    step.raw_chunks = result.raw_chunks ?? null;\n    saveDb(db);\n    notifyServer(\"step-update\");\n  }\n};\n\n// src/middleware.ts\nvar generateId = () => crypto.randomUUID();\nvar activeSteps = /* @__PURE__ */ new Map();\nvar signalHandlersRegistered = false;\nvar registerSignalHandlers = () => {\n  if (signalHandlersRegistered) return;\n  signalHandlersRegistered = true;\n  const cleanup = async () => {\n    if (activeSteps.size === 0) return;\n    const promises = Array.from(activeSteps.entries()).map(\n      async ([stepId, data]) => {\n        const durationMs = Date.now() - data.startTime;\n        await updateStepResult(stepId, {\n          duration_ms: durationMs,\n          output: JSON.stringify(data.collectedOutput),\n          usage: null,\n          error: \"Request aborted\",\n          raw_request: data.request && typeof data.request === \"object\" && \"body\" in data.request ? JSON.stringify(data.request.body) : null,\n          raw_response: JSON.stringify(data.fullStreamChunks),\n          raw_chunks: JSON.stringify(data.rawChunks)\n        });\n      }\n    );\n    await Promise.all(promises);\n    await notifyServerAsync(\"step-update\");\n  };\n  process.on(\"SIGINT\", () => {\n    cleanup().then(() => process.exit(130));\n  });\n  process.on(\"SIGTERM\", () => {\n    cleanup().then(() => process.exit(143));\n  });\n};\nvar generateRunId = () => {\n  const now = /* @__PURE__ */ new Date();\n  const timestamp = now.toISOString().replace(/[-:T.Z]/g, \"\").slice(0, 17);\n  const uniqueId = crypto.randomUUID().slice(0, 8);\n  return `${timestamp}-${uniqueId}`;\n};\nvar devToolsMiddleware = () => {\n  if (process.env.NODE_ENV === \"production\") {\n    throw new Error(\n      \"@ai-sdk/devtools should not be used in production. Remove devToolsMiddleware from your model configuration for production builds.\"\n    );\n  }\n  registerSignalHandlers();\n  const runId = generateRunId();\n  let runCreated = false;\n  let stepCounter = 0;\n  const ensureRunCreated = async () => {\n    if (!runCreated) {\n      await createRun(runId);\n      runCreated = true;\n    }\n  };\n  const getNextStepNumber = () => {\n    stepCounter++;\n    return stepCounter;\n  };\n  return {\n    specificationVersion: \"v3\",\n    wrapGenerate: async ({ doGenerate, params, model }) => {\n      const startTime = Date.now();\n      const stepId = generateId();\n      const stepNumber = getNextStepNumber();\n      await ensureRunCreated();\n      await createStep({\n        id: stepId,\n        run_id: runId,\n        step_number: stepNumber,\n        type: \"generate\",\n        model_id: model.modelId,\n        // @ts-expect-error broken type\n        provider: model.config?.provider,\n        started_at: (/* @__PURE__ */ new Date()).toISOString(),\n        input: JSON.stringify({\n          prompt: params.prompt,\n          tools: params.tools,\n          toolChoice: params.toolChoice,\n          maxOutputTokens: params.maxOutputTokens,\n          temperature: params.temperature,\n          topP: params.topP,\n          topK: params.topK,\n          presencePenalty: params.presencePenalty,\n          frequencyPenalty: params.frequencyPenalty,\n          seed: params.seed,\n          responseFormat: params.responseFormat\n        }),\n        provider_options: params.providerOptions ? JSON.stringify(params.providerOptions) : null\n      });\n      try {\n        const result = await doGenerate();\n        const durationMs = Date.now() - startTime;\n        await updateStepResult(stepId, {\n          duration_ms: durationMs,\n          output: JSON.stringify({\n            content: result.content,\n            finishReason: result.finishReason,\n            response: result.response\n          }),\n          usage: result.usage ? JSON.stringify(result.usage) : null,\n          error: null,\n          raw_request: result.request?.body ? JSON.stringify(result.request.body) : null,\n          raw_response: result.response?.body ? JSON.stringify(result.response.body) : null\n        });\n        return result;\n      } catch (error) {\n        const durationMs = Date.now() - startTime;\n        await updateStepResult(stepId, {\n          duration_ms: durationMs,\n          output: null,\n          usage: null,\n          error: error instanceof Error ? error.message : String(error),\n          raw_request: null,\n          raw_response: null\n        });\n        throw error;\n      }\n    },\n    wrapStream: async ({ doStream, params, model }) => {\n      const startTime = Date.now();\n      const stepId = generateId();\n      const stepNumber = getNextStepNumber();\n      await ensureRunCreated();\n      const userRequestedRawChunks = params.includeRawChunks === true;\n      params.includeRawChunks = true;\n      await createStep({\n        id: stepId,\n        run_id: runId,\n        step_number: stepNumber,\n        type: \"stream\",\n        model_id: model.modelId,\n        // @ts-expect-error broken type\n        provider: model.config?.provider,\n        started_at: (/* @__PURE__ */ new Date()).toISOString(),\n        input: JSON.stringify({\n          prompt: params.prompt,\n          tools: params.tools,\n          toolChoice: params.toolChoice,\n          maxOutputTokens: params.maxOutputTokens,\n          temperature: params.temperature,\n          topP: params.topP,\n          topK: params.topK,\n          presencePenalty: params.presencePenalty,\n          frequencyPenalty: params.frequencyPenalty,\n          seed: params.seed,\n          responseFormat: params.responseFormat\n        }),\n        provider_options: params.providerOptions ? JSON.stringify(params.providerOptions) : null\n      });\n      try {\n        const { stream, request, response, ...rest } = await doStream();\n        const collectedOutput = {\n          textParts: [],\n          reasoningParts: [],\n          toolCalls: []\n        };\n        const currentText = /* @__PURE__ */ new Map();\n        const currentReasoning = /* @__PURE__ */ new Map();\n        const fullStreamChunks = [];\n        const rawChunks = [];\n        activeSteps.set(stepId, {\n          startTime,\n          collectedOutput,\n          request,\n          fullStreamChunks,\n          rawChunks\n        });\n        const transformStream = new TransformStream({\n          transform(chunk, controller) {\n            if (chunk.type === \"raw\") {\n              rawChunks.push(chunk.rawValue);\n              if (userRequestedRawChunks) {\n                controller.enqueue(chunk);\n              }\n              return;\n            }\n            fullStreamChunks.push(chunk);\n            switch (chunk.type) {\n              case \"text-start\":\n                currentText.set(chunk.id, \"\");\n                break;\n              case \"text-delta\":\n                currentText.set(\n                  chunk.id,\n                  (currentText.get(chunk.id) ?? \"\") + chunk.delta\n                );\n                break;\n              case \"text-end\":\n                collectedOutput.textParts.push({\n                  id: chunk.id,\n                  text: currentText.get(chunk.id) ?? \"\"\n                });\n                break;\n              case \"reasoning-start\":\n                currentReasoning.set(chunk.id, \"\");\n                break;\n              case \"reasoning-delta\":\n                currentReasoning.set(\n                  chunk.id,\n                  (currentReasoning.get(chunk.id) ?? \"\") + chunk.delta\n                );\n                break;\n              case \"reasoning-end\":\n                collectedOutput.reasoningParts.push({\n                  id: chunk.id,\n                  text: currentReasoning.get(chunk.id) ?? \"\"\n                });\n                break;\n              case \"tool-call\":\n                collectedOutput.toolCalls.push(chunk);\n                break;\n              case \"finish\":\n                collectedOutput.finishReason = chunk.finishReason;\n                collectedOutput.usage = chunk.usage;\n                break;\n            }\n            controller.enqueue(chunk);\n          },\n          async flush() {\n            activeSteps.delete(stepId);\n            const durationMs = Date.now() - startTime;\n            await updateStepResult(stepId, {\n              duration_ms: durationMs,\n              output: JSON.stringify(collectedOutput),\n              usage: collectedOutput.usage ? JSON.stringify(collectedOutput.usage) : null,\n              error: null,\n              raw_request: request?.body ? JSON.stringify(request.body) : null,\n              raw_response: JSON.stringify(fullStreamChunks),\n              raw_chunks: JSON.stringify(rawChunks)\n            });\n          },\n          // @ts-expect-error - cancel is valid per WHATWG Streams spec but missing from TS types\n          async cancel() {\n            activeSteps.delete(stepId);\n            const durationMs = Date.now() - startTime;\n            await updateStepResult(stepId, {\n              duration_ms: durationMs,\n              output: JSON.stringify(collectedOutput),\n              usage: collectedOutput.usage ? JSON.stringify(collectedOutput.usage) : null,\n              error: \"Request aborted\",\n              raw_request: request?.body ? JSON.stringify(request.body) : null,\n              raw_response: JSON.stringify(fullStreamChunks),\n              raw_chunks: JSON.stringify(rawChunks)\n            });\n          }\n        });\n        return {\n          stream: stream.pipeThrough(transformStream),\n          request,\n          response,\n          ...rest\n        };\n      } catch (error) {\n        activeSteps.delete(stepId);\n        const durationMs = Date.now() - startTime;\n        await updateStepResult(stepId, {\n          duration_ms: durationMs,\n          output: null,\n          usage: null,\n          error: error instanceof Error ? error.message : String(error),\n          raw_request: null,\n          raw_response: null,\n          raw_chunks: null\n        });\n        throw error;\n      }\n    }\n  };\n};\nexport {\n  devToolsMiddleware\n};\n","// src/combine-headers.ts\nfunction combineHeaders(...headers) {\n  return headers.reduce(\n    (combinedHeaders, currentHeaders) => ({\n      ...combinedHeaders,\n      ...currentHeaders != null ? currentHeaders : {}\n    }),\n    {}\n  );\n}\n\n// src/convert-async-iterator-to-readable-stream.ts\nfunction convertAsyncIteratorToReadableStream(iterator) {\n  let cancelled = false;\n  return new ReadableStream({\n    /**\n     * Called when the consumer wants to pull more data from the stream.\n     *\n     * @param {ReadableStreamDefaultController<T>} controller - The controller to enqueue data into the stream.\n     * @returns {Promise<void>}\n     */\n    async pull(controller) {\n      if (cancelled) return;\n      try {\n        const { value, done } = await iterator.next();\n        if (done) {\n          controller.close();\n        } else {\n          controller.enqueue(value);\n        }\n      } catch (error) {\n        controller.error(error);\n      }\n    },\n    /**\n     * Called when the consumer cancels the stream.\n     */\n    async cancel(reason) {\n      cancelled = true;\n      if (iterator.return) {\n        try {\n          await iterator.return(reason);\n        } catch (e) {\n        }\n      }\n    }\n  });\n}\n\n// src/create-tool-name-mapping.ts\nfunction createToolNameMapping({\n  tools = [],\n  providerToolNames\n}) {\n  const customToolNameToProviderToolName = {};\n  const providerToolNameToCustomToolName = {};\n  for (const tool2 of tools) {\n    if (tool2.type === \"provider\" && tool2.id in providerToolNames) {\n      const providerToolName = providerToolNames[tool2.id];\n      customToolNameToProviderToolName[tool2.name] = providerToolName;\n      providerToolNameToCustomToolName[providerToolName] = tool2.name;\n    }\n  }\n  return {\n    toProviderToolName: (customToolName) => {\n      var _a2;\n      return (_a2 = customToolNameToProviderToolName[customToolName]) != null ? _a2 : customToolName;\n    },\n    toCustomToolName: (providerToolName) => {\n      var _a2;\n      return (_a2 = providerToolNameToCustomToolName[providerToolName]) != null ? _a2 : providerToolName;\n    }\n  };\n}\n\n// src/delay.ts\nasync function delay(delayInMs, options) {\n  if (delayInMs == null) {\n    return Promise.resolve();\n  }\n  const signal = options == null ? void 0 : options.abortSignal;\n  return new Promise((resolve2, reject) => {\n    if (signal == null ? void 0 : signal.aborted) {\n      reject(createAbortError());\n      return;\n    }\n    const timeoutId = setTimeout(() => {\n      cleanup();\n      resolve2();\n    }, delayInMs);\n    const cleanup = () => {\n      clearTimeout(timeoutId);\n      signal == null ? void 0 : signal.removeEventListener(\"abort\", onAbort);\n    };\n    const onAbort = () => {\n      cleanup();\n      reject(createAbortError());\n    };\n    signal == null ? void 0 : signal.addEventListener(\"abort\", onAbort);\n  });\n}\nfunction createAbortError() {\n  return new DOMException(\"Delay was aborted\", \"AbortError\");\n}\n\n// src/delayed-promise.ts\nvar DelayedPromise = class {\n  constructor() {\n    this.status = { type: \"pending\" };\n    this._resolve = void 0;\n    this._reject = void 0;\n  }\n  get promise() {\n    if (this._promise) {\n      return this._promise;\n    }\n    this._promise = new Promise((resolve2, reject) => {\n      if (this.status.type === \"resolved\") {\n        resolve2(this.status.value);\n      } else if (this.status.type === \"rejected\") {\n        reject(this.status.error);\n      }\n      this._resolve = resolve2;\n      this._reject = reject;\n    });\n    return this._promise;\n  }\n  resolve(value) {\n    var _a2;\n    this.status = { type: \"resolved\", value };\n    if (this._promise) {\n      (_a2 = this._resolve) == null ? void 0 : _a2.call(this, value);\n    }\n  }\n  reject(error) {\n    var _a2;\n    this.status = { type: \"rejected\", error };\n    if (this._promise) {\n      (_a2 = this._reject) == null ? void 0 : _a2.call(this, error);\n    }\n  }\n  isResolved() {\n    return this.status.type === \"resolved\";\n  }\n  isRejected() {\n    return this.status.type === \"rejected\";\n  }\n  isPending() {\n    return this.status.type === \"pending\";\n  }\n};\n\n// src/extract-response-headers.ts\nfunction extractResponseHeaders(response) {\n  return Object.fromEntries([...response.headers]);\n}\n\n// src/uint8-utils.ts\nvar { btoa, atob } = globalThis;\nfunction convertBase64ToUint8Array(base64String) {\n  const base64Url = base64String.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const latin1string = atob(base64Url);\n  return Uint8Array.from(latin1string, (byte) => byte.codePointAt(0));\n}\nfunction convertUint8ArrayToBase64(array) {\n  let latin1string = \"\";\n  for (let i = 0; i < array.length; i++) {\n    latin1string += String.fromCodePoint(array[i]);\n  }\n  return btoa(latin1string);\n}\nfunction convertToBase64(value) {\n  return value instanceof Uint8Array ? convertUint8ArrayToBase64(value) : value;\n}\n\n// src/convert-image-model-file-to-data-uri.ts\nfunction convertImageModelFileToDataUri(file) {\n  if (file.type === \"url\") return file.url;\n  return `data:${file.mediaType};base64,${typeof file.data === \"string\" ? file.data : convertUint8ArrayToBase64(file.data)}`;\n}\n\n// src/convert-to-form-data.ts\nfunction convertToFormData(input, options = {}) {\n  const { useArrayBrackets = true } = options;\n  const formData = new FormData();\n  for (const [key, value] of Object.entries(input)) {\n    if (value == null) {\n      continue;\n    }\n    if (Array.isArray(value)) {\n      if (value.length === 1) {\n        formData.append(key, value[0]);\n        continue;\n      }\n      const arrayKey = useArrayBrackets ? `${key}[]` : key;\n      for (const item of value) {\n        formData.append(arrayKey, item);\n      }\n      continue;\n    }\n    formData.append(key, value);\n  }\n  return formData;\n}\n\n// src/download-error.ts\nimport { AISDKError } from \"@ai-sdk/provider\";\nvar name = \"AI_DownloadError\";\nvar marker = `vercel.ai.error.${name}`;\nvar symbol = Symbol.for(marker);\nvar _a, _b;\nvar DownloadError = class extends (_b = AISDKError, _a = symbol, _b) {\n  constructor({\n    url,\n    statusCode,\n    statusText,\n    cause,\n    message = cause == null ? `Failed to download ${url}: ${statusCode} ${statusText}` : `Failed to download ${url}: ${cause}`\n  }) {\n    super({ name, message, cause });\n    this[_a] = true;\n    this.url = url;\n    this.statusCode = statusCode;\n    this.statusText = statusText;\n  }\n  static isInstance(error) {\n    return AISDKError.hasMarker(error, marker);\n  }\n};\n\n// src/download-blob.ts\nasync function downloadBlob(url) {\n  try {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new DownloadError({\n        url,\n        statusCode: response.status,\n        statusText: response.statusText\n      });\n    }\n    return await response.blob();\n  } catch (error) {\n    if (DownloadError.isInstance(error)) {\n      throw error;\n    }\n    throw new DownloadError({ url, cause: error });\n  }\n}\n\n// src/generate-id.ts\nimport { InvalidArgumentError } from \"@ai-sdk/provider\";\nvar createIdGenerator = ({\n  prefix,\n  size = 16,\n  alphabet = \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\",\n  separator = \"-\"\n} = {}) => {\n  const generator = () => {\n    const alphabetLength = alphabet.length;\n    const chars = new Array(size);\n    for (let i = 0; i < size; i++) {\n      chars[i] = alphabet[Math.random() * alphabetLength | 0];\n    }\n    return chars.join(\"\");\n  };\n  if (prefix == null) {\n    return generator;\n  }\n  if (alphabet.includes(separator)) {\n    throw new InvalidArgumentError({\n      argument: \"separator\",\n      message: `The separator \"${separator}\" must not be part of the alphabet \"${alphabet}\".`\n    });\n  }\n  return () => `${prefix}${separator}${generator()}`;\n};\nvar generateId = createIdGenerator();\n\n// src/get-error-message.ts\nfunction getErrorMessage(error) {\n  if (error == null) {\n    return \"unknown error\";\n  }\n  if (typeof error === \"string\") {\n    return error;\n  }\n  if (error instanceof Error) {\n    return error.message;\n  }\n  return JSON.stringify(error);\n}\n\n// src/get-from-api.ts\nimport { APICallError as APICallError2 } from \"@ai-sdk/provider\";\n\n// src/handle-fetch-error.ts\nimport { APICallError } from \"@ai-sdk/provider\";\n\n// src/is-abort-error.ts\nfunction isAbortError(error) {\n  return (error instanceof Error || error instanceof DOMException) && (error.name === \"AbortError\" || error.name === \"ResponseAborted\" || // Next.js\n  error.name === \"TimeoutError\");\n}\n\n// src/handle-fetch-error.ts\nvar FETCH_FAILED_ERROR_MESSAGES = [\"fetch failed\", \"failed to fetch\"];\nfunction handleFetchError({\n  error,\n  url,\n  requestBodyValues\n}) {\n  if (isAbortError(error)) {\n    return error;\n  }\n  if (error instanceof TypeError && FETCH_FAILED_ERROR_MESSAGES.includes(error.message.toLowerCase())) {\n    const cause = error.cause;\n    if (cause != null) {\n      return new APICallError({\n        message: `Cannot connect to API: ${cause.message}`,\n        cause,\n        url,\n        requestBodyValues,\n        isRetryable: true\n        // retry when network error\n      });\n    }\n  }\n  return error;\n}\n\n// src/get-runtime-environment-user-agent.ts\nfunction getRuntimeEnvironmentUserAgent(globalThisAny = globalThis) {\n  var _a2, _b2, _c;\n  if (globalThisAny.window) {\n    return `runtime/browser`;\n  }\n  if ((_a2 = globalThisAny.navigator) == null ? void 0 : _a2.userAgent) {\n    return `runtime/${globalThisAny.navigator.userAgent.toLowerCase()}`;\n  }\n  if ((_c = (_b2 = globalThisAny.process) == null ? void 0 : _b2.versions) == null ? void 0 : _c.node) {\n    return `runtime/node.js/${globalThisAny.process.version.substring(0)}`;\n  }\n  if (globalThisAny.EdgeRuntime) {\n    return `runtime/vercel-edge`;\n  }\n  return \"runtime/unknown\";\n}\n\n// src/normalize-headers.ts\nfunction normalizeHeaders(headers) {\n  if (headers == null) {\n    return {};\n  }\n  const normalized = {};\n  if (headers instanceof Headers) {\n    headers.forEach((value, key) => {\n      normalized[key.toLowerCase()] = value;\n    });\n  } else {\n    if (!Array.isArray(headers)) {\n      headers = Object.entries(headers);\n    }\n    for (const [key, value] of headers) {\n      if (value != null) {\n        normalized[key.toLowerCase()] = value;\n      }\n    }\n  }\n  return normalized;\n}\n\n// src/with-user-agent-suffix.ts\nfunction withUserAgentSuffix(headers, ...userAgentSuffixParts) {\n  const normalizedHeaders = new Headers(normalizeHeaders(headers));\n  const currentUserAgentHeader = normalizedHeaders.get(\"user-agent\") || \"\";\n  normalizedHeaders.set(\n    \"user-agent\",\n    [currentUserAgentHeader, ...userAgentSuffixParts].filter(Boolean).join(\" \")\n  );\n  return Object.fromEntries(normalizedHeaders.entries());\n}\n\n// src/version.ts\nvar VERSION = true ? \"4.0.1\" : \"0.0.0-test\";\n\n// src/get-from-api.ts\nvar getOriginalFetch = () => globalThis.fetch;\nvar getFromApi = async ({\n  url,\n  headers = {},\n  successfulResponseHandler,\n  failedResponseHandler,\n  abortSignal,\n  fetch: fetch2 = getOriginalFetch()\n}) => {\n  try {\n    const response = await fetch2(url, {\n      method: \"GET\",\n      headers: withUserAgentSuffix(\n        headers,\n        `ai-sdk/provider-utils/${VERSION}`,\n        getRuntimeEnvironmentUserAgent()\n      ),\n      signal: abortSignal\n    });\n    const responseHeaders = extractResponseHeaders(response);\n    if (!response.ok) {\n      let errorInformation;\n      try {\n        errorInformation = await failedResponseHandler({\n          response,\n          url,\n          requestBodyValues: {}\n        });\n      } catch (error) {\n        if (isAbortError(error) || APICallError2.isInstance(error)) {\n          throw error;\n        }\n        throw new APICallError2({\n          message: \"Failed to process error response\",\n          cause: error,\n          statusCode: response.status,\n          url,\n          responseHeaders,\n          requestBodyValues: {}\n        });\n      }\n      throw errorInformation.value;\n    }\n    try {\n      return await successfulResponseHandler({\n        response,\n        url,\n        requestBodyValues: {}\n      });\n    } catch (error) {\n      if (error instanceof Error) {\n        if (isAbortError(error) || APICallError2.isInstance(error)) {\n          throw error;\n        }\n      }\n      throw new APICallError2({\n        message: \"Failed to process successful response\",\n        cause: error,\n        statusCode: response.status,\n        url,\n        responseHeaders,\n        requestBodyValues: {}\n      });\n    }\n  } catch (error) {\n    throw handleFetchError({ error, url, requestBodyValues: {} });\n  }\n};\n\n// src/inject-json-instruction.ts\nvar DEFAULT_SCHEMA_PREFIX = \"JSON schema:\";\nvar DEFAULT_SCHEMA_SUFFIX = \"You MUST answer with a JSON object that matches the JSON schema above.\";\nvar DEFAULT_GENERIC_SUFFIX = \"You MUST answer with JSON.\";\nfunction injectJsonInstruction({\n  prompt,\n  schema,\n  schemaPrefix = schema != null ? DEFAULT_SCHEMA_PREFIX : void 0,\n  schemaSuffix = schema != null ? DEFAULT_SCHEMA_SUFFIX : DEFAULT_GENERIC_SUFFIX\n}) {\n  return [\n    prompt != null && prompt.length > 0 ? prompt : void 0,\n    prompt != null && prompt.length > 0 ? \"\" : void 0,\n    // add a newline if prompt is not null\n    schemaPrefix,\n    schema != null ? JSON.stringify(schema) : void 0,\n    schemaSuffix\n  ].filter((line) => line != null).join(\"\\n\");\n}\nfunction injectJsonInstructionIntoMessages({\n  messages,\n  schema,\n  schemaPrefix,\n  schemaSuffix\n}) {\n  var _a2, _b2;\n  const systemMessage = ((_a2 = messages[0]) == null ? void 0 : _a2.role) === \"system\" ? { ...messages[0] } : { role: \"system\", content: \"\" };\n  systemMessage.content = injectJsonInstruction({\n    prompt: systemMessage.content,\n    schema,\n    schemaPrefix,\n    schemaSuffix\n  });\n  return [\n    systemMessage,\n    ...((_b2 = messages[0]) == null ? void 0 : _b2.role) === \"system\" ? messages.slice(1) : messages\n  ];\n}\n\n// src/is-non-nullable.ts\nfunction isNonNullable(value) {\n  return value != null;\n}\n\n// src/is-url-supported.ts\nfunction isUrlSupported({\n  mediaType,\n  url,\n  supportedUrls\n}) {\n  url = url.toLowerCase();\n  mediaType = mediaType.toLowerCase();\n  return Object.entries(supportedUrls).map(([key, value]) => {\n    const mediaType2 = key.toLowerCase();\n    return mediaType2 === \"*\" || mediaType2 === \"*/*\" ? { mediaTypePrefix: \"\", regexes: value } : { mediaTypePrefix: mediaType2.replace(/\\*/, \"\"), regexes: value };\n  }).filter(({ mediaTypePrefix }) => mediaType.startsWith(mediaTypePrefix)).flatMap(({ regexes }) => regexes).some((pattern) => pattern.test(url));\n}\n\n// src/load-api-key.ts\nimport { LoadAPIKeyError } from \"@ai-sdk/provider\";\nfunction loadApiKey({\n  apiKey,\n  environmentVariableName,\n  apiKeyParameterName = \"apiKey\",\n  description\n}) {\n  if (typeof apiKey === \"string\") {\n    return apiKey;\n  }\n  if (apiKey != null) {\n    throw new LoadAPIKeyError({\n      message: `${description} API key must be a string.`\n    });\n  }\n  if (typeof process === \"undefined\") {\n    throw new LoadAPIKeyError({\n      message: `${description} API key is missing. Pass it using the '${apiKeyParameterName}' parameter. Environment variables is not supported in this environment.`\n    });\n  }\n  apiKey = process.env[environmentVariableName];\n  if (apiKey == null) {\n    throw new LoadAPIKeyError({\n      message: `${description} API key is missing. Pass it using the '${apiKeyParameterName}' parameter or the ${environmentVariableName} environment variable.`\n    });\n  }\n  if (typeof apiKey !== \"string\") {\n    throw new LoadAPIKeyError({\n      message: `${description} API key must be a string. The value of the ${environmentVariableName} environment variable is not a string.`\n    });\n  }\n  return apiKey;\n}\n\n// src/load-optional-setting.ts\nfunction loadOptionalSetting({\n  settingValue,\n  environmentVariableName\n}) {\n  if (typeof settingValue === \"string\") {\n    return settingValue;\n  }\n  if (settingValue != null || typeof process === \"undefined\") {\n    return void 0;\n  }\n  settingValue = process.env[environmentVariableName];\n  if (settingValue == null || typeof settingValue !== \"string\") {\n    return void 0;\n  }\n  return settingValue;\n}\n\n// src/load-setting.ts\nimport { LoadSettingError } from \"@ai-sdk/provider\";\nfunction loadSetting({\n  settingValue,\n  environmentVariableName,\n  settingName,\n  description\n}) {\n  if (typeof settingValue === \"string\") {\n    return settingValue;\n  }\n  if (settingValue != null) {\n    throw new LoadSettingError({\n      message: `${description} setting must be a string.`\n    });\n  }\n  if (typeof process === \"undefined\") {\n    throw new LoadSettingError({\n      message: `${description} setting is missing. Pass it using the '${settingName}' parameter. Environment variables is not supported in this environment.`\n    });\n  }\n  settingValue = process.env[environmentVariableName];\n  if (settingValue == null) {\n    throw new LoadSettingError({\n      message: `${description} setting is missing. Pass it using the '${settingName}' parameter or the ${environmentVariableName} environment variable.`\n    });\n  }\n  if (typeof settingValue !== \"string\") {\n    throw new LoadSettingError({\n      message: `${description} setting must be a string. The value of the ${environmentVariableName} environment variable is not a string.`\n    });\n  }\n  return settingValue;\n}\n\n// src/media-type-to-extension.ts\nfunction mediaTypeToExtension(mediaType) {\n  var _a2;\n  const [_type, subtype = \"\"] = mediaType.toLowerCase().split(\"/\");\n  return (_a2 = {\n    mpeg: \"mp3\",\n    \"x-wav\": \"wav\",\n    opus: \"ogg\",\n    mp4: \"m4a\",\n    \"x-m4a\": \"m4a\"\n  }[subtype]) != null ? _a2 : subtype;\n}\n\n// src/parse-json.ts\nimport {\n  JSONParseError,\n  TypeValidationError as TypeValidationError3\n} from \"@ai-sdk/provider\";\n\n// src/secure-json-parse.ts\nvar suspectProtoRx = /\"__proto__\"\\s*:/;\nvar suspectConstructorRx = /\"constructor\"\\s*:/;\nfunction _parse(text) {\n  const obj = JSON.parse(text);\n  if (obj === null || typeof obj !== \"object\") {\n    return obj;\n  }\n  if (suspectProtoRx.test(text) === false && suspectConstructorRx.test(text) === false) {\n    return obj;\n  }\n  return filter(obj);\n}\nfunction filter(obj) {\n  let next = [obj];\n  while (next.length) {\n    const nodes = next;\n    next = [];\n    for (const node of nodes) {\n      if (Object.prototype.hasOwnProperty.call(node, \"__proto__\")) {\n        throw new SyntaxError(\"Object contains forbidden prototype property\");\n      }\n      if (Object.prototype.hasOwnProperty.call(node, \"constructor\") && Object.prototype.hasOwnProperty.call(node.constructor, \"prototype\")) {\n        throw new SyntaxError(\"Object contains forbidden prototype property\");\n      }\n      for (const key in node) {\n        const value = node[key];\n        if (value && typeof value === \"object\") {\n          next.push(value);\n        }\n      }\n    }\n  }\n  return obj;\n}\nfunction secureJsonParse(text) {\n  const { stackTraceLimit } = Error;\n  try {\n    Error.stackTraceLimit = 0;\n  } catch (e) {\n    return _parse(text);\n  }\n  try {\n    return _parse(text);\n  } finally {\n    Error.stackTraceLimit = stackTraceLimit;\n  }\n}\n\n// src/validate-types.ts\nimport { TypeValidationError as TypeValidationError2 } from \"@ai-sdk/provider\";\n\n// src/schema.ts\nimport { TypeValidationError } from \"@ai-sdk/provider\";\nimport * as z4 from \"zod/v4\";\n\n// src/add-additional-properties-to-json-schema.ts\nfunction addAdditionalPropertiesToJsonSchema(jsonSchema2) {\n  if (jsonSchema2.type === \"object\") {\n    jsonSchema2.additionalProperties = false;\n    const properties = jsonSchema2.properties;\n    if (properties != null) {\n      for (const property in properties) {\n        properties[property] = addAdditionalPropertiesToJsonSchema(\n          properties[property]\n        );\n      }\n    }\n  }\n  if (jsonSchema2.type === \"array\" && jsonSchema2.items != null) {\n    if (Array.isArray(jsonSchema2.items)) {\n      jsonSchema2.items = jsonSchema2.items.map(\n        (item) => addAdditionalPropertiesToJsonSchema(item)\n      );\n    } else {\n      jsonSchema2.items = addAdditionalPropertiesToJsonSchema(\n        jsonSchema2.items\n      );\n    }\n  }\n  return jsonSchema2;\n}\n\n// src/to-json-schema/zod3-to-json-schema/options.ts\nvar ignoreOverride = Symbol(\n  \"Let zodToJsonSchema decide on which parser to use\"\n);\nvar defaultOptions = {\n  name: void 0,\n  $refStrategy: \"root\",\n  basePath: [\"#\"],\n  effectStrategy: \"input\",\n  pipeStrategy: \"all\",\n  dateStrategy: \"format:date-time\",\n  mapStrategy: \"entries\",\n  removeAdditionalStrategy: \"passthrough\",\n  allowedAdditionalProperties: true,\n  rejectedAdditionalProperties: false,\n  definitionPath: \"definitions\",\n  strictUnions: false,\n  definitions: {},\n  errorMessages: false,\n  patternStrategy: \"escape\",\n  applyRegexFlags: false,\n  emailStrategy: \"format:email\",\n  base64Strategy: \"contentEncoding:base64\",\n  nameStrategy: \"ref\"\n};\nvar getDefaultOptions = (options) => typeof options === \"string\" ? {\n  ...defaultOptions,\n  name: options\n} : {\n  ...defaultOptions,\n  ...options\n};\n\n// src/to-json-schema/zod3-to-json-schema/select-parser.ts\nimport { ZodFirstPartyTypeKind as ZodFirstPartyTypeKind3 } from \"zod/v3\";\n\n// src/to-json-schema/zod3-to-json-schema/parsers/any.ts\nfunction parseAnyDef() {\n  return {};\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/array.ts\nimport { ZodFirstPartyTypeKind } from \"zod/v3\";\nfunction parseArrayDef(def, refs) {\n  var _a2, _b2, _c;\n  const res = {\n    type: \"array\"\n  };\n  if (((_a2 = def.type) == null ? void 0 : _a2._def) && ((_c = (_b2 = def.type) == null ? void 0 : _b2._def) == null ? void 0 : _c.typeName) !== ZodFirstPartyTypeKind.ZodAny) {\n    res.items = parseDef(def.type._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, \"items\"]\n    });\n  }\n  if (def.minLength) {\n    res.minItems = def.minLength.value;\n  }\n  if (def.maxLength) {\n    res.maxItems = def.maxLength.value;\n  }\n  if (def.exactLength) {\n    res.minItems = def.exactLength.value;\n    res.maxItems = def.exactLength.value;\n  }\n  return res;\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/bigint.ts\nfunction parseBigintDef(def) {\n  const res = {\n    type: \"integer\",\n    format: \"int64\"\n  };\n  if (!def.checks) return res;\n  for (const check of def.checks) {\n    switch (check.kind) {\n      case \"min\":\n        if (check.inclusive) {\n          res.minimum = check.value;\n        } else {\n          res.exclusiveMinimum = check.value;\n        }\n        break;\n      case \"max\":\n        if (check.inclusive) {\n          res.maximum = check.value;\n        } else {\n          res.exclusiveMaximum = check.value;\n        }\n        break;\n      case \"multipleOf\":\n        res.multipleOf = check.value;\n        break;\n    }\n  }\n  return res;\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/boolean.ts\nfunction parseBooleanDef() {\n  return { type: \"boolean\" };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/branded.ts\nfunction parseBrandedDef(_def, refs) {\n  return parseDef(_def.type._def, refs);\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/catch.ts\nvar parseCatchDef = (def, refs) => {\n  return parseDef(def.innerType._def, refs);\n};\n\n// src/to-json-schema/zod3-to-json-schema/parsers/date.ts\nfunction parseDateDef(def, refs, overrideDateStrategy) {\n  const strategy = overrideDateStrategy != null ? overrideDateStrategy : refs.dateStrategy;\n  if (Array.isArray(strategy)) {\n    return {\n      anyOf: strategy.map((item, i) => parseDateDef(def, refs, item))\n    };\n  }\n  switch (strategy) {\n    case \"string\":\n    case \"format:date-time\":\n      return {\n        type: \"string\",\n        format: \"date-time\"\n      };\n    case \"format:date\":\n      return {\n        type: \"string\",\n        format: \"date\"\n      };\n    case \"integer\":\n      return integerDateParser(def);\n  }\n}\nvar integerDateParser = (def) => {\n  const res = {\n    type: \"integer\",\n    format: \"unix-time\"\n  };\n  for (const check of def.checks) {\n    switch (check.kind) {\n      case \"min\":\n        res.minimum = check.value;\n        break;\n      case \"max\":\n        res.maximum = check.value;\n        break;\n    }\n  }\n  return res;\n};\n\n// src/to-json-schema/zod3-to-json-schema/parsers/default.ts\nfunction parseDefaultDef(_def, refs) {\n  return {\n    ...parseDef(_def.innerType._def, refs),\n    default: _def.defaultValue()\n  };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/effects.ts\nfunction parseEffectsDef(_def, refs) {\n  return refs.effectStrategy === \"input\" ? parseDef(_def.schema._def, refs) : parseAnyDef();\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/enum.ts\nfunction parseEnumDef(def) {\n  return {\n    type: \"string\",\n    enum: Array.from(def.values)\n  };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/intersection.ts\nvar isJsonSchema7AllOfType = (type) => {\n  if (\"type\" in type && type.type === \"string\") return false;\n  return \"allOf\" in type;\n};\nfunction parseIntersectionDef(def, refs) {\n  const allOf = [\n    parseDef(def.left._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, \"allOf\", \"0\"]\n    }),\n    parseDef(def.right._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, \"allOf\", \"1\"]\n    })\n  ].filter((x) => !!x);\n  const mergedAllOf = [];\n  allOf.forEach((schema) => {\n    if (isJsonSchema7AllOfType(schema)) {\n      mergedAllOf.push(...schema.allOf);\n    } else {\n      let nestedSchema = schema;\n      if (\"additionalProperties\" in schema && schema.additionalProperties === false) {\n        const { additionalProperties, ...rest } = schema;\n        nestedSchema = rest;\n      }\n      mergedAllOf.push(nestedSchema);\n    }\n  });\n  return mergedAllOf.length ? { allOf: mergedAllOf } : void 0;\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/literal.ts\nfunction parseLiteralDef(def) {\n  const parsedType = typeof def.value;\n  if (parsedType !== \"bigint\" && parsedType !== \"number\" && parsedType !== \"boolean\" && parsedType !== \"string\") {\n    return {\n      type: Array.isArray(def.value) ? \"array\" : \"object\"\n    };\n  }\n  return {\n    type: parsedType === \"bigint\" ? \"integer\" : parsedType,\n    const: def.value\n  };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/record.ts\nimport {\n  ZodFirstPartyTypeKind as ZodFirstPartyTypeKind2\n} from \"zod/v3\";\n\n// src/to-json-schema/zod3-to-json-schema/parsers/string.ts\nvar emojiRegex = void 0;\nvar zodPatterns = {\n  /**\n   * `c` was changed to `[cC]` to replicate /i flag\n   */\n  cuid: /^[cC][^\\s-]{8,}$/,\n  cuid2: /^[0-9a-z]+$/,\n  ulid: /^[0-9A-HJKMNP-TV-Z]{26}$/,\n  /**\n   * `a-z` was added to replicate /i flag\n   */\n  email: /^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_'+\\-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$/,\n  /**\n   * Constructed a valid Unicode RegExp\n   *\n   * Lazily instantiate since this type of regex isn't supported\n   * in all envs (e.g. React Native).\n   *\n   * See:\n   * https://github.com/colinhacks/zod/issues/2433\n   * Fix in Zod:\n   * https://github.com/colinhacks/zod/commit/9340fd51e48576a75adc919bff65dbc4a5d4c99b\n   */\n  emoji: () => {\n    if (emojiRegex === void 0) {\n      emojiRegex = RegExp(\n        \"^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$\",\n        \"u\"\n      );\n    }\n    return emojiRegex;\n  },\n  /**\n   * Unused\n   */\n  uuid: /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/,\n  /**\n   * Unused\n   */\n  ipv4: /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,\n  ipv4Cidr: /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\/(3[0-2]|[12]?[0-9])$/,\n  /**\n   * Unused\n   */\n  ipv6: /^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,\n  ipv6Cidr: /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,\n  base64: /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,\n  base64url: /^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,\n  nanoid: /^[a-zA-Z0-9_-]{21}$/,\n  jwt: /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]*$/\n};\nfunction parseStringDef(def, refs) {\n  const res = {\n    type: \"string\"\n  };\n  if (def.checks) {\n    for (const check of def.checks) {\n      switch (check.kind) {\n        case \"min\":\n          res.minLength = typeof res.minLength === \"number\" ? Math.max(res.minLength, check.value) : check.value;\n          break;\n        case \"max\":\n          res.maxLength = typeof res.maxLength === \"number\" ? Math.min(res.maxLength, check.value) : check.value;\n          break;\n        case \"email\":\n          switch (refs.emailStrategy) {\n            case \"format:email\":\n              addFormat(res, \"email\", check.message, refs);\n              break;\n            case \"format:idn-email\":\n              addFormat(res, \"idn-email\", check.message, refs);\n              break;\n            case \"pattern:zod\":\n              addPattern(res, zodPatterns.email, check.message, refs);\n              break;\n          }\n          break;\n        case \"url\":\n          addFormat(res, \"uri\", check.message, refs);\n          break;\n        case \"uuid\":\n          addFormat(res, \"uuid\", check.message, refs);\n          break;\n        case \"regex\":\n          addPattern(res, check.regex, check.message, refs);\n          break;\n        case \"cuid\":\n          addPattern(res, zodPatterns.cuid, check.message, refs);\n          break;\n        case \"cuid2\":\n          addPattern(res, zodPatterns.cuid2, check.message, refs);\n          break;\n        case \"startsWith\":\n          addPattern(\n            res,\n            RegExp(`^${escapeLiteralCheckValue(check.value, refs)}`),\n            check.message,\n            refs\n          );\n          break;\n        case \"endsWith\":\n          addPattern(\n            res,\n            RegExp(`${escapeLiteralCheckValue(check.value, refs)}$`),\n            check.message,\n            refs\n          );\n          break;\n        case \"datetime\":\n          addFormat(res, \"date-time\", check.message, refs);\n          break;\n        case \"date\":\n          addFormat(res, \"date\", check.message, refs);\n          break;\n        case \"time\":\n          addFormat(res, \"time\", check.message, refs);\n          break;\n        case \"duration\":\n          addFormat(res, \"duration\", check.message, refs);\n          break;\n        case \"length\":\n          res.minLength = typeof res.minLength === \"number\" ? Math.max(res.minLength, check.value) : check.value;\n          res.maxLength = typeof res.maxLength === \"number\" ? Math.min(res.maxLength, check.value) : check.value;\n          break;\n        case \"includes\": {\n          addPattern(\n            res,\n            RegExp(escapeLiteralCheckValue(check.value, refs)),\n            check.message,\n            refs\n          );\n          break;\n        }\n        case \"ip\": {\n          if (check.version !== \"v6\") {\n            addFormat(res, \"ipv4\", check.message, refs);\n          }\n          if (check.version !== \"v4\") {\n            addFormat(res, \"ipv6\", check.message, refs);\n          }\n          break;\n        }\n        case \"base64url\":\n          addPattern(res, zodPatterns.base64url, check.message, refs);\n          break;\n        case \"jwt\":\n          addPattern(res, zodPatterns.jwt, check.message, refs);\n          break;\n        case \"cidr\": {\n          if (check.version !== \"v6\") {\n            addPattern(res, zodPatterns.ipv4Cidr, check.message, refs);\n          }\n          if (check.version !== \"v4\") {\n            addPattern(res, zodPatterns.ipv6Cidr, check.message, refs);\n          }\n          break;\n        }\n        case \"emoji\":\n          addPattern(res, zodPatterns.emoji(), check.message, refs);\n          break;\n        case \"ulid\": {\n          addPattern(res, zodPatterns.ulid, check.message, refs);\n          break;\n        }\n        case \"base64\": {\n          switch (refs.base64Strategy) {\n            case \"format:binary\": {\n              addFormat(res, \"binary\", check.message, refs);\n              break;\n            }\n            case \"contentEncoding:base64\": {\n              res.contentEncoding = \"base64\";\n              break;\n            }\n            case \"pattern:zod\": {\n              addPattern(res, zodPatterns.base64, check.message, refs);\n              break;\n            }\n          }\n          break;\n        }\n        case \"nanoid\": {\n          addPattern(res, zodPatterns.nanoid, check.message, refs);\n        }\n        case \"toLowerCase\":\n        case \"toUpperCase\":\n        case \"trim\":\n          break;\n        default:\n          /* @__PURE__ */ ((_) => {\n          })(check);\n      }\n    }\n  }\n  return res;\n}\nfunction escapeLiteralCheckValue(literal, refs) {\n  return refs.patternStrategy === \"escape\" ? escapeNonAlphaNumeric(literal) : literal;\n}\nvar ALPHA_NUMERIC = new Set(\n  \"ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789\"\n);\nfunction escapeNonAlphaNumeric(source) {\n  let result = \"\";\n  for (let i = 0; i < source.length; i++) {\n    if (!ALPHA_NUMERIC.has(source[i])) {\n      result += \"\\\\\";\n    }\n    result += source[i];\n  }\n  return result;\n}\nfunction addFormat(schema, value, message, refs) {\n  var _a2;\n  if (schema.format || ((_a2 = schema.anyOf) == null ? void 0 : _a2.some((x) => x.format))) {\n    if (!schema.anyOf) {\n      schema.anyOf = [];\n    }\n    if (schema.format) {\n      schema.anyOf.push({\n        format: schema.format\n      });\n      delete schema.format;\n    }\n    schema.anyOf.push({\n      format: value,\n      ...message && refs.errorMessages && { errorMessage: { format: message } }\n    });\n  } else {\n    schema.format = value;\n  }\n}\nfunction addPattern(schema, regex, message, refs) {\n  var _a2;\n  if (schema.pattern || ((_a2 = schema.allOf) == null ? void 0 : _a2.some((x) => x.pattern))) {\n    if (!schema.allOf) {\n      schema.allOf = [];\n    }\n    if (schema.pattern) {\n      schema.allOf.push({\n        pattern: schema.pattern\n      });\n      delete schema.pattern;\n    }\n    schema.allOf.push({\n      pattern: stringifyRegExpWithFlags(regex, refs),\n      ...message && refs.errorMessages && { errorMessage: { pattern: message } }\n    });\n  } else {\n    schema.pattern = stringifyRegExpWithFlags(regex, refs);\n  }\n}\nfunction stringifyRegExpWithFlags(regex, refs) {\n  var _a2;\n  if (!refs.applyRegexFlags || !regex.flags) {\n    return regex.source;\n  }\n  const flags = {\n    i: regex.flags.includes(\"i\"),\n    // Case-insensitive\n    m: regex.flags.includes(\"m\"),\n    // `^` and `$` matches adjacent to newline characters\n    s: regex.flags.includes(\"s\")\n    // `.` matches newlines\n  };\n  const source = flags.i ? regex.source.toLowerCase() : regex.source;\n  let pattern = \"\";\n  let isEscaped = false;\n  let inCharGroup = false;\n  let inCharRange = false;\n  for (let i = 0; i < source.length; i++) {\n    if (isEscaped) {\n      pattern += source[i];\n      isEscaped = false;\n      continue;\n    }\n    if (flags.i) {\n      if (inCharGroup) {\n        if (source[i].match(/[a-z]/)) {\n          if (inCharRange) {\n            pattern += source[i];\n            pattern += `${source[i - 2]}-${source[i]}`.toUpperCase();\n            inCharRange = false;\n          } else if (source[i + 1] === \"-\" && ((_a2 = source[i + 2]) == null ? void 0 : _a2.match(/[a-z]/))) {\n            pattern += source[i];\n            inCharRange = true;\n          } else {\n            pattern += `${source[i]}${source[i].toUpperCase()}`;\n          }\n          continue;\n        }\n      } else if (source[i].match(/[a-z]/)) {\n        pattern += `[${source[i]}${source[i].toUpperCase()}]`;\n        continue;\n      }\n    }\n    if (flags.m) {\n      if (source[i] === \"^\") {\n        pattern += `(^|(?<=[\\r\n]))`;\n        continue;\n      } else if (source[i] === \"$\") {\n        pattern += `($|(?=[\\r\n]))`;\n        continue;\n      }\n    }\n    if (flags.s && source[i] === \".\") {\n      pattern += inCharGroup ? `${source[i]}\\r\n` : `[${source[i]}\\r\n]`;\n      continue;\n    }\n    pattern += source[i];\n    if (source[i] === \"\\\\\") {\n      isEscaped = true;\n    } else if (inCharGroup && source[i] === \"]\") {\n      inCharGroup = false;\n    } else if (!inCharGroup && source[i] === \"[\") {\n      inCharGroup = true;\n    }\n  }\n  try {\n    new RegExp(pattern);\n  } catch (e) {\n    console.warn(\n      `Could not convert regex pattern at ${refs.currentPath.join(\n        \"/\"\n      )} to a flag-independent form! Falling back to the flag-ignorant source`\n    );\n    return regex.source;\n  }\n  return pattern;\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/record.ts\nfunction parseRecordDef(def, refs) {\n  var _a2, _b2, _c, _d, _e, _f;\n  const schema = {\n    type: \"object\",\n    additionalProperties: (_a2 = parseDef(def.valueType._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, \"additionalProperties\"]\n    })) != null ? _a2 : refs.allowedAdditionalProperties\n  };\n  if (((_b2 = def.keyType) == null ? void 0 : _b2._def.typeName) === ZodFirstPartyTypeKind2.ZodString && ((_c = def.keyType._def.checks) == null ? void 0 : _c.length)) {\n    const { type, ...keyType } = parseStringDef(def.keyType._def, refs);\n    return {\n      ...schema,\n      propertyNames: keyType\n    };\n  } else if (((_d = def.keyType) == null ? void 0 : _d._def.typeName) === ZodFirstPartyTypeKind2.ZodEnum) {\n    return {\n      ...schema,\n      propertyNames: {\n        enum: def.keyType._def.values\n      }\n    };\n  } else if (((_e = def.keyType) == null ? void 0 : _e._def.typeName) === ZodFirstPartyTypeKind2.ZodBranded && def.keyType._def.type._def.typeName === ZodFirstPartyTypeKind2.ZodString && ((_f = def.keyType._def.type._def.checks) == null ? void 0 : _f.length)) {\n    const { type, ...keyType } = parseBrandedDef(\n      def.keyType._def,\n      refs\n    );\n    return {\n      ...schema,\n      propertyNames: keyType\n    };\n  }\n  return schema;\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/map.ts\nfunction parseMapDef(def, refs) {\n  if (refs.mapStrategy === \"record\") {\n    return parseRecordDef(def, refs);\n  }\n  const keys = parseDef(def.keyType._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, \"items\", \"items\", \"0\"]\n  }) || parseAnyDef();\n  const values = parseDef(def.valueType._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, \"items\", \"items\", \"1\"]\n  }) || parseAnyDef();\n  return {\n    type: \"array\",\n    maxItems: 125,\n    items: {\n      type: \"array\",\n      items: [keys, values],\n      minItems: 2,\n      maxItems: 2\n    }\n  };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/native-enum.ts\nfunction parseNativeEnumDef(def) {\n  const object = def.values;\n  const actualKeys = Object.keys(def.values).filter((key) => {\n    return typeof object[object[key]] !== \"number\";\n  });\n  const actualValues = actualKeys.map((key) => object[key]);\n  const parsedTypes = Array.from(\n    new Set(actualValues.map((values) => typeof values))\n  );\n  return {\n    type: parsedTypes.length === 1 ? parsedTypes[0] === \"string\" ? \"string\" : \"number\" : [\"string\", \"number\"],\n    enum: actualValues\n  };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/never.ts\nfunction parseNeverDef() {\n  return { not: parseAnyDef() };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/null.ts\nfunction parseNullDef() {\n  return {\n    type: \"null\"\n  };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/union.ts\nvar primitiveMappings = {\n  ZodString: \"string\",\n  ZodNumber: \"number\",\n  ZodBigInt: \"integer\",\n  ZodBoolean: \"boolean\",\n  ZodNull: \"null\"\n};\nfunction parseUnionDef(def, refs) {\n  const options = def.options instanceof Map ? Array.from(def.options.values()) : def.options;\n  if (options.every(\n    (x) => x._def.typeName in primitiveMappings && (!x._def.checks || !x._def.checks.length)\n  )) {\n    const types = options.reduce((types2, x) => {\n      const type = primitiveMappings[x._def.typeName];\n      return type && !types2.includes(type) ? [...types2, type] : types2;\n    }, []);\n    return {\n      type: types.length > 1 ? types : types[0]\n    };\n  } else if (options.every((x) => x._def.typeName === \"ZodLiteral\" && !x.description)) {\n    const types = options.reduce(\n      (acc, x) => {\n        const type = typeof x._def.value;\n        switch (type) {\n          case \"string\":\n          case \"number\":\n          case \"boolean\":\n            return [...acc, type];\n          case \"bigint\":\n            return [...acc, \"integer\"];\n          case \"object\":\n            if (x._def.value === null) return [...acc, \"null\"];\n          case \"symbol\":\n          case \"undefined\":\n          case \"function\":\n          default:\n            return acc;\n        }\n      },\n      []\n    );\n    if (types.length === options.length) {\n      const uniqueTypes = types.filter((x, i, a) => a.indexOf(x) === i);\n      return {\n        type: uniqueTypes.length > 1 ? uniqueTypes : uniqueTypes[0],\n        enum: options.reduce(\n          (acc, x) => {\n            return acc.includes(x._def.value) ? acc : [...acc, x._def.value];\n          },\n          []\n        )\n      };\n    }\n  } else if (options.every((x) => x._def.typeName === \"ZodEnum\")) {\n    return {\n      type: \"string\",\n      enum: options.reduce(\n        (acc, x) => [\n          ...acc,\n          ...x._def.values.filter((x2) => !acc.includes(x2))\n        ],\n        []\n      )\n    };\n  }\n  return asAnyOf(def, refs);\n}\nvar asAnyOf = (def, refs) => {\n  const anyOf = (def.options instanceof Map ? Array.from(def.options.values()) : def.options).map(\n    (x, i) => parseDef(x._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, \"anyOf\", `${i}`]\n    })\n  ).filter(\n    (x) => !!x && (!refs.strictUnions || typeof x === \"object\" && Object.keys(x).length > 0)\n  );\n  return anyOf.length ? { anyOf } : void 0;\n};\n\n// src/to-json-schema/zod3-to-json-schema/parsers/nullable.ts\nfunction parseNullableDef(def, refs) {\n  if ([\"ZodString\", \"ZodNumber\", \"ZodBigInt\", \"ZodBoolean\", \"ZodNull\"].includes(\n    def.innerType._def.typeName\n  ) && (!def.innerType._def.checks || !def.innerType._def.checks.length)) {\n    return {\n      type: [\n        primitiveMappings[def.innerType._def.typeName],\n        \"null\"\n      ]\n    };\n  }\n  const base = parseDef(def.innerType._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, \"anyOf\", \"0\"]\n  });\n  return base && { anyOf: [base, { type: \"null\" }] };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/number.ts\nfunction parseNumberDef(def) {\n  const res = {\n    type: \"number\"\n  };\n  if (!def.checks) return res;\n  for (const check of def.checks) {\n    switch (check.kind) {\n      case \"int\":\n        res.type = \"integer\";\n        break;\n      case \"min\":\n        if (check.inclusive) {\n          res.minimum = check.value;\n        } else {\n          res.exclusiveMinimum = check.value;\n        }\n        break;\n      case \"max\":\n        if (check.inclusive) {\n          res.maximum = check.value;\n        } else {\n          res.exclusiveMaximum = check.value;\n        }\n        break;\n      case \"multipleOf\":\n        res.multipleOf = check.value;\n        break;\n    }\n  }\n  return res;\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/object.ts\nfunction parseObjectDef(def, refs) {\n  const result = {\n    type: \"object\",\n    properties: {}\n  };\n  const required = [];\n  const shape = def.shape();\n  for (const propName in shape) {\n    let propDef = shape[propName];\n    if (propDef === void 0 || propDef._def === void 0) {\n      continue;\n    }\n    const propOptional = safeIsOptional(propDef);\n    const parsedDef = parseDef(propDef._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, \"properties\", propName],\n      propertyPath: [...refs.currentPath, \"properties\", propName]\n    });\n    if (parsedDef === void 0) {\n      continue;\n    }\n    result.properties[propName] = parsedDef;\n    if (!propOptional) {\n      required.push(propName);\n    }\n  }\n  if (required.length) {\n    result.required = required;\n  }\n  const additionalProperties = decideAdditionalProperties(def, refs);\n  if (additionalProperties !== void 0) {\n    result.additionalProperties = additionalProperties;\n  }\n  return result;\n}\nfunction decideAdditionalProperties(def, refs) {\n  if (def.catchall._def.typeName !== \"ZodNever\") {\n    return parseDef(def.catchall._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, \"additionalProperties\"]\n    });\n  }\n  switch (def.unknownKeys) {\n    case \"passthrough\":\n      return refs.allowedAdditionalProperties;\n    case \"strict\":\n      return refs.rejectedAdditionalProperties;\n    case \"strip\":\n      return refs.removeAdditionalStrategy === \"strict\" ? refs.allowedAdditionalProperties : refs.rejectedAdditionalProperties;\n  }\n}\nfunction safeIsOptional(schema) {\n  try {\n    return schema.isOptional();\n  } catch (e) {\n    return true;\n  }\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/optional.ts\nvar parseOptionalDef = (def, refs) => {\n  var _a2;\n  if (refs.currentPath.toString() === ((_a2 = refs.propertyPath) == null ? void 0 : _a2.toString())) {\n    return parseDef(def.innerType._def, refs);\n  }\n  const innerSchema = parseDef(def.innerType._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, \"anyOf\", \"1\"]\n  });\n  return innerSchema ? { anyOf: [{ not: parseAnyDef() }, innerSchema] } : parseAnyDef();\n};\n\n// src/to-json-schema/zod3-to-json-schema/parsers/pipeline.ts\nvar parsePipelineDef = (def, refs) => {\n  if (refs.pipeStrategy === \"input\") {\n    return parseDef(def.in._def, refs);\n  } else if (refs.pipeStrategy === \"output\") {\n    return parseDef(def.out._def, refs);\n  }\n  const a = parseDef(def.in._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, \"allOf\", \"0\"]\n  });\n  const b = parseDef(def.out._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, \"allOf\", a ? \"1\" : \"0\"]\n  });\n  return {\n    allOf: [a, b].filter((x) => x !== void 0)\n  };\n};\n\n// src/to-json-schema/zod3-to-json-schema/parsers/promise.ts\nfunction parsePromiseDef(def, refs) {\n  return parseDef(def.type._def, refs);\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/set.ts\nfunction parseSetDef(def, refs) {\n  const items = parseDef(def.valueType._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, \"items\"]\n  });\n  const schema = {\n    type: \"array\",\n    uniqueItems: true,\n    items\n  };\n  if (def.minSize) {\n    schema.minItems = def.minSize.value;\n  }\n  if (def.maxSize) {\n    schema.maxItems = def.maxSize.value;\n  }\n  return schema;\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/tuple.ts\nfunction parseTupleDef(def, refs) {\n  if (def.rest) {\n    return {\n      type: \"array\",\n      minItems: def.items.length,\n      items: def.items.map(\n        (x, i) => parseDef(x._def, {\n          ...refs,\n          currentPath: [...refs.currentPath, \"items\", `${i}`]\n        })\n      ).reduce(\n        (acc, x) => x === void 0 ? acc : [...acc, x],\n        []\n      ),\n      additionalItems: parseDef(def.rest._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"additionalItems\"]\n      })\n    };\n  } else {\n    return {\n      type: \"array\",\n      minItems: def.items.length,\n      maxItems: def.items.length,\n      items: def.items.map(\n        (x, i) => parseDef(x._def, {\n          ...refs,\n          currentPath: [...refs.currentPath, \"items\", `${i}`]\n        })\n      ).reduce(\n        (acc, x) => x === void 0 ? acc : [...acc, x],\n        []\n      )\n    };\n  }\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/undefined.ts\nfunction parseUndefinedDef() {\n  return {\n    not: parseAnyDef()\n  };\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/unknown.ts\nfunction parseUnknownDef() {\n  return parseAnyDef();\n}\n\n// src/to-json-schema/zod3-to-json-schema/parsers/readonly.ts\nvar parseReadonlyDef = (def, refs) => {\n  return parseDef(def.innerType._def, refs);\n};\n\n// src/to-json-schema/zod3-to-json-schema/select-parser.ts\nvar selectParser = (def, typeName, refs) => {\n  switch (typeName) {\n    case ZodFirstPartyTypeKind3.ZodString:\n      return parseStringDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodNumber:\n      return parseNumberDef(def);\n    case ZodFirstPartyTypeKind3.ZodObject:\n      return parseObjectDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodBigInt:\n      return parseBigintDef(def);\n    case ZodFirstPartyTypeKind3.ZodBoolean:\n      return parseBooleanDef();\n    case ZodFirstPartyTypeKind3.ZodDate:\n      return parseDateDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodUndefined:\n      return parseUndefinedDef();\n    case ZodFirstPartyTypeKind3.ZodNull:\n      return parseNullDef();\n    case ZodFirstPartyTypeKind3.ZodArray:\n      return parseArrayDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodUnion:\n    case ZodFirstPartyTypeKind3.ZodDiscriminatedUnion:\n      return parseUnionDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodIntersection:\n      return parseIntersectionDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodTuple:\n      return parseTupleDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodRecord:\n      return parseRecordDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodLiteral:\n      return parseLiteralDef(def);\n    case ZodFirstPartyTypeKind3.ZodEnum:\n      return parseEnumDef(def);\n    case ZodFirstPartyTypeKind3.ZodNativeEnum:\n      return parseNativeEnumDef(def);\n    case ZodFirstPartyTypeKind3.ZodNullable:\n      return parseNullableDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodOptional:\n      return parseOptionalDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodMap:\n      return parseMapDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodSet:\n      return parseSetDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodLazy:\n      return () => def.getter()._def;\n    case ZodFirstPartyTypeKind3.ZodPromise:\n      return parsePromiseDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodNaN:\n    case ZodFirstPartyTypeKind3.ZodNever:\n      return parseNeverDef();\n    case ZodFirstPartyTypeKind3.ZodEffects:\n      return parseEffectsDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodAny:\n      return parseAnyDef();\n    case ZodFirstPartyTypeKind3.ZodUnknown:\n      return parseUnknownDef();\n    case ZodFirstPartyTypeKind3.ZodDefault:\n      return parseDefaultDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodBranded:\n      return parseBrandedDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodReadonly:\n      return parseReadonlyDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodCatch:\n      return parseCatchDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodPipeline:\n      return parsePipelineDef(def, refs);\n    case ZodFirstPartyTypeKind3.ZodFunction:\n    case ZodFirstPartyTypeKind3.ZodVoid:\n    case ZodFirstPartyTypeKind3.ZodSymbol:\n      return void 0;\n    default:\n      return /* @__PURE__ */ ((_) => void 0)(typeName);\n  }\n};\n\n// src/to-json-schema/zod3-to-json-schema/get-relative-path.ts\nvar getRelativePath = (pathA, pathB) => {\n  let i = 0;\n  for (; i < pathA.length && i < pathB.length; i++) {\n    if (pathA[i] !== pathB[i]) break;\n  }\n  return [(pathA.length - i).toString(), ...pathB.slice(i)].join(\"/\");\n};\n\n// src/to-json-schema/zod3-to-json-schema/parse-def.ts\nfunction parseDef(def, refs, forceResolution = false) {\n  var _a2;\n  const seenItem = refs.seen.get(def);\n  if (refs.override) {\n    const overrideResult = (_a2 = refs.override) == null ? void 0 : _a2.call(\n      refs,\n      def,\n      refs,\n      seenItem,\n      forceResolution\n    );\n    if (overrideResult !== ignoreOverride) {\n      return overrideResult;\n    }\n  }\n  if (seenItem && !forceResolution) {\n    const seenSchema = get$ref(seenItem, refs);\n    if (seenSchema !== void 0) {\n      return seenSchema;\n    }\n  }\n  const newItem = { def, path: refs.currentPath, jsonSchema: void 0 };\n  refs.seen.set(def, newItem);\n  const jsonSchemaOrGetter = selectParser(def, def.typeName, refs);\n  const jsonSchema2 = typeof jsonSchemaOrGetter === \"function\" ? parseDef(jsonSchemaOrGetter(), refs) : jsonSchemaOrGetter;\n  if (jsonSchema2) {\n    addMeta(def, refs, jsonSchema2);\n  }\n  if (refs.postProcess) {\n    const postProcessResult = refs.postProcess(jsonSchema2, def, refs);\n    newItem.jsonSchema = jsonSchema2;\n    return postProcessResult;\n  }\n  newItem.jsonSchema = jsonSchema2;\n  return jsonSchema2;\n}\nvar get$ref = (item, refs) => {\n  switch (refs.$refStrategy) {\n    case \"root\":\n      return { $ref: item.path.join(\"/\") };\n    case \"relative\":\n      return { $ref: getRelativePath(refs.currentPath, item.path) };\n    case \"none\":\n    case \"seen\": {\n      if (item.path.length < refs.currentPath.length && item.path.every((value, index) => refs.currentPath[index] === value)) {\n        console.warn(\n          `Recursive reference detected at ${refs.currentPath.join(\n            \"/\"\n          )}! Defaulting to any`\n        );\n        return parseAnyDef();\n      }\n      return refs.$refStrategy === \"seen\" ? parseAnyDef() : void 0;\n    }\n  }\n};\nvar addMeta = (def, refs, jsonSchema2) => {\n  if (def.description) {\n    jsonSchema2.description = def.description;\n  }\n  return jsonSchema2;\n};\n\n// src/to-json-schema/zod3-to-json-schema/refs.ts\nvar getRefs = (options) => {\n  const _options = getDefaultOptions(options);\n  const currentPath = _options.name !== void 0 ? [..._options.basePath, _options.definitionPath, _options.name] : _options.basePath;\n  return {\n    ..._options,\n    currentPath,\n    propertyPath: void 0,\n    seen: new Map(\n      Object.entries(_options.definitions).map(([name2, def]) => [\n        def._def,\n        {\n          def: def._def,\n          path: [..._options.basePath, _options.definitionPath, name2],\n          // Resolution of references will be forced even though seen, so it's ok that the schema is undefined here for now.\n          jsonSchema: void 0\n        }\n      ])\n    )\n  };\n};\n\n// src/to-json-schema/zod3-to-json-schema/zod3-to-json-schema.ts\nvar zod3ToJsonSchema = (schema, options) => {\n  var _a2;\n  const refs = getRefs(options);\n  let definitions = typeof options === \"object\" && options.definitions ? Object.entries(options.definitions).reduce(\n    (acc, [name3, schema2]) => {\n      var _a3;\n      return {\n        ...acc,\n        [name3]: (_a3 = parseDef(\n          schema2._def,\n          {\n            ...refs,\n            currentPath: [...refs.basePath, refs.definitionPath, name3]\n          },\n          true\n        )) != null ? _a3 : parseAnyDef()\n      };\n    },\n    {}\n  ) : void 0;\n  const name2 = typeof options === \"string\" ? options : (options == null ? void 0 : options.nameStrategy) === \"title\" ? void 0 : options == null ? void 0 : options.name;\n  const main = (_a2 = parseDef(\n    schema._def,\n    name2 === void 0 ? refs : {\n      ...refs,\n      currentPath: [...refs.basePath, refs.definitionPath, name2]\n    },\n    false\n  )) != null ? _a2 : parseAnyDef();\n  const title = typeof options === \"object\" && options.name !== void 0 && options.nameStrategy === \"title\" ? options.name : void 0;\n  if (title !== void 0) {\n    main.title = title;\n  }\n  const combined = name2 === void 0 ? definitions ? {\n    ...main,\n    [refs.definitionPath]: definitions\n  } : main : {\n    $ref: [\n      ...refs.$refStrategy === \"relative\" ? [] : refs.basePath,\n      refs.definitionPath,\n      name2\n    ].join(\"/\"),\n    [refs.definitionPath]: {\n      ...definitions,\n      [name2]: main\n    }\n  };\n  combined.$schema = \"http://json-schema.org/draft-07/schema#\";\n  return combined;\n};\n\n// src/schema.ts\nvar schemaSymbol = Symbol.for(\"vercel.ai.schema\");\nfunction lazySchema(createSchema) {\n  let schema;\n  return () => {\n    if (schema == null) {\n      schema = createSchema();\n    }\n    return schema;\n  };\n}\nfunction jsonSchema(jsonSchema2, {\n  validate\n} = {}) {\n  return {\n    [schemaSymbol]: true,\n    _type: void 0,\n    // should never be used directly\n    get jsonSchema() {\n      if (typeof jsonSchema2 === \"function\") {\n        jsonSchema2 = jsonSchema2();\n      }\n      return jsonSchema2;\n    },\n    validate\n  };\n}\nfunction isSchema(value) {\n  return typeof value === \"object\" && value !== null && schemaSymbol in value && value[schemaSymbol] === true && \"jsonSchema\" in value && \"validate\" in value;\n}\nfunction asSchema(schema) {\n  return schema == null ? jsonSchema({ properties: {}, additionalProperties: false }) : isSchema(schema) ? schema : \"~standard\" in schema ? schema[\"~standard\"].vendor === \"zod\" ? zodSchema(schema) : standardSchema(schema) : schema();\n}\nfunction standardSchema(standardSchema2) {\n  return jsonSchema(\n    () => standardSchema2[\"~standard\"].jsonSchema.input({\n      target: \"draft-07\"\n    }),\n    {\n      validate: async (value) => {\n        const result = await standardSchema2[\"~standard\"].validate(value);\n        return \"value\" in result ? { success: true, value: result.value } : {\n          success: false,\n          error: new TypeValidationError({\n            value,\n            cause: result.issues\n          })\n        };\n      }\n    }\n  );\n}\nfunction zod3Schema(zodSchema2, options) {\n  var _a2;\n  const useReferences = (_a2 = options == null ? void 0 : options.useReferences) != null ? _a2 : false;\n  return jsonSchema(\n    // defer json schema creation to avoid unnecessary computation when only validation is needed\n    () => zod3ToJsonSchema(zodSchema2, {\n      $refStrategy: useReferences ? \"root\" : \"none\"\n    }),\n    {\n      validate: async (value) => {\n        const result = await zodSchema2.safeParseAsync(value);\n        return result.success ? { success: true, value: result.data } : { success: false, error: result.error };\n      }\n    }\n  );\n}\nfunction zod4Schema(zodSchema2, options) {\n  var _a2;\n  const useReferences = (_a2 = options == null ? void 0 : options.useReferences) != null ? _a2 : false;\n  return jsonSchema(\n    // defer json schema creation to avoid unnecessary computation when only validation is needed\n    () => addAdditionalPropertiesToJsonSchema(\n      z4.toJSONSchema(zodSchema2, {\n        target: \"draft-7\",\n        io: \"input\",\n        reused: useReferences ? \"ref\" : \"inline\"\n      })\n    ),\n    {\n      validate: async (value) => {\n        const result = await z4.safeParseAsync(zodSchema2, value);\n        return result.success ? { success: true, value: result.data } : { success: false, error: result.error };\n      }\n    }\n  );\n}\nfunction isZod4Schema(zodSchema2) {\n  return \"_zod\" in zodSchema2;\n}\nfunction zodSchema(zodSchema2, options) {\n  if (isZod4Schema(zodSchema2)) {\n    return zod4Schema(zodSchema2, options);\n  } else {\n    return zod3Schema(zodSchema2, options);\n  }\n}\n\n// src/validate-types.ts\nasync function validateTypes({\n  value,\n  schema\n}) {\n  const result = await safeValidateTypes({ value, schema });\n  if (!result.success) {\n    throw TypeValidationError2.wrap({ value, cause: result.error });\n  }\n  return result.value;\n}\nasync function safeValidateTypes({\n  value,\n  schema\n}) {\n  const actualSchema = asSchema(schema);\n  try {\n    if (actualSchema.validate == null) {\n      return { success: true, value, rawValue: value };\n    }\n    const result = await actualSchema.validate(value);\n    if (result.success) {\n      return { success: true, value: result.value, rawValue: value };\n    }\n    return {\n      success: false,\n      error: TypeValidationError2.wrap({ value, cause: result.error }),\n      rawValue: value\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: TypeValidationError2.wrap({ value, cause: error }),\n      rawValue: value\n    };\n  }\n}\n\n// src/parse-json.ts\nasync function parseJSON({\n  text,\n  schema\n}) {\n  try {\n    const value = secureJsonParse(text);\n    if (schema == null) {\n      return value;\n    }\n    return validateTypes({ value, schema });\n  } catch (error) {\n    if (JSONParseError.isInstance(error) || TypeValidationError3.isInstance(error)) {\n      throw error;\n    }\n    throw new JSONParseError({ text, cause: error });\n  }\n}\nasync function safeParseJSON({\n  text,\n  schema\n}) {\n  try {\n    const value = secureJsonParse(text);\n    if (schema == null) {\n      return { success: true, value, rawValue: value };\n    }\n    return await safeValidateTypes({ value, schema });\n  } catch (error) {\n    return {\n      success: false,\n      error: JSONParseError.isInstance(error) ? error : new JSONParseError({ text, cause: error }),\n      rawValue: void 0\n    };\n  }\n}\nfunction isParsableJson(input) {\n  try {\n    secureJsonParse(input);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n// src/parse-json-event-stream.ts\nimport {\n  EventSourceParserStream\n} from \"eventsource-parser/stream\";\nfunction parseJsonEventStream({\n  stream,\n  schema\n}) {\n  return stream.pipeThrough(new TextDecoderStream()).pipeThrough(new EventSourceParserStream()).pipeThrough(\n    new TransformStream({\n      async transform({ data }, controller) {\n        if (data === \"[DONE]\") {\n          return;\n        }\n        controller.enqueue(await safeParseJSON({ text: data, schema }));\n      }\n    })\n  );\n}\n\n// src/parse-provider-options.ts\nimport { InvalidArgumentError as InvalidArgumentError2 } from \"@ai-sdk/provider\";\nasync function parseProviderOptions({\n  provider,\n  providerOptions,\n  schema\n}) {\n  if ((providerOptions == null ? void 0 : providerOptions[provider]) == null) {\n    return void 0;\n  }\n  const parsedProviderOptions = await safeValidateTypes({\n    value: providerOptions[provider],\n    schema\n  });\n  if (!parsedProviderOptions.success) {\n    throw new InvalidArgumentError2({\n      argument: \"providerOptions\",\n      message: `invalid ${provider} provider options`,\n      cause: parsedProviderOptions.error\n    });\n  }\n  return parsedProviderOptions.value;\n}\n\n// src/post-to-api.ts\nimport { APICallError as APICallError3 } from \"@ai-sdk/provider\";\nvar getOriginalFetch2 = () => globalThis.fetch;\nvar postJsonToApi = async ({\n  url,\n  headers,\n  body,\n  failedResponseHandler,\n  successfulResponseHandler,\n  abortSignal,\n  fetch: fetch2\n}) => postToApi({\n  url,\n  headers: {\n    \"Content-Type\": \"application/json\",\n    ...headers\n  },\n  body: {\n    content: JSON.stringify(body),\n    values: body\n  },\n  failedResponseHandler,\n  successfulResponseHandler,\n  abortSignal,\n  fetch: fetch2\n});\nvar postFormDataToApi = async ({\n  url,\n  headers,\n  formData,\n  failedResponseHandler,\n  successfulResponseHandler,\n  abortSignal,\n  fetch: fetch2\n}) => postToApi({\n  url,\n  headers,\n  body: {\n    content: formData,\n    values: Object.fromEntries(formData.entries())\n  },\n  failedResponseHandler,\n  successfulResponseHandler,\n  abortSignal,\n  fetch: fetch2\n});\nvar postToApi = async ({\n  url,\n  headers = {},\n  body,\n  successfulResponseHandler,\n  failedResponseHandler,\n  abortSignal,\n  fetch: fetch2 = getOriginalFetch2()\n}) => {\n  try {\n    const response = await fetch2(url, {\n      method: \"POST\",\n      headers: withUserAgentSuffix(\n        headers,\n        `ai-sdk/provider-utils/${VERSION}`,\n        getRuntimeEnvironmentUserAgent()\n      ),\n      body: body.content,\n      signal: abortSignal\n    });\n    const responseHeaders = extractResponseHeaders(response);\n    if (!response.ok) {\n      let errorInformation;\n      try {\n        errorInformation = await failedResponseHandler({\n          response,\n          url,\n          requestBodyValues: body.values\n        });\n      } catch (error) {\n        if (isAbortError(error) || APICallError3.isInstance(error)) {\n          throw error;\n        }\n        throw new APICallError3({\n          message: \"Failed to process error response\",\n          cause: error,\n          statusCode: response.status,\n          url,\n          responseHeaders,\n          requestBodyValues: body.values\n        });\n      }\n      throw errorInformation.value;\n    }\n    try {\n      return await successfulResponseHandler({\n        response,\n        url,\n        requestBodyValues: body.values\n      });\n    } catch (error) {\n      if (error instanceof Error) {\n        if (isAbortError(error) || APICallError3.isInstance(error)) {\n          throw error;\n        }\n      }\n      throw new APICallError3({\n        message: \"Failed to process successful response\",\n        cause: error,\n        statusCode: response.status,\n        url,\n        responseHeaders,\n        requestBodyValues: body.values\n      });\n    }\n  } catch (error) {\n    throw handleFetchError({ error, url, requestBodyValues: body.values });\n  }\n};\n\n// src/types/tool.ts\nfunction tool(tool2) {\n  return tool2;\n}\nfunction dynamicTool(tool2) {\n  return { ...tool2, type: \"dynamic\" };\n}\n\n// src/provider-tool-factory.ts\nfunction createProviderToolFactory({\n  id,\n  inputSchema\n}) {\n  return ({\n    execute,\n    outputSchema,\n    needsApproval,\n    toModelOutput,\n    onInputStart,\n    onInputDelta,\n    onInputAvailable,\n    ...args\n  }) => tool({\n    type: \"provider\",\n    id,\n    args,\n    inputSchema,\n    outputSchema,\n    execute,\n    needsApproval,\n    toModelOutput,\n    onInputStart,\n    onInputDelta,\n    onInputAvailable\n  });\n}\nfunction createProviderToolFactoryWithOutputSchema({\n  id,\n  inputSchema,\n  outputSchema,\n  supportsDeferredResults\n}) {\n  return ({\n    execute,\n    needsApproval,\n    toModelOutput,\n    onInputStart,\n    onInputDelta,\n    onInputAvailable,\n    ...args\n  }) => tool({\n    type: \"provider\",\n    id,\n    args,\n    inputSchema,\n    outputSchema,\n    execute,\n    needsApproval,\n    toModelOutput,\n    onInputStart,\n    onInputDelta,\n    onInputAvailable,\n    supportsDeferredResults\n  });\n}\n\n// src/remove-undefined-entries.ts\nfunction removeUndefinedEntries(record) {\n  return Object.fromEntries(\n    Object.entries(record).filter(([_key, value]) => value != null)\n  );\n}\n\n// src/resolve.ts\nasync function resolve(value) {\n  if (typeof value === \"function\") {\n    value = value();\n  }\n  return Promise.resolve(value);\n}\n\n// src/response-handler.ts\nimport { APICallError as APICallError4, EmptyResponseBodyError } from \"@ai-sdk/provider\";\nvar createJsonErrorResponseHandler = ({\n  errorSchema,\n  errorToMessage,\n  isRetryable\n}) => async ({ response, url, requestBodyValues }) => {\n  const responseBody = await response.text();\n  const responseHeaders = extractResponseHeaders(response);\n  if (responseBody.trim() === \"\") {\n    return {\n      responseHeaders,\n      value: new APICallError4({\n        message: response.statusText,\n        url,\n        requestBodyValues,\n        statusCode: response.status,\n        responseHeaders,\n        responseBody,\n        isRetryable: isRetryable == null ? void 0 : isRetryable(response)\n      })\n    };\n  }\n  try {\n    const parsedError = await parseJSON({\n      text: responseBody,\n      schema: errorSchema\n    });\n    return {\n      responseHeaders,\n      value: new APICallError4({\n        message: errorToMessage(parsedError),\n        url,\n        requestBodyValues,\n        statusCode: response.status,\n        responseHeaders,\n        responseBody,\n        data: parsedError,\n        isRetryable: isRetryable == null ? void 0 : isRetryable(response, parsedError)\n      })\n    };\n  } catch (parseError) {\n    return {\n      responseHeaders,\n      value: new APICallError4({\n        message: response.statusText,\n        url,\n        requestBodyValues,\n        statusCode: response.status,\n        responseHeaders,\n        responseBody,\n        isRetryable: isRetryable == null ? void 0 : isRetryable(response)\n      })\n    };\n  }\n};\nvar createEventSourceResponseHandler = (chunkSchema) => async ({ response }) => {\n  const responseHeaders = extractResponseHeaders(response);\n  if (response.body == null) {\n    throw new EmptyResponseBodyError({});\n  }\n  return {\n    responseHeaders,\n    value: parseJsonEventStream({\n      stream: response.body,\n      schema: chunkSchema\n    })\n  };\n};\nvar createJsonResponseHandler = (responseSchema) => async ({ response, url, requestBodyValues }) => {\n  const responseBody = await response.text();\n  const parsedResult = await safeParseJSON({\n    text: responseBody,\n    schema: responseSchema\n  });\n  const responseHeaders = extractResponseHeaders(response);\n  if (!parsedResult.success) {\n    throw new APICallError4({\n      message: \"Invalid JSON response\",\n      cause: parsedResult.error,\n      statusCode: response.status,\n      responseHeaders,\n      responseBody,\n      url,\n      requestBodyValues\n    });\n  }\n  return {\n    responseHeaders,\n    value: parsedResult.value,\n    rawValue: parsedResult.rawValue\n  };\n};\nvar createBinaryResponseHandler = () => async ({ response, url, requestBodyValues }) => {\n  const responseHeaders = extractResponseHeaders(response);\n  if (!response.body) {\n    throw new APICallError4({\n      message: \"Response body is empty\",\n      url,\n      requestBodyValues,\n      statusCode: response.status,\n      responseHeaders,\n      responseBody: void 0\n    });\n  }\n  try {\n    const buffer = await response.arrayBuffer();\n    return {\n      responseHeaders,\n      value: new Uint8Array(buffer)\n    };\n  } catch (error) {\n    throw new APICallError4({\n      message: \"Failed to read response as array buffer\",\n      url,\n      requestBodyValues,\n      statusCode: response.status,\n      responseHeaders,\n      responseBody: void 0,\n      cause: error\n    });\n  }\n};\nvar createStatusCodeErrorResponseHandler = () => async ({ response, url, requestBodyValues }) => {\n  const responseHeaders = extractResponseHeaders(response);\n  const responseBody = await response.text();\n  return {\n    responseHeaders,\n    value: new APICallError4({\n      message: response.statusText,\n      url,\n      requestBodyValues,\n      statusCode: response.status,\n      responseHeaders,\n      responseBody\n    })\n  };\n};\n\n// src/without-trailing-slash.ts\nfunction withoutTrailingSlash(url) {\n  return url == null ? void 0 : url.replace(/\\/$/, \"\");\n}\n\n// src/is-async-iterable.ts\nfunction isAsyncIterable(obj) {\n  return obj != null && typeof obj[Symbol.asyncIterator] === \"function\";\n}\n\n// src/types/execute-tool.ts\nasync function* executeTool({\n  execute,\n  input,\n  options\n}) {\n  const result = execute(input, options);\n  if (isAsyncIterable(result)) {\n    let lastOutput;\n    for await (const output of result) {\n      lastOutput = output;\n      yield { type: \"preliminary\", output };\n    }\n    yield { type: \"final\", output: lastOutput };\n  } else {\n    yield { type: \"final\", output: await result };\n  }\n}\n\n// src/index.ts\nexport * from \"@standard-schema/spec\";\nimport {\n  EventSourceParserStream as EventSourceParserStream2\n} from \"eventsource-parser/stream\";\nexport {\n  DelayedPromise,\n  DownloadError,\n  EventSourceParserStream2 as EventSourceParserStream,\n  VERSION,\n  asSchema,\n  combineHeaders,\n  convertAsyncIteratorToReadableStream,\n  convertBase64ToUint8Array,\n  convertImageModelFileToDataUri,\n  convertToBase64,\n  convertToFormData,\n  convertUint8ArrayToBase64,\n  createBinaryResponseHandler,\n  createEventSourceResponseHandler,\n  createIdGenerator,\n  createJsonErrorResponseHandler,\n  createJsonResponseHandler,\n  createProviderToolFactory,\n  createProviderToolFactoryWithOutputSchema,\n  createStatusCodeErrorResponseHandler,\n  createToolNameMapping,\n  delay,\n  downloadBlob,\n  dynamicTool,\n  executeTool,\n  extractResponseHeaders,\n  generateId,\n  getErrorMessage,\n  getFromApi,\n  getRuntimeEnvironmentUserAgent,\n  injectJsonInstructionIntoMessages,\n  isAbortError,\n  isNonNullable,\n  isParsableJson,\n  isUrlSupported,\n  jsonSchema,\n  lazySchema,\n  loadApiKey,\n  loadOptionalSetting,\n  loadSetting,\n  mediaTypeToExtension,\n  normalizeHeaders,\n  parseJSON,\n  parseJsonEventStream,\n  parseProviderOptions,\n  postFormDataToApi,\n  postJsonToApi,\n  postToApi,\n  removeUndefinedEntries,\n  resolve,\n  safeParseJSON,\n  safeValidateTypes,\n  tool,\n  validateTypes,\n  withUserAgentSuffix,\n  withoutTrailingSlash,\n  zodSchema\n};\n//# sourceMappingURL=index.mjs.map","// src/gateway-provider.ts\nimport {\n  loadOptionalSetting,\n  withoutTrailingSlash\n} from \"@ai-sdk/provider-utils\";\n\n// src/errors/as-gateway-error.ts\nimport { APICallError } from \"@ai-sdk/provider\";\n\n// src/errors/create-gateway-error.ts\nimport { z as z2 } from \"zod/v4\";\n\n// src/errors/gateway-error.ts\nvar marker = \"vercel.ai.gateway.error\";\nvar symbol = Symbol.for(marker);\nvar _a, _b;\nvar GatewayError = class _GatewayError extends (_b = Error, _a = symbol, _b) {\n  constructor({\n    message,\n    statusCode = 500,\n    cause\n  }) {\n    super(message);\n    this[_a] = true;\n    this.statusCode = statusCode;\n    this.cause = cause;\n  }\n  /**\n   * Checks if the given error is a Gateway Error.\n   * @param {unknown} error - The error to check.\n   * @returns {boolean} True if the error is a Gateway Error, false otherwise.\n   */\n  static isInstance(error) {\n    return _GatewayError.hasMarker(error);\n  }\n  static hasMarker(error) {\n    return typeof error === \"object\" && error !== null && symbol in error && error[symbol] === true;\n  }\n};\n\n// src/errors/gateway-authentication-error.ts\nvar name = \"GatewayAuthenticationError\";\nvar marker2 = `vercel.ai.gateway.error.${name}`;\nvar symbol2 = Symbol.for(marker2);\nvar _a2, _b2;\nvar GatewayAuthenticationError = class _GatewayAuthenticationError extends (_b2 = GatewayError, _a2 = symbol2, _b2) {\n  constructor({\n    message = \"Authentication failed\",\n    statusCode = 401,\n    cause\n  } = {}) {\n    super({ message, statusCode, cause });\n    this[_a2] = true;\n    // used in isInstance\n    this.name = name;\n    this.type = \"authentication_error\";\n  }\n  static isInstance(error) {\n    return GatewayError.hasMarker(error) && symbol2 in error;\n  }\n  /**\n   * Creates a contextual error message when authentication fails\n   */\n  static createContextualError({\n    apiKeyProvided,\n    oidcTokenProvided,\n    message = \"Authentication failed\",\n    statusCode = 401,\n    cause\n  }) {\n    let contextualMessage;\n    if (apiKeyProvided) {\n      contextualMessage = `AI Gateway authentication failed: Invalid API key.\n\nCreate a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys\n\nProvide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`;\n    } else if (oidcTokenProvided) {\n      contextualMessage = `AI Gateway authentication failed: Invalid OIDC token.\n\nRun 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.\n\nAlternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`;\n    } else {\n      contextualMessage = `AI Gateway authentication failed: No authentication provided.\n\nOption 1 - API key:\nCreate an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys\nProvide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.\n\nOption 2 - OIDC token:\nRun 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`;\n    }\n    return new _GatewayAuthenticationError({\n      message: contextualMessage,\n      statusCode,\n      cause\n    });\n  }\n};\n\n// src/errors/gateway-invalid-request-error.ts\nvar name2 = \"GatewayInvalidRequestError\";\nvar marker3 = `vercel.ai.gateway.error.${name2}`;\nvar symbol3 = Symbol.for(marker3);\nvar _a3, _b3;\nvar GatewayInvalidRequestError = class extends (_b3 = GatewayError, _a3 = symbol3, _b3) {\n  constructor({\n    message = \"Invalid request\",\n    statusCode = 400,\n    cause\n  } = {}) {\n    super({ message, statusCode, cause });\n    this[_a3] = true;\n    // used in isInstance\n    this.name = name2;\n    this.type = \"invalid_request_error\";\n  }\n  static isInstance(error) {\n    return GatewayError.hasMarker(error) && symbol3 in error;\n  }\n};\n\n// src/errors/gateway-rate-limit-error.ts\nvar name3 = \"GatewayRateLimitError\";\nvar marker4 = `vercel.ai.gateway.error.${name3}`;\nvar symbol4 = Symbol.for(marker4);\nvar _a4, _b4;\nvar GatewayRateLimitError = class extends (_b4 = GatewayError, _a4 = symbol4, _b4) {\n  constructor({\n    message = \"Rate limit exceeded\",\n    statusCode = 429,\n    cause\n  } = {}) {\n    super({ message, statusCode, cause });\n    this[_a4] = true;\n    // used in isInstance\n    this.name = name3;\n    this.type = \"rate_limit_exceeded\";\n  }\n  static isInstance(error) {\n    return GatewayError.hasMarker(error) && symbol4 in error;\n  }\n};\n\n// src/errors/gateway-model-not-found-error.ts\nimport { z } from \"zod/v4\";\nimport { lazySchema, zodSchema } from \"@ai-sdk/provider-utils\";\nvar name4 = \"GatewayModelNotFoundError\";\nvar marker5 = `vercel.ai.gateway.error.${name4}`;\nvar symbol5 = Symbol.for(marker5);\nvar modelNotFoundParamSchema = lazySchema(\n  () => zodSchema(\n    z.object({\n      modelId: z.string()\n    })\n  )\n);\nvar _a5, _b5;\nvar GatewayModelNotFoundError = class extends (_b5 = GatewayError, _a5 = symbol5, _b5) {\n  constructor({\n    message = \"Model not found\",\n    statusCode = 404,\n    modelId,\n    cause\n  } = {}) {\n    super({ message, statusCode, cause });\n    this[_a5] = true;\n    // used in isInstance\n    this.name = name4;\n    this.type = \"model_not_found\";\n    this.modelId = modelId;\n  }\n  static isInstance(error) {\n    return GatewayError.hasMarker(error) && symbol5 in error;\n  }\n};\n\n// src/errors/gateway-internal-server-error.ts\nvar name5 = \"GatewayInternalServerError\";\nvar marker6 = `vercel.ai.gateway.error.${name5}`;\nvar symbol6 = Symbol.for(marker6);\nvar _a6, _b6;\nvar GatewayInternalServerError = class extends (_b6 = GatewayError, _a6 = symbol6, _b6) {\n  constructor({\n    message = \"Internal server error\",\n    statusCode = 500,\n    cause\n  } = {}) {\n    super({ message, statusCode, cause });\n    this[_a6] = true;\n    // used in isInstance\n    this.name = name5;\n    this.type = \"internal_server_error\";\n  }\n  static isInstance(error) {\n    return GatewayError.hasMarker(error) && symbol6 in error;\n  }\n};\n\n// src/errors/gateway-response-error.ts\nvar name6 = \"GatewayResponseError\";\nvar marker7 = `vercel.ai.gateway.error.${name6}`;\nvar symbol7 = Symbol.for(marker7);\nvar _a7, _b7;\nvar GatewayResponseError = class extends (_b7 = GatewayError, _a7 = symbol7, _b7) {\n  constructor({\n    message = \"Invalid response from Gateway\",\n    statusCode = 502,\n    response,\n    validationError,\n    cause\n  } = {}) {\n    super({ message, statusCode, cause });\n    this[_a7] = true;\n    // used in isInstance\n    this.name = name6;\n    this.type = \"response_error\";\n    this.response = response;\n    this.validationError = validationError;\n  }\n  static isInstance(error) {\n    return GatewayError.hasMarker(error) && symbol7 in error;\n  }\n};\n\n// src/errors/create-gateway-error.ts\nimport {\n  lazySchema as lazySchema2,\n  safeValidateTypes,\n  zodSchema as zodSchema2\n} from \"@ai-sdk/provider-utils\";\nasync function createGatewayErrorFromResponse({\n  response,\n  statusCode,\n  defaultMessage = \"Gateway request failed\",\n  cause,\n  authMethod\n}) {\n  const parseResult = await safeValidateTypes({\n    value: response,\n    schema: gatewayErrorResponseSchema\n  });\n  if (!parseResult.success) {\n    return new GatewayResponseError({\n      message: `Invalid error response format: ${defaultMessage}`,\n      statusCode,\n      response,\n      validationError: parseResult.error,\n      cause\n    });\n  }\n  const validatedResponse = parseResult.value;\n  const errorType = validatedResponse.error.type;\n  const message = validatedResponse.error.message;\n  switch (errorType) {\n    case \"authentication_error\":\n      return GatewayAuthenticationError.createContextualError({\n        apiKeyProvided: authMethod === \"api-key\",\n        oidcTokenProvided: authMethod === \"oidc\",\n        statusCode,\n        cause\n      });\n    case \"invalid_request_error\":\n      return new GatewayInvalidRequestError({ message, statusCode, cause });\n    case \"rate_limit_exceeded\":\n      return new GatewayRateLimitError({ message, statusCode, cause });\n    case \"model_not_found\": {\n      const modelResult = await safeValidateTypes({\n        value: validatedResponse.error.param,\n        schema: modelNotFoundParamSchema\n      });\n      return new GatewayModelNotFoundError({\n        message,\n        statusCode,\n        modelId: modelResult.success ? modelResult.value.modelId : void 0,\n        cause\n      });\n    }\n    case \"internal_server_error\":\n      return new GatewayInternalServerError({ message, statusCode, cause });\n    default:\n      return new GatewayInternalServerError({ message, statusCode, cause });\n  }\n}\nvar gatewayErrorResponseSchema = lazySchema2(\n  () => zodSchema2(\n    z2.object({\n      error: z2.object({\n        message: z2.string(),\n        type: z2.string().nullish(),\n        param: z2.unknown().nullish(),\n        code: z2.union([z2.string(), z2.number()]).nullish()\n      })\n    })\n  )\n);\n\n// src/errors/as-gateway-error.ts\nfunction asGatewayError(error, authMethod) {\n  var _a8;\n  if (GatewayError.isInstance(error)) {\n    return error;\n  }\n  if (APICallError.isInstance(error)) {\n    return createGatewayErrorFromResponse({\n      response: extractApiCallResponse(error),\n      statusCode: (_a8 = error.statusCode) != null ? _a8 : 500,\n      defaultMessage: \"Gateway request failed\",\n      cause: error,\n      authMethod\n    });\n  }\n  return createGatewayErrorFromResponse({\n    response: {},\n    statusCode: 500,\n    defaultMessage: error instanceof Error ? `Gateway request failed: ${error.message}` : \"Unknown Gateway error\",\n    cause: error,\n    authMethod\n  });\n}\n\n// src/errors/extract-api-call-response.ts\nfunction extractApiCallResponse(error) {\n  if (error.data !== void 0) {\n    return error.data;\n  }\n  if (error.responseBody != null) {\n    try {\n      return JSON.parse(error.responseBody);\n    } catch (e) {\n      return error.responseBody;\n    }\n  }\n  return {};\n}\n\n// src/errors/parse-auth-method.ts\nimport { z as z3 } from \"zod/v4\";\nimport {\n  lazySchema as lazySchema3,\n  safeValidateTypes as safeValidateTypes2,\n  zodSchema as zodSchema3\n} from \"@ai-sdk/provider-utils\";\nvar GATEWAY_AUTH_METHOD_HEADER = \"ai-gateway-auth-method\";\nasync function parseAuthMethod(headers) {\n  const result = await safeValidateTypes2({\n    value: headers[GATEWAY_AUTH_METHOD_HEADER],\n    schema: gatewayAuthMethodSchema\n  });\n  return result.success ? result.value : void 0;\n}\nvar gatewayAuthMethodSchema = lazySchema3(\n  () => zodSchema3(z3.union([z3.literal(\"api-key\"), z3.literal(\"oidc\")]))\n);\n\n// src/gateway-fetch-metadata.ts\nimport {\n  createJsonErrorResponseHandler,\n  createJsonResponseHandler,\n  getFromApi,\n  lazySchema as lazySchema4,\n  resolve,\n  zodSchema as zodSchema4\n} from \"@ai-sdk/provider-utils\";\nimport { z as z4 } from \"zod/v4\";\nvar GatewayFetchMetadata = class {\n  constructor(config) {\n    this.config = config;\n  }\n  async getAvailableModels() {\n    try {\n      const { value } = await getFromApi({\n        url: `${this.config.baseURL}/config`,\n        headers: await resolve(this.config.headers()),\n        successfulResponseHandler: createJsonResponseHandler(\n          gatewayAvailableModelsResponseSchema\n        ),\n        failedResponseHandler: createJsonErrorResponseHandler({\n          errorSchema: z4.any(),\n          errorToMessage: (data) => data\n        }),\n        fetch: this.config.fetch\n      });\n      return value;\n    } catch (error) {\n      throw await asGatewayError(error);\n    }\n  }\n  async getCredits() {\n    try {\n      const baseUrl = new URL(this.config.baseURL);\n      const { value } = await getFromApi({\n        url: `${baseUrl.origin}/v1/credits`,\n        headers: await resolve(this.config.headers()),\n        successfulResponseHandler: createJsonResponseHandler(\n          gatewayCreditsResponseSchema\n        ),\n        failedResponseHandler: createJsonErrorResponseHandler({\n          errorSchema: z4.any(),\n          errorToMessage: (data) => data\n        }),\n        fetch: this.config.fetch\n      });\n      return value;\n    } catch (error) {\n      throw await asGatewayError(error);\n    }\n  }\n};\nvar gatewayAvailableModelsResponseSchema = lazySchema4(\n  () => zodSchema4(\n    z4.object({\n      models: z4.array(\n        z4.object({\n          id: z4.string(),\n          name: z4.string(),\n          description: z4.string().nullish(),\n          pricing: z4.object({\n            input: z4.string(),\n            output: z4.string(),\n            input_cache_read: z4.string().nullish(),\n            input_cache_write: z4.string().nullish()\n          }).transform(\n            ({ input, output, input_cache_read, input_cache_write }) => ({\n              input,\n              output,\n              ...input_cache_read ? { cachedInputTokens: input_cache_read } : {},\n              ...input_cache_write ? { cacheCreationInputTokens: input_cache_write } : {}\n            })\n          ).nullish(),\n          specification: z4.object({\n            specificationVersion: z4.literal(\"v3\"),\n            provider: z4.string(),\n            modelId: z4.string()\n          }),\n          modelType: z4.enum([\"language\", \"embedding\", \"image\"]).nullish()\n        })\n      )\n    })\n  )\n);\nvar gatewayCreditsResponseSchema = lazySchema4(\n  () => zodSchema4(\n    z4.object({\n      balance: z4.string(),\n      total_used: z4.string()\n    }).transform(({ balance, total_used }) => ({\n      balance,\n      totalUsed: total_used\n    }))\n  )\n);\n\n// src/gateway-language-model.ts\nimport {\n  combineHeaders,\n  createEventSourceResponseHandler,\n  createJsonErrorResponseHandler as createJsonErrorResponseHandler2,\n  createJsonResponseHandler as createJsonResponseHandler2,\n  postJsonToApi,\n  resolve as resolve2\n} from \"@ai-sdk/provider-utils\";\nimport { z as z5 } from \"zod/v4\";\nvar GatewayLanguageModel = class {\n  constructor(modelId, config) {\n    this.modelId = modelId;\n    this.config = config;\n    this.specificationVersion = \"v3\";\n    this.supportedUrls = { \"*/*\": [/.*/] };\n  }\n  get provider() {\n    return this.config.provider;\n  }\n  async getArgs(options) {\n    const { abortSignal: _abortSignal, ...optionsWithoutSignal } = options;\n    return {\n      args: this.maybeEncodeFileParts(optionsWithoutSignal),\n      warnings: []\n    };\n  }\n  async doGenerate(options) {\n    const { args, warnings } = await this.getArgs(options);\n    const { abortSignal } = options;\n    const resolvedHeaders = await resolve2(this.config.headers());\n    try {\n      const {\n        responseHeaders,\n        value: responseBody,\n        rawValue: rawResponse\n      } = await postJsonToApi({\n        url: this.getUrl(),\n        headers: combineHeaders(\n          resolvedHeaders,\n          options.headers,\n          this.getModelConfigHeaders(this.modelId, false),\n          await resolve2(this.config.o11yHeaders)\n        ),\n        body: args,\n        successfulResponseHandler: createJsonResponseHandler2(z5.any()),\n        failedResponseHandler: createJsonErrorResponseHandler2({\n          errorSchema: z5.any(),\n          errorToMessage: (data) => data\n        }),\n        ...abortSignal && { abortSignal },\n        fetch: this.config.fetch\n      });\n      return {\n        ...responseBody,\n        request: { body: args },\n        response: { headers: responseHeaders, body: rawResponse },\n        warnings\n      };\n    } catch (error) {\n      throw await asGatewayError(error, await parseAuthMethod(resolvedHeaders));\n    }\n  }\n  async doStream(options) {\n    const { args, warnings } = await this.getArgs(options);\n    const { abortSignal } = options;\n    const resolvedHeaders = await resolve2(this.config.headers());\n    try {\n      const { value: response, responseHeaders } = await postJsonToApi({\n        url: this.getUrl(),\n        headers: combineHeaders(\n          resolvedHeaders,\n          options.headers,\n          this.getModelConfigHeaders(this.modelId, true),\n          await resolve2(this.config.o11yHeaders)\n        ),\n        body: args,\n        successfulResponseHandler: createEventSourceResponseHandler(z5.any()),\n        failedResponseHandler: createJsonErrorResponseHandler2({\n          errorSchema: z5.any(),\n          errorToMessage: (data) => data\n        }),\n        ...abortSignal && { abortSignal },\n        fetch: this.config.fetch\n      });\n      return {\n        stream: response.pipeThrough(\n          new TransformStream({\n            start(controller) {\n              if (warnings.length > 0) {\n                controller.enqueue({ type: \"stream-start\", warnings });\n              }\n            },\n            transform(chunk, controller) {\n              if (chunk.success) {\n                const streamPart = chunk.value;\n                if (streamPart.type === \"raw\" && !options.includeRawChunks) {\n                  return;\n                }\n                if (streamPart.type === \"response-metadata\" && streamPart.timestamp && typeof streamPart.timestamp === \"string\") {\n                  streamPart.timestamp = new Date(streamPart.timestamp);\n                }\n                controller.enqueue(streamPart);\n              } else {\n                controller.error(\n                  chunk.error\n                );\n              }\n            }\n          })\n        ),\n        request: { body: args },\n        response: { headers: responseHeaders }\n      };\n    } catch (error) {\n      throw await asGatewayError(error, await parseAuthMethod(resolvedHeaders));\n    }\n  }\n  isFilePart(part) {\n    return part && typeof part === \"object\" && \"type\" in part && part.type === \"file\";\n  }\n  /**\n   * Encodes file parts in the prompt to base64. Mutates the passed options\n   * instance directly to avoid copying the file data.\n   * @param options - The options to encode.\n   * @returns The options with the file parts encoded.\n   */\n  maybeEncodeFileParts(options) {\n    for (const message of options.prompt) {\n      for (const part of message.content) {\n        if (this.isFilePart(part)) {\n          const filePart = part;\n          if (filePart.data instanceof Uint8Array) {\n            const buffer = Uint8Array.from(filePart.data);\n            const base64Data = Buffer.from(buffer).toString(\"base64\");\n            filePart.data = new URL(\n              `data:${filePart.mediaType || \"application/octet-stream\"};base64,${base64Data}`\n            );\n          }\n        }\n      }\n    }\n    return options;\n  }\n  getUrl() {\n    return `${this.config.baseURL}/language-model`;\n  }\n  getModelConfigHeaders(modelId, streaming) {\n    return {\n      \"ai-language-model-specification-version\": \"2\",\n      \"ai-language-model-id\": modelId,\n      \"ai-language-model-streaming\": String(streaming)\n    };\n  }\n};\n\n// src/gateway-embedding-model.ts\nimport {\n  combineHeaders as combineHeaders2,\n  createJsonErrorResponseHandler as createJsonErrorResponseHandler3,\n  createJsonResponseHandler as createJsonResponseHandler3,\n  lazySchema as lazySchema5,\n  postJsonToApi as postJsonToApi2,\n  resolve as resolve3,\n  zodSchema as zodSchema5\n} from \"@ai-sdk/provider-utils\";\nimport { z as z6 } from \"zod/v4\";\nvar GatewayEmbeddingModel = class {\n  constructor(modelId, config) {\n    this.modelId = modelId;\n    this.config = config;\n    this.specificationVersion = \"v3\";\n    this.maxEmbeddingsPerCall = 2048;\n    this.supportsParallelCalls = true;\n  }\n  get provider() {\n    return this.config.provider;\n  }\n  async doEmbed({\n    values,\n    headers,\n    abortSignal,\n    providerOptions\n  }) {\n    var _a8;\n    const resolvedHeaders = await resolve3(this.config.headers());\n    try {\n      const {\n        responseHeaders,\n        value: responseBody,\n        rawValue\n      } = await postJsonToApi2({\n        url: this.getUrl(),\n        headers: combineHeaders2(\n          resolvedHeaders,\n          headers != null ? headers : {},\n          this.getModelConfigHeaders(),\n          await resolve3(this.config.o11yHeaders)\n        ),\n        body: {\n          values,\n          ...providerOptions ? { providerOptions } : {}\n        },\n        successfulResponseHandler: createJsonResponseHandler3(\n          gatewayEmbeddingResponseSchema\n        ),\n        failedResponseHandler: createJsonErrorResponseHandler3({\n          errorSchema: z6.any(),\n          errorToMessage: (data) => data\n        }),\n        ...abortSignal && { abortSignal },\n        fetch: this.config.fetch\n      });\n      return {\n        embeddings: responseBody.embeddings,\n        usage: (_a8 = responseBody.usage) != null ? _a8 : void 0,\n        providerMetadata: responseBody.providerMetadata,\n        response: { headers: responseHeaders, body: rawValue },\n        warnings: []\n      };\n    } catch (error) {\n      throw await asGatewayError(error, await parseAuthMethod(resolvedHeaders));\n    }\n  }\n  getUrl() {\n    return `${this.config.baseURL}/embedding-model`;\n  }\n  getModelConfigHeaders() {\n    return {\n      \"ai-embedding-model-specification-version\": \"2\",\n      \"ai-model-id\": this.modelId\n    };\n  }\n};\nvar gatewayEmbeddingResponseSchema = lazySchema5(\n  () => zodSchema5(\n    z6.object({\n      embeddings: z6.array(z6.array(z6.number())),\n      usage: z6.object({ tokens: z6.number() }).nullish(),\n      providerMetadata: z6.record(z6.string(), z6.record(z6.string(), z6.unknown())).optional()\n    })\n  )\n);\n\n// src/gateway-image-model.ts\nimport {\n  combineHeaders as combineHeaders3,\n  createJsonResponseHandler as createJsonResponseHandler4,\n  createJsonErrorResponseHandler as createJsonErrorResponseHandler4,\n  postJsonToApi as postJsonToApi3,\n  resolve as resolve4\n} from \"@ai-sdk/provider-utils\";\nimport { z as z7 } from \"zod/v4\";\nvar GatewayImageModel = class {\n  constructor(modelId, config) {\n    this.modelId = modelId;\n    this.config = config;\n    this.specificationVersion = \"v3\";\n    // Set a very large number to prevent client-side splitting of requests\n    this.maxImagesPerCall = Number.MAX_SAFE_INTEGER;\n  }\n  get provider() {\n    return this.config.provider;\n  }\n  async doGenerate({\n    prompt,\n    n,\n    size,\n    aspectRatio,\n    seed,\n    providerOptions,\n    headers,\n    abortSignal\n  }) {\n    var _a8;\n    const resolvedHeaders = await resolve4(this.config.headers());\n    try {\n      const {\n        responseHeaders,\n        value: responseBody,\n        rawValue\n      } = await postJsonToApi3({\n        url: this.getUrl(),\n        headers: combineHeaders3(\n          resolvedHeaders,\n          headers != null ? headers : {},\n          this.getModelConfigHeaders(),\n          await resolve4(this.config.o11yHeaders)\n        ),\n        body: {\n          prompt,\n          n,\n          ...size && { size },\n          ...aspectRatio && { aspectRatio },\n          ...seed && { seed },\n          ...providerOptions && { providerOptions }\n        },\n        successfulResponseHandler: createJsonResponseHandler4(\n          gatewayImageResponseSchema\n        ),\n        failedResponseHandler: createJsonErrorResponseHandler4({\n          errorSchema: z7.any(),\n          errorToMessage: (data) => data\n        }),\n        ...abortSignal && { abortSignal },\n        fetch: this.config.fetch\n      });\n      return {\n        images: responseBody.images,\n        // Always base64 strings from server\n        warnings: (_a8 = responseBody.warnings) != null ? _a8 : [],\n        providerMetadata: responseBody.providerMetadata,\n        response: {\n          timestamp: /* @__PURE__ */ new Date(),\n          modelId: this.modelId,\n          headers: responseHeaders\n        }\n      };\n    } catch (error) {\n      throw asGatewayError(error, await parseAuthMethod(resolvedHeaders));\n    }\n  }\n  getUrl() {\n    return `${this.config.baseURL}/image-model`;\n  }\n  getModelConfigHeaders() {\n    return {\n      \"ai-image-model-specification-version\": \"2\",\n      \"ai-model-id\": this.modelId\n    };\n  }\n};\nvar providerMetadataEntrySchema = z7.object({\n  images: z7.array(z7.unknown()).optional()\n}).catchall(z7.unknown());\nvar gatewayImageResponseSchema = z7.object({\n  images: z7.array(z7.string()),\n  // Always base64 strings over the wire\n  warnings: z7.array(\n    z7.object({\n      type: z7.literal(\"other\"),\n      message: z7.string()\n    })\n  ).optional(),\n  providerMetadata: z7.record(z7.string(), providerMetadataEntrySchema).optional()\n});\n\n// src/vercel-environment.ts\nimport { getContext } from \"@vercel/oidc\";\nimport { getVercelOidcToken } from \"@vercel/oidc\";\nasync function getVercelRequestId() {\n  var _a8;\n  return (_a8 = getContext().headers) == null ? void 0 : _a8[\"x-vercel-id\"];\n}\n\n// src/gateway-provider.ts\nimport { withUserAgentSuffix } from \"@ai-sdk/provider-utils\";\n\n// src/version.ts\nvar VERSION = true ? \"3.0.2\" : \"0.0.0-test\";\n\n// src/gateway-provider.ts\nvar AI_GATEWAY_PROTOCOL_VERSION = \"0.0.1\";\nfunction createGatewayProvider(options = {}) {\n  var _a8, _b8;\n  let pendingMetadata = null;\n  let metadataCache = null;\n  const cacheRefreshMillis = (_a8 = options.metadataCacheRefreshMillis) != null ? _a8 : 1e3 * 60 * 5;\n  let lastFetchTime = 0;\n  const baseURL = (_b8 = withoutTrailingSlash(options.baseURL)) != null ? _b8 : \"https://ai-gateway.vercel.sh/v3/ai\";\n  const getHeaders = async () => {\n    const auth = await getGatewayAuthToken(options);\n    if (auth) {\n      return withUserAgentSuffix(\n        {\n          Authorization: `Bearer ${auth.token}`,\n          \"ai-gateway-protocol-version\": AI_GATEWAY_PROTOCOL_VERSION,\n          [GATEWAY_AUTH_METHOD_HEADER]: auth.authMethod,\n          ...options.headers\n        },\n        `ai-sdk/gateway/${VERSION}`\n      );\n    }\n    throw GatewayAuthenticationError.createContextualError({\n      apiKeyProvided: false,\n      oidcTokenProvided: false,\n      statusCode: 401\n    });\n  };\n  const createO11yHeaders = () => {\n    const deploymentId = loadOptionalSetting({\n      settingValue: void 0,\n      environmentVariableName: \"VERCEL_DEPLOYMENT_ID\"\n    });\n    const environment = loadOptionalSetting({\n      settingValue: void 0,\n      environmentVariableName: \"VERCEL_ENV\"\n    });\n    const region = loadOptionalSetting({\n      settingValue: void 0,\n      environmentVariableName: \"VERCEL_REGION\"\n    });\n    return async () => {\n      const requestId = await getVercelRequestId();\n      return {\n        ...deploymentId && { \"ai-o11y-deployment-id\": deploymentId },\n        ...environment && { \"ai-o11y-environment\": environment },\n        ...region && { \"ai-o11y-region\": region },\n        ...requestId && { \"ai-o11y-request-id\": requestId }\n      };\n    };\n  };\n  const createLanguageModel = (modelId) => {\n    return new GatewayLanguageModel(modelId, {\n      provider: \"gateway\",\n      baseURL,\n      headers: getHeaders,\n      fetch: options.fetch,\n      o11yHeaders: createO11yHeaders()\n    });\n  };\n  const getAvailableModels = async () => {\n    var _a9, _b9, _c;\n    const now = (_c = (_b9 = (_a9 = options._internal) == null ? void 0 : _a9.currentDate) == null ? void 0 : _b9.call(_a9).getTime()) != null ? _c : Date.now();\n    if (!pendingMetadata || now - lastFetchTime > cacheRefreshMillis) {\n      lastFetchTime = now;\n      pendingMetadata = new GatewayFetchMetadata({\n        baseURL,\n        headers: getHeaders,\n        fetch: options.fetch\n      }).getAvailableModels().then((metadata) => {\n        metadataCache = metadata;\n        return metadata;\n      }).catch(async (error) => {\n        throw await asGatewayError(\n          error,\n          await parseAuthMethod(await getHeaders())\n        );\n      });\n    }\n    return metadataCache ? Promise.resolve(metadataCache) : pendingMetadata;\n  };\n  const getCredits = async () => {\n    return new GatewayFetchMetadata({\n      baseURL,\n      headers: getHeaders,\n      fetch: options.fetch\n    }).getCredits().catch(async (error) => {\n      throw await asGatewayError(\n        error,\n        await parseAuthMethod(await getHeaders())\n      );\n    });\n  };\n  const provider = function(modelId) {\n    if (new.target) {\n      throw new Error(\n        \"The Gateway Provider model function cannot be called with the new keyword.\"\n      );\n    }\n    return createLanguageModel(modelId);\n  };\n  provider.specificationVersion = \"v3\";\n  provider.getAvailableModels = getAvailableModels;\n  provider.getCredits = getCredits;\n  provider.imageModel = (modelId) => {\n    return new GatewayImageModel(modelId, {\n      provider: \"gateway\",\n      baseURL,\n      headers: getHeaders,\n      fetch: options.fetch,\n      o11yHeaders: createO11yHeaders()\n    });\n  };\n  provider.languageModel = createLanguageModel;\n  const createEmbeddingModel = (modelId) => {\n    return new GatewayEmbeddingModel(modelId, {\n      provider: \"gateway\",\n      baseURL,\n      headers: getHeaders,\n      fetch: options.fetch,\n      o11yHeaders: createO11yHeaders()\n    });\n  };\n  provider.embeddingModel = createEmbeddingModel;\n  provider.textEmbeddingModel = createEmbeddingModel;\n  return provider;\n}\nvar gateway = createGatewayProvider();\nasync function getGatewayAuthToken(options) {\n  const apiKey = loadOptionalSetting({\n    settingValue: options.apiKey,\n    environmentVariableName: \"AI_GATEWAY_API_KEY\"\n  });\n  if (apiKey) {\n    return {\n      token: apiKey,\n      authMethod: \"api-key\"\n    };\n  }\n  try {\n    const oidcToken = await getVercelOidcToken();\n    return {\n      token: oidcToken,\n      authMethod: \"oidc\"\n    };\n  } catch (e) {\n    return null;\n  }\n}\nexport {\n  GatewayAuthenticationError,\n  GatewayError,\n  GatewayInternalServerError,\n  GatewayInvalidRequestError,\n  GatewayModelNotFoundError,\n  GatewayRateLimitError,\n  GatewayResponseError,\n  createGatewayProvider as createGateway,\n  createGatewayProvider,\n  gateway\n};\n//# sourceMappingURL=index.mjs.map","import type { AnthropicProviderOptions } from \"@ai-sdk/anthropic\";\nimport { devToolsMiddleware } from \"@ai-sdk/devtools\";\nimport { gateway } from \"@ai-sdk/gateway\";\nimport type { GoogleGenerativeAIProviderOptions } from \"@ai-sdk/google\";\nimport type { OpenAIResponsesProviderOptions } from \"@ai-sdk/openai\";\nimport { extractReasoningMiddleware, wrapLanguageModel } from \"ai\";\nimport type {\n  ImageModelId,\n  MultimodalImageModelId,\n} from \"../models/image-model-id\";\nimport type { AppModelId, ModelId } from \"./app-models\";\nimport { getAppModelDefinition } from \"./app-models\";\n\nconst _telemetryConfig = {\n  telemetry: {\n    isEnabled: true,\n    functionId: \"get-language-model\",\n  },\n};\n\nexport const getLanguageModel = async (modelId: ModelId) => {\n  const model = await getAppModelDefinition(modelId);\n  const languageProvider = gateway(model.id);\n\n  const middlewares: Parameters<typeof wrapLanguageModel>[0][\"middleware\"][] =\n    [];\n\n  // Add devtools middleware in development\n  if (process.env.NODE_ENV === \"development\") {\n    middlewares.push(devToolsMiddleware());\n  }\n\n  // Add reasoning middleware if the model supports reasoning\n  if (model.reasoning && model.owned_by === \"xai\") {\n    console.log(\"Wrapping reasoning middleware for\", model.id);\n    middlewares.push(extractReasoningMiddleware({ tagName: \"think\" }));\n  }\n\n  if (middlewares.length === 0) {\n    return languageProvider;\n  }\n\n  return wrapLanguageModel({\n    model: languageProvider,\n    // @ts-expect-error - Version of LanguageModel don't match\n    middleware: middlewares,\n  });\n};\n\nexport const getImageModel = (modelId: ImageModelId) =>\n  gateway.imageModel(modelId);\n\n// Get a multimodal language model that can generate images via generateText\nexport const getMultimodalImageModel = (modelId: MultimodalImageModelId) =>\n  gateway(modelId);\n\n// Model aliases removed - use getLanguageModel directly with specific model IDs\n\nexport const getModelProviderOptions = async (\n  providerModelId: AppModelId\n): Promise<\n  | {\n      openai: OpenAIResponsesProviderOptions;\n    }\n  | {\n      anthropic: AnthropicProviderOptions;\n    }\n  | {\n      xai: Record<string, never>;\n    }\n  | {\n      google: GoogleGenerativeAIProviderOptions;\n    }\n  | Record<string, never>\n> => {\n  const model = await getAppModelDefinition(providerModelId);\n  if (model.owned_by === \"openai\") {\n    if (model.reasoning) {\n      return {\n        openai: {\n          reasoningSummary: \"auto\",\n          ...(model.id === \"openai/gpt-5\" ||\n          model.id === \"openai/gpt-5-mini\" ||\n          model.id === \"openai/gpt-5-nano\"\n            ? { reasoningEffort: \"low\" }\n            : {}),\n        } satisfies OpenAIResponsesProviderOptions,\n      };\n    }\n    return { openai: {} };\n  }\n  if (model.owned_by === \"anthropic\") {\n    if (model.reasoning) {\n      return {\n        anthropic: {\n          thinking: {\n            type: \"enabled\",\n            budgetTokens: 4096,\n          },\n        } satisfies AnthropicProviderOptions,\n      };\n    }\n    return { anthropic: {} };\n  }\n  if (model.owned_by === \"xai\") {\n    return {\n      xai: {},\n    };\n  }\n  if (model.owned_by === \"google\") {\n    if (model.reasoning) {\n      return {\n        google: {\n          thinkingConfig: {\n            thinkingBudget: 10_000,\n          },\n        },\n      };\n    }\n    return { google: {} };\n  }\n  return {};\n};\n","import type { FileUIPart } from \"ai\";\nimport type { ChatMessage } from \"./ai/types\";\nimport { uploadFile } from \"./blob\";\nimport { BLOB_FILE_PREFIX } from \"./constants\";\nimport { generateUUID } from \"./utils\";\n\nfunction cloneMessages<\n  T extends { id: string; chatId: string; parentMessageId?: string | null },\n>(sourceMessages: T[], newChatId: string): T[] {\n  // First pass: Create mapping from old IDs to new IDs\n  const idMap = new Map<string, string>();\n  for (const message of sourceMessages) {\n    idMap.set(message.id, generateUUID());\n  }\n\n  // Second pass: Clone messages using the ID mapping\n  const clonedMessages: T[] = [];\n  for (const message of sourceMessages) {\n    const newId = idMap.get(message.id);\n    if (!newId) {\n      throw new Error(`Message ID ${message.id} not found in mapping`);\n    }\n\n    let newParentId: string | null = null;\n    if (message.parentMessageId) {\n      const mappedParentId = idMap.get(message.parentMessageId);\n      if (!mappedParentId) {\n        throw new Error(\n          `Parent message ID ${message.parentMessageId} not found in mapping`\n        );\n      }\n      newParentId = mappedParentId;\n    }\n\n    const clonedMessage: T = {\n      ...message,\n      id: newId,\n      chatId: newChatId,\n      parentMessageId: newParentId,\n    };\n    clonedMessages.push(clonedMessage);\n  }\n\n  return clonedMessages;\n}\nfunction createDocumentIdMap<T extends { id: string }>(\n  documents: T[]\n): Map<string, string> {\n  const documentIdMap = new Map<string, string>();\n  for (const document of documents) {\n    documentIdMap.set(document.id, generateUUID());\n  }\n  return documentIdMap;\n}\n\nfunction updateDocumentIdInPart(\n  oldDocId: string,\n  documentIdMap: Map<string, string>\n): string {\n  const newDocId = documentIdMap.get(oldDocId);\n  if (!newDocId) {\n    throw new Error(`Document ID ${oldDocId} not found in mapping`);\n  }\n  return newDocId;\n}\n\nfunction transformDeepResearchPart(\n  part: ChatMessage[\"parts\"][number],\n  documentIdMap: Map<string, string>\n): ChatMessage[\"parts\"][number] {\n  if (part.type !== \"tool-deepResearch\") {\n    return part;\n  }\n  if (part.state !== \"output-available\") {\n    return part;\n  }\n  if (part.output?.format !== \"report\" || part.output.status !== \"success\") {\n    return part;\n  }\n  const oldDocId = part.output.documentId;\n  const newDocId = updateDocumentIdInPart(oldDocId, documentIdMap);\n  return {\n    ...part,\n    output: {\n      ...part.output,\n      documentId: newDocId,\n    },\n  };\n}\n\nfunction isEditDocumentPart(\n  part: ChatMessage[\"parts\"][number]\n): part is Extract<\n  ChatMessage[\"parts\"][number],\n  | { type: \"tool-editTextDocument\" }\n  | { type: \"tool-editCodeDocument\" }\n  | { type: \"tool-editSheetDocument\" }\n> {\n  return (\n    part.type === \"tool-editTextDocument\" ||\n    part.type === \"tool-editCodeDocument\" ||\n    part.type === \"tool-editSheetDocument\"\n  );\n}\n\nfunction isCreateDocumentPart(\n  part: ChatMessage[\"parts\"][number]\n): part is Extract<\n  ChatMessage[\"parts\"][number],\n  | { type: \"tool-createTextDocument\" }\n  | { type: \"tool-createCodeDocument\" }\n  | { type: \"tool-createSheetDocument\" }\n> {\n  return (\n    part.type === \"tool-createTextDocument\" ||\n    part.type === \"tool-createCodeDocument\" ||\n    part.type === \"tool-createSheetDocument\"\n  );\n}\n\nfunction transformEditDocumentPart(\n  part: ChatMessage[\"parts\"][number],\n  documentIdMap: Map<string, string>\n): ChatMessage[\"parts\"][number] {\n  if (!isEditDocumentPart(part)) {\n    return part;\n  }\n  if (part.state !== \"output-available\") {\n    return part;\n  }\n  if (part.output.status !== \"success\") {\n    return part;\n  }\n  const oldDocId = part.output.documentId;\n  const newDocId = updateDocumentIdInPart(oldDocId, documentIdMap);\n  return {\n    ...part,\n    output: {\n      ...part.output,\n      documentId: newDocId,\n    },\n  };\n}\n\nfunction transformCreateDocumentPart(\n  part: ChatMessage[\"parts\"][number],\n  documentIdMap: Map<string, string>\n): ChatMessage[\"parts\"][number] {\n  if (!isCreateDocumentPart(part)) {\n    return part;\n  }\n  if (part.state !== \"output-available\") {\n    return part;\n  }\n  if (part.output.status !== \"success\") {\n    return part;\n  }\n  const oldDocId = part.output.documentId;\n  const newDocId = updateDocumentIdInPart(oldDocId, documentIdMap);\n  return {\n    ...part,\n    output: {\n      ...part.output,\n      documentId: newDocId,\n    },\n  };\n}\n\nfunction transformPartWithDocumentId(\n  part: ChatMessage[\"parts\"][number],\n  documentIdMap: Map<string, string>\n): ChatMessage[\"parts\"][number] {\n  if (part.type === \"tool-deepResearch\") {\n    return transformDeepResearchPart(part, documentIdMap);\n  }\n  if (isEditDocumentPart(part)) {\n    return transformEditDocumentPart(part, documentIdMap);\n  }\n  if (isCreateDocumentPart(part)) {\n    return transformCreateDocumentPart(part, documentIdMap);\n  }\n  return part;\n}\n\nfunction updateDocumentReferencesInMessageParts<\n  T extends { parts: ChatMessage[\"parts\"] },\n>(messages: T[], documentIdMap: Map<string, string>): T[] {\n  return messages.map((message) => {\n    const parts = message.parts;\n    let updatedParts: ChatMessage[\"parts\"] = [];\n\n    if (Array.isArray(parts)) {\n      updatedParts = parts.map((part) =>\n        transformPartWithDocumentId(part, documentIdMap)\n      );\n    }\n\n    return {\n      ...message,\n      parts: updatedParts,\n    };\n  });\n}\nfunction cloneDocuments<\n  T extends { id: string; messageId: string; userId: string },\n>(\n  sourceDocuments: T[],\n  documentIdMap: Map<string, string>,\n  messageIdMap: Map<string, string>,\n  newUserId: string\n): T[] {\n  const clonedDocuments: T[] = [];\n\n  for (const document of sourceDocuments) {\n    const newDocumentId = documentIdMap.get(document.id);\n    const newMessageId = messageIdMap.get(document.messageId);\n\n    if (!newDocumentId) {\n      throw new Error(`Document ID ${document.id} not found in mapping`);\n    }\n    if (!newMessageId) {\n      throw new Error(`Message ID ${document.messageId} not found in mapping`);\n    }\n\n    const clonedDocument: T = {\n      ...document,\n      id: newDocumentId,\n      messageId: newMessageId,\n      userId: newUserId,\n    };\n    clonedDocuments.push(clonedDocument);\n  }\n\n  return clonedDocuments;\n}\n\nasync function cloneFileUIPart(part: FileUIPart): Promise<FileUIPart> {\n  try {\n    // Skip if no URL is provided\n    if (!part.url) {\n      console.warn(\"Attachment has no URL, skipping clone\");\n      return part;\n    }\n\n    // Skip if URL is not managed by this app (might be external).\n    if (!isManagedAttachmentUrl(part.url)) {\n      console.warn(\n        \"Attachment is not managed by local file storage, skipping clone:\",\n        part.url\n      );\n      return part;\n    }\n\n    // Fetch the original file\n    const response = await fetch(resolveAttachmentUrl(part.url));\n    if (!response.ok) {\n      throw new Error(`Failed to fetch attachment: ${response.statusText}`);\n    }\n\n    const blob = await response.blob();\n\n    // Extract just the base filename without any path components\n    let filename = part.filename || \"attachment\";\n\n    // If filename contains path separators, get just the last part\n    if (filename.includes(\"/\")) {\n      filename = filename.split(\"/\").pop() || \"attachment\";\n    }\n\n    // Remove any existing prefix if it somehow got into the filename\n    if (filename.startsWith(BLOB_FILE_PREFIX)) {\n      filename = filename.replace(BLOB_FILE_PREFIX, \"\");\n    }\n\n    const newBlob = await uploadFile(\n      filename,\n      Buffer.from(await blob.arrayBuffer()),\n      {\n        contentType: blob.type || undefined,\n      }\n    );\n\n    return {\n      ...part,\n      url: newBlob.url,\n    };\n  } catch (error) {\n    console.error(\"Failed to clone attachment:\", error);\n    // Return original attachment as fallback to avoid breaking the cloning process\n    return part;\n  }\n}\n\nfunction isManagedAttachmentUrl(url: string): boolean {\n  if (url.startsWith(\"/api/files/\")) {\n    return true;\n  }\n\n  if (url.includes(\"blob.vercel-storage.com\")) {\n    return true;\n  }\n\n  try {\n    const parsed = new URL(url);\n    return parsed.pathname.startsWith(\"/api/files/\");\n  } catch {\n    return false;\n  }\n}\n\nfunction resolveAttachmentUrl(url: string): string {\n  if (url.startsWith(\"http://\") || url.startsWith(\"https://\")) {\n    return url;\n  }\n\n  if (url.startsWith(\"/\")) {\n    return new URL(url, getCloneBaseUrl()).toString();\n  }\n\n  return url;\n}\n\nfunction getCloneBaseUrl(): string {\n  const raw = process.env.APP_URL?.trim();\n  if (raw) {\n    return raw;\n  }\n\n  return \"http://localhost:5173\";\n}\n\nexport async function cloneAttachmentsInMessages<\n  T extends { parts: ChatMessage[\"parts\"] },\n>(messages: T[]): Promise<T[]> {\n  const clonedMessages: T[] = [];\n\n  for (const message of messages) {\n    if (message.parts && Array.isArray(message.parts)) {\n      const clonedParts: ChatMessage[\"parts\"] = [];\n\n      for (const part of message.parts) {\n        if (part.type === \"file\") {\n          const clonedPart = await cloneFileUIPart(part);\n          clonedParts.push(clonedPart);\n        } else {\n          clonedParts.push(part);\n        }\n      }\n\n      const clonedMessage: T = {\n        ...message,\n        parts: clonedParts,\n      };\n      clonedMessages.push(clonedMessage);\n    } else {\n      clonedMessages.push(message);\n    }\n  }\n\n  return clonedMessages;\n}\n\nexport function cloneMessagesWithDocuments<\n  TMessage extends {\n    id: string;\n    chatId: string;\n    parentMessageId?: string | null;\n    parts: ChatMessage[\"parts\"];\n    metadata?: {\n      parentMessageId: string | null;\n    } & Record<string, unknown>;\n  },\n  TDocument extends {\n    id: string;\n    messageId: string;\n    userId: string;\n    title: string;\n    kind: any;\n    content: string | null;\n    createdAt: Date;\n  },\n>(\n  sourceMessages: TMessage[],\n  sourceDocuments: TDocument[],\n  newChatId: string,\n  newUserId: string\n): {\n  clonedMessages: TMessage[];\n  clonedDocuments: TDocument[];\n  messageIdMap: Map<string, string>;\n  documentIdMap: Map<string, string>;\n} {\n  // Step 1: Clone messages (id, chatId, and parentMessageId field)\n  const clonedMessagesBase = cloneMessages(sourceMessages, newChatId);\n\n  // Step 2: Create message ID mapping for later use\n  const messageIdMap = new Map<string, string>();\n  for (let i = 0; i < sourceMessages.length; i++) {\n    messageIdMap.set(sourceMessages[i].id, clonedMessagesBase[i].id);\n  }\n\n  // Step 2b: If messages have metadata.parentMessageId (ChatMessage),\n  // remap it using the messageIdMap so the thread structure is preserved.\n  const clonedMessages: TMessage[] = clonedMessagesBase.map(\n    (clonedMessage, index) => {\n      const sourceMessage = sourceMessages[index];\n\n      const oldMetadataParentId =\n        sourceMessage.metadata?.parentMessageId ?? null;\n\n      if (oldMetadataParentId === null) {\n        // Ensure we don't accidentally carry over an old parent in metadata\n        if (!clonedMessage.metadata) {\n          return clonedMessage;\n        }\n\n        return {\n          ...clonedMessage,\n          metadata: {\n            ...clonedMessage.metadata,\n            parentMessageId: null,\n          },\n        };\n      }\n\n      const newMetadataParentId = messageIdMap.get(oldMetadataParentId);\n      if (!newMetadataParentId) {\n        throw new Error(\n          `Parent message ID ${oldMetadataParentId} from metadata not found in mapping`\n        );\n      }\n\n      const existingMetadata = clonedMessage.metadata ?? {\n        parentMessageId: null,\n      };\n\n      return {\n        ...clonedMessage,\n        metadata: {\n          ...existingMetadata,\n          parentMessageId: newMetadataParentId,\n        },\n      };\n    }\n  );\n\n  // Step 3: Create document ID mapping\n  const documentIdMap = createDocumentIdMap(sourceDocuments);\n\n  // Step 4: Update document references in message parts\n  const messagesWithUpdatedDocRefs = updateDocumentReferencesInMessageParts(\n    clonedMessages,\n    documentIdMap\n  );\n\n  // Step 5: Clone documents\n  const clonedDocuments = cloneDocuments(\n    sourceDocuments,\n    documentIdMap,\n    messageIdMap,\n    newUserId\n  );\n\n  return {\n    clonedMessages: messagesWithUpdatedDocRefs,\n    clonedDocuments,\n    messageIdMap,\n    documentIdMap,\n  };\n}\n","// Centralized limits for tokens and derived character counts\n\n// Maximum input tokens allowed for a single user message\nexport const MAX_INPUT_TOKENS = 50_000;\n\n// Derive maximum message characters as 3x tokens (rough heuristic)\nexport const MAX_MESSAGE_CHARS = MAX_INPUT_TOKENS * 3;\n","import { z } from \"zod\";\nimport { MAX_MESSAGE_CHARS } from \"@/lib/limits/tokens\";\n\nexport const chatGetAllChatsInputSchema = z\n  .object({\n    projectId: z.uuid().optional().nullable(),\n  })\n  .optional();\n\nexport const chatIdInputSchema = z.object({\n  chatId: z.string().uuid(),\n});\n\nexport const chatRenameInputSchema = z.object({\n  chatId: z.string().uuid(),\n  title: z.string().min(1).max(255),\n});\n\nexport const chatMessageIdInputSchema = z.object({\n  messageId: z.string().uuid(),\n});\n\nexport const chatSetVisibilityInputSchema = z.object({\n  chatId: z.string().uuid(),\n  visibility: z.enum([\"private\", \"public\"]),\n});\n\nexport const chatSetIsPinnedInputSchema = z.object({\n  chatId: z.string().uuid(),\n  isPinned: z.boolean(),\n});\n\nexport const chatGenerateTitleInputSchema = z.object({\n  message: z.string().min(1).max(MAX_MESSAGE_CHARS),\n});\n","\"use server\";\n\nimport { generateText } from \"ai\";\nimport { requestInfo } from \"rwsdk/worker\";\nimport { getLanguageModel } from \"@/lib/ai/providers\";\nimport type { ChatMessage } from \"@/lib/ai/types\";\nimport { auth } from \"@/lib/auth\";\nimport {\n  cloneAttachmentsInMessages,\n  cloneMessagesWithDocuments,\n} from \"@/lib/clone-messages\";\nimport { config } from \"@/lib/config\";\nimport {\n  deleteChatById,\n  deleteMessagesByChatIdAfterMessageId,\n  getAllMessagesByChatId,\n  getChatById as getChatByIdQuery,\n  getChatsByUserId,\n  getDocumentsByMessageIds,\n  getMessageById,\n  saveChat,\n  saveChatMessages,\n  saveDocuments,\n  updateChatIsPinnedById,\n  updateChatTitleById,\n  updateChatVisiblityById,\n  updateMessageCanceledAt,\n} from \"@/lib/db/queries\";\nimport { dbChatToUIChat } from \"@/lib/message-conversion\";\nimport {\n  chatGenerateTitleInputSchema,\n  chatGetAllChatsInputSchema,\n  chatIdInputSchema,\n  chatMessageIdInputSchema,\n  chatRenameInputSchema,\n  chatSetIsPinnedInputSchema,\n  chatSetVisibilityInputSchema,\n} from \"@/lib/schemas/chat\";\nimport { generateUUID } from \"@/lib/utils\";\n\nfunction serializeChat(chat: ReturnType<typeof dbChatToUIChat>) {\n  return {\n    ...chat,\n    createdAt:\n      chat.createdAt instanceof Date\n        ? chat.createdAt.toISOString()\n        : chat.createdAt,\n    updatedAt:\n      chat.updatedAt instanceof Date\n        ? chat.updatedAt.toISOString()\n        : chat.updatedAt,\n  };\n}\n\nfunction serializeMessage(message: ChatMessage) {\n  return {\n    ...message,\n    metadata: {\n      ...message.metadata,\n      createdAt:\n        message.metadata.createdAt instanceof Date\n          ? message.metadata.createdAt.toISOString()\n          : message.metadata.createdAt,\n    },\n  };\n}\n\nasync function requireUserId() {\n  const session = await auth.api.getSession({\n    headers: requestInfo.request.headers,\n  });\n  const userId = session?.user?.id;\n  if (!userId) {\n    throw new Error(\"UNAUTHORIZED\");\n  }\n  return userId;\n}\n\nexport async function getAllChats(rawInput?: unknown) {\n  const input = chatGetAllChatsInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const chats = await getChatsByUserId({\n    id: userId,\n    projectId: input?.projectId,\n  });\n\n  // Sort chats by pinned status, then by last updated date\n  chats.sort((a, b) => {\n    if (a.isPinned && !b.isPinned) {\n      return -1;\n    }\n    if (!a.isPinned && b.isPinned) {\n      return 1;\n    }\n    return new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime();\n  });\n\n  return chats.map((chat) => serializeChat(dbChatToUIChat(chat)));\n}\n\nexport async function getChatById(rawInput: unknown) {\n  const input = chatIdInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const chat = await getChatByIdQuery({ id: input.chatId });\n\n  if (!chat || chat.userId !== userId) {\n    throw new Error(\"Chat not found\");\n  }\n\n  return serializeChat(dbChatToUIChat(chat));\n}\n\nexport async function getChatMessages(rawInput: unknown) {\n  const input = chatIdInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const chat = await getChatByIdQuery({ id: input.chatId });\n  if (!chat || chat.userId !== userId) {\n    throw new Error(\"Chat not found\");\n  }\n\n  const dbMessages = await getAllMessagesByChatId({ chatId: input.chatId });\n  return dbMessages.map(serializeMessage);\n}\n\nexport async function renameChat(rawInput: unknown) {\n  const input = chatRenameInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const chat = await getChatByIdQuery({ id: input.chatId });\n  if (!chat || chat.userId !== userId) {\n    throw new Error(\"Chat not found or access denied\");\n  }\n\n  await updateChatTitleById({\n    chatId: input.chatId,\n    title: input.title,\n  });\n}\n\nexport async function deleteTrailingMessages(rawInput: unknown) {\n  const input = chatMessageIdInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const [message] = await getMessageById({ id: input.messageId });\n\n  if (!message) {\n    throw new Error(\"Message not found\");\n  }\n\n  const chat = await getChatByIdQuery({ id: message.chatId });\n  if (!chat || chat.userId !== userId) {\n    throw new Error(\"Access denied\");\n  }\n\n  await deleteMessagesByChatIdAfterMessageId({\n    chatId: message.chatId,\n    messageId: input.messageId,\n  });\n}\n\nexport async function stopStream(rawInput: unknown) {\n  const input = chatMessageIdInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const [msg] = await getMessageById({ id: input.messageId });\n  if (!msg) {\n    throw new Error(\"Message not found\");\n  }\n\n  const chat = await getChatByIdQuery({ id: msg.chatId });\n  if (!chat || chat.userId !== userId) {\n    throw new Error(\"Chat not found or access denied\");\n  }\n\n  await updateMessageCanceledAt({\n    messageId: input.messageId,\n    canceledAt: new Date(),\n  });\n\n  return { success: true };\n}\n\nexport async function setVisibility(rawInput: unknown) {\n  const input = chatSetVisibilityInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const chat = await getChatByIdQuery({ id: input.chatId });\n  if (!chat || chat.userId !== userId) {\n    throw new Error(\"Chat not found or access denied\");\n  }\n\n  await updateChatVisiblityById({\n    chatId: input.chatId,\n    visibility: input.visibility,\n  });\n\n  return { success: true };\n}\n\nexport async function setIsPinned(rawInput: unknown) {\n  const input = chatSetIsPinnedInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const chat = await getChatByIdQuery({ id: input.chatId });\n  if (!chat || chat.userId !== userId) {\n    throw new Error(\"Chat not found or access denied\");\n  }\n\n  await updateChatIsPinnedById({\n    chatId: input.chatId,\n    isPinned: input.isPinned,\n  });\n\n  return { success: true };\n}\n\nexport async function deleteChat(rawInput: unknown) {\n  const input = chatIdInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const chat = await getChatByIdQuery({ id: input.chatId });\n  if (!chat || chat.userId !== userId) {\n    throw new Error(\"Chat not found or access denied\");\n  }\n\n  await deleteChatById({ id: input.chatId });\n  return { success: true };\n}\n\nexport async function generateTitle(rawInput: unknown) {\n  const input = chatGenerateTitleInputSchema.parse(rawInput);\n  const { text: title } = await generateText({\n    model: await getLanguageModel(config.models.defaults.title),\n    system: `\\n\n        - you will generate a short title based on the first message a user begins a conversation with\n        - ensure it is not more than 80 characters long\n        - the title should be a summary of the user's message\n        - do not use quotes or colons`,\n    prompt: input.message,\n    experimental_telemetry: { isEnabled: true },\n  });\n\n  return { title };\n}\n\nexport async function getPublicChat(rawInput: unknown) {\n  const input = chatIdInputSchema.parse(rawInput);\n  const chat = await getChatByIdQuery({ id: input.chatId });\n\n  if (!chat || chat.visibility !== \"public\") {\n    throw new Error(\"Public chat not found\");\n  }\n\n  return serializeChat(dbChatToUIChat(chat));\n}\n\nexport async function getPublicChatMessages(rawInput: unknown) {\n  const input = chatIdInputSchema.parse(rawInput);\n\n  const chat = await getChatByIdQuery({ id: input.chatId });\n\n  if (!chat || chat.visibility !== \"public\") {\n    throw new Error(\"Public chat not found\");\n  }\n\n  const dbMessages = await getAllMessagesByChatId({ chatId: input.chatId });\n  return dbMessages.map(serializeMessage);\n}\n\nexport async function cloneSharedChat(rawInput: unknown) {\n  const input = chatIdInputSchema.parse(rawInput);\n  const userId = await requireUserId();\n\n  const sourceChat = await getChatByIdQuery({ id: input.chatId });\n\n  if (!sourceChat || sourceChat.visibility !== \"public\") {\n    throw new Error(\"Public chat not found\");\n  }\n\n  const sourceMessages = await getAllMessagesByChatId({\n    chatId: input.chatId,\n  });\n\n  if (sourceMessages.length === 0) {\n    throw new Error(\"Source chat has no messages to copy\");\n  }\n\n  const sourceMessageIds = sourceMessages.map((msg) => msg.id);\n  const sourceDocuments = await getDocumentsByMessageIds({\n    messageIds: sourceMessageIds,\n  });\n\n  const newChatId = generateUUID();\n\n  await saveChat({\n    id: newChatId,\n    userId,\n    title: `${sourceChat.title}`,\n  });\n\n  const { clonedMessages, clonedDocuments } = cloneMessagesWithDocuments(\n    sourceMessages.map((msg) => ({\n      ...msg,\n      chatId: input.chatId,\n    })) as Array<ChatMessage & { chatId: string }>,\n    sourceDocuments,\n    newChatId,\n    userId\n  );\n\n  const messagesWithClonedAttachments =\n    await cloneAttachmentsInMessages(clonedMessages);\n\n  await saveChatMessages({\n    messages: messagesWithClonedAttachments.map((msg) => ({\n      id: msg.id,\n      chatId: newChatId,\n      message: msg,\n    })),\n  });\n  if (clonedDocuments.length > 0) {\n    await saveDocuments({ documents: clonedDocuments });\n  }\n\n  return { chatId: newChatId };\n}\n"],"names":["DB_DIR","path","combineHeaders","headers","combinedHeaders","currentHeaders","extractResponseHeaders","response","createIdGenerator","prefix","size","alphabet","separator","generator","alphabetLength","chars","InvalidArgumentError","isAbortError","error","FETCH_FAILED_ERROR_MESSAGES","handleFetchError","url","requestBodyValues","cause","APICallError","getRuntimeEnvironmentUserAgent","globalThisAny","_a2","_b2","_c","normalizeHeaders","normalized","value","key","withUserAgentSuffix","userAgentSuffixParts","normalizedHeaders","currentUserAgentHeader","VERSION","getOriginalFetch","getFromApi","successfulResponseHandler","failedResponseHandler","abortSignal","fetch2","responseHeaders","errorInformation","APICallError2","loadOptionalSetting","settingValue","environmentVariableName","suspectProtoRx","suspectConstructorRx","_parse","text","obj","filter","next","nodes","node","secureJsonParse","stackTraceLimit","addAdditionalPropertiesToJsonSchema","jsonSchema2","properties","property","item","ignoreOverride","defaultOptions","getDefaultOptions","options","parseAnyDef","parseArrayDef","def","refs","res","ZodFirstPartyTypeKind","parseDef","parseBigintDef","check","parseBooleanDef","parseBrandedDef","_def","parseCatchDef","parseDateDef","overrideDateStrategy","strategy","i","integerDateParser","parseDefaultDef","parseEffectsDef","parseEnumDef","isJsonSchema7AllOfType","type","parseIntersectionDef","allOf","x","mergedAllOf","schema","nestedSchema","additionalProperties","rest","parseLiteralDef","parsedType","emojiRegex","zodPatterns","parseStringDef","addFormat","addPattern","escapeLiteralCheckValue","literal","escapeNonAlphaNumeric","ALPHA_NUMERIC","source","result","message","regex","stringifyRegExpWithFlags","flags","pattern","isEscaped","inCharGroup","inCharRange","parseRecordDef","_d","_e","_f","ZodFirstPartyTypeKind2","keyType","parseMapDef","keys","values","parseNativeEnumDef","object","actualValues","parsedTypes","parseNeverDef","parseNullDef","primitiveMappings","parseUnionDef","types","types2","acc","uniqueTypes","a","x2","asAnyOf","anyOf","parseNullableDef","base","parseNumberDef","parseObjectDef","required","shape","propName","propDef","propOptional","safeIsOptional","parsedDef","decideAdditionalProperties","parseOptionalDef","innerSchema","parsePipelineDef","b","parsePromiseDef","parseSetDef","parseTupleDef","parseUndefinedDef","parseUnknownDef","parseReadonlyDef","selectParser","typeName","ZodFirstPartyTypeKind3","_","getRelativePath","pathA","pathB","forceResolution","seenItem","overrideResult","seenSchema","get$ref","newItem","jsonSchemaOrGetter","addMeta","postProcessResult","index","getRefs","_options","currentPath","name2","zod3ToJsonSchema","definitions","name3","schema2","_a3","main","title","combined","schemaSymbol","lazySchema","createSchema","jsonSchema","validate","isSchema","asSchema","zodSchema","standardSchema","standardSchema2","TypeValidationError","zod3Schema","zodSchema2","useReferences","zod4Schema","z4.toJSONSchema","z4.safeParseAsync","isZod4Schema","validateTypes","safeValidateTypes","TypeValidationError2","actualSchema","parseJSON","JSONParseError","TypeValidationError3","safeParseJSON","parseJsonEventStream","stream","EventSourceParserStream","data","controller","getOriginalFetch2","postJsonToApi","body","postToApi","APICallError3","resolve","createJsonErrorResponseHandler","errorSchema","errorToMessage","isRetryable","responseBody","APICallError4","parsedError","createEventSourceResponseHandler","chunkSchema","EmptyResponseBodyError","createJsonResponseHandler","responseSchema","parsedResult","withoutTrailingSlash","marker","symbol","_a","_b","GatewayError","_GatewayError","statusCode","name","marker2","symbol2","GatewayAuthenticationError","_GatewayAuthenticationError","apiKeyProvided","oidcTokenProvided","contextualMessage","marker3","symbol3","_b3","GatewayInvalidRequestError","marker4","symbol4","_a4","_b4","GatewayRateLimitError","name4","marker5","symbol5","modelNotFoundParamSchema","z.object","z.string","_a5","_b5","GatewayModelNotFoundError","modelId","name5","marker6","symbol6","_a6","_b6","GatewayInternalServerError","name6","marker7","symbol7","_a7","_b7","GatewayResponseError","validationError","createGatewayErrorFromResponse","defaultMessage","authMethod","parseResult","gatewayErrorResponseSchema","validatedResponse","errorType","modelResult","lazySchema2","z2.object","z2.string","z2.unknown","z2.union","z2.number","asGatewayError","_a8","extractApiCallResponse","GATEWAY_AUTH_METHOD_HEADER","parseAuthMethod","safeValidateTypes2","gatewayAuthMethodSchema","lazySchema3","zodSchema3","z3.union","z3.literal","GatewayFetchMetadata","config","gatewayAvailableModelsResponseSchema","z4.any","baseUrl","gatewayCreditsResponseSchema","lazySchema4","zodSchema4","z4.object","z4.array","z4.string","input","output","input_cache_read","input_cache_write","z4.literal","z4.enum","balance","total_used","GatewayLanguageModel","_abortSignal","optionsWithoutSignal","args","warnings","resolvedHeaders","resolve2","rawResponse","createJsonResponseHandler2","z5.any","createJsonErrorResponseHandler2","chunk","streamPart","part","filePart","buffer","base64Data","streaming","GatewayEmbeddingModel","providerOptions","resolve3","rawValue","postJsonToApi2","combineHeaders2","createJsonResponseHandler3","gatewayEmbeddingResponseSchema","createJsonErrorResponseHandler3","z6.any","lazySchema5","zodSchema5","z6.object","z6.array","z6.number","z6.record","z6.string","z6.unknown","GatewayImageModel","prompt","n","aspectRatio","seed","resolve4","postJsonToApi3","combineHeaders3","createJsonResponseHandler4","gatewayImageResponseSchema","createJsonErrorResponseHandler4","z7.any","providerMetadataEntrySchema","z7.object","z7.array","z7.unknown","z7.string","z7.literal","z7.record","getVercelRequestId","getContext","AI_GATEWAY_PROTOCOL_VERSION","createGatewayProvider","_b8","pendingMetadata","metadataCache","cacheRefreshMillis","lastFetchTime","baseURL","getHeaders","auth","getGatewayAuthToken","createO11yHeaders","deploymentId","environment","region","requestId","createLanguageModel","getAvailableModels","_a9","_b9","now","metadata","getCredits","provider","createEmbeddingModel","gateway","apiKey","getVercelOidcToken","getLanguageModel","model","getAppModelDefinition","languageProvider","middlewares","extractReasoningMiddleware","wrapLanguageModel","cloneMessages","sourceMessages","newChatId","idMap","generateUUID","clonedMessages","newId","newParentId","mappedParentId","clonedMessage","createDocumentIdMap","documents","documentIdMap","document","updateDocumentIdInPart","oldDocId","newDocId","transformDeepResearchPart","isEditDocumentPart","isCreateDocumentPart","transformEditDocumentPart","transformCreateDocumentPart","transformPartWithDocumentId","updateDocumentReferencesInMessageParts","messages","parts","updatedParts","cloneDocuments","sourceDocuments","messageIdMap","newUserId","clonedDocuments","newDocumentId","newMessageId","clonedDocument","cloneFileUIPart","isManagedAttachmentUrl","resolveAttachmentUrl","blob","filename","BLOB_FILE_PREFIX","newBlob","uploadFile","getCloneBaseUrl","raw","cloneAttachmentsInMessages","clonedParts","clonedPart","cloneMessagesWithDocuments","clonedMessagesBase","oldMetadataParentId","newMetadataParentId","existingMetadata","messagesWithUpdatedDocRefs","MAX_INPUT_TOKENS","MAX_MESSAGE_CHARS","chatGetAllChatsInputSchema","z.uuid","chatIdInputSchema","chatRenameInputSchema","chatMessageIdInputSchema","chatSetVisibilityInputSchema","z.enum","chatSetIsPinnedInputSchema","z.boolean","chatGenerateTitleInputSchema","serializeChat","chat","serializeMessage","requireUserId","userId","requestInfo","getAllChats","rawInput","chats","getChatsByUserId","dbChatToUIChat","getChatById","getChatByIdQuery","getChatMessages","getAllMessagesByChatId","renameChat","updateChatTitleById","deleteTrailingMessages","getMessageById","deleteMessagesByChatIdAfterMessageId","stopStream","msg","updateMessageCanceledAt","setVisibility","updateChatVisiblityById","setIsPinned","updateChatIsPinnedById","deleteChat","deleteChatById","generateTitle","generateText","getPublicChat","getPublicChatMessages","cloneSharedChat","sourceChat","sourceMessageIds","getDocumentsByMessageIds","saveChat","messagesWithClonedAttachments","saveChatMessages","saveDocuments"],"mappings":"08BAGA,IAAIA,GAASC,GAAK,KAAK,QAAQ,IAAA,EAAO,WAAW,EACnCA,GAAK,KAAKD,GAAQ,kBAAkB,EAC9B,QAAQ,IAAI,sBAAuB,SAAS,QAAQ,IAAI,oBAAoB,ECJhG,SAASE,KAAkBC,EAAS,CAClC,OAAOA,EAAQ,OACb,CAACC,EAAiBC,KAAoB,CACpC,GAAGD,EACH,GAAGC,GAA0C,CAAA,CACnD,GACI,CAAA,CACJ,CACA,CAgJA,SAASC,EAAuBC,EAAU,CACxC,OAAO,OAAO,YAAY,CAAC,GAAGA,EAAS,OAAO,CAAC,CACjD,CAiGA,IAAIC,GAAoB,CAAC,CACvB,OAAAC,EACA,KAAAC,EAAO,GACP,SAAAC,EAAW,iEACX,UAAAC,EAAY,GACd,EAAI,KAAO,CACT,MAAMC,EAAY,IAAM,CACtB,MAAMC,EAAiBH,EAAS,OAC1BI,EAAQ,IAAI,MAAML,CAAI,EAC5B,QAAS,EAAI,EAAG,EAAIA,EAAM,IACxBK,EAAM,CAAC,EAAIJ,EAAS,KAAK,OAAM,EAAKG,EAAiB,CAAC,EAExD,OAAOC,EAAM,KAAK,EAAE,CACtB,EACA,GAAIN,GAAU,KACZ,OAAOI,EAET,GAAIF,EAAS,SAASC,CAAS,EAC7B,MAAM,IAAII,GAAqB,CAC7B,SAAU,YACV,QAAS,kBAAkBJ,CAAS,uCAAuCD,CAAQ,IACzF,CAAK,EAEH,MAAO,IAAM,GAAGF,CAAM,GAAGG,CAAS,GAAGC,EAAS,CAAE,EAClD,EACiBL,GAAiB,EAuBlC,SAASS,EAAaC,EAAO,CAC3B,OAAQA,aAAiB,OAASA,aAAiB,gBAAkBA,EAAM,OAAS,cAAgBA,EAAM,OAAS,mBACnHA,EAAM,OAAS,eACjB,CAGA,IAAIC,GAA8B,CAAC,eAAgB,iBAAiB,EACpE,SAASC,GAAiB,CACxB,MAAAF,EACA,IAAAG,EACA,kBAAAC,CACF,EAAG,CACD,GAAIL,EAAaC,CAAK,EACpB,OAAOA,EAET,GAAIA,aAAiB,WAAaC,GAA4B,SAASD,EAAM,QAAQ,YAAW,CAAE,EAAG,CACnG,MAAMK,EAAQL,EAAM,MACpB,GAAIK,GAAS,KACX,OAAO,IAAIC,EAAa,CACtB,QAAS,0BAA0BD,EAAM,OAAO,GAChD,MAAAA,EACA,IAAAF,EACA,kBAAAC,EACA,YAAa,EAErB,CAAO,CAEL,CACA,OAAOJ,CACT,CAGA,SAASO,GAA+BC,EAAgB,WAAY,CAClE,IAAIC,EAAKC,EAAKC,EACd,OAAIH,EAAc,OACT,mBAEJC,EAAMD,EAAc,YAAc,MAAgBC,EAAI,UAClD,WAAWD,EAAc,UAAU,UAAU,YAAW,CAAE,IAE9DG,GAAMD,EAAMF,EAAc,UAAY,KAAO,OAASE,EAAI,WAAa,MAAgBC,EAAG,KACtF,mBAAmBH,EAAc,QAAQ,QAAQ,UAAU,CAAC,CAAC,GAElEA,EAAc,YACT,sBAEF,iBACT,CAGA,SAASI,GAAiB3B,EAAS,CACjC,GAAIA,GAAW,KACb,MAAO,CAAA,EAET,MAAM4B,EAAa,CAAA,EACnB,GAAI5B,aAAmB,QACrBA,EAAQ,QAAQ,CAAC6B,EAAOC,IAAQ,CAC9BF,EAAWE,EAAI,YAAW,CAAE,EAAID,CAClC,CAAC,MACI,CACA,MAAM,QAAQ7B,CAAO,IACxBA,EAAU,OAAO,QAAQA,CAAO,GAElC,SAAW,CAAC8B,EAAKD,CAAK,IAAK7B,EACrB6B,GAAS,OACXD,EAAWE,EAAI,YAAW,CAAE,EAAID,EAGtC,CACA,OAAOD,CACT,CAGA,SAASG,GAAoB/B,KAAYgC,EAAsB,CAC7D,MAAMC,EAAoB,IAAI,QAAQN,GAAiB3B,CAAO,CAAC,EACzDkC,EAAyBD,EAAkB,IAAI,YAAY,GAAK,GACtE,OAAAA,EAAkB,IAChB,aACA,CAACC,EAAwB,GAAGF,CAAoB,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,CAC9E,EACS,OAAO,YAAYC,EAAkB,QAAO,CAAE,CACvD,CAGA,IAAIE,GAAiB,QAGjBC,GAAmB,IAAM,WAAW,MACpCC,GAAa,MAAO,CACtB,IAAAnB,EACA,QAAAlB,EAAU,CAAA,EACV,0BAAAsC,EACA,sBAAAC,EACA,YAAAC,EACA,MAAOC,EAASL,GAAgB,CAClC,IAAM,CACJ,GAAI,CACF,MAAMhC,EAAW,MAAMqC,EAAOvB,EAAK,CACjC,OAAQ,MACR,QAASa,GACP/B,EACA,yBAAyBmC,EAAO,GAChCb,GAA8B,CACtC,EACM,OAAQkB,CACd,CAAK,EACKE,EAAkBvC,EAAuBC,CAAQ,EACvD,GAAI,CAACA,EAAS,GAAI,CAChB,IAAIuC,EACJ,GAAI,CACFA,EAAmB,MAAMJ,EAAsB,CAC7C,SAAAnC,EACA,IAAAc,EACA,kBAAmB,CAAA,CAC7B,CAAS,CACH,OAASH,EAAO,CACd,MAAID,EAAaC,CAAK,GAAK6B,EAAc,WAAW7B,CAAK,EACjDA,EAEF,IAAI6B,EAAc,CACtB,QAAS,mCACT,MAAO7B,EACP,WAAYX,EAAS,OACrB,IAAAc,EACA,gBAAAwB,EACA,kBAAmB,CAAA,CAC7B,CAAS,CACH,CACA,MAAMC,EAAiB,KACzB,CACA,GAAI,CACF,OAAO,MAAML,EAA0B,CACrC,SAAAlC,EACA,IAAAc,EACA,kBAAmB,CAAA,CAC3B,CAAO,CACH,OAASH,EAAO,CACd,MAAIA,aAAiB,QACfD,EAAaC,CAAK,GAAK6B,EAAc,WAAW7B,CAAK,GACjDA,EAGJ,IAAI6B,EAAc,CACtB,QAAS,wCACT,MAAO7B,EACP,WAAYX,EAAS,OACrB,IAAAc,EACA,gBAAAwB,EACA,kBAAmB,CAAA,CAC3B,CAAO,CACH,CACF,OAAS3B,EAAO,CACd,MAAME,GAAiB,CAAE,MAAAF,EAAO,IAAAG,EAAK,kBAAmB,CAAA,CAAE,CAAE,CAC9D,CACF,EAgGA,SAAS2B,EAAoB,CAC3B,aAAAC,EACA,wBAAAC,CACF,EAAG,CACD,GAAI,OAAOD,GAAiB,SAC1B,OAAOA,EAET,GAAI,EAAAA,GAAgB,MAAQ,OAAO,QAAY,OAG/CA,EAAe,QAAQ,IAAIC,CAAuB,EAC9C,EAAAD,GAAgB,MAAQ,OAAOA,GAAiB,WAGpD,OAAOA,CACT,CAyDA,IAAIE,GAAiB,kBACjBC,GAAuB,oBAC3B,SAASC,GAAOC,EAAM,CACpB,MAAMC,EAAM,KAAK,MAAMD,CAAI,EAI3B,OAHIC,IAAQ,MAAQ,OAAOA,GAAQ,UAG/BJ,GAAe,KAAKG,CAAI,IAAM,IAASF,GAAqB,KAAKE,CAAI,IAAM,GACtEC,EAEFC,GAAOD,CAAG,CACnB,CACA,SAASC,GAAOD,EAAK,CACnB,IAAIE,EAAO,CAACF,CAAG,EACf,KAAOE,EAAK,QAAQ,CAClB,MAAMC,EAAQD,EACdA,EAAO,CAAA,EACP,UAAWE,KAAQD,EAAO,CACxB,GAAI,OAAO,UAAU,eAAe,KAAKC,EAAM,WAAW,EACxD,MAAM,IAAI,YAAY,8CAA8C,EAEtE,GAAI,OAAO,UAAU,eAAe,KAAKA,EAAM,aAAa,GAAK,OAAO,UAAU,eAAe,KAAKA,EAAK,YAAa,WAAW,EACjI,MAAM,IAAI,YAAY,8CAA8C,EAEtE,UAAW1B,KAAO0B,EAAM,CACtB,MAAM3B,EAAQ2B,EAAK1B,CAAG,EAClBD,GAAS,OAAOA,GAAU,UAC5ByB,EAAK,KAAKzB,CAAK,CAEnB,CACF,CACF,CACA,OAAOuB,CACT,CACA,SAASK,GAAgBN,EAAM,CAC7B,KAAM,CAAE,gBAAAO,CAAe,EAAK,MAC5B,GAAI,CACF,MAAM,gBAAkB,CAC1B,MAAY,CACV,OAAOR,GAAOC,CAAI,CACpB,CACA,GAAI,CACF,OAAOD,GAAOC,CAAI,CACpB,QAAC,CACC,MAAM,gBAAkBO,CAC1B,CACF,CAUA,SAASC,EAAoCC,EAAa,CACxD,GAAIA,EAAY,OAAS,SAAU,CACjCA,EAAY,qBAAuB,GACnC,MAAMC,EAAaD,EAAY,WAC/B,GAAIC,GAAc,KAChB,UAAWC,KAAYD,EACrBA,EAAWC,CAAQ,EAAIH,EACrBE,EAAWC,CAAQ,CAC7B,CAGE,CACA,OAAIF,EAAY,OAAS,SAAWA,EAAY,OAAS,OACnD,MAAM,QAAQA,EAAY,KAAK,EACjCA,EAAY,MAAQA,EAAY,MAAM,IACnCG,GAASJ,EAAoCI,CAAI,CAC1D,EAEMH,EAAY,MAAQD,EAClBC,EAAY,KACpB,GAGSA,CACT,CAGA,IAAII,GAAiB,OACnB,mDACF,EACIC,GAAiB,CACnB,KAAM,OACN,aAAc,OACd,SAAU,CAAC,GAAG,EACd,eAAgB,QAChB,aAAc,MACd,aAAc,mBACd,YAAa,UACb,yBAA0B,cAC1B,4BAA6B,GAC7B,6BAA8B,GAC9B,eAAgB,cAChB,aAAc,GACd,YAAa,CAAA,EACb,cAAe,GACf,gBAAiB,SACjB,gBAAiB,GACjB,cAAe,eACf,eAAgB,yBAChB,aAAc,KAChB,EACIC,GAAqBC,GAAY,OAAOA,GAAY,SAAW,CACjE,GAAGF,GACH,KAAME,CACR,EAAI,CACF,GAAGF,GACH,GAAGE,CACL,EAMA,SAASC,GAAc,CACrB,MAAO,CAAA,CACT,CAIA,SAASC,GAAcC,EAAKC,EAAM,CAChC,IAAI/C,EAAKC,EAAKC,EACd,MAAM8C,EAAM,CACV,KAAM,OACV,EACE,OAAMhD,EAAM8C,EAAI,OAAS,MAAgB9C,EAAI,QAAWE,GAAMD,EAAM6C,EAAI,OAAS,KAAO,OAAS7C,EAAI,OAAS,KAAO,OAASC,EAAG,YAAc+C,EAAsB,SACnKD,EAAI,MAAQE,EAASJ,EAAI,KAAK,KAAM,CAClC,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,OAAO,CAChD,CAAK,GAECD,EAAI,YACNE,EAAI,SAAWF,EAAI,UAAU,OAE3BA,EAAI,YACNE,EAAI,SAAWF,EAAI,UAAU,OAE3BA,EAAI,cACNE,EAAI,SAAWF,EAAI,YAAY,MAC/BE,EAAI,SAAWF,EAAI,YAAY,OAE1BE,CACT,CAGA,SAASG,GAAeL,EAAK,CAC3B,MAAME,EAAM,CACV,KAAM,UACN,OAAQ,OACZ,EACE,GAAI,CAACF,EAAI,OAAQ,OAAOE,EACxB,UAAWI,KAASN,EAAI,OACtB,OAAQM,EAAM,KAAI,CAChB,IAAK,MACCA,EAAM,UACRJ,EAAI,QAAUI,EAAM,MAEpBJ,EAAI,iBAAmBI,EAAM,MAE/B,MACF,IAAK,MACCA,EAAM,UACRJ,EAAI,QAAUI,EAAM,MAEpBJ,EAAI,iBAAmBI,EAAM,MAE/B,MACF,IAAK,aACHJ,EAAI,WAAaI,EAAM,MACvB,KACR,CAEE,OAAOJ,CACT,CAGA,SAASK,IAAkB,CACzB,MAAO,CAAE,KAAM,SAAS,CAC1B,CAGA,SAASC,GAAgBC,EAAMR,EAAM,CACnC,OAAOG,EAASK,EAAK,KAAK,KAAMR,CAAI,CACtC,CAGA,IAAIS,GAAgB,CAACV,EAAKC,IACjBG,EAASJ,EAAI,UAAU,KAAMC,CAAI,EAI1C,SAASU,GAAaX,EAAKC,EAAMW,EAAsB,CACrD,MAAMC,EAAWD,GAAsDX,EAAK,aAC5E,GAAI,MAAM,QAAQY,CAAQ,EACxB,MAAO,CACL,MAAOA,EAAS,IAAI,CAACpB,EAAMqB,IAAMH,GAAaX,EAAKC,EAAMR,CAAI,CAAC,CACpE,EAEE,OAAQoB,EAAQ,CACd,IAAK,SACL,IAAK,mBACH,MAAO,CACL,KAAM,SACN,OAAQ,WAChB,EACI,IAAK,cACH,MAAO,CACL,KAAM,SACN,OAAQ,MAChB,EACI,IAAK,UACH,OAAOE,GAAkBf,CAAG,CAClC,CACA,CACA,IAAIe,GAAqBf,GAAQ,CAC/B,MAAME,EAAM,CACV,KAAM,UACN,OAAQ,WACZ,EACE,UAAWI,KAASN,EAAI,OACtB,OAAQM,EAAM,KAAI,CAChB,IAAK,MACHJ,EAAI,QAAUI,EAAM,MACpB,MACF,IAAK,MACHJ,EAAI,QAAUI,EAAM,MACpB,KACR,CAEE,OAAOJ,CACT,EAGA,SAASc,GAAgBP,EAAMR,EAAM,CACnC,MAAO,CACL,GAAGG,EAASK,EAAK,UAAU,KAAMR,CAAI,EACrC,QAASQ,EAAK,aAAY,CAC9B,CACA,CAGA,SAASQ,GAAgBR,EAAMR,EAAM,CACnC,OAAOA,EAAK,iBAAmB,QAAUG,EAASK,EAAK,OAAO,KAAMR,CAAI,EAAIH,EAAW,CACzF,CAGA,SAASoB,GAAalB,EAAK,CACzB,MAAO,CACL,KAAM,SACN,KAAM,MAAM,KAAKA,EAAI,MAAM,CAC/B,CACA,CAGA,IAAImB,GAA0BC,GACxB,SAAUA,GAAQA,EAAK,OAAS,SAAiB,GAC9C,UAAWA,EAEpB,SAASC,GAAqBrB,EAAKC,EAAM,CACvC,MAAMqB,EAAQ,CACZlB,EAASJ,EAAI,KAAK,KAAM,CACtB,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,GAAG,CACrD,CAAK,EACDG,EAASJ,EAAI,MAAM,KAAM,CACvB,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,GAAG,CACrD,CAAK,CACL,EAAI,OAAQsB,GAAM,CAAC,CAACA,CAAC,EACbC,EAAc,CAAA,EACpB,OAAAF,EAAM,QAASG,GAAW,CACxB,GAAIN,GAAuBM,CAAM,EAC/BD,EAAY,KAAK,GAAGC,EAAO,KAAK,MAC3B,CACL,IAAIC,EAAeD,EACnB,GAAI,yBAA0BA,GAAUA,EAAO,uBAAyB,GAAO,CAC7E,KAAM,CAAE,qBAAAE,EAAsB,GAAGC,CAAI,EAAKH,EAC1CC,EAAeE,CACjB,CACAJ,EAAY,KAAKE,CAAY,CAC/B,CACF,CAAC,EACMF,EAAY,OAAS,CAAE,MAAOA,CAAW,EAAK,MACvD,CAGA,SAASK,GAAgB7B,EAAK,CAC5B,MAAM8B,EAAa,OAAO9B,EAAI,MAC9B,OAAI8B,IAAe,UAAYA,IAAe,UAAYA,IAAe,WAAaA,IAAe,SAC5F,CACL,KAAM,MAAM,QAAQ9B,EAAI,KAAK,EAAI,QAAU,QACjD,EAES,CACL,KAAM8B,IAAe,SAAW,UAAYA,EAC5C,MAAO9B,EAAI,KACf,CACA,CAQA,IAAI+B,GAAa,OACbC,EAAc,CAIhB,KAAM,mBACN,MAAO,cACP,KAAM,2BAIN,MAAO,mGAYP,MAAO,KACDD,KAAe,SACjBA,GAAa,OACX,uDACA,GACR,GAEWA,IAKT,KAAM,wFAIN,KAAM,sHACN,SAAU,2IAIV,KAAM,+XACN,SAAU,0rBACV,OAAQ,mEACR,UAAW,yEACX,OAAQ,sBACR,IAAK,kDACP,EACA,SAASE,GAAejC,EAAKC,EAAM,CACjC,MAAMC,EAAM,CACV,KAAM,QACV,EACE,GAAIF,EAAI,OACN,UAAWM,KAASN,EAAI,OACtB,OAAQM,EAAM,KAAI,CAChB,IAAK,MACHJ,EAAI,UAAY,OAAOA,EAAI,WAAc,SAAW,KAAK,IAAIA,EAAI,UAAWI,EAAM,KAAK,EAAIA,EAAM,MACjG,MACF,IAAK,MACHJ,EAAI,UAAY,OAAOA,EAAI,WAAc,SAAW,KAAK,IAAIA,EAAI,UAAWI,EAAM,KAAK,EAAIA,EAAM,MACjG,MACF,IAAK,QACH,OAAQL,EAAK,cAAa,CACxB,IAAK,eACHiC,EAAUhC,EAAK,QAASI,EAAM,QAASL,CAAI,EAC3C,MACF,IAAK,mBACHiC,EAAUhC,EAAK,YAAaI,EAAM,QAASL,CAAI,EAC/C,MACF,IAAK,cACHkC,EAAWjC,EAAK8B,EAAY,MAAO1B,EAAM,QAASL,CAAI,EACtD,KACd,CACU,MACF,IAAK,MACHiC,EAAUhC,EAAK,MAAOI,EAAM,QAASL,CAAI,EACzC,MACF,IAAK,OACHiC,EAAUhC,EAAK,OAAQI,EAAM,QAASL,CAAI,EAC1C,MACF,IAAK,QACHkC,EAAWjC,EAAKI,EAAM,MAAOA,EAAM,QAASL,CAAI,EAChD,MACF,IAAK,OACHkC,EAAWjC,EAAK8B,EAAY,KAAM1B,EAAM,QAASL,CAAI,EACrD,MACF,IAAK,QACHkC,EAAWjC,EAAK8B,EAAY,MAAO1B,EAAM,QAASL,CAAI,EACtD,MACF,IAAK,aACHkC,EACEjC,EACA,OAAO,IAAIkC,GAAwB9B,EAAM,MAAOL,CAAI,CAAC,EAAE,EACvDK,EAAM,QACNL,CACZ,EACU,MACF,IAAK,WACHkC,EACEjC,EACA,OAAO,GAAGkC,GAAwB9B,EAAM,MAAOL,CAAI,CAAC,GAAG,EACvDK,EAAM,QACNL,CACZ,EACU,MACF,IAAK,WACHiC,EAAUhC,EAAK,YAAaI,EAAM,QAASL,CAAI,EAC/C,MACF,IAAK,OACHiC,EAAUhC,EAAK,OAAQI,EAAM,QAASL,CAAI,EAC1C,MACF,IAAK,OACHiC,EAAUhC,EAAK,OAAQI,EAAM,QAASL,CAAI,EAC1C,MACF,IAAK,WACHiC,EAAUhC,EAAK,WAAYI,EAAM,QAASL,CAAI,EAC9C,MACF,IAAK,SACHC,EAAI,UAAY,OAAOA,EAAI,WAAc,SAAW,KAAK,IAAIA,EAAI,UAAWI,EAAM,KAAK,EAAIA,EAAM,MACjGJ,EAAI,UAAY,OAAOA,EAAI,WAAc,SAAW,KAAK,IAAIA,EAAI,UAAWI,EAAM,KAAK,EAAIA,EAAM,MACjG,MACF,IAAK,WAAY,CACf6B,EACEjC,EACA,OAAOkC,GAAwB9B,EAAM,MAAOL,CAAI,CAAC,EACjDK,EAAM,QACNL,CACZ,EACU,KACF,CACA,IAAK,KAAM,CACLK,EAAM,UAAY,MACpB4B,EAAUhC,EAAK,OAAQI,EAAM,QAASL,CAAI,EAExCK,EAAM,UAAY,MACpB4B,EAAUhC,EAAK,OAAQI,EAAM,QAASL,CAAI,EAE5C,KACF,CACA,IAAK,YACHkC,EAAWjC,EAAK8B,EAAY,UAAW1B,EAAM,QAASL,CAAI,EAC1D,MACF,IAAK,MACHkC,EAAWjC,EAAK8B,EAAY,IAAK1B,EAAM,QAASL,CAAI,EACpD,MACF,IAAK,OAAQ,CACPK,EAAM,UAAY,MACpB6B,EAAWjC,EAAK8B,EAAY,SAAU1B,EAAM,QAASL,CAAI,EAEvDK,EAAM,UAAY,MACpB6B,EAAWjC,EAAK8B,EAAY,SAAU1B,EAAM,QAASL,CAAI,EAE3D,KACF,CACA,IAAK,QACHkC,EAAWjC,EAAK8B,EAAY,MAAK,EAAI1B,EAAM,QAASL,CAAI,EACxD,MACF,IAAK,OAAQ,CACXkC,EAAWjC,EAAK8B,EAAY,KAAM1B,EAAM,QAASL,CAAI,EACrD,KACF,CACA,IAAK,SAAU,CACb,OAAQA,EAAK,eAAc,CACzB,IAAK,gBAAiB,CACpBiC,EAAUhC,EAAK,SAAUI,EAAM,QAASL,CAAI,EAC5C,KACF,CACA,IAAK,yBAA0B,CAC7BC,EAAI,gBAAkB,SACtB,KACF,CACA,IAAK,cAAe,CAClBiC,EAAWjC,EAAK8B,EAAY,OAAQ1B,EAAM,QAASL,CAAI,EACvD,KACF,CACZ,CACU,KACF,CACA,IAAK,SACHkC,EAAWjC,EAAK8B,EAAY,OAAQ1B,EAAM,QAASL,CAAI,CASjE,CAGE,OAAOC,CACT,CACA,SAASkC,GAAwBC,EAASpC,EAAM,CAC9C,OAAOA,EAAK,kBAAoB,SAAWqC,GAAsBD,CAAO,EAAIA,CAC9E,CACA,IAAIE,GAAgB,IAAI,IACtB,8DACF,EACA,SAASD,GAAsBE,EAAQ,CACrC,IAAIC,EAAS,GACb,QAAS3B,EAAI,EAAGA,EAAI0B,EAAO,OAAQ1B,IAC5ByB,GAAc,IAAIC,EAAO1B,CAAC,CAAC,IAC9B2B,GAAU,MAEZA,GAAUD,EAAO1B,CAAC,EAEpB,OAAO2B,CACT,CACA,SAASP,EAAUT,EAAQlE,EAAOmF,EAASzC,EAAM,CAC/C,IAAI/C,EACAuE,EAAO,SAAYvE,EAAMuE,EAAO,QAAU,MAAgBvE,EAAI,KAAMqE,GAAMA,EAAE,MAAM,GAC/EE,EAAO,QACVA,EAAO,MAAQ,CAAA,GAEbA,EAAO,SACTA,EAAO,MAAM,KAAK,CAChB,OAAQA,EAAO,MACvB,CAAO,EACD,OAAOA,EAAO,QAEhBA,EAAO,MAAM,KAAK,CAChB,OAAQlE,EACR,GAAGmF,GAAWzC,EAAK,eAAiB,CAAE,aAAc,CAAE,OAAQyC,CAAO,CAAE,CAC7E,CAAK,GAEDjB,EAAO,OAASlE,CAEpB,CACA,SAAS4E,EAAWV,EAAQkB,EAAOD,EAASzC,EAAM,CAChD,IAAI/C,EACAuE,EAAO,UAAavE,EAAMuE,EAAO,QAAU,MAAgBvE,EAAI,KAAMqE,GAAMA,EAAE,OAAO,GACjFE,EAAO,QACVA,EAAO,MAAQ,CAAA,GAEbA,EAAO,UACTA,EAAO,MAAM,KAAK,CAChB,QAASA,EAAO,OACxB,CAAO,EACD,OAAOA,EAAO,SAEhBA,EAAO,MAAM,KAAK,CAChB,QAASmB,GAAyBD,EAAO1C,CAAI,EAC7C,GAAGyC,GAAWzC,EAAK,eAAiB,CAAE,aAAc,CAAE,QAASyC,CAAO,CAAE,CAC9E,CAAK,GAEDjB,EAAO,QAAUmB,GAAyBD,EAAO1C,CAAI,CAEzD,CACA,SAAS2C,GAAyBD,EAAO1C,EAAM,CAC7C,IAAI/C,EACJ,GAAI,CAAC+C,EAAK,iBAAmB,CAAC0C,EAAM,MAClC,OAAOA,EAAM,OAEf,MAAME,EAAQ,CACZ,EAAGF,EAAM,MAAM,SAAS,GAAG,EAE3B,EAAGA,EAAM,MAAM,SAAS,GAAG,EAE3B,EAAGA,EAAM,MAAM,SAAS,GAAG,CAE/B,EACQH,EAASK,EAAM,EAAIF,EAAM,OAAO,YAAW,EAAKA,EAAM,OAC5D,IAAIG,EAAU,GACVC,EAAY,GACZC,EAAc,GACdC,EAAc,GAClB,QAASnC,EAAI,EAAGA,EAAI0B,EAAO,OAAQ1B,IAAK,CACtC,GAAIiC,EAAW,CACbD,GAAWN,EAAO1B,CAAC,EACnBiC,EAAY,GACZ,QACF,CACA,GAAIF,EAAM,GACR,GAAIG,GACF,GAAIR,EAAO1B,CAAC,EAAE,MAAM,OAAO,EAAG,CACxBmC,GACFH,GAAWN,EAAO1B,CAAC,EACnBgC,GAAW,GAAGN,EAAO1B,EAAI,CAAC,CAAC,IAAI0B,EAAO1B,CAAC,CAAC,GAAG,YAAW,EACtDmC,EAAc,IACLT,EAAO1B,EAAI,CAAC,IAAM,OAAS5D,EAAMsF,EAAO1B,EAAI,CAAC,IAAM,MAAgB5D,EAAI,MAAM,OAAO,IAC7F4F,GAAWN,EAAO1B,CAAC,EACnBmC,EAAc,IAEdH,GAAW,GAAGN,EAAO1B,CAAC,CAAC,GAAG0B,EAAO1B,CAAC,EAAE,YAAW,CAAE,GAEnD,QACF,UACS0B,EAAO1B,CAAC,EAAE,MAAM,OAAO,EAAG,CACnCgC,GAAW,IAAIN,EAAO1B,CAAC,CAAC,GAAG0B,EAAO1B,CAAC,EAAE,YAAW,CAAE,IAClD,QACF,EAEF,GAAI+B,EAAM,GACR,GAAIL,EAAO1B,CAAC,IAAM,IAAK,CACrBgC,GAAW;AAAA,KAEX,QACF,SAAWN,EAAO1B,CAAC,IAAM,IAAK,CAC5BgC,GAAW;AAAA,KAEX,QACF,EAEF,GAAID,EAAM,GAAKL,EAAO1B,CAAC,IAAM,IAAK,CAChCgC,GAAWE,EAAc,GAAGR,EAAO1B,CAAC,CAAC;AAAA,EACvC,IAAI0B,EAAO1B,CAAC,CAAC;AAAA,GAEX,QACF,CACAgC,GAAWN,EAAO1B,CAAC,EACf0B,EAAO1B,CAAC,IAAM,KAChBiC,EAAY,GACHC,GAAeR,EAAO1B,CAAC,IAAM,IACtCkC,EAAc,GACL,CAACA,GAAeR,EAAO1B,CAAC,IAAM,MACvCkC,EAAc,GAElB,CACA,GAAI,CACF,IAAI,OAAOF,CAAO,CACpB,MAAY,CACV,eAAQ,KACN,sCAAsC7C,EAAK,YAAY,KACrD,GACR,CAAO,uEACP,EACW0C,EAAM,MACf,CACA,OAAOG,CACT,CAGA,SAASI,GAAelD,EAAKC,EAAM,CACjC,IAAI/C,EAAKC,EAAKC,EAAI+F,EAAIC,EAAIC,EAC1B,MAAM5B,EAAS,CACb,KAAM,SACN,sBAAuBvE,EAAMkD,EAASJ,EAAI,UAAU,KAAM,CACxD,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,sBAAsB,CAC/D,CAAK,IAAM,KAAO/C,EAAM+C,EAAK,2BAC7B,EACE,KAAM9C,EAAM6C,EAAI,UAAY,KAAO,OAAS7C,EAAI,KAAK,YAAcmG,EAAuB,aAAelG,EAAK4C,EAAI,QAAQ,KAAK,SAAW,MAAgB5C,EAAG,QAAS,CACpK,KAAM,CAAE,KAAAgE,EAAM,GAAGmC,CAAO,EAAKtB,GAAejC,EAAI,QAAQ,KAAMC,CAAI,EAClE,MAAO,CACL,GAAGwB,EACH,cAAe8B,CACrB,CACE,KAAO,MAAMJ,EAAKnD,EAAI,UAAY,KAAO,OAASmD,EAAG,KAAK,YAAcG,EAAuB,QAC7F,MAAO,CACL,GAAG7B,EACH,cAAe,CACb,KAAMzB,EAAI,QAAQ,KAAK,MAC/B,CACA,EACS,KAAMoD,EAAKpD,EAAI,UAAY,KAAO,OAASoD,EAAG,KAAK,YAAcE,EAAuB,YAActD,EAAI,QAAQ,KAAK,KAAK,KAAK,WAAasD,EAAuB,aAAeD,EAAKrD,EAAI,QAAQ,KAAK,KAAK,KAAK,SAAW,MAAgBqD,EAAG,QAAS,CAChQ,KAAM,CAAE,KAAAjC,EAAM,GAAGmC,CAAO,EAAK/C,GAC3BR,EAAI,QAAQ,KACZC,CACN,EACI,MAAO,CACL,GAAGwB,EACH,cAAe8B,CACrB,CACE,EACA,OAAO9B,CACT,CAGA,SAAS+B,GAAYxD,EAAKC,EAAM,CAC9B,GAAIA,EAAK,cAAgB,SACvB,OAAOiD,GAAelD,EAAKC,CAAI,EAEjC,MAAMwD,EAAOrD,EAASJ,EAAI,QAAQ,KAAM,CACtC,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,QAAS,GAAG,CAC5D,CAAG,GAAKH,EAAW,EACX4D,EAAStD,EAASJ,EAAI,UAAU,KAAM,CAC1C,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,QAAS,GAAG,CAC5D,CAAG,GAAKH,EAAW,EACjB,MAAO,CACL,KAAM,QACN,SAAU,IACV,MAAO,CACL,KAAM,QACN,MAAO,CAAC2D,EAAMC,CAAM,EACpB,SAAU,EACV,SAAU,CAChB,CACA,CACA,CAGA,SAASC,GAAmB3D,EAAK,CAC/B,MAAM4D,EAAS5D,EAAI,OAIb6D,EAHa,OAAO,KAAK7D,EAAI,MAAM,EAAE,OAAQxC,GAC1C,OAAOoG,EAAOA,EAAOpG,CAAG,CAAC,GAAM,QACvC,EAC+B,IAAKA,GAAQoG,EAAOpG,CAAG,CAAC,EAClDsG,EAAc,MAAM,KACxB,IAAI,IAAID,EAAa,IAAKH,GAAW,OAAOA,CAAM,CAAC,CACvD,EACE,MAAO,CACL,KAAMI,EAAY,SAAW,EAAIA,EAAY,CAAC,IAAM,SAAW,SAAW,SAAW,CAAC,SAAU,QAAQ,EACxG,KAAMD,CACV,CACA,CAGA,SAASE,IAAgB,CACvB,MAAO,CAAE,IAAKjE,GAAa,CAC7B,CAGA,SAASkE,IAAe,CACtB,MAAO,CACL,KAAM,MACV,CACA,CAGA,IAAIC,GAAoB,CACtB,UAAW,SACX,UAAW,SACX,UAAW,UACX,WAAY,UACZ,QAAS,MACX,EACA,SAASC,GAAclE,EAAKC,EAAM,CAChC,MAAMJ,EAAUG,EAAI,mBAAmB,IAAM,MAAM,KAAKA,EAAI,QAAQ,QAAQ,EAAIA,EAAI,QACpF,GAAIH,EAAQ,MACT0B,GAAMA,EAAE,KAAK,YAAY0C,KAAsB,CAAC1C,EAAE,KAAK,QAAU,CAACA,EAAE,KAAK,OAAO,OACrF,EAAK,CACD,MAAM4C,EAAQtE,EAAQ,OAAO,CAACuE,EAAQ7C,IAAM,CAC1C,MAAMH,EAAO6C,GAAkB1C,EAAE,KAAK,QAAQ,EAC9C,OAAOH,GAAQ,CAACgD,EAAO,SAAShD,CAAI,EAAI,CAAC,GAAGgD,EAAQhD,CAAI,EAAIgD,CAC9D,EAAG,CAAA,CAAE,EACL,MAAO,CACL,KAAMD,EAAM,OAAS,EAAIA,EAAQA,EAAM,CAAC,CAC9C,CACE,SAAWtE,EAAQ,MAAO0B,GAAMA,EAAE,KAAK,WAAa,cAAgB,CAACA,EAAE,WAAW,EAAG,CACnF,MAAM4C,EAAQtE,EAAQ,OACpB,CAACwE,EAAK9C,IAAM,CACV,MAAMH,EAAO,OAAOG,EAAE,KAAK,MAC3B,OAAQH,EAAI,CACV,IAAK,SACL,IAAK,SACL,IAAK,UACH,MAAO,CAAC,GAAGiD,EAAKjD,CAAI,EACtB,IAAK,SACH,MAAO,CAAC,GAAGiD,EAAK,SAAS,EAC3B,IAAK,SACH,GAAI9C,EAAE,KAAK,QAAU,KAAM,MAAO,CAAC,GAAG8C,EAAK,MAAM,EAInD,QACE,OAAOA,CACnB,CACM,EACA,CAAA,CACN,EACI,GAAIF,EAAM,SAAWtE,EAAQ,OAAQ,CACnC,MAAMyE,EAAcH,EAAM,OAAO,CAAC5C,EAAGT,EAAGyD,IAAMA,EAAE,QAAQhD,CAAC,IAAMT,CAAC,EAChE,MAAO,CACL,KAAMwD,EAAY,OAAS,EAAIA,EAAcA,EAAY,CAAC,EAC1D,KAAMzE,EAAQ,OACZ,CAACwE,EAAK9C,IACG8C,EAAI,SAAS9C,EAAE,KAAK,KAAK,EAAI8C,EAAM,CAAC,GAAGA,EAAK9C,EAAE,KAAK,KAAK,EAEjE,CAAA,CACV,CACA,CACI,CACF,SAAW1B,EAAQ,MAAO0B,GAAMA,EAAE,KAAK,WAAa,SAAS,EAC3D,MAAO,CACL,KAAM,SACN,KAAM1B,EAAQ,OACZ,CAACwE,EAAK9C,IAAM,CACV,GAAG8C,EACH,GAAG9C,EAAE,KAAK,OAAO,OAAQiD,GAAO,CAACH,EAAI,SAASG,CAAE,CAAC,CAC3D,EACQ,CAAA,CACR,CACA,EAEE,OAAOC,GAAQzE,EAAKC,CAAI,CAC1B,CACA,IAAIwE,GAAU,CAACzE,EAAKC,IAAS,CAC3B,MAAMyE,GAAS1E,EAAI,mBAAmB,IAAM,MAAM,KAAKA,EAAI,QAAQ,OAAM,CAAE,EAAIA,EAAI,SAAS,IAC1F,CAACuB,EAAGT,IAAMV,EAASmB,EAAE,KAAM,CACzB,GAAGtB,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,GAAGa,CAAC,EAAE,CACxD,CAAK,CACL,EAAI,OACCS,GAAM,CAAC,CAACA,IAAM,CAACtB,EAAK,cAAgB,OAAOsB,GAAM,UAAY,OAAO,KAAKA,CAAC,EAAE,OAAS,EAC1F,EACE,OAAOmD,EAAM,OAAS,CAAE,MAAAA,CAAK,EAAK,MACpC,EAGA,SAASC,GAAiB3E,EAAKC,EAAM,CACnC,GAAI,CAAC,YAAa,YAAa,YAAa,aAAc,SAAS,EAAE,SACnED,EAAI,UAAU,KAAK,QACvB,IAAQ,CAACA,EAAI,UAAU,KAAK,QAAU,CAACA,EAAI,UAAU,KAAK,OAAO,QAC7D,MAAO,CACL,KAAM,CACJiE,GAAkBjE,EAAI,UAAU,KAAK,QAAQ,EAC7C,MACR,CACA,EAEE,MAAM4E,EAAOxE,EAASJ,EAAI,UAAU,KAAM,CACxC,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,GAAG,CACnD,CAAG,EACD,OAAO2E,GAAQ,CAAE,MAAO,CAACA,EAAM,CAAE,KAAM,MAAM,CAAE,CAAC,CAClD,CAGA,SAASC,GAAe7E,EAAK,CAC3B,MAAME,EAAM,CACV,KAAM,QACV,EACE,GAAI,CAACF,EAAI,OAAQ,OAAOE,EACxB,UAAWI,KAASN,EAAI,OACtB,OAAQM,EAAM,KAAI,CAChB,IAAK,MACHJ,EAAI,KAAO,UACX,MACF,IAAK,MACCI,EAAM,UACRJ,EAAI,QAAUI,EAAM,MAEpBJ,EAAI,iBAAmBI,EAAM,MAE/B,MACF,IAAK,MACCA,EAAM,UACRJ,EAAI,QAAUI,EAAM,MAEpBJ,EAAI,iBAAmBI,EAAM,MAE/B,MACF,IAAK,aACHJ,EAAI,WAAaI,EAAM,MACvB,KACR,CAEE,OAAOJ,CACT,CAGA,SAAS4E,GAAe9E,EAAKC,EAAM,CACjC,MAAMwC,EAAS,CACb,KAAM,SACN,WAAY,CAAA,CAChB,EACQsC,EAAW,CAAA,EACXC,EAAQhF,EAAI,MAAK,EACvB,UAAWiF,KAAYD,EAAO,CAC5B,IAAIE,EAAUF,EAAMC,CAAQ,EAC5B,GAAIC,IAAY,QAAUA,EAAQ,OAAS,OACzC,SAEF,MAAMC,EAAeC,GAAeF,CAAO,EACrCG,EAAYjF,EAAS8E,EAAQ,KAAM,CACvC,GAAGjF,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,aAAcgF,CAAQ,EACzD,aAAc,CAAC,GAAGhF,EAAK,YAAa,aAAcgF,CAAQ,CAChE,CAAK,EACGI,IAAc,SAGlB5C,EAAO,WAAWwC,CAAQ,EAAII,EACzBF,GACHJ,EAAS,KAAKE,CAAQ,EAE1B,CACIF,EAAS,SACXtC,EAAO,SAAWsC,GAEpB,MAAMpD,EAAuB2D,GAA2BtF,EAAKC,CAAI,EACjE,OAAI0B,IAAyB,SAC3Bc,EAAO,qBAAuBd,GAEzBc,CACT,CACA,SAAS6C,GAA2BtF,EAAKC,EAAM,CAC7C,GAAID,EAAI,SAAS,KAAK,WAAa,WACjC,OAAOI,EAASJ,EAAI,SAAS,KAAM,CACjC,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,sBAAsB,CAC/D,CAAK,EAEH,OAAQD,EAAI,YAAW,CACrB,IAAK,cACH,OAAOC,EAAK,4BACd,IAAK,SACH,OAAOA,EAAK,6BACd,IAAK,QACH,OAAOA,EAAK,2BAA6B,SAAWA,EAAK,4BAA8BA,EAAK,4BAClG,CACA,CACA,SAASmF,GAAe3D,EAAQ,CAC9B,GAAI,CACF,OAAOA,EAAO,WAAU,CAC1B,MAAY,CACV,MAAO,EACT,CACF,CAGA,IAAI8D,GAAmB,CAACvF,EAAKC,IAAS,CACpC,IAAI/C,EACJ,GAAI+C,EAAK,YAAY,SAAQ,MAAS/C,EAAM+C,EAAK,eAAiB,KAAO,OAAS/C,EAAI,SAAQ,GAC5F,OAAOkD,EAASJ,EAAI,UAAU,KAAMC,CAAI,EAE1C,MAAMuF,EAAcpF,EAASJ,EAAI,UAAU,KAAM,CAC/C,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,GAAG,CACnD,CAAG,EACD,OAAOuF,EAAc,CAAE,MAAO,CAAC,CAAE,IAAK1F,EAAW,GAAM0F,CAAW,CAAC,EAAK1F,EAAW,CACrF,EAGI2F,GAAmB,CAACzF,EAAKC,IAAS,CACpC,GAAIA,EAAK,eAAiB,QACxB,OAAOG,EAASJ,EAAI,GAAG,KAAMC,CAAI,EAC5B,GAAIA,EAAK,eAAiB,SAC/B,OAAOG,EAASJ,EAAI,IAAI,KAAMC,CAAI,EAEpC,MAAM,EAAIG,EAASJ,EAAI,GAAG,KAAM,CAC9B,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,GAAG,CACnD,CAAG,EACKyF,EAAItF,EAASJ,EAAI,IAAI,KAAM,CAC/B,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,EAAI,IAAM,GAAG,CAC7D,CAAG,EACD,MAAO,CACL,MAAO,CAAC,EAAGyF,CAAC,EAAE,OAAQnE,GAAMA,IAAM,MAAM,CAC5C,CACA,EAGA,SAASoE,GAAgB3F,EAAKC,EAAM,CAClC,OAAOG,EAASJ,EAAI,KAAK,KAAMC,CAAI,CACrC,CAGA,SAAS2F,GAAY5F,EAAKC,EAAM,CAK9B,MAAMwB,EAAS,CACb,KAAM,QACN,YAAa,GACb,MAPYrB,EAASJ,EAAI,UAAU,KAAM,CACzC,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,OAAO,CAC9C,CAAG,CAKH,EACE,OAAID,EAAI,UACNyB,EAAO,SAAWzB,EAAI,QAAQ,OAE5BA,EAAI,UACNyB,EAAO,SAAWzB,EAAI,QAAQ,OAEzByB,CACT,CAGA,SAASoE,GAAc7F,EAAKC,EAAM,CAChC,OAAID,EAAI,KACC,CACL,KAAM,QACN,SAAUA,EAAI,MAAM,OACpB,MAAOA,EAAI,MAAM,IACf,CAACuB,EAAGT,IAAMV,EAASmB,EAAE,KAAM,CACzB,GAAGtB,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,GAAGa,CAAC,EAAE,CAC5D,CAAS,CACT,EAAQ,OACA,CAACuD,EAAK9C,IAAMA,IAAM,OAAS8C,EAAM,CAAC,GAAGA,EAAK9C,CAAC,EAC3C,CAAA,CACR,EACM,gBAAiBnB,EAASJ,EAAI,KAAK,KAAM,CACvC,GAAGC,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,iBAAiB,CAC5D,CAAO,CACP,EAEW,CACL,KAAM,QACN,SAAUD,EAAI,MAAM,OACpB,SAAUA,EAAI,MAAM,OACpB,MAAOA,EAAI,MAAM,IACf,CAACuB,EAAGT,IAAMV,EAASmB,EAAE,KAAM,CACzB,GAAGtB,EACH,YAAa,CAAC,GAAGA,EAAK,YAAa,QAAS,GAAGa,CAAC,EAAE,CAC5D,CAAS,CACT,EAAQ,OACA,CAACuD,EAAK9C,IAAMA,IAAM,OAAS8C,EAAM,CAAC,GAAGA,EAAK9C,CAAC,EAC3C,CAAA,CACR,CACA,CAEA,CAGA,SAASuE,IAAoB,CAC3B,MAAO,CACL,IAAKhG,EAAW,CACpB,CACA,CAGA,SAASiG,IAAkB,CACzB,OAAOjG,EAAW,CACpB,CAGA,IAAIkG,GAAmB,CAAChG,EAAKC,IACpBG,EAASJ,EAAI,UAAU,KAAMC,CAAI,EAItCgG,GAAe,CAACjG,EAAKkG,EAAUjG,IAAS,CAC1C,OAAQiG,EAAQ,CACd,KAAKC,EAAuB,UAC1B,OAAOlE,GAAejC,EAAKC,CAAI,EACjC,KAAKkG,EAAuB,UAC1B,OAAOtB,GAAe7E,CAAG,EAC3B,KAAKmG,EAAuB,UAC1B,OAAOrB,GAAe9E,EAAKC,CAAI,EACjC,KAAKkG,EAAuB,UAC1B,OAAO9F,GAAeL,CAAG,EAC3B,KAAKmG,EAAuB,WAC1B,OAAO5F,GAAe,EACxB,KAAK4F,EAAuB,QAC1B,OAAOxF,GAAaX,EAAKC,CAAI,EAC/B,KAAKkG,EAAuB,aAC1B,OAAOL,GAAiB,EAC1B,KAAKK,EAAuB,QAC1B,OAAOnC,GAAY,EACrB,KAAKmC,EAAuB,SAC1B,OAAOpG,GAAcC,EAAKC,CAAI,EAChC,KAAKkG,EAAuB,SAC5B,KAAKA,EAAuB,sBAC1B,OAAOjC,GAAclE,EAAKC,CAAI,EAChC,KAAKkG,EAAuB,gBAC1B,OAAO9E,GAAqBrB,EAAKC,CAAI,EACvC,KAAKkG,EAAuB,SAC1B,OAAON,GAAc7F,EAAKC,CAAI,EAChC,KAAKkG,EAAuB,UAC1B,OAAOjD,GAAelD,EAAKC,CAAI,EACjC,KAAKkG,EAAuB,WAC1B,OAAOtE,GAAgB7B,CAAG,EAC5B,KAAKmG,EAAuB,QAC1B,OAAOjF,GAAalB,CAAG,EACzB,KAAKmG,EAAuB,cAC1B,OAAOxC,GAAmB3D,CAAG,EAC/B,KAAKmG,EAAuB,YAC1B,OAAOxB,GAAiB3E,EAAKC,CAAI,EACnC,KAAKkG,EAAuB,YAC1B,OAAOZ,GAAiBvF,EAAKC,CAAI,EACnC,KAAKkG,EAAuB,OAC1B,OAAO3C,GAAYxD,EAAKC,CAAI,EAC9B,KAAKkG,EAAuB,OAC1B,OAAOP,GAAY5F,EAAKC,CAAI,EAC9B,KAAKkG,EAAuB,QAC1B,MAAO,IAAMnG,EAAI,OAAM,EAAG,KAC5B,KAAKmG,EAAuB,WAC1B,OAAOR,GAAgB3F,EAAKC,CAAI,EAClC,KAAKkG,EAAuB,OAC5B,KAAKA,EAAuB,SAC1B,OAAOpC,GAAa,EACtB,KAAKoC,EAAuB,WAC1B,OAAOlF,GAAgBjB,EAAKC,CAAI,EAClC,KAAKkG,EAAuB,OAC1B,OAAOrG,EAAW,EACpB,KAAKqG,EAAuB,WAC1B,OAAOJ,GAAe,EACxB,KAAKI,EAAuB,WAC1B,OAAOnF,GAAgBhB,EAAKC,CAAI,EAClC,KAAKkG,EAAuB,WAC1B,OAAO3F,GAAgBR,EAAKC,CAAI,EAClC,KAAKkG,EAAuB,YAC1B,OAAOH,GAAiBhG,EAAKC,CAAI,EACnC,KAAKkG,EAAuB,SAC1B,OAAOzF,GAAcV,EAAKC,CAAI,EAChC,KAAKkG,EAAuB,YAC1B,OAAOV,GAAiBzF,EAAKC,CAAI,EACnC,KAAKkG,EAAuB,YAC5B,KAAKA,EAAuB,QAC5B,KAAKA,EAAuB,UAC1B,OACF,QACE,OAAyBC,GAAC,IAAqB,CACrD,CACA,EAGIC,GAAkB,CAACC,EAAOC,IAAU,CACtC,IAAIzF,EAAI,EACR,KAAOA,EAAIwF,EAAM,QAAUxF,EAAIyF,EAAM,QAC/BD,EAAMxF,CAAC,IAAMyF,EAAMzF,CAAC,EADmBA,IAC3C,CAEF,MAAO,EAAEwF,EAAM,OAASxF,GAAG,SAAQ,EAAI,GAAGyF,EAAM,MAAMzF,CAAC,CAAC,EAAE,KAAK,GAAG,CACpE,EAGA,SAASV,EAASJ,EAAKC,EAAMuG,EAAkB,GAAO,CACpD,IAAItJ,EACJ,MAAMuJ,EAAWxG,EAAK,KAAK,IAAID,CAAG,EAClC,GAAIC,EAAK,SAAU,CACjB,MAAMyG,GAAkBxJ,EAAM+C,EAAK,WAAa,KAAO,OAAS/C,EAAI,KAClE+C,EACAD,EACAC,EACAwG,EACAD,CACN,EACI,GAAIE,IAAmBhH,GACrB,OAAOgH,CAEX,CACA,GAAID,GAAY,CAACD,EAAiB,CAChC,MAAMG,EAAaC,GAAQH,EAAUxG,CAAI,EACzC,GAAI0G,IAAe,OACjB,OAAOA,CAEX,CACA,MAAME,EAAU,CAAE,IAAA7G,EAAK,KAAMC,EAAK,YAAa,WAAY,MAAM,EACjEA,EAAK,KAAK,IAAID,EAAK6G,CAAO,EAC1B,MAAMC,EAAqBb,GAAajG,EAAKA,EAAI,SAAUC,CAAI,EACzDX,EAAc,OAAOwH,GAAuB,WAAa1G,EAAS0G,EAAkB,EAAI7G,CAAI,EAAI6G,EAItG,GAHIxH,GACFyH,GAAQ/G,EAAKC,EAAMX,CAAW,EAE5BW,EAAK,YAAa,CACpB,MAAM+G,EAAoB/G,EAAK,YAAYX,EAAaU,EAAKC,CAAI,EACjE,OAAA4G,EAAQ,WAAavH,EACd0H,CACT,CACA,OAAAH,EAAQ,WAAavH,EACdA,CACT,CACA,IAAIsH,GAAU,CAACnH,EAAMQ,IAAS,CAC5B,OAAQA,EAAK,aAAY,CACvB,IAAK,OACH,MAAO,CAAE,KAAMR,EAAK,KAAK,KAAK,GAAG,CAAC,EACpC,IAAK,WACH,MAAO,CAAE,KAAM4G,GAAgBpG,EAAK,YAAaR,EAAK,IAAI,CAAC,EAC7D,IAAK,OACL,IAAK,OACH,OAAIA,EAAK,KAAK,OAASQ,EAAK,YAAY,QAAUR,EAAK,KAAK,MAAM,CAAClC,EAAO0J,IAAUhH,EAAK,YAAYgH,CAAK,IAAM1J,CAAK,GACnH,QAAQ,KACN,mCAAmC0C,EAAK,YAAY,KAClD,GACZ,CAAW,qBACX,EACeH,EAAW,GAEbG,EAAK,eAAiB,OAASH,EAAW,EAAK,MAE5D,CACA,EACIiH,GAAU,CAAC/G,EAAKC,EAAMX,KACpBU,EAAI,cACNV,EAAY,YAAcU,EAAI,aAEzBV,GAIL4H,GAAWrH,GAAY,CACzB,MAAMsH,EAAWvH,GAAkBC,CAAO,EACpCuH,EAAcD,EAAS,OAAS,OAAS,CAAC,GAAGA,EAAS,SAAUA,EAAS,eAAgBA,EAAS,IAAI,EAAIA,EAAS,SACzH,MAAO,CACL,GAAGA,EACH,YAAAC,EACA,aAAc,OACd,KAAM,IAAI,IACR,OAAO,QAAQD,EAAS,WAAW,EAAE,IAAI,CAAC,CAACE,EAAOrH,CAAG,IAAM,CACzDA,EAAI,KACJ,CACE,IAAKA,EAAI,KACT,KAAM,CAAC,GAAGmH,EAAS,SAAUA,EAAS,eAAgBE,CAAK,EAE3D,WAAY,MACtB,CACA,CAAO,CACP,CACA,CACA,EAGIC,GAAmB,CAAC7F,EAAQ5B,IAAY,CAC1C,IAAI3C,EACJ,MAAM+C,EAAOiH,GAAQrH,CAAO,EAC5B,IAAI0H,EAAc,OAAO1H,GAAY,UAAYA,EAAQ,YAAc,OAAO,QAAQA,EAAQ,WAAW,EAAE,OACzG,CAACwE,EAAK,CAACmD,EAAOC,CAAO,IAAM,CACzB,IAAIC,EACJ,MAAO,CACL,GAAGrD,EACH,CAACmD,CAAK,GAAIE,EAAMtH,EACdqH,EAAQ,KACR,CACE,GAAGxH,EACH,YAAa,CAAC,GAAGA,EAAK,SAAUA,EAAK,eAAgBuH,CAAK,CACtE,EACU,EACV,IAAc,KAAOE,EAAM5H,EAAW,CACtC,CACI,EACA,CAAA,CACJ,EAAM,OACJ,MAAMuH,EAAQ,OAAOxH,GAAY,SAAWA,EAAsCA,GAAQ,eAAkB,QAAU,OAAoCA,GAAQ,KAC5J8H,GAAQzK,EAAMkD,EAClBqB,EAAO,KACP4F,IAAU,OAASpH,EAAO,CACxB,GAAGA,EACH,YAAa,CAAC,GAAGA,EAAK,SAAUA,EAAK,eAAgBoH,CAAK,CAChE,EACI,EACJ,IAAQ,KAAOnK,EAAM4C,EAAW,EACxB8H,EAAQ,OAAO/H,GAAY,UAAYA,EAAQ,OAAS,QAAUA,EAAQ,eAAiB,QAAUA,EAAQ,KAAO,OACtH+H,IAAU,SACZD,EAAK,MAAQC,GAEf,MAAMC,EAAWR,IAAU,OAASE,EAAc,CAChD,GAAGI,EACH,CAAC1H,EAAK,cAAc,EAAGsH,CAC3B,EAAMI,EAAO,CACT,KAAM,CACJ,GAAG1H,EAAK,eAAiB,WAAa,CAAA,EAAKA,EAAK,SAChDA,EAAK,eACLoH,CACN,EAAM,KAAK,GAAG,EACV,CAACpH,EAAK,cAAc,EAAG,CACrB,GAAGsH,EACH,CAACF,CAAK,EAAGM,CACf,CACA,EACE,OAAAE,EAAS,QAAU,0CACZA,CACT,EAGIC,GAAe,OAAO,IAAI,kBAAkB,EAChD,SAASC,EAAWC,EAAc,CAChC,IAAIvG,EACJ,MAAO,KACDA,GAAU,OACZA,EAASuG,EAAY,GAEhBvG,EAEX,CACA,SAASwG,GAAW3I,EAAa,CAC/B,SAAA4I,CACF,EAAI,GAAI,CACN,MAAO,CACL,CAACJ,EAAY,EAAG,GAChB,MAAO,OAEP,IAAI,YAAa,CACf,OAAI,OAAOxI,GAAgB,aACzBA,EAAcA,EAAW,GAEpBA,CACT,EACA,SAAA4I,CACJ,CACA,CACA,SAASC,GAAS5K,EAAO,CACvB,OAAO,OAAOA,GAAU,UAAYA,IAAU,MAAQuK,MAAgBvK,GAASA,EAAMuK,EAAY,IAAM,IAAQ,eAAgBvK,GAAS,aAAcA,CACxJ,CACA,SAAS6K,GAAS3G,EAAQ,CACxB,OAAOA,GAAU,KAAOwG,GAAW,CAAE,WAAY,CAAA,EAAI,qBAAsB,EAAK,CAAE,EAAIE,GAAS1G,CAAM,EAAIA,EAAS,cAAeA,EAASA,EAAO,WAAW,EAAE,SAAW,MAAQ4G,EAAU5G,CAAM,EAAI6G,GAAe7G,CAAM,EAAIA,EAAM,CACtO,CACA,SAAS6G,GAAeC,EAAiB,CACvC,OAAON,GACL,IAAMM,EAAgB,WAAW,EAAE,WAAW,MAAM,CAClD,OAAQ,UACd,CAAK,EACD,CACE,SAAU,MAAOhL,GAAU,CACzB,MAAMkF,EAAS,MAAM8F,EAAgB,WAAW,EAAE,SAAShL,CAAK,EAChE,MAAO,UAAWkF,EAAS,CAAE,QAAS,GAAM,MAAOA,EAAO,OAAU,CAClE,QAAS,GACT,MAAO,IAAI+F,EAAoB,CAC7B,MAAAjL,EACA,MAAOkF,EAAO,MAC1B,CAAW,CACX,CACM,CACN,CACA,CACA,CACA,SAASgG,GAAWC,EAAY7I,EAAS,CACvC,IAAI3C,EACJ,MAAMyL,GAAiBzL,EAAwB,SAAmC,KAAOA,EAAM,GAC/F,OAAO+K,GAEL,IAAMX,GAAiBoB,EAAY,CACjC,aAAcC,EAAgB,OAAS,MAC7C,CAAK,EACD,CACE,SAAU,MAAOpL,GAAU,CACzB,MAAMkF,EAAS,MAAMiG,EAAW,eAAenL,CAAK,EACpD,OAAOkF,EAAO,QAAU,CAAE,QAAS,GAAM,MAAOA,EAAO,IAAI,EAAK,CAAE,QAAS,GAAO,MAAOA,EAAO,KAAK,CACvG,CACN,CACA,CACA,CACA,SAASmG,GAAWF,EAAY7I,EAAS,CACvC,IAAI3C,EACJ,MAAMyL,GAAiBzL,EAAwB,SAAmC,KAAOA,EAAM,GAC/F,OAAO+K,GAEL,IAAM5I,EACJwJ,GAAgBH,EAAY,CAC1B,OAAQ,UACR,GAAI,QACJ,OAAQC,EAAgB,MAAQ,QACxC,CAAO,CACP,EACI,CACE,SAAU,MAAOpL,GAAU,CACzB,MAAMkF,EAAS,MAAMqG,GAAkBJ,EAAYnL,CAAK,EACxD,OAAOkF,EAAO,QAAU,CAAE,QAAS,GAAM,MAAOA,EAAO,IAAI,EAAK,CAAE,QAAS,GAAO,MAAOA,EAAO,KAAK,CACvG,CACN,CACA,CACA,CACA,SAASsG,GAAaL,EAAY,CAChC,MAAO,SAAUA,CACnB,CACA,SAASL,EAAUK,EAAY7I,EAAS,CACtC,OAAIkJ,GAAaL,CAAU,EAClBE,GAAWF,CAAmB,EAE9BD,GAAWC,CAAmB,CAEzC,CAGA,eAAeM,GAAc,CAC3B,MAAAzL,EACA,OAAAkE,CACF,EAAG,CACD,MAAMgB,EAAS,MAAMwG,EAAkB,CAAE,MAAA1L,EAAO,OAAAkE,CAAM,CAAE,EACxD,GAAI,CAACgB,EAAO,QACV,MAAMyG,EAAqB,KAAK,CAAE,MAAA3L,EAAO,MAAOkF,EAAO,MAAO,EAEhE,OAAOA,EAAO,KAChB,CACA,eAAewG,EAAkB,CAC/B,MAAA1L,EACA,OAAAkE,CACF,EAAG,CACD,MAAM0H,EAAef,GAAS3G,CAAM,EACpC,GAAI,CACF,GAAI0H,EAAa,UAAY,KAC3B,MAAO,CAAE,QAAS,GAAM,MAAA5L,EAAO,SAAUA,CAAK,EAEhD,MAAMkF,EAAS,MAAM0G,EAAa,SAAS5L,CAAK,EAChD,OAAIkF,EAAO,QACF,CAAE,QAAS,GAAM,MAAOA,EAAO,MAAO,SAAUlF,CAAK,EAEvD,CACL,QAAS,GACT,MAAO2L,EAAqB,KAAK,CAAE,MAAA3L,EAAO,MAAOkF,EAAO,MAAO,EAC/D,SAAUlF,CAChB,CACE,OAASd,EAAO,CACd,MAAO,CACL,QAAS,GACT,MAAOyM,EAAqB,KAAK,CAAE,MAAA3L,EAAO,MAAOd,EAAO,EACxD,SAAUc,CAChB,CACE,CACF,CAGA,eAAe6L,GAAU,CACvB,KAAAvK,EACA,OAAA4C,CACF,EAAG,CACD,GAAI,CACF,MAAMlE,EAAQ4B,GAAgBN,CAAI,EAClC,OAAI4C,GAAU,KACLlE,EAEFyL,GAAc,CAAE,MAAAzL,EAAO,OAAAkE,EAAQ,CACxC,OAAShF,EAAO,CACd,MAAI4M,EAAe,WAAW5M,CAAK,GAAK6M,EAAqB,WAAW7M,CAAK,EACrEA,EAEF,IAAI4M,EAAe,CAAE,KAAAxK,EAAM,MAAOpC,CAAK,CAAE,CACjD,CACF,CACA,eAAe8M,GAAc,CAC3B,KAAA1K,EACA,OAAA4C,CACF,EAAG,CACD,GAAI,CACF,MAAMlE,EAAQ4B,GAAgBN,CAAI,EAClC,OAAI4C,GAAU,KACL,CAAE,QAAS,GAAM,MAAAlE,EAAO,SAAUA,CAAK,EAEzC,MAAM0L,EAAkB,CAAE,MAAA1L,EAAO,OAAAkE,CAAM,CAAE,CAClD,OAAShF,EAAO,CACd,MAAO,CACL,QAAS,GACT,MAAO4M,EAAe,WAAW5M,CAAK,EAAIA,EAAQ,IAAI4M,EAAe,CAAE,KAAAxK,EAAM,MAAOpC,CAAK,CAAE,EAC3F,SAAU,MAChB,CACE,CACF,CAcA,SAAS+M,GAAqB,CAC5B,OAAAC,EACA,OAAAhI,CACF,EAAG,CACD,OAAOgI,EAAO,YAAY,IAAI,iBAAmB,EAAE,YAAY,IAAIC,EAAyB,EAAE,YAC5F,IAAI,gBAAgB,CAClB,MAAM,UAAU,CAAE,KAAAC,CAAI,EAAIC,EAAY,CAChCD,IAAS,UAGbC,EAAW,QAAQ,MAAML,GAAc,CAAE,KAAMI,EAAM,OAAAlI,CAAM,CAAE,CAAC,CAChE,CACN,CAAK,CACL,CACA,CA4BA,IAAIoI,GAAoB,IAAM,WAAW,MACrCC,EAAgB,MAAO,CACzB,IAAAlN,EACA,QAAAlB,EACA,KAAAqO,EACA,sBAAA9L,EACA,0BAAAD,EACA,YAAAE,EACA,MAAOC,CACT,IAAM6L,GAAU,CACd,IAAApN,EACA,QAAS,CACP,eAAgB,mBAChB,GAAGlB,CACP,EACE,KAAM,CACJ,QAAS,KAAK,UAAUqO,CAAI,EAC5B,OAAQA,CACZ,EACE,sBAAA9L,EACA,0BAAAD,EACA,YAAAE,EACA,MAAOC,CACT,CAAC,EAqBG6L,GAAY,MAAO,CACrB,IAAApN,EACA,QAAAlB,EAAU,CAAA,EACV,KAAAqO,EACA,0BAAA/L,EACA,sBAAAC,EACA,YAAAC,EACA,MAAOC,EAAS0L,GAAiB,CACnC,IAAM,CACJ,GAAI,CACF,MAAM/N,EAAW,MAAMqC,EAAOvB,EAAK,CACjC,OAAQ,OACR,QAASa,GACP/B,EACA,yBAAyBmC,EAAO,GAChCb,GAA8B,CACtC,EACM,KAAM+M,EAAK,QACX,OAAQ7L,CACd,CAAK,EACKE,EAAkBvC,EAAuBC,CAAQ,EACvD,GAAI,CAACA,EAAS,GAAI,CAChB,IAAIuC,EACJ,GAAI,CACFA,EAAmB,MAAMJ,EAAsB,CAC7C,SAAAnC,EACA,IAAAc,EACA,kBAAmBmN,EAAK,MAClC,CAAS,CACH,OAAStN,EAAO,CACd,MAAID,EAAaC,CAAK,GAAKwN,EAAc,WAAWxN,CAAK,EACjDA,EAEF,IAAIwN,EAAc,CACtB,QAAS,mCACT,MAAOxN,EACP,WAAYX,EAAS,OACrB,IAAAc,EACA,gBAAAwB,EACA,kBAAmB2L,EAAK,MAClC,CAAS,CACH,CACA,MAAM1L,EAAiB,KACzB,CACA,GAAI,CACF,OAAO,MAAML,EAA0B,CACrC,SAAAlC,EACA,IAAAc,EACA,kBAAmBmN,EAAK,MAChC,CAAO,CACH,OAAStN,EAAO,CACd,MAAIA,aAAiB,QACfD,EAAaC,CAAK,GAAKwN,EAAc,WAAWxN,CAAK,GACjDA,EAGJ,IAAIwN,EAAc,CACtB,QAAS,wCACT,MAAOxN,EACP,WAAYX,EAAS,OACrB,IAAAc,EACA,gBAAAwB,EACA,kBAAmB2L,EAAK,MAChC,CAAO,CACH,CACF,OAAStN,EAAO,CACd,MAAME,GAAiB,CAAE,MAAAF,EAAO,IAAAG,EAAK,kBAAmBmN,EAAK,OAAQ,CACvE,CACF,EA4EA,eAAeG,EAAQ3M,EAAO,CAC5B,OAAI,OAAOA,GAAU,aACnBA,EAAQA,EAAK,GAER,QAAQ,QAAQA,CAAK,CAC9B,CAIA,IAAI4M,EAAiC,CAAC,CACpC,YAAAC,EACA,eAAAC,EACA,YAAAC,CACF,IAAM,MAAO,CAAE,SAAAxO,EAAU,IAAAc,EAAK,kBAAAC,CAAiB,IAAO,CACpD,MAAM0N,EAAe,MAAMzO,EAAS,KAAI,EAClCsC,EAAkBvC,EAAuBC,CAAQ,EACvD,GAAIyO,EAAa,KAAI,IAAO,GAC1B,MAAO,CACL,gBAAAnM,EACA,MAAO,IAAIoM,EAAc,CACvB,QAAS1O,EAAS,WAClB,IAAAc,EACA,kBAAAC,EACA,WAAYf,EAAS,OACrB,gBAAAsC,EACA,aAAAmM,EACA,YAA4CD,IAAYxO,CAAQ,CACxE,CAAO,CACP,EAEE,GAAI,CACF,MAAM2O,EAAc,MAAMrB,GAAU,CAClC,KAAMmB,EACN,OAAQH,CACd,CAAK,EACD,MAAO,CACL,gBAAAhM,EACA,MAAO,IAAIoM,EAAc,CACvB,QAASH,EAAeI,CAAW,EACnC,IAAA7N,EACA,kBAAAC,EACA,WAAYf,EAAS,OACrB,gBAAAsC,EACA,aAAAmM,EACA,KAAME,EACN,YAA4CH,IAAYxO,EAAU2O,CAAW,CACrF,CAAO,CACP,CACE,MAAqB,CACnB,MAAO,CACL,gBAAArM,EACA,MAAO,IAAIoM,EAAc,CACvB,QAAS1O,EAAS,WAClB,IAAAc,EACA,kBAAAC,EACA,WAAYf,EAAS,OACrB,gBAAAsC,EACA,aAAAmM,EACA,YAA4CD,IAAYxO,CAAQ,CACxE,CAAO,CACP,CACE,CACF,EACI4O,GAAoCC,GAAgB,MAAO,CAAE,SAAA7O,CAAQ,IAAO,CAC9E,MAAMsC,EAAkBvC,EAAuBC,CAAQ,EACvD,GAAIA,EAAS,MAAQ,KACnB,MAAM,IAAI8O,GAAuB,EAAE,EAErC,MAAO,CACL,gBAAAxM,EACA,MAAOoL,GAAqB,CAC1B,OAAQ1N,EAAS,KACjB,OAAQ6O,CACd,CAAK,CACL,CACA,EACIE,EAA6BC,GAAmB,MAAO,CAAE,SAAAhP,EAAU,IAAAc,EAAK,kBAAAC,KAAwB,CAClG,MAAM0N,EAAe,MAAMzO,EAAS,KAAI,EAClCiP,EAAe,MAAMxB,GAAc,CACvC,KAAMgB,EACN,OAAQO,CACZ,CAAG,EACK1M,EAAkBvC,EAAuBC,CAAQ,EACvD,GAAI,CAACiP,EAAa,QAChB,MAAM,IAAIP,EAAc,CACtB,QAAS,wBACT,MAAOO,EAAa,MACpB,WAAYjP,EAAS,OACrB,gBAAAsC,EACA,aAAAmM,EACA,IAAA3N,EACA,kBAAAC,CACN,CAAK,EAEH,MAAO,CACL,gBAAAuB,EACA,MAAO2M,EAAa,MACpB,SAAUA,EAAa,QAC3B,CACA,EAgDA,SAASC,GAAqBpO,EAAK,CACjC,OAA8BA,GAAI,QAAQ,MAAO,EAAE,CACrD,CCp4EA,IAAIqO,GAAS,0BACTC,GAAS,OAAO,IAAID,EAAM,EAC1BE,GAAIC,GACJC,EAAe,MAAMC,WAAuBF,GAAK,MAAOD,GAAKD,GAAQE,GAAI,CAC3E,YAAY,CACV,QAAA1I,EACA,WAAA6I,EAAa,IACb,MAAAzO,CACJ,EAAK,CACD,MAAM4F,CAAO,EACb,KAAKyI,EAAE,EAAI,GACX,KAAK,WAAaI,EAClB,KAAK,MAAQzO,CACf,CAMA,OAAO,WAAWL,EAAO,CACvB,OAAO6O,GAAc,UAAU7O,CAAK,CACtC,CACA,OAAO,UAAUA,EAAO,CACtB,OAAO,OAAOA,GAAU,UAAYA,IAAU,MAAQyO,MAAUzO,GAASA,EAAMyO,EAAM,IAAM,EAC7F,CACF,EAGIM,GAAO,6BACPC,GAAU,2BAA2BD,EAAI,GACzCE,GAAU,OAAO,IAAID,EAAO,EAC5BvO,GAAKC,GACLwO,GAA6B,MAAMC,WAAqCzO,GAAMkO,EAAcnO,GAAMwO,GAASvO,GAAK,CAClH,YAAY,CACV,QAAAuF,EAAU,wBACV,WAAA6I,EAAa,IACb,MAAAzO,CACJ,EAAM,GAAI,CACN,MAAM,CAAE,QAAA4F,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,EACpC,KAAKI,EAAG,EAAI,GAEZ,KAAK,KAAOsO,GACZ,KAAK,KAAO,sBACd,CACA,OAAO,WAAW/O,EAAO,CACvB,OAAO4O,EAAa,UAAU5O,CAAK,GAAKiP,MAAWjP,CACrD,CAIA,OAAO,sBAAsB,CAC3B,eAAAoP,EACA,kBAAAC,EACA,QAAApJ,EAAU,wBACV,WAAA6I,EAAa,IACb,MAAAzO,CACJ,EAAK,CACD,IAAIiP,EACJ,OAAIF,EACFE,EAAoB;AAAA;AAAA;AAAA;AAAA,2EAKXD,EACTC,EAAoB;AAAA;AAAA;AAAA;AAAA,4FAMpBA,EAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oFASf,IAAIH,GAA4B,CACrC,QAASG,EACT,WAAAR,EACA,MAAAzO,CACN,CAAK,CACH,CACF,EAGIuK,GAAQ,6BACR2E,GAAU,2BAA2B3E,EAAK,GAC1C4E,GAAU,OAAO,IAAID,EAAO,EAC5BtE,GAAKwE,GACLC,GAA6B,cAAeD,GAAMb,EAAc3D,GAAMuE,GAASC,GAAK,CACtF,YAAY,CACV,QAAAxJ,EAAU,kBACV,WAAA6I,EAAa,IACb,MAAAzO,CACJ,EAAM,GAAI,CACN,MAAM,CAAE,QAAA4F,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,EACpC,KAAK4K,EAAG,EAAI,GAEZ,KAAK,KAAOL,GACZ,KAAK,KAAO,uBACd,CACA,OAAO,WAAW5K,EAAO,CACvB,OAAO4O,EAAa,UAAU5O,CAAK,GAAKwP,MAAWxP,CACrD,CACF,EAGI+K,GAAQ,wBACR4E,GAAU,2BAA2B5E,EAAK,GAC1C6E,GAAU,OAAO,IAAID,EAAO,EAC5BE,GAAKC,GACLC,GAAwB,cAAeD,GAAMlB,EAAciB,GAAMD,GAASE,GAAK,CACjF,YAAY,CACV,QAAA7J,EAAU,sBACV,WAAA6I,EAAa,IACb,MAAAzO,CACJ,EAAM,GAAI,CACN,MAAM,CAAE,QAAA4F,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,EACpC,KAAKwP,EAAG,EAAI,GAEZ,KAAK,KAAO9E,GACZ,KAAK,KAAO,qBACd,CACA,OAAO,WAAW/K,EAAO,CACvB,OAAO4O,EAAa,UAAU5O,CAAK,GAAK4P,MAAW5P,CACrD,CACF,EAKIgQ,GAAQ,4BACRC,GAAU,2BAA2BD,EAAK,GAC1CE,GAAU,OAAO,IAAID,EAAO,EAC5BE,GAA2B7E,EAC7B,IAAMM,EACJwE,EAAS,CACP,QAASC,EAAQ,CACvB,CAAK,CACL,CACA,EACIC,GAAKC,GACLC,GAA4B,cAAeD,GAAM3B,EAAc0B,GAAMJ,GAASK,GAAK,CACrF,YAAY,CACV,QAAAtK,EAAU,kBACV,WAAA6I,EAAa,IACb,QAAA2B,EACA,MAAApQ,CACJ,EAAM,GAAI,CACN,MAAM,CAAE,QAAA4F,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,EACpC,KAAKiQ,EAAG,EAAI,GAEZ,KAAK,KAAON,GACZ,KAAK,KAAO,kBACZ,KAAK,QAAUS,CACjB,CACA,OAAO,WAAWzQ,EAAO,CACvB,OAAO4O,EAAa,UAAU5O,CAAK,GAAKkQ,MAAWlQ,CACrD,CACF,EAGI0Q,GAAQ,6BACRC,GAAU,2BAA2BD,EAAK,GAC1CE,GAAU,OAAO,IAAID,EAAO,EAC5BE,GAAKC,GACLC,GAA6B,cAAeD,GAAMlC,EAAciC,GAAMD,GAASE,GAAK,CACtF,YAAY,CACV,QAAA7K,EAAU,wBACV,WAAA6I,EAAa,IACb,MAAAzO,CACJ,EAAM,GAAI,CACN,MAAM,CAAE,QAAA4F,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,EACpC,KAAKwQ,EAAG,EAAI,GAEZ,KAAK,KAAOH,GACZ,KAAK,KAAO,uBACd,CACA,OAAO,WAAW1Q,EAAO,CACvB,OAAO4O,EAAa,UAAU5O,CAAK,GAAK4Q,MAAW5Q,CACrD,CACF,EAGIgR,GAAQ,uBACRC,GAAU,2BAA2BD,EAAK,GAC1CE,GAAU,OAAO,IAAID,EAAO,EAC5BE,GAAKC,GACLC,GAAuB,cAAeD,GAAMxC,EAAcuC,GAAMD,GAASE,GAAK,CAChF,YAAY,CACV,QAAAnL,EAAU,gCACV,WAAA6I,EAAa,IACb,SAAAzP,EACA,gBAAAiS,EACA,MAAAjR,CACJ,EAAM,GAAI,CACN,MAAM,CAAE,QAAA4F,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,EACpC,KAAK8Q,EAAG,EAAI,GAEZ,KAAK,KAAOH,GACZ,KAAK,KAAO,iBACZ,KAAK,SAAW3R,EAChB,KAAK,gBAAkBiS,CACzB,CACA,OAAO,WAAWtR,EAAO,CACvB,OAAO4O,EAAa,UAAU5O,CAAK,GAAKkR,MAAWlR,CACrD,CACF,EAQA,eAAeuR,GAA+B,CAC5C,SAAAlS,EACA,WAAAyP,EACA,eAAA0C,EAAiB,yBACjB,MAAAnR,EACA,WAAAoR,CACF,EAAG,CACD,MAAMC,EAAc,MAAMlF,EAAkB,CAC1C,MAAOnN,EACP,OAAQsS,EACZ,CAAG,EACD,GAAI,CAACD,EAAY,QACf,OAAO,IAAIL,GAAqB,CAC9B,QAAS,kCAAkCG,CAAc,GACzD,WAAA1C,EACA,SAAAzP,EACA,gBAAiBqS,EAAY,MAC7B,MAAArR,CACN,CAAK,EAEH,MAAMuR,EAAoBF,EAAY,MAChCG,EAAYD,EAAkB,MAAM,KACpC3L,EAAU2L,EAAkB,MAAM,QACxC,OAAQC,EAAS,CACf,IAAK,uBACH,OAAO3C,GAA2B,sBAAsB,CACtD,eAAgBuC,IAAe,UAC/B,kBAAmBA,IAAe,OAClC,WAAA3C,EACA,MAAAzO,CACR,CAAO,EACH,IAAK,wBACH,OAAO,IAAIqP,GAA2B,CAAE,QAAAzJ,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,EACtE,IAAK,sBACH,OAAO,IAAI0P,GAAsB,CAAE,QAAA9J,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,EACjE,IAAK,kBAAmB,CACtB,MAAMyR,EAAc,MAAMtF,EAAkB,CAC1C,MAAOoF,EAAkB,MAAM,MAC/B,OAAQzB,EAChB,CAAO,EACD,OAAO,IAAIK,GAA0B,CACnC,QAAAvK,EACA,WAAA6I,EACA,QAASgD,EAAY,QAAUA,EAAY,MAAM,QAAU,OAC3D,MAAAzR,CACR,CAAO,CACH,CACA,IAAK,wBACH,OAAO,IAAI0Q,GAA2B,CAAE,QAAA9K,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,EACtE,QACE,OAAO,IAAI0Q,GAA2B,CAAE,QAAA9K,EAAS,WAAA6I,EAAY,MAAAzO,CAAK,CAAE,CAC1E,CACA,CACA,IAAIsR,GAA6BI,EAC/B,IAAM9F,EACJ+F,EAAU,CACR,MAAOA,EAAU,CACf,QAASC,EAAS,EAClB,KAAMA,EAAS,EAAG,QAAO,EACzB,MAAOC,EAAU,EAAG,QAAO,EAC3B,KAAMC,GAAS,CAACF,EAAS,EAAIG,GAAS,CAAE,CAAC,EAAE,QAAO,CAC1D,CAAO,CACP,CAAK,CACL,CACA,EAGA,SAASC,EAAerS,EAAOyR,EAAY,CACzC,IAAIa,EACJ,OAAI1D,EAAa,WAAW5O,CAAK,EACxBA,EAELM,EAAa,WAAWN,CAAK,EACxBuR,GAA+B,CACpC,SAAUgB,GAAuBvS,CAAK,EACtC,YAAasS,EAAMtS,EAAM,aAAe,KAAOsS,EAAM,IACrD,eAAgB,yBAChB,MAAOtS,EACP,WAAAyR,CACN,CAAK,EAEIF,GAA+B,CACpC,SAAU,CAAA,EACV,WAAY,IACZ,eAAgBvR,aAAiB,MAAQ,2BAA2BA,EAAM,OAAO,GAAK,wBACtF,MAAOA,EACP,WAAAyR,CACJ,CAAG,CACH,CAGA,SAASc,GAAuBvS,EAAO,CACrC,GAAIA,EAAM,OAAS,OACjB,OAAOA,EAAM,KAEf,GAAIA,EAAM,cAAgB,KACxB,GAAI,CACF,OAAO,KAAK,MAAMA,EAAM,YAAY,CACtC,MAAY,CACV,OAAOA,EAAM,YACf,CAEF,MAAO,CAAA,CACT,CASA,IAAIwS,GAA6B,yBACjC,eAAeC,EAAgBxT,EAAS,CACtC,MAAM+G,EAAS,MAAM0M,EAAmB,CACtC,MAAOzT,EAAQuT,EAA0B,EACzC,OAAQG,EACZ,CAAG,EACD,OAAO3M,EAAO,QAAUA,EAAO,MAAQ,MACzC,CACA,IAAI2M,GAA0BC,EAC5B,IAAMC,EAAWC,GAAS,CAACC,EAAW,SAAS,EAAGA,EAAW,MAAM,CAAC,CAAC,CAAC,CACxE,EAYIC,GAAuB,KAAM,CAC/B,YAAYC,EAAQ,CAClB,KAAK,OAASA,CAChB,CACA,MAAM,oBAAqB,CACzB,GAAI,CACF,KAAM,CAAE,MAAAnS,GAAU,MAAMQ,GAAW,CACjC,IAAK,GAAG,KAAK,OAAO,OAAO,UAC3B,QAAS,MAAMmM,EAAQ,KAAK,OAAO,QAAO,CAAE,EAC5C,0BAA2BW,EACzB8E,EACV,EACQ,sBAAuBxF,EAA+B,CACpD,YAAayF,EAAM,EACnB,eAAiBjG,GAASA,CACpC,CAAS,EACD,MAAO,KAAK,OAAO,KAC3B,CAAO,EACD,OAAOpM,CACT,OAASd,EAAO,CACd,MAAM,MAAMqS,EAAerS,CAAK,CAClC,CACF,CACA,MAAM,YAAa,CACjB,GAAI,CACF,MAAMoT,EAAU,IAAI,IAAI,KAAK,OAAO,OAAO,EACrC,CAAE,MAAAtS,GAAU,MAAMQ,GAAW,CACjC,IAAK,GAAG8R,EAAQ,MAAM,cACtB,QAAS,MAAM3F,EAAQ,KAAK,OAAO,QAAO,CAAE,EAC5C,0BAA2BW,EACzBiF,EACV,EACQ,sBAAuB3F,EAA+B,CACpD,YAAayF,EAAM,EACnB,eAAiBjG,GAASA,CACpC,CAAS,EACD,MAAO,KAAK,OAAO,KAC3B,CAAO,EACD,OAAOpM,CACT,OAASd,EAAO,CACd,MAAM,MAAMqS,EAAerS,CAAK,CAClC,CACF,CACF,EACIkT,GAAuCI,EACzC,IAAMC,EACJC,EAAU,CACR,OAAQC,EACND,EAAU,CACR,GAAIE,EAAS,EACb,KAAMA,EAAS,EACf,YAAaA,EAAS,EAAG,QAAO,EAChC,QAASF,EAAU,CACjB,MAAOE,EAAS,EAChB,OAAQA,EAAS,EACjB,iBAAkBA,EAAS,EAAG,QAAO,EACrC,kBAAmBA,EAAS,EAAG,QAAO,CAClD,CAAW,EAAE,UACD,CAAC,CAAE,MAAAC,EAAO,OAAAC,EAAQ,iBAAAC,EAAkB,kBAAAC,CAAiB,KAAQ,CAC3D,MAAAH,EACA,OAAAC,EACA,GAAGC,EAAmB,CAAE,kBAAmBA,CAAgB,EAAK,CAAA,EAChE,GAAGC,EAAoB,CAAE,yBAA0BA,GAAsB,CAAA,CACvF,EACA,EAAY,QAAO,EACT,cAAeN,EAAU,CACvB,qBAAsBO,EAAW,IAAI,EACrC,SAAUL,EAAS,EACnB,QAASA,EAAS,CAC9B,CAAW,EACD,UAAWM,GAAQ,CAAC,WAAY,YAAa,OAAO,CAAC,EAAE,QAAO,CACxE,CAAS,CACT,CACA,CAAK,CACL,CACA,EACIX,GAA+BC,EACjC,IAAMC,EACJC,EAAU,CACR,QAASE,EAAS,EAClB,WAAYA,EAAS,CAC3B,CAAK,EAAE,UAAU,CAAC,CAAE,QAAAO,EAAS,WAAAC,CAAU,KAAQ,CACzC,QAAAD,EACA,UAAWC,CACjB,EAAM,CACN,CACA,EAYIC,GAAuB,KAAM,CAC/B,YAAY1D,EAASwC,EAAQ,CAC3B,KAAK,QAAUxC,EACf,KAAK,OAASwC,EACd,KAAK,qBAAuB,KAC5B,KAAK,cAAgB,CAAE,MAAO,CAAC,IAAI,CAAC,CACtC,CACA,IAAI,UAAW,CACb,OAAO,KAAK,OAAO,QACrB,CACA,MAAM,QAAQ7P,EAAS,CACrB,KAAM,CAAE,YAAagR,EAAc,GAAGC,CAAoB,EAAKjR,EAC/D,MAAO,CACL,KAAM,KAAK,qBAAqBiR,CAAoB,EACpD,SAAU,CAAA,CAChB,CACE,CACA,MAAM,WAAWjR,EAAS,CACxB,KAAM,CAAE,KAAAkR,EAAM,SAAAC,CAAQ,EAAK,MAAM,KAAK,QAAQnR,CAAO,EAC/C,CAAE,YAAA3B,CAAW,EAAK2B,EAClBoR,EAAkB,MAAMC,EAAS,KAAK,OAAO,QAAO,CAAE,EAC5D,GAAI,CACF,KAAM,CACJ,gBAAA9S,EACA,MAAOmM,EACP,SAAU4G,CAClB,EAAU,MAAMrH,EAAc,CACtB,IAAK,KAAK,OAAM,EAChB,QAASrO,EACPwV,EACApR,EAAQ,QACR,KAAK,sBAAsB,KAAK,QAAS,EAAK,EAC9C,MAAMqR,EAAS,KAAK,OAAO,WAAW,CAChD,EACQ,KAAMH,EACN,0BAA2BK,EAA2BC,GAAQ,EAC9D,sBAAuBC,EAAgC,CACrD,YAAaD,EAAM,EACnB,eAAiB1H,GAASA,CACpC,CAAS,EACD,GAAGzL,GAAe,CAAE,YAAAA,CAAW,EAC/B,MAAO,KAAK,OAAO,KAC3B,CAAO,EACD,MAAO,CACL,GAAGqM,EACH,QAAS,CAAE,KAAMwG,CAAI,EACrB,SAAU,CAAE,QAAS3S,EAAiB,KAAM+S,CAAW,EACvD,SAAAH,CACR,CACI,OAASvU,EAAO,CACd,MAAM,MAAMqS,EAAerS,EAAO,MAAMyS,EAAgB+B,CAAe,CAAC,CAC1E,CACF,CACA,MAAM,SAASpR,EAAS,CACtB,KAAM,CAAE,KAAAkR,EAAM,SAAAC,CAAQ,EAAK,MAAM,KAAK,QAAQnR,CAAO,EAC/C,CAAE,YAAA3B,CAAW,EAAK2B,EAClBoR,EAAkB,MAAMC,EAAS,KAAK,OAAO,QAAO,CAAE,EAC5D,GAAI,CACF,KAAM,CAAE,MAAOpV,EAAU,gBAAAsC,CAAe,EAAK,MAAM0L,EAAc,CAC/D,IAAK,KAAK,OAAM,EAChB,QAASrO,EACPwV,EACApR,EAAQ,QACR,KAAK,sBAAsB,KAAK,QAAS,EAAI,EAC7C,MAAMqR,EAAS,KAAK,OAAO,WAAW,CAChD,EACQ,KAAMH,EACN,0BAA2BrG,GAAiC2G,GAAQ,EACpE,sBAAuBC,EAAgC,CACrD,YAAaD,EAAM,EACnB,eAAiB1H,GAASA,CACpC,CAAS,EACD,GAAGzL,GAAe,CAAE,YAAAA,CAAW,EAC/B,MAAO,KAAK,OAAO,KAC3B,CAAO,EACD,MAAO,CACL,OAAQpC,EAAS,YACf,IAAI,gBAAgB,CAClB,MAAM8N,EAAY,CACZoH,EAAS,OAAS,GACpBpH,EAAW,QAAQ,CAAE,KAAM,eAAgB,SAAAoH,CAAQ,CAAE,CAEzD,EACA,UAAUO,EAAO3H,EAAY,CAC3B,GAAI2H,EAAM,QAAS,CACjB,MAAMC,EAAaD,EAAM,MACzB,GAAIC,EAAW,OAAS,OAAS,CAAC3R,EAAQ,iBACxC,OAEE2R,EAAW,OAAS,qBAAuBA,EAAW,WAAa,OAAOA,EAAW,WAAc,WACrGA,EAAW,UAAY,IAAI,KAAKA,EAAW,SAAS,GAEtD5H,EAAW,QAAQ4H,CAAU,CAC/B,MACE5H,EAAW,MACT2H,EAAM,KACxB,CAEY,CACZ,CAAW,CACX,EACQ,QAAS,CAAE,KAAMR,CAAI,EACrB,SAAU,CAAE,QAAS3S,CAAe,CAC5C,CACI,OAAS3B,EAAO,CACd,MAAM,MAAMqS,EAAerS,EAAO,MAAMyS,EAAgB+B,CAAe,CAAC,CAC1E,CACF,CACA,WAAWQ,EAAM,CACf,OAAOA,GAAQ,OAAOA,GAAS,UAAY,SAAUA,GAAQA,EAAK,OAAS,MAC7E,CAOA,qBAAqB5R,EAAS,CAC5B,UAAW6C,KAAW7C,EAAQ,OAC5B,UAAW4R,KAAQ/O,EAAQ,QACzB,GAAI,KAAK,WAAW+O,CAAI,EAAG,CACzB,MAAMC,EAAWD,EACjB,GAAIC,EAAS,gBAAgB,WAAY,CACvC,MAAMC,EAAS,WAAW,KAAKD,EAAS,IAAI,EACtCE,EAAa,OAAO,KAAKD,CAAM,EAAE,SAAS,QAAQ,EACxDD,EAAS,KAAO,IAAI,IAClB,QAAQA,EAAS,WAAa,0BAA0B,WAAWE,CAAU,EAC3F,CACU,CACF,CAGJ,OAAO/R,CACT,CACA,QAAS,CACP,MAAO,GAAG,KAAK,OAAO,OAAO,iBAC/B,CACA,sBAAsBqN,EAAS2E,EAAW,CACxC,MAAO,CACL,0CAA2C,IAC3C,uBAAwB3E,EACxB,8BAA+B,OAAO2E,CAAS,CACrD,CACE,CACF,EAaIC,GAAwB,KAAM,CAChC,YAAY5E,EAASwC,EAAQ,CAC3B,KAAK,QAAUxC,EACf,KAAK,OAASwC,EACd,KAAK,qBAAuB,KAC5B,KAAK,qBAAuB,KAC5B,KAAK,sBAAwB,EAC/B,CACA,IAAI,UAAW,CACb,OAAO,KAAK,OAAO,QACrB,CACA,MAAM,QAAQ,CACZ,OAAAhM,EACA,QAAAhI,EACA,YAAAwC,EACA,gBAAA6T,CACJ,EAAK,CACD,IAAIhD,EACJ,MAAMkC,EAAkB,MAAMe,EAAS,KAAK,OAAO,QAAO,CAAE,EAC5D,GAAI,CACF,KAAM,CACJ,gBAAA5T,EACA,MAAOmM,EACP,SAAA0H,CACR,EAAU,MAAMC,EAAe,CACvB,IAAK,KAAK,OAAM,EAChB,QAASC,EACPlB,EACAvV,GAA4B,CAAA,EAC5B,KAAK,sBAAqB,EAC1B,MAAMsW,EAAS,KAAK,OAAO,WAAW,CAChD,EACQ,KAAM,CACJ,OAAAtO,EACA,GAAGqO,EAAkB,CAAE,gBAAAA,GAAoB,CAAA,CACrD,EACQ,0BAA2BK,EACzBC,EACV,EACQ,sBAAuBC,EAAgC,CACrD,YAAaC,EAAM,EACnB,eAAiB5I,GAASA,CACpC,CAAS,EACD,GAAGzL,GAAe,CAAE,YAAAA,CAAW,EAC/B,MAAO,KAAK,OAAO,KAC3B,CAAO,EACD,MAAO,CACL,WAAYqM,EAAa,WACzB,OAAQwE,EAAMxE,EAAa,QAAU,KAAOwE,EAAM,OAClD,iBAAkBxE,EAAa,iBAC/B,SAAU,CAAE,QAASnM,EAAiB,KAAM6T,CAAQ,EACpD,SAAU,CAAA,CAClB,CACI,OAASxV,EAAO,CACd,MAAM,MAAMqS,EAAerS,EAAO,MAAMyS,EAAgB+B,CAAe,CAAC,CAC1E,CACF,CACA,QAAS,CACP,MAAO,GAAG,KAAK,OAAO,OAAO,kBAC/B,CACA,uBAAwB,CACtB,MAAO,CACL,2CAA4C,IAC5C,cAAe,KAAK,OAC1B,CACE,CACF,EACIoB,GAAiCG,EACnC,IAAMC,EACJC,EAAU,CACR,WAAYC,EAASA,EAASC,GAAS,CAAE,CAAC,EAC1C,MAAOF,EAAU,CAAE,OAAQE,GAAS,CAAE,CAAE,EAAE,QAAO,EACjD,iBAAkBC,GAAUC,IAAaD,GAAUC,IAAaC,GAAY,CAAC,EAAE,SAAQ,CAC7F,CAAK,CACL,CACA,EAWIC,GAAoB,KAAM,CAC5B,YAAY9F,EAASwC,EAAQ,CAC3B,KAAK,QAAUxC,EACf,KAAK,OAASwC,EACd,KAAK,qBAAuB,KAE5B,KAAK,iBAAmB,OAAO,gBACjC,CACA,IAAI,UAAW,CACb,OAAO,KAAK,OAAO,QACrB,CACA,MAAM,WAAW,CACf,OAAAuD,EACA,EAAAC,EACA,KAAAjX,EACA,YAAAkX,EACA,KAAAC,EACA,gBAAArB,EACA,QAAArW,EACA,YAAAwC,CACJ,EAAK,CACD,IAAI6Q,EACJ,MAAMkC,EAAkB,MAAMoC,EAAS,KAAK,OAAO,QAAO,CAAE,EAC5D,GAAI,CACF,KAAM,CACJ,gBAAAjV,EACA,MAAOmM,EACP,SAAA0H,CACR,EAAU,MAAMqB,EAAe,CACvB,IAAK,KAAK,OAAM,EAChB,QAASC,EACPtC,EACAvV,GAA4B,CAAA,EAC5B,KAAK,sBAAqB,EAC1B,MAAM2X,EAAS,KAAK,OAAO,WAAW,CAChD,EACQ,KAAM,CACJ,OAAAJ,EACA,EAAAC,EACA,GAAGjX,GAAQ,CAAE,KAAAA,CAAI,EACjB,GAAGkX,GAAe,CAAE,YAAAA,CAAW,EAC/B,GAAGC,GAAQ,CAAE,KAAAA,CAAI,EACjB,GAAGrB,GAAmB,CAAE,gBAAAA,CAAe,CACjD,EACQ,0BAA2ByB,EACzBC,EACV,EACQ,sBAAuBC,EAAgC,CACrD,YAAaC,EAAM,EACnB,eAAiBhK,GAASA,CACpC,CAAS,EACD,GAAGzL,GAAe,CAAE,YAAAA,CAAW,EAC/B,MAAO,KAAK,OAAO,KAC3B,CAAO,EACD,MAAO,CACL,OAAQqM,EAAa,OAErB,UAAWwE,EAAMxE,EAAa,WAAa,KAAOwE,EAAM,CAAA,EACxD,iBAAkBxE,EAAa,iBAC/B,SAAU,CACR,UAA2B,IAAI,KAC/B,QAAS,KAAK,QACd,QAASnM,CACnB,CACA,CACI,OAAS3B,EAAO,CACd,MAAMqS,EAAerS,EAAO,MAAMyS,EAAgB+B,CAAe,CAAC,CACpE,CACF,CACA,QAAS,CACP,MAAO,GAAG,KAAK,OAAO,OAAO,cAC/B,CACA,uBAAwB,CACtB,MAAO,CACL,uCAAwC,IACxC,cAAe,KAAK,OAC1B,CACE,CACF,EACI2C,GAA8BC,EAAU,CAC1C,OAAQC,EAASC,EAAU,CAAE,EAAE,SAAQ,CACzC,CAAC,EAAE,SAASA,GAAY,EACpBN,GAA6BI,EAAU,CACzC,OAAQC,EAASE,GAAW,EAE5B,SAAUF,EACRD,EAAU,CACR,KAAMI,EAAW,OAAO,EACxB,QAASD,EAAS,CACxB,CAAK,CACL,EAAI,SAAQ,EACV,iBAAkBE,GAAUF,IAAaJ,EAA2B,EAAE,SAAQ,CAChF,CAAC,EAKD,eAAeO,IAAqB,CAClC,IAAIpF,EACJ,OAAQA,EAAMqF,GAAAA,aAAa,UAAY,KAAO,OAASrF,EAAI,aAAa,CAC1E,CAMA,IAAIlR,GAAiB,QAGjBwW,GAA8B,QAClC,SAASC,GAAsBzU,EAAU,GAAI,CAC3C,IAAIkP,EAAKwF,EACT,IAAIC,EAAkB,KAClBC,EAAgB,KACpB,MAAMC,GAAsB3F,EAAMlP,EAAQ,6BAA+B,KAAOkP,EAAM,IAAM,GAAK,EACjG,IAAI4F,EAAgB,EACpB,MAAMC,GAAWL,EAAMvJ,GAAqBnL,EAAQ,OAAO,IAAM,KAAO0U,EAAM,qCACxEM,EAAa,SAAY,CAC7B,MAAMC,EAAO,MAAMC,GAAoBlV,CAAO,EAC9C,GAAIiV,EACF,OAAOrX,GACL,CACE,cAAe,UAAUqX,EAAK,KAAK,GACnC,8BAA+BT,GAC/B,CAACpF,EAA0B,EAAG6F,EAAK,WACnC,GAAGjV,EAAQ,OACrB,EACQ,kBAAkBhC,EAAO,EACjC,EAEI,MAAM8N,GAA2B,sBAAsB,CACrD,eAAgB,GAChB,kBAAmB,GACnB,WAAY,GAClB,CAAK,CACH,EACMqJ,EAAoB,IAAM,CAC9B,MAAMC,EAAe1W,EAAoB,CACvC,aAAc,OACd,wBAAyB,sBAC/B,CAAK,EACK2W,EAAc3W,EAAoB,CACtC,aAAc,OACd,wBAAyB,YAC/B,CAAK,EACK4W,EAAS5W,EAAoB,CACjC,aAAc,OACd,wBAAyB,eAC/B,CAAK,EACD,MAAO,UAAY,CACjB,MAAM6W,EAAY,MAAMjB,GAAkB,EAC1C,MAAO,CACL,GAAGc,GAAgB,CAAE,wBAAyBA,CAAY,EAC1D,GAAGC,GAAe,CAAE,sBAAuBA,CAAW,EACtD,GAAGC,GAAU,CAAE,iBAAkBA,CAAM,EACvC,GAAGC,GAAa,CAAE,qBAAsBA,CAAS,CACzD,CACI,CACF,EACMC,EAAuBnI,GACpB,IAAI0D,GAAqB1D,EAAS,CACvC,SAAU,UACV,QAAA0H,EACA,QAASC,EACT,MAAOhV,EAAQ,MACf,YAAamV,EAAiB,CACpC,CAAK,EAEGM,EAAqB,SAAY,CACrC,IAAIC,EAAKC,EAAKpY,EACd,MAAMqY,GAAOrY,GAAMoY,GAAOD,EAAM1V,EAAQ,YAAc,KAAO,OAAS0V,EAAI,cAAgB,KAAO,OAASC,EAAI,KAAKD,CAAG,EAAE,QAAO,IAAO,KAAOnY,EAAK,KAAK,IAAG,EAC1J,OAAI,CAACoX,GAAmBiB,EAAMd,EAAgBD,KAC5CC,EAAgBc,EAChBjB,EAAkB,IAAI/E,GAAqB,CACzC,QAAAmF,EACA,QAASC,EACT,MAAOhV,EAAQ,KACvB,CAAO,EAAE,mBAAkB,EAAG,KAAM6V,IAC5BjB,EAAgBiB,EACTA,EACR,EAAE,MAAM,MAAOjZ,GAAU,CACxB,MAAM,MAAMqS,EACVrS,EACA,MAAMyS,EAAgB,MAAM2F,EAAU,CAAE,CAClD,CACM,CAAC,GAEIJ,EAAgB,QAAQ,QAAQA,CAAa,EAAID,CAC1D,EACMmB,EAAa,SACV,IAAIlG,GAAqB,CAC9B,QAAAmF,EACA,QAASC,EACT,MAAOhV,EAAQ,KACrB,CAAK,EAAE,WAAU,EAAG,MAAM,MAAOpD,GAAU,CACrC,MAAM,MAAMqS,EACVrS,EACA,MAAMyS,EAAgB,MAAM2F,EAAU,CAAE,CAChD,CACI,CAAC,EAEGe,EAAW,SAAS1I,EAAS,CACjC,GAAI,WACF,MAAM,IAAI,MACR,4EACR,EAEI,OAAOmI,EAAoBnI,CAAO,CACpC,EACA0I,EAAS,qBAAuB,KAChCA,EAAS,mBAAqBN,EAC9BM,EAAS,WAAaD,EACtBC,EAAS,WAAc1I,GACd,IAAI8F,GAAkB9F,EAAS,CACpC,SAAU,UACV,QAAA0H,EACA,QAASC,EACT,MAAOhV,EAAQ,MACf,YAAamV,EAAiB,CACpC,CAAK,EAEHY,EAAS,cAAgBP,EACzB,MAAMQ,EAAwB3I,GACrB,IAAI4E,GAAsB5E,EAAS,CACxC,SAAU,UACV,QAAA0H,EACA,QAASC,EACT,MAAOhV,EAAQ,MACf,YAAamV,EAAiB,CACpC,CAAK,EAEH,OAAAY,EAAS,eAAiBC,EAC1BD,EAAS,mBAAqBC,EACvBD,CACT,CACA,IAAIE,GAAUxB,GAAqB,EACnC,eAAeS,GAAoBlV,EAAS,CAC1C,MAAMkW,EAASxX,EAAoB,CACjC,aAAcsB,EAAQ,OACtB,wBAAyB,oBAC7B,CAAG,EACD,GAAIkW,EACF,MAAO,CACL,MAAOA,EACP,WAAY,SAClB,EAEE,GAAI,CAEF,MAAO,CACL,MAFgB,MAAMC,sBAAkB,EAGxC,WAAY,MAClB,CACE,MAAY,CACV,OAAO,IACT,CACF,CC/6BO,MAAMC,GAAmB,MAAO/I,GAAqB,CAC1D,MAAMgJ,EAAQ,MAAMC,GAAsBjJ,CAAO,EAC3CkJ,EAAmBN,GAAQI,EAAM,EAAE,EAEnCG,EACJ,CAAA,EAaF,OALIH,EAAM,WAAaA,EAAM,WAAa,QACxC,QAAQ,IAAI,oCAAqCA,EAAM,EAAE,EACzDG,EAAY,KAAKC,GAA2B,CAAE,QAAS,OAAA,CAAS,CAAC,GAG/DD,EAAY,SAAW,EAClBD,EAGFG,GAAkB,CACvB,MAAOH,EAEP,WAAYC,CAAA,CACb,CACH,ECzCA,SAASG,GAEPC,EAAqBC,EAAwB,CAE7C,MAAMC,MAAY,IAClB,UAAWjU,KAAW+T,EACpBE,EAAM,IAAIjU,EAAQ,GAAIkU,GAAA,CAAc,EAItC,MAAMC,EAAsB,CAAA,EAC5B,UAAWnU,KAAW+T,EAAgB,CACpC,MAAMK,EAAQH,EAAM,IAAIjU,EAAQ,EAAE,EAClC,GAAI,CAACoU,EACH,MAAM,IAAI,MAAM,cAAcpU,EAAQ,EAAE,uBAAuB,EAGjE,IAAIqU,EAA6B,KACjC,GAAIrU,EAAQ,gBAAiB,CAC3B,MAAMsU,EAAiBL,EAAM,IAAIjU,EAAQ,eAAe,EACxD,GAAI,CAACsU,EACH,MAAM,IAAI,MACR,qBAAqBtU,EAAQ,eAAe,uBAAA,EAGhDqU,EAAcC,CAChB,CAEA,MAAMC,EAAmB,CACvB,GAAGvU,EACH,GAAIoU,EACJ,OAAQJ,EACR,gBAAiBK,CAAA,EAEnBF,EAAe,KAAKI,CAAa,CACnC,CAEA,OAAOJ,CACT,CACA,SAASK,GACPC,EACqB,CACrB,MAAMC,MAAoB,IAC1B,UAAWC,KAAYF,EACrBC,EAAc,IAAIC,EAAS,GAAIT,GAAA,CAAc,EAE/C,OAAOQ,CACT,CAEA,SAASE,GACPC,EACAH,EACQ,CACR,MAAMI,EAAWJ,EAAc,IAAIG,CAAQ,EAC3C,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,eAAeD,CAAQ,uBAAuB,EAEhE,OAAOC,CACT,CAEA,SAASC,GACPhG,EACA2F,EAC8B,CAO9B,GANI3F,EAAK,OAAS,qBAGdA,EAAK,QAAU,oBAGfA,EAAK,QAAQ,SAAW,UAAYA,EAAK,OAAO,SAAW,UAC7D,OAAOA,EAET,MAAM8F,EAAW9F,EAAK,OAAO,WACvB+F,EAAWF,GAAuBC,EAAUH,CAAa,EAC/D,MAAO,CACL,GAAG3F,EACH,OAAQ,CACN,GAAGA,EAAK,OACR,WAAY+F,CAAA,CACd,CAEJ,CAEA,SAASE,GACPjG,EAMA,CACA,OACEA,EAAK,OAAS,yBACdA,EAAK,OAAS,yBACdA,EAAK,OAAS,wBAElB,CAEA,SAASkG,GACPlG,EAMA,CACA,OACEA,EAAK,OAAS,2BACdA,EAAK,OAAS,2BACdA,EAAK,OAAS,0BAElB,CAEA,SAASmG,GACPnG,EACA2F,EAC8B,CAO9B,GANI,CAACM,GAAmBjG,CAAI,GAGxBA,EAAK,QAAU,oBAGfA,EAAK,OAAO,SAAW,UACzB,OAAOA,EAET,MAAM8F,EAAW9F,EAAK,OAAO,WACvB+F,EAAWF,GAAuBC,EAAUH,CAAa,EAC/D,MAAO,CACL,GAAG3F,EACH,OAAQ,CACN,GAAGA,EAAK,OACR,WAAY+F,CAAA,CACd,CAEJ,CAEA,SAASK,GACPpG,EACA2F,EAC8B,CAO9B,GANI,CAACO,GAAqBlG,CAAI,GAG1BA,EAAK,QAAU,oBAGfA,EAAK,OAAO,SAAW,UACzB,OAAOA,EAET,MAAM8F,EAAW9F,EAAK,OAAO,WACvB+F,EAAWF,GAAuBC,EAAUH,CAAa,EAC/D,MAAO,CACL,GAAG3F,EACH,OAAQ,CACN,GAAGA,EAAK,OACR,WAAY+F,CAAA,CACd,CAEJ,CAEA,SAASM,GACPrG,EACA2F,EAC8B,CAC9B,OAAI3F,EAAK,OAAS,oBACTgG,GAA0BhG,EAAM2F,CAAa,EAElDM,GAAmBjG,CAAI,EAClBmG,GAA0BnG,EAAM2F,CAAa,EAElDO,GAAqBlG,CAAI,EACpBoG,GAA4BpG,EAAM2F,CAAa,EAEjD3F,CACT,CAEA,SAASsG,GAEPC,EAAeZ,EAAyC,CACxD,OAAOY,EAAS,IAAKtV,GAAY,CAC/B,MAAMuV,EAAQvV,EAAQ,MACtB,IAAIwV,EAAqC,CAAA,EAEzC,OAAI,MAAM,QAAQD,CAAK,IACrBC,EAAeD,EAAM,IAAKxG,GACxBqG,GAA4BrG,EAAM2F,CAAa,CAAA,GAI5C,CACL,GAAG1U,EACH,MAAOwV,CAAA,CAEX,CAAC,CACH,CACA,SAASC,GAGPC,EACAhB,EACAiB,EACAC,EACK,CACL,MAAMC,EAAuB,CAAA,EAE7B,UAAWlB,KAAYe,EAAiB,CACtC,MAAMI,EAAgBpB,EAAc,IAAIC,EAAS,EAAE,EAC7CoB,EAAeJ,EAAa,IAAIhB,EAAS,SAAS,EAExD,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,eAAenB,EAAS,EAAE,uBAAuB,EAEnE,GAAI,CAACoB,EACH,MAAM,IAAI,MAAM,cAAcpB,EAAS,SAAS,uBAAuB,EAGzE,MAAMqB,EAAoB,CACxB,GAAGrB,EACH,GAAImB,EACJ,UAAWC,EACX,OAAQH,CAAA,EAEVC,EAAgB,KAAKG,CAAc,CACrC,CAEA,OAAOH,CACT,CAEA,eAAeI,GAAgBlH,EAAuC,CACpE,GAAI,CAEF,GAAI,CAACA,EAAK,IACR,eAAQ,KAAK,uCAAuC,EAC7CA,EAIT,GAAI,CAACmH,GAAuBnH,EAAK,GAAG,EAClC,eAAQ,KACN,mEACAA,EAAK,GAAA,EAEAA,EAIT,MAAM3V,EAAW,MAAM,MAAM+c,GAAqBpH,EAAK,GAAG,CAAC,EAC3D,GAAI,CAAC3V,EAAS,GACZ,MAAM,IAAI,MAAM,+BAA+BA,EAAS,UAAU,EAAE,EAGtE,MAAMgd,EAAO,MAAMhd,EAAS,KAAA,EAG5B,IAAIid,EAAWtH,EAAK,UAAY,aAG5BsH,EAAS,SAAS,GAAG,IACvBA,EAAWA,EAAS,MAAM,GAAG,EAAE,OAAS,cAItCA,EAAS,WAAWC,EAAgB,IACtCD,EAAWA,EAAS,QAAQC,GAAkB,EAAE,GAGlD,MAAMC,EAAU,MAAMC,GACpBH,EACA,OAAO,KAAK,MAAMD,EAAK,aAAa,EACpC,CACE,YAAaA,EAAK,MAAQ,MAAA,CAC5B,EAGF,MAAO,CACL,GAAGrH,EACH,IAAKwH,EAAQ,GAAA,CAEjB,OAASxc,EAAO,CACd,eAAQ,MAAM,8BAA+BA,CAAK,EAE3CgV,CACT,CACF,CAEA,SAASmH,GAAuBhc,EAAsB,CAKpD,GAJIA,EAAI,WAAW,aAAa,GAI5BA,EAAI,SAAS,yBAAyB,EACxC,MAAO,GAGT,GAAI,CAEF,OADe,IAAI,IAAIA,CAAG,EACZ,SAAS,WAAW,aAAa,CACjD,MAAQ,CACN,MAAO,EACT,CACF,CAEA,SAASic,GAAqBjc,EAAqB,CACjD,OAAIA,EAAI,WAAW,SAAS,GAAKA,EAAI,WAAW,UAAU,EACjDA,EAGLA,EAAI,WAAW,GAAG,EACb,IAAI,IAAIA,EAAKuc,GAAA,CAAiB,EAAE,SAAA,EAGlCvc,CACT,CAEA,SAASuc,IAA0B,CACjC,MAAMC,EAAM,QAAQ,IAAI,SAAS,KAAA,EACjC,OAAIA,GAIG,uBACT,CAEA,eAAsBC,GAEpBrB,EAA6B,CAC7B,MAAMnB,EAAsB,CAAA,EAE5B,UAAWnU,KAAWsV,EACpB,GAAItV,EAAQ,OAAS,MAAM,QAAQA,EAAQ,KAAK,EAAG,CACjD,MAAM4W,EAAoC,CAAA,EAE1C,UAAW7H,KAAQ/O,EAAQ,MACzB,GAAI+O,EAAK,OAAS,OAAQ,CACxB,MAAM8H,EAAa,MAAMZ,GAAgBlH,CAAI,EAC7C6H,EAAY,KAAKC,CAAU,CAC7B,MACED,EAAY,KAAK7H,CAAI,EAIzB,MAAMwF,EAAmB,CACvB,GAAGvU,EACH,MAAO4W,CAAA,EAETzC,EAAe,KAAKI,CAAa,CACnC,MACEJ,EAAe,KAAKnU,CAAO,EAI/B,OAAOmU,CACT,CAEO,SAAS2C,GAoBd/C,EACA2B,EACA1B,EACA4B,EAMA,CAEA,MAAMmB,EAAqBjD,GAAcC,EAAgBC,CAAS,EAG5D2B,MAAmB,IACzB,QAASvX,EAAI,EAAGA,EAAI2V,EAAe,OAAQ3V,IACzCuX,EAAa,IAAI5B,EAAe3V,CAAC,EAAE,GAAI2Y,EAAmB3Y,CAAC,EAAE,EAAE,EAKjE,MAAM+V,EAA6B4C,EAAmB,IACpD,CAACxC,EAAehQ,IAAU,CAGxB,MAAMyS,EAFgBjD,EAAexP,CAAK,EAG1B,UAAU,iBAAmB,KAE7C,GAAIyS,IAAwB,KAE1B,OAAKzC,EAAc,SAIZ,CACL,GAAGA,EACH,SAAU,CACR,GAAGA,EAAc,SACjB,gBAAiB,IAAA,CACnB,EAROA,EAYX,MAAM0C,EAAsBtB,EAAa,IAAIqB,CAAmB,EAChE,GAAI,CAACC,EACH,MAAM,IAAI,MACR,qBAAqBD,CAAmB,qCAAA,EAI5C,MAAME,EAAmB3C,EAAc,UAAY,CACjD,gBAAiB,IAAA,EAGnB,MAAO,CACL,GAAGA,EACH,SAAU,CACR,GAAG2C,EACH,gBAAiBD,CAAA,CACnB,CAEJ,CAAA,EAIIvC,EAAgBF,GAAoBkB,CAAe,EAGnDyB,EAA6B9B,GACjClB,EACAO,CAAA,EAIImB,EAAkBJ,GACtBC,EACAhB,EACAiB,EACAC,CAAA,EAGF,MAAO,CACL,eAAgBuB,EAChB,gBAAAtB,EACA,aAAAF,EACA,cAAAjB,CAAA,CAEJ,CCldO,MAAM0C,GAAmB,IAGnBC,GAAoBD,GAAmB,ECHvCE,GAA6BnN,EAChC,CACN,UAAWoN,GAAE,EAAO,SAAA,EAAW,SAAA,CACjC,CAAC,EACA,SAAA,EAEUC,EAAoBrN,EAAS,CACxC,OAAQC,EAAE,EAAS,KAAA,CACrB,CAAC,EAEYqN,GAAwBtN,EAAS,CAC5C,OAAQC,EAAE,EAAS,KAAA,EACnB,MAAOA,EAAE,EAAS,IAAI,CAAC,EAAE,IAAI,GAAG,CAClC,CAAC,EAEYsN,GAA2BvN,EAAS,CAC/C,UAAWC,EAAE,EAAS,KAAA,CACxB,CAAC,EAEYuN,GAA+BxN,EAAS,CACnD,OAAQC,EAAE,EAAS,KAAA,EACnB,WAAYwN,GAAO,CAAC,UAAW,QAAQ,CAAC,CAC1C,CAAC,EAEYC,GAA6B1N,EAAS,CACjD,OAAQC,EAAE,EAAS,KAAA,EACnB,SAAU0N,GAAE,CACd,CAAC,EAEYC,GAA+B5N,EAAS,CACnD,QAASC,EAAE,EAAS,IAAI,CAAC,EAAE,IAAIiN,EAAiB,CAClD,CAAC,ECMD,SAASW,GAAcC,EAAyC,CAC9D,MAAO,CACL,GAAGA,EACH,UACEA,EAAK,qBAAqB,KACtBA,EAAK,UAAU,cACfA,EAAK,UACX,UACEA,EAAK,qBAAqB,KACtBA,EAAK,UAAU,YAAA,EACfA,EAAK,SAAA,CAEf,CAEA,SAASC,GAAiBlY,EAAsB,CAC9C,MAAO,CACL,GAAGA,EACH,SAAU,CACR,GAAGA,EAAQ,SACX,UACEA,EAAQ,SAAS,qBAAqB,KAClCA,EAAQ,SAAS,UAAU,cAC3BA,EAAQ,SAAS,SAAA,CACzB,CAEJ,CAEA,eAAemY,GAAgB,CAI7B,MAAMC,GAHU,MAAMhG,GAAK,IAAI,WAAW,CACxC,QAASiG,GAAY,QAAQ,OAAA,CAC9B,IACuB,MAAM,GAC9B,GAAI,CAACD,EACH,MAAM,IAAI,MAAM,cAAc,EAEhC,OAAOA,CACT,CAEA,eAAsBE,GAAYC,EAAoB,CACpD,MAAM7K,EAAQ4J,GAA2B,MAAMiB,CAAQ,EACjDH,EAAS,MAAMD,EAAA,EAEfK,EAAQ,MAAMC,GAAiB,CACnC,GAAIL,EACJ,UAAW1K,GAAO,SAAA,CACnB,EAGD,OAAA8K,EAAM,KAAK,CAAC3W,EAAGmB,IACTnB,EAAE,UAAY,CAACmB,EAAE,SACZ,GAEL,CAACnB,EAAE,UAAYmB,EAAE,SACZ,EAEF,IAAI,KAAKA,EAAE,SAAS,EAAE,UAAY,IAAI,KAAKnB,EAAE,SAAS,EAAE,QAAA,CAChE,EAEM2W,EAAM,IAAKP,GAASD,GAAcU,GAAeT,CAAI,CAAC,CAAC,CAChE,CAEA,eAAsBU,GAAYJ,EAAmB,CACnD,MAAM7K,EAAQ8J,EAAkB,MAAMe,CAAQ,EACxCH,EAAS,MAAMD,EAAA,EAEfF,EAAO,MAAMW,EAAiB,CAAE,GAAIlL,EAAM,OAAQ,EAExD,GAAI,CAACuK,GAAQA,EAAK,SAAWG,EAC3B,MAAM,IAAI,MAAM,gBAAgB,EAGlC,OAAOJ,GAAcU,GAAeT,CAAI,CAAC,CAC3C,CAEA,eAAsBY,GAAgBN,EAAmB,CACvD,MAAM7K,EAAQ8J,EAAkB,MAAMe,CAAQ,EACxCH,EAAS,MAAMD,EAAA,EAEfF,EAAO,MAAMW,EAAiB,CAAE,GAAIlL,EAAM,OAAQ,EACxD,GAAI,CAACuK,GAAQA,EAAK,SAAWG,EAC3B,MAAM,IAAI,MAAM,gBAAgB,EAIlC,OADmB,MAAMU,GAAuB,CAAE,OAAQpL,EAAM,OAAQ,GACtD,IAAIwK,EAAgB,CACxC,CAEA,eAAsBa,GAAWR,EAAmB,CAClD,MAAM7K,EAAQ+J,GAAsB,MAAMc,CAAQ,EAC5CH,EAAS,MAAMD,EAAA,EAEfF,EAAO,MAAMW,EAAiB,CAAE,GAAIlL,EAAM,OAAQ,EACxD,GAAI,CAACuK,GAAQA,EAAK,SAAWG,EAC3B,MAAM,IAAI,MAAM,iCAAiC,EAGnD,MAAMY,GAAoB,CACxB,OAAQtL,EAAM,OACd,MAAOA,EAAM,KAAA,CACd,CACH,CAEA,eAAsBuL,GAAuBV,EAAmB,CAC9D,MAAM7K,EAAQgK,GAAyB,MAAMa,CAAQ,EAC/CH,EAAS,MAAMD,EAAA,EAEf,CAACnY,CAAO,EAAI,MAAMkZ,GAAe,CAAE,GAAIxL,EAAM,UAAW,EAE9D,GAAI,CAAC1N,EACH,MAAM,IAAI,MAAM,mBAAmB,EAGrC,MAAMiY,EAAO,MAAMW,EAAiB,CAAE,GAAI5Y,EAAQ,OAAQ,EAC1D,GAAI,CAACiY,GAAQA,EAAK,SAAWG,EAC3B,MAAM,IAAI,MAAM,eAAe,EAGjC,MAAMe,GAAqC,CACzC,OAAQnZ,EAAQ,OAChB,UAAW0N,EAAM,SAAA,CAClB,CACH,CAEA,eAAsB0L,GAAWb,EAAmB,CAClD,MAAM7K,EAAQgK,GAAyB,MAAMa,CAAQ,EAC/CH,EAAS,MAAMD,EAAA,EAEf,CAACkB,CAAG,EAAI,MAAMH,GAAe,CAAE,GAAIxL,EAAM,UAAW,EAC1D,GAAI,CAAC2L,EACH,MAAM,IAAI,MAAM,mBAAmB,EAGrC,MAAMpB,EAAO,MAAMW,EAAiB,CAAE,GAAIS,EAAI,OAAQ,EACtD,GAAI,CAACpB,GAAQA,EAAK,SAAWG,EAC3B,MAAM,IAAI,MAAM,iCAAiC,EAGnD,aAAMkB,GAAwB,CAC5B,UAAW5L,EAAM,UACjB,eAAgB,IAAK,CACtB,EAEM,CAAE,QAAS,EAAA,CACpB,CAEA,eAAsB6L,GAAchB,EAAmB,CACrD,MAAM7K,EAAQiK,GAA6B,MAAMY,CAAQ,EACnDH,EAAS,MAAMD,EAAA,EAEfF,EAAO,MAAMW,EAAiB,CAAE,GAAIlL,EAAM,OAAQ,EACxD,GAAI,CAACuK,GAAQA,EAAK,SAAWG,EAC3B,MAAM,IAAI,MAAM,iCAAiC,EAGnD,aAAMoB,GAAwB,CAC5B,OAAQ9L,EAAM,OACd,WAAYA,EAAM,UAAA,CACnB,EAEM,CAAE,QAAS,EAAA,CACpB,CAEA,eAAsB+L,GAAYlB,EAAmB,CACnD,MAAM7K,EAAQmK,GAA2B,MAAMU,CAAQ,EACjDH,EAAS,MAAMD,EAAA,EAEfF,EAAO,MAAMW,EAAiB,CAAE,GAAIlL,EAAM,OAAQ,EACxD,GAAI,CAACuK,GAAQA,EAAK,SAAWG,EAC3B,MAAM,IAAI,MAAM,iCAAiC,EAGnD,aAAMsB,GAAuB,CAC3B,OAAQhM,EAAM,OACd,SAAUA,EAAM,QAAA,CACjB,EAEM,CAAE,QAAS,EAAA,CACpB,CAEA,eAAsBiM,GAAWpB,EAAmB,CAClD,MAAM7K,EAAQ8J,EAAkB,MAAMe,CAAQ,EACxCH,EAAS,MAAMD,EAAA,EAEfF,EAAO,MAAMW,EAAiB,CAAE,GAAIlL,EAAM,OAAQ,EACxD,GAAI,CAACuK,GAAQA,EAAK,SAAWG,EAC3B,MAAM,IAAI,MAAM,iCAAiC,EAGnD,aAAMwB,GAAe,CAAE,GAAIlM,EAAM,OAAQ,EAClC,CAAE,QAAS,EAAA,CACpB,CAEA,eAAsBmM,GAActB,EAAmB,CACrD,MAAM7K,EAAQqK,GAA6B,MAAMQ,CAAQ,EACnD,CAAE,KAAMrT,CAAA,EAAU,MAAM4U,GAAa,CACzC,MAAO,MAAMvG,GAAiBvG,GAAO,OAAO,SAAS,KAAK,EAC1D,OAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,uCAKR,OAAQU,EAAM,QACd,uBAAwB,CAAE,UAAW,EAAA,CAAK,CAC3C,EAED,MAAO,CAAE,MAAAxI,CAAA,CACX,CAEA,eAAsB6U,GAAcxB,EAAmB,CACrD,MAAM7K,EAAQ8J,EAAkB,MAAMe,CAAQ,EACxCN,EAAO,MAAMW,EAAiB,CAAE,GAAIlL,EAAM,OAAQ,EAExD,GAAI,CAACuK,GAAQA,EAAK,aAAe,SAC/B,MAAM,IAAI,MAAM,uBAAuB,EAGzC,OAAOD,GAAcU,GAAeT,CAAI,CAAC,CAC3C,CAEA,eAAsB+B,GAAsBzB,EAAmB,CAC7D,MAAM7K,EAAQ8J,EAAkB,MAAMe,CAAQ,EAExCN,EAAO,MAAMW,EAAiB,CAAE,GAAIlL,EAAM,OAAQ,EAExD,GAAI,CAACuK,GAAQA,EAAK,aAAe,SAC/B,MAAM,IAAI,MAAM,uBAAuB,EAIzC,OADmB,MAAMa,GAAuB,CAAE,OAAQpL,EAAM,OAAQ,GACtD,IAAIwK,EAAgB,CACxC,CAEA,eAAsB+B,GAAgB1B,EAAmB,CACvD,MAAM7K,EAAQ8J,EAAkB,MAAMe,CAAQ,EACxCH,EAAS,MAAMD,EAAA,EAEf+B,EAAa,MAAMtB,EAAiB,CAAE,GAAIlL,EAAM,OAAQ,EAE9D,GAAI,CAACwM,GAAcA,EAAW,aAAe,SAC3C,MAAM,IAAI,MAAM,uBAAuB,EAGzC,MAAMnG,EAAiB,MAAM+E,GAAuB,CAClD,OAAQpL,EAAM,MAAA,CACf,EAED,GAAIqG,EAAe,SAAW,EAC5B,MAAM,IAAI,MAAM,qCAAqC,EAGvD,MAAMoG,EAAmBpG,EAAe,IAAKsF,GAAQA,EAAI,EAAE,EACrD3D,EAAkB,MAAM0E,GAAyB,CACrD,WAAYD,CAAA,CACb,EAEKnG,EAAYE,GAAA,EAElB,MAAMmG,GAAS,CACb,GAAIrG,EACJ,OAAAoE,EACA,MAAO,GAAG8B,EAAW,KAAK,EAAA,CAC3B,EAED,KAAM,CAAE,eAAA/F,EAAgB,gBAAA0B,CAAA,EAAoBiB,GAC1C/C,EAAe,IAAKsF,IAAS,CAC3B,GAAGA,EACH,OAAQ3L,EAAM,MAAA,EACd,EACFgI,EACA1B,EACAoE,CAAA,EAGIkC,EACJ,MAAM3D,GAA2BxC,CAAc,EAEjD,aAAMoG,GAAiB,CACrB,SAAUD,EAA8B,IAAKjB,IAAS,CACpD,GAAIA,EAAI,GACR,OAAQrF,EACR,QAASqF,CAAA,EACT,CAAA,CACH,EACGxD,EAAgB,OAAS,GAC3B,MAAM2E,GAAc,CAAE,UAAW3E,EAAiB,EAG7C,CAAE,OAAQ7B,CAAA,CACnB","x_google_ignoreList":[0,1,2]}