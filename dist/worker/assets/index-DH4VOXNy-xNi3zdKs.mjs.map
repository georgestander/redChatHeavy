{"version":3,"file":"index-DH4VOXNy-xNi3zdKs.mjs","sources":["index-DH4VOXNy.mjs"],"sourcesContent":["import{az as S,aA as I}from\"./worker-entry-DwuZrGJP.mjs\";import\"node:events\";import\"cloudflare:workers\";import\"/Users/georgestander/dev/tools/chatjs/node_modules/.pnpm/rwsdk@1.0.0-beta.53_@cloudflare+vite-plugin@1.23.0_bufferutil@4.1.0_vite@7.3.1_@types+node@22_zvk7ynha23nrady3r6nbat6zha/node_modules/rwsdk/dist/__intermediate_builds/ssr/ssr_bridge.js\";import\"async_hooks\";import\"node:os\";import\"node:diagnostics_channel\";import\"fs\";import\"events\";import\"util\";import\"path\";import\"assert\";import\"node:stream\";import\"module\";import\"node:path\";import\"url\";import\"buffer\";import\"crypto\";import\"node:crypto\";const Q=(f,R)=>{let w=null;const j=S({config:{adapterId:\"memory\",adapterName:\"Memory Adapter\",usePlural:!1,debugLogs:R?.debugLogs||!1,supportsArrays:!0,customTransformInput(d){return(d.options.advanced?.database?.useNumberId||d.options.advanced?.database?.generateId===\"serial\")&&d.field===\"id\"&&d.action===\"create\"?f[d.model].length+1:d.data},transaction:async d=>{const M=structuredClone(f);try{return await d(j(w))}catch(b){throw Object.keys(f).forEach(v=>{f[v]=M[v]}),b}}},adapter:({getFieldName:d,options:M,getModelName:b})=>{const v=(e,n,c)=>n?e.sort((o,i)=>{const y=d({model:c,field:n.field}),u=o[y],t=i[y];let r=0;return u==null&&t==null?r=0:u==null?r=-1:t==null?r=1:typeof u==\"string\"&&typeof t==\"string\"?r=u.localeCompare(t):u instanceof Date&&t instanceof Date?r=u.getTime()-t.getTime():typeof u==\"number\"&&typeof t==\"number\"?r=u-t:typeof u==\"boolean\"&&typeof t==\"boolean\"?r=u===t?0:u?1:-1:r=String(u).localeCompare(String(t)),n.direction===\"asc\"?r:-r}):e;function h(e,n,c){const o=(t,r)=>{const m=f[r];if(!m)throw I.error(`[MemoryAdapter] Model ${r} not found in the DB`,Object.keys(f)),new Error(`Model ${r} not found`);const g=(s,p)=>{const{field:l,value:a,operator:A}=p;switch(A){case\"in\":if(!Array.isArray(a))throw new Error(\"Value must be an array\");return a.includes(s[l]);case\"not_in\":if(!Array.isArray(a))throw new Error(\"Value must be an array\");return!a.includes(s[l]);case\"contains\":return s[l].includes(a);case\"starts_with\":return s[l].startsWith(a);case\"ends_with\":return s[l].endsWith(a);case\"ne\":return s[l]!==a;case\"gt\":return a!=null&&s[l]>a;case\"gte\":return a!=null&&s[l]>=a;case\"lt\":return a!=null&&s[l]<a;case\"lte\":return a!=null&&s[l]<=a;default:return s[l]===a}};return m.filter(s=>{if(!t.length||t.length===0)return!0;let p=g(s,t[0]);for(const l of t){const a=g(s,l);l.connector===\"OR\"?p=p||a:p=p&&a}return p})};if(!c)return o(e,n);const i=o(e,n),y=new Map,u=new Map;for(const t of i){const r=String(t.id);if(!y.has(r)){const g={...t};for(const[s,p]of Object.entries(c)){const l=b(s);p.relation===\"one-to-one\"?g[l]=null:(g[l]=[],u.set(`${r}-${s}`,new Set))}y.set(r,g)}const m=y.get(r);for(const[g,s]of Object.entries(c)){const p=b(g),l=f[p];if(!l)throw I.error(`[MemoryAdapter] JoinOption model ${p} not found in the DB`,Object.keys(f)),new Error(`JoinOption model ${p} not found`);const a=l.filter(A=>A[s.on.to]===t[s.on.from]);if(s.relation===\"one-to-one\")m[p]=a[0]||null;else{const A=u.get(`${r}-${g}`),C=s.limit??100;let E=0;for(const O of a){if(E>=C)break;A.has(O.id)||(m[p].push(O),A.add(O.id),E++)}}}}return Array.from(y.values())}return{create:async({model:e,data:n})=>((M.advanced?.database?.useNumberId||M.advanced?.database?.generateId===\"serial\")&&(n.id=f[b(e)].length+1),f[e]||(f[e]=[]),f[e].push(n),n),findOne:async({model:e,where:n,join:c})=>{const o=h(n,e,c);if(c){const i=o;return i.length?i[0]:null}return o[0]||null},findMany:async({model:e,where:n,sortBy:c,limit:o,offset:i,join:y})=>{const u=h(n||[],e,y);if(y){const r=u;if(!r.length)return[];v(r,c,e);let m=r;return i!==void 0&&(m=m.slice(i)),o!==void 0&&(m=m.slice(0,o)),m}let t=v(u,c,e);return i!==void 0&&(t=t.slice(i)),o!==void 0&&(t=t.slice(0,o)),t||[]},count:async({model:e,where:n})=>n?h(n,e).length:f[e].length,update:async({model:e,where:n,update:c})=>{const o=h(n,e);return o.forEach(i=>{Object.assign(i,c)}),o[0]||null},delete:async({model:e,where:n})=>{const c=f[e],o=h(n,e);f[e]=c.filter(i=>!o.includes(i))},deleteMany:async({model:e,where:n})=>{const c=f[e],o=h(n,e);let i=0;return f[e]=c.filter(y=>o.includes(y)?(i++,!1):!o.includes(y)),i},updateMany({model:e,where:n,update:c}){const o=h(n,e);return o.forEach(i=>{Object.assign(i,c)}),o[0]||null}}}});return d=>(w=d,j(d))};export{Q as memoryAdapter};\n//# sourceMappingURL=index-DH4VOXNy.mjs.map\n"],"names":["Q","f","R","w","j","S","d","M","v","n","i","y","r","h","m","I","g","p","l","A","O"],"mappings":"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"}