import{A as w,E as gt,J,T as U,q as yt,t as vt,w as wt,Z as d,I as It,x as M,y as je,o as h,s as f,z as Be,B as ne,C as K,D as Y,F as R,G as se,_ as Ge,H as bt,K as _t,L as Pt,f as ce,M as me,N as At,O as Et,b as St,d as E,P as ue,Q as kt,R as Mt,S as Ct,U as Dt,V as Tt,W as Ve,X as Rt,Y as Ot,$ as xt,a0 as $t,a1 as de,a2 as Zt,a3 as Ft,a4 as Nt,a5 as Lt,a as Ht,r as Ut,c as _}from"./worker-entry-DwuZrGJP.mjs";import"/Users/georgestander/dev/tools/chatjs/node_modules/.pnpm/rwsdk@1.0.0-beta.53_@cloudflare+vite-plugin@1.23.0_bufferutil@4.1.0_vite@7.3.1_@types+node@22_zvk7ynha23nrady3r6nbat6zha/node_modules/rwsdk/dist/__intermediate_builds/ssr/ssr_bridge.js";import ze from"node:path";import"node:events";import"cloudflare:workers";import"async_hooks";import"node:os";import"node:diagnostics_channel";import"fs";import"events";import"util";import"path";import"assert";import"node:stream";import"module";import"url";import"buffer";import"crypto";import"node:crypto";var jt=ze.join(process.cwd(),".devtools");ze.join(jt,"generations.json");process.env.AI_SDK_DEVTOOLS_PORT&&parseInt(process.env.AI_SDK_DEVTOOLS_PORT);function X(...e){return e.reduce((t,a)=>({...t,...a??{}}),{})}function V(e){return Object.fromEntries([...e.headers])}var Bt=({prefix:e,size:t=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const n=()=>{const s=a.length,o=new Array(t);for(let i=0;i<t;i++)o[i]=a[Math.random()*s|0];return o.join("")};if(e==null)return n;if(a.includes(r))throw new It({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${e}${r}${n()}`};Bt();function j(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}var Gt=["fetch failed","failed to fetch"];function qe({error:e,url:t,requestBodyValues:a}){if(j(e))return e;if(e instanceof TypeError&&Gt.includes(e.message.toLowerCase())){const r=e.cause;if(r!=null)return new w({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:a,isRetryable:!0})}return e}function We(e=globalThis){var t,a,r;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(r=(a=e.process)==null?void 0:a.versions)!=null&&r.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function Vt(e){if(e==null)return{};const t={};if(e instanceof Headers)e.forEach((a,r)=>{t[r.toLowerCase()]=a});else{Array.isArray(e)||(e=Object.entries(e));for(const[a,r]of e)r!=null&&(t[a.toLowerCase()]=r)}return t}function le(e,...t){const a=new Headers(Vt(e)),r=a.get("user-agent")||"";return a.set("user-agent",[r,...t].filter(Boolean).join(" ")),Object.fromEntries(a.entries())}var Je="4.0.1",zt=()=>globalThis.fetch,he=async({url:e,headers:t={},successfulResponseHandler:a,failedResponseHandler:r,abortSignal:n,fetch:s=zt()})=>{try{const o=await s(e,{method:"GET",headers:le(t,`ai-sdk/provider-utils/${Je}`,We()),signal:n}),i=V(o);if(!o.ok){let c;try{c=await r({response:o,url:e,requestBodyValues:{}})}catch(u){throw j(u)||w.isInstance(u)?u:new w({message:"Failed to process error response",cause:u,statusCode:o.status,url:e,responseHeaders:i,requestBodyValues:{}})}throw c.value}try{return await a({response:o,url:e,requestBodyValues:{}})}catch(c){throw c instanceof Error&&(j(c)||w.isInstance(c))?c:new w({message:"Failed to process successful response",cause:c,statusCode:o.status,url:e,responseHeaders:i,requestBodyValues:{}})}}catch(o){throw qe({error:o,url:e,requestBodyValues:{}})}};function q({settingValue:e,environmentVariableName:t}){if(typeof e=="string")return e;if(!(e!=null||typeof process>"u")&&(e=process.env[t],!(e==null||typeof e!="string")))return e}var qt=/"__proto__"\s*:/,Wt=/"constructor"\s*:/;function ge(e){const t=JSON.parse(e);return t===null||typeof t!="object"||qt.test(e)===!1&&Wt.test(e)===!1?t:Jt(t)}function Jt(e){let t=[e];for(;t.length;){const a=t;t=[];for(const r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const n in r){const s=r[n];s&&typeof s=="object"&&t.push(s)}}}return e}function Ke(e){const{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return ge(e)}try{return ge(e)}finally{Error.stackTraceLimit=t}}function W(e){if(e.type==="object"){e.additionalProperties=!1;const t=e.properties;if(t!=null)for(const a in t)t[a]=W(t[a])}return e.type==="array"&&e.items!=null&&(Array.isArray(e.items)?e.items=e.items.map(t=>W(t)):e.items=W(e.items)),e}var Kt=Symbol("Let zodToJsonSchema decide on which parser to use"),ye={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Yt=e=>typeof e=="string"?{...ye,name:e}:{...ye,...e};function I(){return{}}function Xt(e,t){var a,r,n;const s={type:"array"};return(a=e.type)!=null&&a._def&&((n=(r=e.type)==null?void 0:r._def)==null?void 0:n.typeName)!==d.ZodAny&&(s.items=p(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(s.minItems=e.minLength.value),e.maxLength&&(s.maxItems=e.maxLength.value),e.exactLength&&(s.minItems=e.exactLength.value,s.maxItems=e.exactLength.value),s}function Qt(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"min":a.inclusive?t.minimum=a.value:t.exclusiveMinimum=a.value;break;case"max":a.inclusive?t.maximum=a.value:t.exclusiveMaximum=a.value;break;case"multipleOf":t.multipleOf=a.value;break}return t}function ea(){return{type:"boolean"}}function Ye(e,t){return p(e.type._def,t)}var ta=(e,t)=>p(e.innerType._def,t);function Xe(e,t,a){const r=a??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,s)=>Xe(e,t,n))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return aa(e)}}var aa=e=>{const t={type:"integer",format:"unix-time"};for(const a of e.checks)switch(a.kind){case"min":t.minimum=a.value;break;case"max":t.maximum=a.value;break}return t};function ra(e,t){return{...p(e.innerType._def,t),default:e.defaultValue()}}function na(e,t){return t.effectStrategy==="input"?p(e.schema._def,t):I()}function sa(e){return{type:"string",enum:Array.from(e.values)}}var oa=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function ia(e,t){const a=[p(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),p(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(n=>!!n),r=[];return a.forEach(n=>{if(oa(n))r.push(...n.allOf);else{let s=n;if("additionalProperties"in n&&n.additionalProperties===!1){const{additionalProperties:o,...i}=n;s=i}r.push(s)}}),r.length?{allOf:r}:void 0}function ca(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}var te=void 0,P={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(te===void 0&&(te=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),te),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Qe(e,t){const a={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(t.emailStrategy){case"format:email":A(a,"email",r.message,t);break;case"format:idn-email":A(a,"idn-email",r.message,t);break;case"pattern:zod":y(a,P.email,r.message,t);break}break;case"url":A(a,"uri",r.message,t);break;case"uuid":A(a,"uuid",r.message,t);break;case"regex":y(a,r.regex,r.message,t);break;case"cuid":y(a,P.cuid,r.message,t);break;case"cuid2":y(a,P.cuid2,r.message,t);break;case"startsWith":y(a,RegExp(`^${ae(r.value,t)}`),r.message,t);break;case"endsWith":y(a,RegExp(`${ae(r.value,t)}$`),r.message,t);break;case"datetime":A(a,"date-time",r.message,t);break;case"date":A(a,"date",r.message,t);break;case"time":A(a,"time",r.message,t);break;case"duration":A(a,"duration",r.message,t);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":{y(a,RegExp(ae(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&A(a,"ipv4",r.message,t),r.version!=="v4"&&A(a,"ipv6",r.message,t);break}case"base64url":y(a,P.base64url,r.message,t);break;case"jwt":y(a,P.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&y(a,P.ipv4Cidr,r.message,t),r.version!=="v4"&&y(a,P.ipv6Cidr,r.message,t);break}case"emoji":y(a,P.emoji(),r.message,t);break;case"ulid":{y(a,P.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{A(a,"binary",r.message,t);break}case"contentEncoding:base64":{a.contentEncoding="base64";break}case"pattern:zod":{y(a,P.base64,r.message,t);break}}break}case"nanoid":y(a,P.nanoid,r.message,t)}return a}function ae(e,t){return t.patternStrategy==="escape"?da(e):e}var ua=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function da(e){let t="";for(let a=0;a<e.length;a++)ua.has(e[a])||(t+="\\"),t+=e[a];return t}function A(e,t,a,r){var n;e.format||(n=e.anyOf)!=null&&n.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...a&&r.errorMessages&&{errorMessage:{format:a}}})):e.format=t}function y(e,t,a,r){var n;e.pattern||(n=e.allOf)!=null&&n.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:ve(t,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):e.pattern=ve(t,r)}function ve(e,t){var a;if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},n=r.i?e.source.toLowerCase():e.source;let s="",o=!1,i=!1,c=!1;for(let u=0;u<n.length;u++){if(o){s+=n[u],o=!1;continue}if(r.i){if(i){if(n[u].match(/[a-z]/)){c?(s+=n[u],s+=`${n[u-2]}-${n[u]}`.toUpperCase(),c=!1):n[u+1]==="-"&&((a=n[u+2])!=null&&a.match(/[a-z]/))?(s+=n[u],c=!0):s+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){s+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(r.m){if(n[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(r.s&&n[u]==="."){s+=i?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}s+=n[u],n[u]==="\\"?o=!0:i&&n[u]==="]"?i=!1:!i&&n[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function et(e,t){var a,r,n,s,o,i;const c={type:"object",additionalProperties:(a=p(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))!=null?a:t.allowedAdditionalProperties};if(((r=e.keyType)==null?void 0:r._def.typeName)===d.ZodString&&((n=e.keyType._def.checks)!=null&&n.length)){const{type:u,...l}=Qe(e.keyType._def,t);return{...c,propertyNames:l}}else{if(((s=e.keyType)==null?void 0:s._def.typeName)===d.ZodEnum)return{...c,propertyNames:{enum:e.keyType._def.values}};if(((o=e.keyType)==null?void 0:o._def.typeName)===d.ZodBranded&&e.keyType._def.type._def.typeName===d.ZodString&&((i=e.keyType._def.type._def.checks)!=null&&i.length)){const{type:u,...l}=Ye(e.keyType._def,t);return{...c,propertyNames:l}}}return c}function la(e,t){if(t.mapStrategy==="record")return et(e,t);const a=p(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||I(),r=p(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||I();return{type:"array",maxItems:125,items:{type:"array",items:[a,r],minItems:2,maxItems:2}}}function pa(e){const t=e.values,r=Object.keys(e.values).filter(s=>typeof t[t[s]]!="number").map(s=>t[s]),n=Array.from(new Set(r.map(s=>typeof s)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:r}}function fa(){return{not:I()}}function ma(){return{type:"null"}}var oe={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ha(e,t){const a=e.options instanceof Map?Array.from(e.options.values()):e.options;if(a.every(r=>r._def.typeName in oe&&(!r._def.checks||!r._def.checks.length))){const r=a.reduce((n,s)=>{const o=oe[s._def.typeName];return o&&!n.includes(o)?[...n,o]:n},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=a.reduce((n,s)=>{const o=typeof s._def.value;switch(o){case"string":case"number":case"boolean":return[...n,o];case"bigint":return[...n,"integer"];case"object":if(s._def.value===null)return[...n,"null"];default:return n}},[]);if(r.length===a.length){const n=r.filter((s,o,i)=>i.indexOf(s)===o);return{type:n.length>1?n:n[0],enum:a.reduce((s,o)=>s.includes(o._def.value)?s:[...s,o._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,n)=>[...r,...n._def.values.filter(s=>!r.includes(s))],[])};return ga(e,t)}var ga=(e,t)=>{const a=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,n)=>p(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function ya(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[oe[e.innerType._def.typeName],"null"]};const a=p(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function va(e){const t={type:"number"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"int":t.type="integer";break;case"min":a.inclusive?t.minimum=a.value:t.exclusiveMinimum=a.value;break;case"max":a.inclusive?t.maximum=a.value:t.exclusiveMaximum=a.value;break;case"multipleOf":t.multipleOf=a.value;break}return t}function wa(e,t){const a={type:"object",properties:{}},r=[],n=e.shape();for(const o in n){let i=n[o];if(i===void 0||i._def===void 0)continue;const c=ba(i),u=p(i._def,{...t,currentPath:[...t.currentPath,"properties",o],propertyPath:[...t.currentPath,"properties",o]});u!==void 0&&(a.properties[o]=u,c||r.push(o))}r.length&&(a.required=r);const s=Ia(e,t);return s!==void 0&&(a.additionalProperties=s),a}function Ia(e,t){if(e.catchall._def.typeName!=="ZodNever")return p(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function ba(e){try{return e.isOptional()}catch{return!0}}var _a=(e,t)=>{var a;if(t.currentPath.toString()===((a=t.propertyPath)==null?void 0:a.toString()))return p(e.innerType._def,t);const r=p(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:I()},r]}:I()},Pa=(e,t)=>{if(t.pipeStrategy==="input")return p(e.in._def,t);if(t.pipeStrategy==="output")return p(e.out._def,t);const a=p(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=p(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",a?"1":"0"]});return{allOf:[a,r].filter(n=>n!==void 0)}};function Aa(e,t){return p(e.type._def,t)}function Ea(e,t){const r={type:"array",uniqueItems:!0,items:p(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(r.minItems=e.minSize.value),e.maxSize&&(r.maxItems=e.maxSize.value),r}function Sa(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((a,r)=>p(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:p(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((a,r)=>p(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function ka(){return{not:I()}}function Ma(){return I()}var Ca=(e,t)=>p(e.innerType._def,t),Da=(e,t,a)=>{switch(t){case d.ZodString:return Qe(e,a);case d.ZodNumber:return va(e);case d.ZodObject:return wa(e,a);case d.ZodBigInt:return Qt(e);case d.ZodBoolean:return ea();case d.ZodDate:return Xe(e,a);case d.ZodUndefined:return ka();case d.ZodNull:return ma();case d.ZodArray:return Xt(e,a);case d.ZodUnion:case d.ZodDiscriminatedUnion:return ha(e,a);case d.ZodIntersection:return ia(e,a);case d.ZodTuple:return Sa(e,a);case d.ZodRecord:return et(e,a);case d.ZodLiteral:return ca(e);case d.ZodEnum:return sa(e);case d.ZodNativeEnum:return pa(e);case d.ZodNullable:return ya(e,a);case d.ZodOptional:return _a(e,a);case d.ZodMap:return la(e,a);case d.ZodSet:return Ea(e,a);case d.ZodLazy:return()=>e.getter()._def;case d.ZodPromise:return Aa(e,a);case d.ZodNaN:case d.ZodNever:return fa();case d.ZodEffects:return na(e,a);case d.ZodAny:return I();case d.ZodUnknown:return Ma();case d.ZodDefault:return ra(e,a);case d.ZodBranded:return Ye(e,a);case d.ZodReadonly:return Ca(e,a);case d.ZodCatch:return ta(e,a);case d.ZodPipeline:return Pa(e,a);case d.ZodFunction:case d.ZodVoid:case d.ZodSymbol:return;default:return(r=>{})()}},Ta=(e,t)=>{let a=0;for(;a<e.length&&a<t.length&&e[a]===t[a];a++);return[(e.length-a).toString(),...t.slice(a)].join("/")};function p(e,t,a=!1){var r;const n=t.seen.get(e);if(t.override){const c=(r=t.override)==null?void 0:r.call(t,e,t,n,a);if(c!==Kt)return c}if(n&&!a){const c=Ra(n,t);if(c!==void 0)return c}const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);const o=Da(e,e.typeName,t),i=typeof o=="function"?p(o(),t):o;if(i&&Oa(e,t,i),t.postProcess){const c=t.postProcess(i,e,t);return s.jsonSchema=i,c}return s.jsonSchema=i,i}var Ra=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Ta(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((a,r)=>t.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),I()):t.$refStrategy==="seen"?I():void 0}},Oa=(e,t,a)=>(e.description&&(a.description=e.description),a),xa=e=>{const t=Yt(e),a=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}},$a=(e,t)=>{var a;const r=xa(t);let n=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[l,g])=>{var T;return{...u,[l]:(T=p(g._def,{...r,currentPath:[...r.basePath,r.definitionPath,l]},!0))!=null?T:I()}},{}):void 0;const s=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,o=(a=p(e._def,s===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,s]},!1))!=null?a:I(),i=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;i!==void 0&&(o.title=i);const c=s===void 0?n?{...o,[r.definitionPath]:n}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,s].join("/"),[r.definitionPath]:{...n,[s]:o}};return c.$schema="http://json-schema.org/draft-07/schema#",c},ie=Symbol.for("vercel.ai.schema");function $(e){let t;return()=>(t==null&&(t=e()),t)}function ee(e,{validate:t}={}){return{[ie]:!0,_type:void 0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}function Za(e){return typeof e=="object"&&e!==null&&ie in e&&e[ie]===!0&&"jsonSchema"in e&&"validate"in e}function Fa(e){return e==null?ee({properties:{},additionalProperties:!1}):Za(e)?e:"~standard"in e?e["~standard"].vendor==="zod"?D(e):Na(e):e()}function Na(e){return ee(()=>e["~standard"].jsonSchema.input({target:"draft-07"}),{validate:async t=>{const a=await e["~standard"].validate(t);return"value"in a?{success:!0,value:a.value}:{success:!1,error:new U({value:t,cause:a.issues})}}})}function La(e,t){var a;const r=(a=void 0)!=null?a:!1;return ee(()=>$a(e,{$refStrategy:r?"root":"none"}),{validate:async n=>{const s=await e.safeParseAsync(n);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function Ha(e,t){var a;const r=(a=void 0)!=null?a:!1;return ee(()=>W(wt(e,{target:"draft-7",io:"input",reused:r?"ref":"inline"})),{validate:async n=>{const s=await vt(e,n);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function Ua(e){return"_zod"in e}function D(e,t){return Ua(e)?Ha(e):La(e)}async function ja({value:e,schema:t}){const a=await B({value:e,schema:t});if(!a.success)throw U.wrap({value:e,cause:a.error});return a.value}async function B({value:e,schema:t}){const a=Fa(t);try{if(a.validate==null)return{success:!0,value:e,rawValue:e};const r=await a.validate(e);return r.success?{success:!0,value:r.value,rawValue:e}:{success:!1,error:U.wrap({value:e,cause:r.error}),rawValue:e}}catch(r){return{success:!1,error:U.wrap({value:e,cause:r}),rawValue:e}}}async function Ba({text:e,schema:t}){try{const a=Ke(e);return t==null?a:ja({value:a,schema:t})}catch(a){throw J.isInstance(a)||U.isInstance(a)?a:new J({text:e,cause:a})}}async function tt({text:e,schema:t}){try{const a=Ke(e);return t==null?{success:!0,value:a,rawValue:a}:await B({value:a,schema:t})}catch(a){return{success:!1,error:J.isInstance(a)?a:new J({text:e,cause:a}),rawValue:void 0}}}function Ga({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new yt).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await tt({text:a,schema:t}))}}))}var Va=()=>globalThis.fetch,Q=async({url:e,headers:t,body:a,failedResponseHandler:r,successfulResponseHandler:n,abortSignal:s,fetch:o})=>za({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(a),values:a},failedResponseHandler:r,successfulResponseHandler:n,abortSignal:s,fetch:o}),za=async({url:e,headers:t={},body:a,successfulResponseHandler:r,failedResponseHandler:n,abortSignal:s,fetch:o=Va()})=>{try{const i=await o(e,{method:"POST",headers:le(t,`ai-sdk/provider-utils/${Je}`,We()),body:a.content,signal:s}),c=V(i);if(!i.ok){let u;try{u=await n({response:i,url:e,requestBodyValues:a.values})}catch(l){throw j(l)||w.isInstance(l)?l:new w({message:"Failed to process error response",cause:l,statusCode:i.status,url:e,responseHeaders:c,requestBodyValues:a.values})}throw u.value}try{return await r({response:i,url:e,requestBodyValues:a.values})}catch(u){throw u instanceof Error&&(j(u)||w.isInstance(u))?u:new w({message:"Failed to process successful response",cause:u,statusCode:i.status,url:e,responseHeaders:c,requestBodyValues:a.values})}}catch(i){throw qe({error:i,url:e,requestBodyValues:a.values})}};async function S(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}var O=({errorSchema:e,errorToMessage:t,isRetryable:a})=>async({response:r,url:n,requestBodyValues:s})=>{const o=await r.text(),i=V(r);if(o.trim()==="")return{responseHeaders:i,value:new w({message:r.statusText,url:n,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:a?.(r)})};try{const c=await Ba({text:o,schema:e});return{responseHeaders:i,value:new w({message:t(c),url:n,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:o,data:c,isRetryable:a?.(r,c)})}}catch{return{responseHeaders:i,value:new w({message:r.statusText,url:n,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:a?.(r)})}}},qa=e=>async({response:t})=>{const a=V(t);if(t.body==null)throw new gt({});return{responseHeaders:a,value:Ga({stream:t.body,schema:e})}},G=e=>async({response:t,url:a,requestBodyValues:r})=>{const n=await t.text(),s=await tt({text:n,schema:e}),o=V(t);if(!s.success)throw new w({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:o,responseBody:n,url:a,requestBodyValues:r});return{responseHeaders:o,value:s.value,rawValue:s.rawValue}};function Wa(e){return e?.replace(/\/$/,"")}var Ja="vercel.ai.gateway.error",re=Symbol.for(Ja),we,Ie,b=class at extends(Ie=Error,we=re,Ie){constructor({message:t,statusCode:a=500,cause:r}){super(t),this[we]=!0,this.statusCode=a,this.cause=r}static isInstance(t){return at.hasMarker(t)}static hasMarker(t){return typeof t=="object"&&t!==null&&re in t&&t[re]===!0}},rt="GatewayAuthenticationError",Ka=`vercel.ai.gateway.error.${rt}`,be=Symbol.for(Ka),_e,Pe,nt=class st extends(Pe=b,_e=be,Pe){constructor({message:t="Authentication failed",statusCode:a=401,cause:r}={}){super({message:t,statusCode:a,cause:r}),this[_e]=!0,this.name=rt,this.type="authentication_error"}static isInstance(t){return b.hasMarker(t)&&be in t}static createContextualError({apiKeyProvided:t,oidcTokenProvided:a,message:r="Authentication failed",statusCode:n=401,cause:s}){let o;return t?o=`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:a?o=`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:o=`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new st({message:o,statusCode:n,cause:s})}},ot="GatewayInvalidRequestError",Ya=`vercel.ai.gateway.error.${ot}`,Ae=Symbol.for(Ya),Ee,Se,Xa=class extends(Se=b,Ee=Ae,Se){constructor({message:e="Invalid request",statusCode:t=400,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[Ee]=!0,this.name=ot,this.type="invalid_request_error"}static isInstance(e){return b.hasMarker(e)&&Ae in e}},it="GatewayRateLimitError",Qa=`vercel.ai.gateway.error.${it}`,ke=Symbol.for(Qa),Me,Ce,er=class extends(Ce=b,Me=ke,Ce){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[Me]=!0,this.name=it,this.type="rate_limit_exceeded"}static isInstance(e){return b.hasMarker(e)&&ke in e}},ct="GatewayModelNotFoundError",tr=`vercel.ai.gateway.error.${ct}`,De=Symbol.for(tr),ar=$(()=>D(h({modelId:f()}))),Te,Re,rr=class extends(Re=b,Te=De,Re){constructor({message:e="Model not found",statusCode:t=404,modelId:a,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[Te]=!0,this.name=ct,this.type="model_not_found",this.modelId=a}static isInstance(e){return b.hasMarker(e)&&De in e}},ut="GatewayInternalServerError",nr=`vercel.ai.gateway.error.${ut}`,Oe=Symbol.for(nr),xe,$e,Ze=class extends($e=b,xe=Oe,$e){constructor({message:e="Internal server error",statusCode:t=500,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[xe]=!0,this.name=ut,this.type="internal_server_error"}static isInstance(e){return b.hasMarker(e)&&Oe in e}},dt="GatewayResponseError",sr=`vercel.ai.gateway.error.${dt}`,Fe=Symbol.for(sr),Ne,Le,or=class extends(Le=b,Ne=Fe,Le){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:a,validationError:r,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Ne]=!0,this.name=dt,this.type="response_error",this.response=a,this.validationError=r}static isInstance(e){return b.hasMarker(e)&&Fe in e}};async function He({response:e,statusCode:t,defaultMessage:a="Gateway request failed",cause:r,authMethod:n}){const s=await B({value:e,schema:ir});if(!s.success)return new or({message:`Invalid error response format: ${a}`,statusCode:t,response:e,validationError:s.error,cause:r});const o=s.value,i=o.error.type,c=o.error.message;switch(i){case"authentication_error":return nt.createContextualError({apiKeyProvided:n==="api-key",oidcTokenProvided:n==="oidc",statusCode:t,cause:r});case"invalid_request_error":return new Xa({message:c,statusCode:t,cause:r});case"rate_limit_exceeded":return new er({message:c,statusCode:t,cause:r});case"model_not_found":{const u=await B({value:o.error.param,schema:ar});return new rr({message:c,statusCode:t,modelId:u.success?u.value.modelId:void 0,cause:r})}case"internal_server_error":return new Ze({message:c,statusCode:t,cause:r});default:return new Ze({message:c,statusCode:t,cause:r})}}var ir=$(()=>D(h({error:h({message:f(),type:f().nullish(),param:K().nullish(),code:Be([f(),ne()]).nullish()})})));function C(e,t){var a;return b.isInstance(e)?e:w.isInstance(e)?He({response:cr(e),statusCode:(a=e.statusCode)!=null?a:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):He({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}function cr(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var lt="ai-gateway-auth-method";async function x(e){const t=await B({value:e[lt],schema:ur});return t.success?t.value:void 0}var ur=$(()=>D(Be([Y("api-key"),Y("oidc")]))),Ue=class{constructor(e){this.config=e}async getAvailableModels(){try{const{value:e}=await he({url:`${this.config.baseURL}/config`,headers:await S(this.config.headers()),successfulResponseHandler:G(dr),failedResponseHandler:O({errorSchema:M(),errorToMessage:t=>t}),fetch:this.config.fetch});return e}catch(e){throw await C(e)}}async getCredits(){try{const e=new URL(this.config.baseURL),{value:t}=await he({url:`${e.origin}/v1/credits`,headers:await S(this.config.headers()),successfulResponseHandler:G(lr),failedResponseHandler:O({errorSchema:M(),errorToMessage:a=>a}),fetch:this.config.fetch});return t}catch(e){throw await C(e)}}},dr=$(()=>D(h({models:R(h({id:f(),name:f(),description:f().nullish(),pricing:h({input:f(),output:f(),input_cache_read:f().nullish(),input_cache_write:f().nullish()}).transform(({input:e,output:t,input_cache_read:a,input_cache_write:r})=>({input:e,output:t,...a?{cachedInputTokens:a}:{},...r?{cacheCreationInputTokens:r}:{}})).nullish(),specification:h({specificationVersion:Y("v3"),provider:f(),modelId:f()}),modelType:Ge(["language","embedding","image"]).nullish()}))}))),lr=$(()=>D(h({balance:f(),total_used:f()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),pr=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){const{abortSignal:t,...a}=e;return{args:this.maybeEncodeFileParts(a),warnings:[]}}async doGenerate(e){const{args:t,warnings:a}=await this.getArgs(e),{abortSignal:r}=e,n=await S(this.config.headers());try{const{responseHeaders:s,value:o,rawValue:i}=await Q({url:this.getUrl(),headers:X(n,e.headers,this.getModelConfigHeaders(this.modelId,!1),await S(this.config.o11yHeaders)),body:t,successfulResponseHandler:G(M()),failedResponseHandler:O({errorSchema:M(),errorToMessage:c=>c}),...r&&{abortSignal:r},fetch:this.config.fetch});return{...o,request:{body:t},response:{headers:s,body:i},warnings:a}}catch(s){throw await C(s,await x(n))}}async doStream(e){const{args:t,warnings:a}=await this.getArgs(e),{abortSignal:r}=e,n=await S(this.config.headers());try{const{value:s,responseHeaders:o}=await Q({url:this.getUrl(),headers:X(n,e.headers,this.getModelConfigHeaders(this.modelId,!0),await S(this.config.o11yHeaders)),body:t,successfulResponseHandler:qa(M()),failedResponseHandler:O({errorSchema:M(),errorToMessage:i=>i}),...r&&{abortSignal:r},fetch:this.config.fetch});return{stream:s.pipeThrough(new TransformStream({start(i){a.length>0&&i.enqueue({type:"stream-start",warnings:a})},transform(i,c){if(i.success){const u=i.value;if(u.type==="raw"&&!e.includeRawChunks)return;u.type==="response-metadata"&&u.timestamp&&typeof u.timestamp=="string"&&(u.timestamp=new Date(u.timestamp)),c.enqueue(u)}else c.error(i.error)}})),request:{body:t},response:{headers:o}}}catch(s){throw await C(s,await x(n))}}isFilePart(e){return e&&typeof e=="object"&&"type"in e&&e.type==="file"}maybeEncodeFileParts(e){for(const t of e.prompt)for(const a of t.content)if(this.isFilePart(a)){const r=a;if(r.data instanceof Uint8Array){const n=Uint8Array.from(r.data),s=Buffer.from(n).toString("base64");r.data=new URL(`data:${r.mediaType||"application/octet-stream"};base64,${s}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},fr=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:a,providerOptions:r}){var n;const s=await S(this.config.headers());try{const{responseHeaders:o,value:i,rawValue:c}=await Q({url:this.getUrl(),headers:X(s,t??{},this.getModelConfigHeaders(),await S(this.config.o11yHeaders)),body:{values:e,...r?{providerOptions:r}:{}},successfulResponseHandler:G(mr),failedResponseHandler:O({errorSchema:M(),errorToMessage:u=>u}),...a&&{abortSignal:a},fetch:this.config.fetch});return{embeddings:i.embeddings,usage:(n=i.usage)!=null?n:void 0,providerMetadata:i.providerMetadata,response:{headers:o,body:c},warnings:[]}}catch(o){throw await C(o,await x(s))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},mr=$(()=>D(h({embeddings:R(R(ne())),usage:h({tokens:ne()}).nullish(),providerMetadata:se(f(),se(f(),K())).optional()}))),hr=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.maxImagesPerCall=Number.MAX_SAFE_INTEGER}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:a,aspectRatio:r,seed:n,providerOptions:s,headers:o,abortSignal:i}){var c;const u=await S(this.config.headers());try{const{responseHeaders:l,value:g,rawValue:T}=await Q({url:this.getUrl(),headers:X(u,o??{},this.getModelConfigHeaders(),await S(this.config.o11yHeaders)),body:{prompt:e,n:t,...a&&{size:a},...r&&{aspectRatio:r},...n&&{seed:n},...s&&{providerOptions:s}},successfulResponseHandler:G(yr),failedResponseHandler:O({errorSchema:M(),errorToMessage:v=>v}),...i&&{abortSignal:i},fetch:this.config.fetch});return{images:g.images,warnings:(c=g.warnings)!=null?c:[],providerMetadata:g.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:l}}}catch(l){throw C(l,await x(u))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":"2","ai-model-id":this.modelId}}},gr=h({images:R(K()).optional()}).catchall(K()),yr=h({images:R(f()),warnings:R(h({type:Y("other"),message:f()})).optional(),providerMetadata:se(f(),gr).optional()});async function vr(){var e;return(e=je.getContext().headers)==null?void 0:e["x-vercel-id"]}var wr="3.0.2",Ir="0.0.1";function br(e={}){var t,a;let r=null,n=null;const s=(t=e.metadataCacheRefreshMillis)!=null?t:1e3*60*5;let o=0;const i=(a=Wa(e.baseURL))!=null?a:"https://ai-gateway.vercel.sh/v3/ai",c=async()=>{const m=await Pr(e);if(m)return le({Authorization:`Bearer ${m.token}`,"ai-gateway-protocol-version":Ir,[lt]:m.authMethod,...e.headers},`ai-sdk/gateway/${wr}`);throw nt.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},u=()=>{const m=q({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),N=q({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),L=q({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const H=await vr();return{...m&&{"ai-o11y-deployment-id":m},...N&&{"ai-o11y-environment":N},...L&&{"ai-o11y-region":L},...H&&{"ai-o11y-request-id":H}}}},l=m=>new pr(m,{provider:"gateway",baseURL:i,headers:c,fetch:e.fetch,o11yHeaders:u()}),g=async()=>{var m,N,L;const H=(L=(N=(m=e._internal)==null?void 0:m.currentDate)==null?void 0:N.call(m).getTime())!=null?L:Date.now();return(!r||H-o>s)&&(o=H,r=new Ue({baseURL:i,headers:c,fetch:e.fetch}).getAvailableModels().then(z=>(n=z,z)).catch(async z=>{throw await C(z,await x(await c()))})),n?Promise.resolve(n):r},T=async()=>new Ue({baseURL:i,headers:c,fetch:e.fetch}).getCredits().catch(async m=>{throw await C(m,await x(await c()))}),v=function(m){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return l(m)};v.specificationVersion="v3",v.getAvailableModels=g,v.getCredits=T,v.imageModel=m=>new hr(m,{provider:"gateway",baseURL:i,headers:c,fetch:e.fetch,o11yHeaders:u()}),v.languageModel=l;const F=m=>new fr(m,{provider:"gateway",baseURL:i,headers:c,fetch:e.fetch,o11yHeaders:u()});return v.embeddingModel=F,v.textEmbeddingModel=F,v}var _r=br();async function Pr(e){const t=q({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{return{token:await je.getVercelOidcToken(),authMethod:"oidc"}}catch{return null}}const Ar=async e=>{const t=await bt(e),a=_r(t.id),r=[];return t.reasoning&&t.owned_by==="xai"&&(console.log("Wrapping reasoning middleware for",t.id),r.push(Pt({tagName:"think"}))),r.length===0?a:_t({model:a,middleware:r})};function Er(e,t){const a=new Map;for(const n of e)a.set(n.id,ce());const r=[];for(const n of e){const s=a.get(n.id);if(!s)throw new Error(`Message ID ${n.id} not found in mapping`);let o=null;if(n.parentMessageId){const c=a.get(n.parentMessageId);if(!c)throw new Error(`Parent message ID ${n.parentMessageId} not found in mapping`);o=c}const i={...n,id:s,chatId:t,parentMessageId:o};r.push(i)}return r}function Sr(e){const t=new Map;for(const a of e)t.set(a.id,ce());return t}function pe(e,t){const a=t.get(e);if(!a)throw new Error(`Document ID ${e} not found in mapping`);return a}function kr(e,t){if(e.type!=="tool-deepResearch"||e.state!=="output-available"||e.output?.format!=="report"||e.output.status!=="success")return e;const a=e.output.documentId,r=pe(a,t);return{...e,output:{...e.output,documentId:r}}}function pt(e){return e.type==="tool-editTextDocument"||e.type==="tool-editCodeDocument"||e.type==="tool-editSheetDocument"}function ft(e){return e.type==="tool-createTextDocument"||e.type==="tool-createCodeDocument"||e.type==="tool-createSheetDocument"}function Mr(e,t){if(!pt(e)||e.state!=="output-available"||e.output.status!=="success")return e;const a=e.output.documentId,r=pe(a,t);return{...e,output:{...e.output,documentId:r}}}function Cr(e,t){if(!ft(e)||e.state!=="output-available"||e.output.status!=="success")return e;const a=e.output.documentId,r=pe(a,t);return{...e,output:{...e.output,documentId:r}}}function Dr(e,t){return e.type==="tool-deepResearch"?kr(e,t):pt(e)?Mr(e,t):ft(e)?Cr(e,t):e}function Tr(e,t){return e.map(a=>{const r=a.parts;let n=[];return Array.isArray(r)&&(n=r.map(s=>Dr(s,t))),{...a,parts:n}})}function Rr(e,t,a,r){const n=[];for(const s of e){const o=t.get(s.id),i=a.get(s.messageId);if(!o)throw new Error(`Document ID ${s.id} not found in mapping`);if(!i)throw new Error(`Message ID ${s.messageId} not found in mapping`);const c={...s,id:o,messageId:i,userId:r};n.push(c)}return n}async function Or(e){try{if(!e.url)return console.warn("Attachment has no URL, skipping clone"),e;if(!xr(e.url))return console.warn("Attachment is not managed by local file storage, skipping clone:",e.url),e;const t=await fetch($r(e.url));if(!t.ok)throw new Error(`Failed to fetch attachment: ${t.statusText}`);const a=await t.blob();let r=e.filename||"attachment";r.includes("/")&&(r=r.split("/").pop()||"attachment"),r.startsWith(me)&&(r=r.replace(me,""));const n=await At(r,Buffer.from(await a.arrayBuffer()),{contentType:a.type||void 0});return{...e,url:n.url}}catch(t){return console.error("Failed to clone attachment:",t),e}}function xr(e){if(e.startsWith("/api/files/")||e.includes("blob.vercel-storage.com"))return!0;try{return new URL(e).pathname.startsWith("/api/files/")}catch{return!1}}function $r(e){return e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?new URL(e,Zr()).toString():e}function Zr(){const e=process.env.APP_URL?.trim();return e||"http://localhost:5173"}async function Fr(e){const t=[];for(const a of e)if(a.parts&&Array.isArray(a.parts)){const r=[];for(const s of a.parts)if(s.type==="file"){const o=await Or(s);r.push(o)}else r.push(s);const n={...a,parts:r};t.push(n)}else t.push(a);return t}function Nr(e,t,a,r){const n=Er(e,a),s=new Map;for(let l=0;l<e.length;l++)s.set(e[l].id,n[l].id);const o=n.map((l,g)=>{const v=e[g].metadata?.parentMessageId??null;if(v===null)return l.metadata?{...l,metadata:{...l.metadata,parentMessageId:null}}:l;const F=s.get(v);if(!F)throw new Error(`Parent message ID ${v} from metadata not found in mapping`);const m=l.metadata??{parentMessageId:null};return{...l,metadata:{...m,parentMessageId:F}}}),i=Sr(t),c=Tr(o,i),u=Rr(t,i,s,r);return{clonedMessages:c,clonedDocuments:u,messageIdMap:s,documentIdMap:i}}const Lr=5e4,Hr=Lr*3,Ur=h({projectId:Et().optional().nullable()}).optional(),Z=h({chatId:f().uuid()}),jr=h({chatId:f().uuid(),title:f().min(1).max(255)}),mt=h({messageId:f().uuid()}),Br=h({chatId:f().uuid(),visibility:Ge(["private","public"])}),Gr=h({chatId:f().uuid(),isPinned:St()}),Vr=h({message:f().min(1).max(Hr)});function fe(e){return{...e,createdAt:e.createdAt instanceof Date?e.createdAt.toISOString():e.createdAt,updatedAt:e.updatedAt instanceof Date?e.updatedAt.toISOString():e.updatedAt}}function ht(e){return{...e,metadata:{...e.metadata,createdAt:e.metadata.createdAt instanceof Date?e.metadata.createdAt.toISOString():e.metadata.createdAt}}}async function k(){const t=(await Ht.api.getSession({headers:Ut.request.headers}))?.user?.id;if(!t)throw new Error("UNAUTHORIZED");return t}async function zr(e){const t=Ur.parse(e),a=await k(),r=await $t({id:a,projectId:t?.projectId});return r.sort((n,s)=>n.isPinned&&!s.isPinned?-1:!n.isPinned&&s.isPinned?1:new Date(s.updatedAt).getTime()-new Date(n.updatedAt).getTime()),r.map(n=>fe(de(n)))}async function qr(e){const t=Z.parse(e),a=await k(),r=await E({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found");return fe(de(r))}async function Wr(e){const t=Z.parse(e),a=await k(),r=await E({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found");return(await ue({chatId:t.chatId})).map(ht)}async function Jr(e){const t=jr.parse(e),a=await k(),r=await E({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found or access denied");await Zt({chatId:t.chatId,title:t.title})}async function Kr(e){const t=mt.parse(e),a=await k(),[r]=await Ve({id:t.messageId});if(!r)throw new Error("Message not found");const n=await E({id:r.chatId});if(!n||n.userId!==a)throw new Error("Access denied");await Rt({chatId:r.chatId,messageId:t.messageId})}async function Yr(e){const t=mt.parse(e),a=await k(),[r]=await Ve({id:t.messageId});if(!r)throw new Error("Message not found");const n=await E({id:r.chatId});if(!n||n.userId!==a)throw new Error("Chat not found or access denied");return await Lt({messageId:t.messageId,canceledAt:new Date}),{success:!0}}async function Xr(e){const t=Br.parse(e),a=await k(),r=await E({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found or access denied");return await Nt({chatId:t.chatId,visibility:t.visibility}),{success:!0}}async function Qr(e){const t=Gr.parse(e),a=await k(),r=await E({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found or access denied");return await Ft({chatId:t.chatId,isPinned:t.isPinned}),{success:!0}}async function en(e){const t=Z.parse(e),a=await k(),r=await E({id:t.chatId});if(!r||r.userId!==a)throw new Error("Chat not found or access denied");return await Tt({id:t.chatId}),{success:!0}}async function tn(e){const t=Vr.parse(e),{text:a}=await Ot({model:await Ar(xt.models.defaults.title),system:`

        - you will generate a short title based on the first message a user begins a conversation with
        - ensure it is not more than 80 characters long
        - the title should be a summary of the user's message
        - do not use quotes or colons`,prompt:t.message,experimental_telemetry:{isEnabled:!0}});return{title:a}}async function an(e){const t=Z.parse(e),a=await E({id:t.chatId});if(!a||a.visibility!=="public")throw new Error("Public chat not found");return fe(de(a))}async function rn(e){const t=Z.parse(e),a=await E({id:t.chatId});if(!a||a.visibility!=="public")throw new Error("Public chat not found");return(await ue({chatId:t.chatId})).map(ht)}async function nn(e){const t=Z.parse(e),a=await k(),r=await E({id:t.chatId});if(!r||r.visibility!=="public")throw new Error("Public chat not found");const n=await ue({chatId:t.chatId});if(n.length===0)throw new Error("Source chat has no messages to copy");const s=n.map(g=>g.id),o=await kt({messageIds:s}),i=ce();await Mt({id:i,userId:a,title:`${r.title}`});const{clonedMessages:c,clonedDocuments:u}=Nr(n.map(g=>({...g,chatId:t.chatId})),o,i,a),l=await Fr(c);return await Ct({messages:l.map(g=>({id:g.id,chatId:i,message:g}))}),u.length>0&&await Dt({documents:u}),{chatId:i}}_(zr,"/src/server/actions/chat.ts","getAllChats");_(qr,"/src/server/actions/chat.ts","getChatById");_(Wr,"/src/server/actions/chat.ts","getChatMessages");_(Jr,"/src/server/actions/chat.ts","renameChat");_(Kr,"/src/server/actions/chat.ts","deleteTrailingMessages");_(Yr,"/src/server/actions/chat.ts","stopStream");_(Xr,"/src/server/actions/chat.ts","setVisibility");_(Qr,"/src/server/actions/chat.ts","setIsPinned");_(en,"/src/server/actions/chat.ts","deleteChat");_(tn,"/src/server/actions/chat.ts","generateTitle");_(an,"/src/server/actions/chat.ts","getPublicChat");_(rn,"/src/server/actions/chat.ts","getPublicChatMessages");_(nn,"/src/server/actions/chat.ts","cloneSharedChat");export{nn as cloneSharedChat,en as deleteChat,Kr as deleteTrailingMessages,tn as generateTitle,zr as getAllChats,qr as getChatById,Wr as getChatMessages,an as getPublicChat,rn as getPublicChatMessages,Jr as renameChat,Qr as setIsPinned,Xr as setVisibility,Yr as stopStream};
//# sourceMappingURL=chat-DSVyH--d.mjs.map
