{"version":3,"file":"project-chat-page-7fTy0Ecc.js","sources":["../../../app/(chat)/project/[projectId]/chat/[chatId]/project-chat-page.tsx"],"sourcesContent":["\"use client\";\nimport { useSuspenseQuery } from \"@tanstack/react-query\";\nimport { useMemo } from \"react\";\nimport { ChatSystem } from \"@/components/chat-system\";\nimport {\n  useGetChatByIdQueryOptions,\n  useGetChatMessagesQueryOptions,\n} from \"@/hooks/chat-sync-hooks\";\nimport type { UiToolName } from \"@/lib/ai/types\";\nimport { getDefaultThread } from \"@/lib/thread-utils\";\nimport { useChatId } from \"@/providers/chat-id-provider\";\n\nexport function ProjectChatPage({ projectId }: { projectId: string }) {\n  const { id } = useChatId();\n  const getChatByIdQueryOptions = useGetChatByIdQueryOptions(id);\n  const { data: chat } = useSuspenseQuery(getChatByIdQueryOptions);\n  const getMessagesByChatIdQueryOptions = useGetChatMessagesQueryOptions();\n  const { data: messages } = useSuspenseQuery(getMessagesByChatIdQueryOptions);\n\n  const initialThreadMessages = useMemo(() => {\n    if (!messages) {\n      return [];\n    }\n    return getDefaultThread(\n      messages.map((msg) => ({ ...msg, id: msg.id.toString() }))\n    );\n  }, [messages]);\n\n  const initialTool = useMemo<UiToolName | null>(() => {\n    const lastAssistantMessage = messages?.findLast(\n      (m) => m.role === \"assistant\"\n    );\n    if (!(lastAssistantMessage && Array.isArray(lastAssistantMessage.parts))) {\n      return null;\n    }\n    for (const part of lastAssistantMessage.parts) {\n      if (\n        part?.type === \"tool-deepResearch\" &&\n        part?.state === \"output-available\" &&\n        part?.output?.format === \"clarifying_questions\"\n      ) {\n        return \"deepResearch\";\n      }\n    }\n    return null;\n  }, [messages]);\n\n  if (!id) {\n    return (\n      <div className=\"flex h-dvh items-center justify-center\">\n        <div className=\"text-muted-foreground\">Chat not found.</div>\n      </div>\n    );\n  }\n\n  if (!chat) {\n    return (\n      <div className=\"flex h-dvh items-center justify-center\">\n        <div className=\"text-muted-foreground\">Chat not found.</div>\n      </div>\n    );\n  }\n\n  return (\n    <ChatSystem\n      id={chat.id}\n      initialMessages={initialThreadMessages}\n      initialTool={initialTool}\n      isReadonly={false}\n      projectId={projectId}\n    />\n  );\n}\n"],"names":["ProjectChatPage","projectId","id","useChatId","getChatByIdQueryOptions","useGetChatByIdQueryOptions","chat","useSuspenseQuery","getMessagesByChatIdQueryOptions","useGetChatMessagesQueryOptions","messages","initialThreadMessages","useMemo","getDefaultThread","msg","initialTool","lastAssistantMessage","m","part","jsx","ChatSystem"],"mappings":"ixDAYO,SAASA,GAAgB,CAAE,UAAAC,GAAoC,CACpE,KAAM,CAAE,GAAAC,CAAA,EAAOC,EAAA,EACTC,EAA0BC,EAA2BH,CAAE,EACvD,CAAE,KAAMI,GAASC,EAAiBH,CAAuB,EACzDI,EAAkCC,EAAA,EAClC,CAAE,KAAMC,GAAaH,EAAiBC,CAA+B,EAErEG,EAAwBC,EAAAA,QAAQ,IAC/BF,EAGEG,EACLH,EAAS,IAAKI,IAAS,CAAE,GAAGA,EAAK,GAAIA,EAAI,GAAG,SAAA,GAAa,CAAA,EAHlD,CAAA,EAKR,CAACJ,CAAQ,CAAC,EAEPK,EAAcH,EAAAA,QAA2B,IAAM,CACnD,MAAMI,EAAuBN,GAAU,SACpCO,GAAMA,EAAE,OAAS,WAAA,EAEpB,GAAI,EAAED,GAAwB,MAAM,QAAQA,EAAqB,KAAK,GACpE,OAAO,KAET,UAAWE,KAAQF,EAAqB,MACtC,GACEE,GAAM,OAAS,qBACfA,GAAM,QAAU,oBAChBA,GAAM,QAAQ,SAAW,uBAEzB,MAAO,eAGX,OAAO,IACT,EAAG,CAACR,CAAQ,CAAC,EAEb,OAAKR,EAQAI,EASHa,EAAAA,IAACC,EAAA,CACC,GAAId,EAAK,GACT,gBAAiBK,EACjB,YAAAI,EACA,WAAY,GACZ,UAAAd,CAAA,CAAA,EAZAkB,EAAAA,IAAC,OAAI,UAAU,yCACb,eAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,iBAAA,CAAe,CAAA,CACxD,EAVAA,EAAAA,IAAC,OAAI,UAAU,yCACb,eAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,iBAAA,CAAe,CAAA,CACxD,CAqBN"}