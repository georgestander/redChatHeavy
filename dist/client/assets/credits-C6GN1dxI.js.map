{"version":3,"file":"credits-C6GN1dxI.js","sources":["../../../lib/types/anonymous.ts","../../../lib/constants.ts","../../../lib/anonymous-session-client.ts","../../../src/lib/query-keys/credits.ts"],"sourcesContent":["import type { ToolName } from \"../ai/types\";\nimport { config } from \"../config\";\n\nexport type AnonymousSession = {\n  id: string;\n  remainingCredits: number;\n  createdAt: Date;\n};\n\nconst anonConfig = config.anonymous;\n\nexport const ANONYMOUS_LIMITS = {\n  CREDITS: anonConfig.credits,\n  AVAILABLE_MODELS: config.models.anonymousModels,\n  AVAILABLE_TOOLS: anonConfig.availableTools as ToolName[],\n  SESSION_DURATION: 2_147_483_647, // Max session time\n  RATE_LIMIT: {\n    REQUESTS_PER_MINUTE: anonConfig.rateLimit.requestsPerMinute,\n    REQUESTS_PER_MONTH: anonConfig.rateLimit.requestsPerMonth,\n  },\n} as const;\n","import { config } from \"@/lib/config\";\n\nconst _isProductionEnvironment = process.env.NODE_ENV === \"production\";\n\nconst _isTestEnvironment = Boolean(\n  process.env.PLAYWRIGHT_TEST_BASE_URL ||\n    process.env.PLAYWRIGHT ||\n    process.env.CI_PLAYWRIGHT\n);\n\nexport const BLOB_FILE_PREFIX = `${config.appPrefix}/files/`;\n\nexport const ANONYMOUS_SESSION_COOKIES_KEY = \"anonymous-session\";\n","\"use client\";\nimport type { AnonymousSession } from \"@/lib/types/anonymous\";\nimport { ANONYMOUS_LIMITS } from \"@/lib/types/anonymous\";\nimport { ANONYMOUS_SESSION_COOKIES_KEY } from \"./constants\";\n\n// Client-side cookie helpers\nfunction getCookie(name: string): string | null {\n  if (typeof document === \"undefined\") {\n    return null;\n  }\n\n  const value = `; ${document.cookie}`;\n  const parts = value.split(`; ${name}=`);\n  if (parts.length === 2) {\n    const cookieValue = parts.pop()?.split(\";\").shift() || null;\n    return cookieValue ? decodeURIComponent(cookieValue) : null;\n  }\n  return null;\n}\n\nfunction setCookie(name: string, value: string, maxAge: number): void {\n  if (typeof document === \"undefined\") {\n    return;\n  }\n\n  const secure = window.location.protocol === \"https:\" ? \"; Secure\" : \"\";\n  const encodedValue = encodeURIComponent(value);\n  if (\"cookieStore\" in window) {\n    // @ts-expect-error cookieStore is not yet in TS lib.dom\n    window.cookieStore\n      .set({\n        name,\n        value: encodedValue,\n        path: \"/\",\n        expires: Date.now() + maxAge * 1000,\n        sameSite: \"lax\",\n        secure: window.location.protocol === \"https:\",\n      })\n      .catch(() => {\n        // Fail silently if Cookie Store API fails\n      });\n  } else {\n    // biome-ignore lint/suspicious/noDocumentCookie: Cookie Store API not available\n    document.cookie = `${name}=${encodedValue}; Path=/; Max-Age=${maxAge}; SameSite=Lax${secure}`;\n  }\n}\n\nfunction deleteCookie(name: string): void {\n  if (typeof document === \"undefined\") {\n    return;\n  }\n  if (\"cookieStore\" in window) {\n    // @ts-expect-error cookieStore is not yet in TS lib.dom\n    window.cookieStore.delete(name).catch(() => {\n      // Fail silently if Cookie Store API fails\n    });\n  } else {\n    // biome-ignore lint/suspicious/noDocumentCookie: Cookie Store API not available\n    document.cookie = `${name}=; Path=/; Max-Age=0`;\n  }\n}\n\nexport function getAnonymousSession(): AnonymousSession | null {\n  try {\n    const sessionData = getCookie(ANONYMOUS_SESSION_COOKIES_KEY);\n    if (!sessionData) {\n      return null;\n    }\n\n    const session = JSON.parse(sessionData) as AnonymousSession;\n\n    // Convert createdAt back to Date object if it's a string\n    if (typeof session.createdAt === \"string\") {\n      session.createdAt = new Date(session.createdAt);\n    }\n\n    // Check if session is expired\n    const isExpired =\n      Date.now() - session.createdAt.getTime() >\n      ANONYMOUS_LIMITS.SESSION_DURATION;\n\n    return isExpired ? null : session;\n  } catch (error) {\n    console.error(\"Error parsing anonymous session:\", error);\n    return null;\n  }\n}\n\nexport function setAnonymousSession(session: AnonymousSession): void {\n  setCookie(\n    ANONYMOUS_SESSION_COOKIES_KEY,\n    JSON.stringify(session),\n    ANONYMOUS_LIMITS.SESSION_DURATION\n  );\n}\n\nexport function clearAnonymousSession(): void {\n  deleteCookie(ANONYMOUS_SESSION_COOKIES_KEY);\n}\n","export const creditsKeys = {\n  available: [\"credits\", \"available\"] as const,\n} as const;\n"],"names":["anonConfig","config","ANONYMOUS_LIMITS","ANONYMOUS_SESSION_COOKIES_KEY","getCookie","name","parts","cookieValue","setCookie","value","maxAge","secure","encodedValue","deleteCookie","getAnonymousSession","sessionData","session","error","setAnonymousSession","clearAnonymousSession","creditsKeys"],"mappings":"yCASA,MAAMA,EAAaC,EAAO,UAEbC,EAAmB,CAC9B,QAASF,EAAW,QACpB,iBAAkBC,EAAO,OAAO,gBAChC,gBAAiBD,EAAW,eAC5B,iBAAkB,WAClB,WAAY,CACV,oBAAqBA,EAAW,UAAU,kBAC1C,mBAAoBA,EAAW,UAAU,gBAAA,CAE7C,ECVmC,GAAAC,EAAO,YAEnC,MAAME,EAAgC,oBCN7C,SAASC,EAAUC,EAA6B,CAC9C,GAAI,OAAO,SAAa,IACtB,OAAO,KAIT,MAAMC,EADQ,KAAK,SAAS,MAAM,GACd,MAAM,KAAKD,CAAI,GAAG,EACtC,GAAIC,EAAM,SAAW,EAAG,CACtB,MAAMC,EAAcD,EAAM,IAAA,GAAO,MAAM,GAAG,EAAE,SAAW,KACvD,OAAOC,EAAc,mBAAmBA,CAAW,EAAI,IACzD,CACA,OAAO,IACT,CAEA,SAASC,EAAUH,EAAcI,EAAeC,EAAsB,CACpE,GAAI,OAAO,SAAa,IACtB,OAGF,MAAMC,EAAS,OAAO,SAAS,WAAa,SAAW,WAAa,GAC9DC,EAAe,mBAAmBH,CAAK,EACzC,gBAAiB,OAEnB,OAAO,YACJ,IAAI,CACH,KAAAJ,EACA,MAAOO,EACP,KAAM,IACN,QAAS,KAAK,IAAA,EAAQF,EAAS,IAC/B,SAAU,MACV,OAAQ,OAAO,SAAS,WAAa,QAAA,CACtC,EACA,MAAM,IAAM,CAEb,CAAC,EAGH,SAAS,OAAS,GAAGL,CAAI,IAAIO,CAAY,qBAAqBF,CAAM,iBAAiBC,CAAM,EAE/F,CAEA,SAASE,EAAaR,EAAoB,CACpC,OAAO,SAAa,MAGpB,gBAAiB,OAEnB,OAAO,YAAY,OAAOA,CAAI,EAAE,MAAM,IAAM,CAE5C,CAAC,EAGD,SAAS,OAAS,GAAGA,CAAI,uBAE7B,CAEO,SAASS,GAA+C,CAC7D,GAAI,CACF,MAAMC,EAAcX,EAAUD,CAA6B,EAC3D,GAAI,CAACY,EACH,OAAO,KAGT,MAAMC,EAAU,KAAK,MAAMD,CAAW,EAGtC,OAAI,OAAOC,EAAQ,WAAc,WAC/BA,EAAQ,UAAY,IAAI,KAAKA,EAAQ,SAAS,GAK9C,KAAK,IAAA,EAAQA,EAAQ,UAAU,UAC/Bd,EAAiB,iBAEA,KAAOc,CAC5B,OAASC,EAAO,CACd,eAAQ,MAAM,mCAAoCA,CAAK,EAChD,IACT,CACF,CAEO,SAASC,EAAoBF,EAAiC,CACnER,EACEL,EACA,KAAK,UAAUa,CAAO,EACtBd,EAAiB,gBAAA,CAErB,CAEO,SAASiB,GAA8B,CAC5CN,EAAaV,CAA6B,CAC5C,CClGO,MAAMiB,EAAc,CACzB,UAAW,CAAC,UAAW,WAAW,CACpC"}