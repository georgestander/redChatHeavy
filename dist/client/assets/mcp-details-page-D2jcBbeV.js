import{r as f,j as e}from"./client-BXVv_YeC.js";import{u as N}from"./useQuery-DtNLQT6k.js";import{u as W}from"./QueryClientProvider-BboFp7b3.js";import{u as P}from"./useMutation-BU4p8oK4.js";import{t as h}from"./index-BMGOATel.js";import F from"./link-WNlkKt4p.js";import{B as C}from"./button-BvmNNHkl.js";import{C as L,L as X,W as J}from"./label-1ycYdh1s.js";import{S as V}from"./scroll-area-DLgGIp4C.js";import{S as _}from"./index-C-kxXg33.js";import{S as Y,F as Z}from"./switch-7fStXT0_.js";import{u as I,a as ee}from"./use-navigation-QuPGD7m8.js";import{m,e as se,a as te,l as re,f as ne,b as ae,t as ie}from"./get-google-favicon-url-Bedu1OEO.js";import{useSession as oe}from"./session-provider-DBOweKPF.js";import{C as ce,M as le}from"./mcp-connect-dialog-CB7DmmcD.js";import{SettingsPageContent as S}from"./settings-page-BL_H9J7T.js";import{c as K}from"./createLucideIcon-CqP9863P.js";import{T as ue,L as me}from"./trash-2-DP4m9RAL.js";import"./query-Cv3hDNY5.js";import"./mutation-DaBpc3iQ.js";import"./index-C_VP89m5.js";import"./index-B4KKYCLu.js";import"./utils-D-FPgC8r.js";import"./index-CWLAyDMs.js";import"./index-DhI-dh9t.js";import"./index-B4ZZijhN.js";import"./index-D3le2-Ql.js";import"./auth-client-NCEzhzlD.js";import"./dialog-BVCtBu-i.js";import"./config-DrLGYCgI.js";const de=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"M8 11h8",key:"vwpz6n"}],["path",{d:"M8 7h6",key:"1f0q6e"}]],xe=K("book-text",de);const fe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],T=K("circle-alert",fe),pe=/HTTP (\d{3})/;function he(t){const s=t.match(pe);if(s){const n=s[1];return n==="502"?"MCP server is temporarily unavailable (502 Bad Gateway)":n==="503"?"MCP server is temporarily unavailable (503 Service Unavailable)":n==="504"?"MCP server timed out (504 Gateway Timeout)":n==="500"?"MCP server encountered an internal error (500)":n==="401"||n==="403"?"Authentication failed. Try reconnecting.":`MCP server returned HTTP ${n}`}return t.length>200?`${t.slice(0,200)}...`:t}function Xe({connectorId:t}){const s=W(),n=ee(),l=I(),{data:d}=oe(),x=!!d?.user,[b,y]=f.useState(!1),a=m.list,{data:u,isLoading:B}=N({queryKey:m.list,queryFn:re,enabled:x}),r=f.useMemo(()=>u?.find(i=>i.id===t)??null,[u,t]),z=r?.userId!==null,{mutate:E}=P({mutationFn:se,onMutate:async i=>{await s.cancelQueries({queryKey:a});const c=s.getQueryData(a);return s.setQueryData(a,o=>o&&o.map(p=>p.id===i.id?{...p,enabled:i.enabled}:p)),{prev:c}},onError:(i,c,o)=>{s.setQueryData(a,o?.prev),h.error("Failed to update connector")},onSettled:()=>{s.invalidateQueries({queryKey:a})}}),{mutate:q}=P({mutationFn:te,onMutate:async i=>{await s.cancelQueries({queryKey:a});const c=s.getQueryData(a);return s.setQueryData(a,o=>o&&o.filter(p=>p.id!==i.id)),{prev:c}},onError:(i,c,o)=>{s.setQueryData(a,o?.prev),h.error("Failed to uninstall connector")},onSuccess:()=>{h.success("Connector uninstalled"),n.push("/settings/connectors")},onSettled:()=>{s.invalidateQueries({queryKey:a})}}),{data:w,isLoading:H,error:A,refetch:j}=N({queryKey:m.discover(t),queryFn:()=>ne({id:t}),enabled:x&&r!==null,retry:!1}),{data:$}=N({queryKey:m.checkAuth(t),queryFn:()=>ae({id:t}),enabled:x&&r!==null,staleTime:3e4}),{data:Q}=N({queryKey:m.testConnection(t),queryFn:()=>ie({id:t}),enabled:x&&r!==null,staleTime:3e4,retry:!1}),v=$?.isAuthenticated??!1,k=Q?.status==="incompatible",D=A instanceof Error?A.message:null,g=D?.includes("OAuth authorization")??!1;f.useEffect(()=>{const i=l.get("connected"),c=l.get("error");i&&h.success("Authorization successful"),c&&h.error(c),(i||c)&&(n.replace(`/settings/connectors/${t}`),s.invalidateQueries({queryKey:m.checkAuth(t)}),s.invalidateQueries({queryKey:m.discover(t)}),j())},[t,s,j,n,l]),f.useEffect(()=>{r&&v&&(s.invalidateQueries({queryKey:m.discover(r.id)}),j())},[r,v,s,j]);const O=f.useCallback(i=>{r&&E({id:r.id,enabled:i})},[r,E]),R=f.useCallback(()=>{r&&q({id:r.id})},[r,q]);if(B)return e.jsx(S,{className:"gap-4",children:e.jsx("div",{className:"animate-pulse space-y-3",children:[1,2].map(i=>e.jsx("div",{className:"h-20 rounded-lg bg-muted/50"},i))})});if(!r)return e.jsxs(S,{className:"gap-4",children:[e.jsx(C,{asChild:!0,className:"w-fit",size:"sm",variant:"ghost",children:e.jsxs(F,{href:"/settings/connectors",children:[e.jsx(L,{className:"size-4"}),"Back"]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(T,{className:"size-6 text-destructive"}),e.jsx("p",{className:"mt-2 font-medium text-sm",children:"Connector not found"}),e.jsx("p",{className:"mt-1 text-muted-foreground text-xs",children:"It may have been deleted or you donâ€™t have access."})]})]});const U=g&&!v&&!k,G=w&&!g&&!k;return e.jsxs(S,{className:"gap-4",children:[e.jsx(C,{asChild:!0,className:"w-fit",size:"sm",variant:"ghost",children:e.jsxs(F,{href:"/settings/connectors",children:[e.jsx(L,{className:"size-4"}),"Back"]})}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx(ce,{isCustom:r.userId!==null,name:r.name,type:r.type,url:r.url}),e.jsxs("div",{className:"flex shrink-0 items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{checked:r.enabled,disabled:!z,id:"connector-enabled",onCheckedChange:O}),e.jsx(X,{className:"text-muted-foreground text-xs",htmlFor:"connector-enabled",children:"Enabled"})]}),z?e.jsxs(C,{onClick:R,size:"sm",variant:"destructive",children:[e.jsx(ue,{className:"size-4"}),"Uninstall"]}):null]})]}),e.jsx(_,{className:"my-2"}),e.jsx(ye,{connectionError:Q?.error,discovery:w??null,discoveryError:D,isIncompatible:k,isLoading:g&&v||H,needsOAuth:g,onConnect:()=>y(!0),showConnectButton:U,showDiscovery:G??!1}),e.jsx(le,{connector:r,onClose:()=>y(!1),open:b})]})}function ye({isLoading:t,showConnectButton:s,onConnect:n,isIncompatible:l,connectionError:d,discoveryError:x,needsOAuth:b,showDiscovery:y,discovery:a}){return t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{className:"size-6 animate-spin text-muted-foreground"})}):s?e.jsxs("div",{className:"flex flex-col items-center gap-4 py-12 text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:"Authorization required"}),e.jsx("p",{className:"max-w-xs text-muted-foreground text-xs",children:"Connect this connector to access its tools and resources."}),e.jsx(C,{onClick:n,children:"Connect"})]}):l?e.jsxs("div",{className:"flex flex-col items-center gap-2 py-12 text-center",children:[e.jsx(T,{className:"size-6 text-destructive"}),e.jsx("p",{className:"font-medium text-sm",children:"Incompatible server"}),e.jsx("p",{className:"max-w-xs text-muted-foreground text-xs",children:d??"This server requires pre-configured OAuth credentials."})]}):x&&!b?e.jsxs("div",{className:"flex flex-col items-center gap-2 py-12 text-center",children:[e.jsx(T,{className:"size-6 text-destructive"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Failed to connect to MCP server"}),e.jsx("p",{className:"max-w-xs text-muted-foreground text-xs",children:he(x)})]}):y&&a?e.jsx(V,{className:"max-h-[60vh]",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(M,{icon:e.jsx(J,{className:"size-4"}),items:a.tools.map(u=>u.name),title:"Tools"}),e.jsx(M,{icon:e.jsx(Z,{className:"size-4"}),items:a.resources.map(u=>u.name),title:"Resources"}),e.jsx(M,{icon:e.jsx(xe,{className:"size-4"}),items:a.prompts.map(u=>u.name),title:"Prompts"})]})}):null}function M({title:t,icon:s,items:n}){const l=n.length;return e.jsxs("div",{className:"rounded-lg border bg-card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:s}),e.jsx("span",{className:"font-medium text-sm",children:t}),e.jsxs("span",{className:"text-muted-foreground text-xs",children:["(",l,")"]})]}),e.jsx(_,{className:"my-3"}),l===0?e.jsx("p",{className:"text-muted-foreground text-xs italic",children:"None available"}):e.jsx("div",{className:"flex flex-wrap gap-1.5",children:n.map(d=>e.jsx("span",{className:"rounded-md bg-muted px-2 py-1 font-mono text-xs",title:d,children:d},d))})]})}export{Xe as McpDetailsPage};
//# sourceMappingURL=mcp-details-page-D2jcBbeV.js.map
