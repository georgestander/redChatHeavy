{"version":3,"file":"session-provider-DBOweKPF.js","sources":["../../../providers/session-provider.tsx"],"sourcesContent":["\"use client\";\n\nimport { createContext, useContext, useMemo } from \"react\";\nimport type { Session } from \"@/lib/auth\";\nimport authClient from \"@/lib/auth-client\";\n\ntype SessionContextValue = {\n  data: Session | null;\n  isPending: boolean;\n};\n\nconst SessionContext = createContext<SessionContextValue | undefined>(\n  undefined\n);\n\nexport function SessionProvider({\n  initialSession,\n  children,\n}: {\n  initialSession?: Session | null;\n  children: React.ReactNode;\n}) {\n  const { data: clientSession, isPending } = authClient.useSession();\n  const serverSession = initialSession ?? null;\n\n  const value = useMemo<SessionContextValue>(() => {\n    // Prefer server session as a fallback even after the client hook settles.\n    // This avoids \"split brain\" when client session fetch is blocked/misconfigured\n    // (e.g. trustedOrigins mismatch) but the server can still read the cookies.\n    const effective = isPending\n      ? (serverSession ?? clientSession)\n      : (clientSession ?? serverSession);\n    return { data: effective, isPending };\n  }, [clientSession, serverSession, isPending]);\n\n  return (\n    <SessionContext.Provider value={value}>{children}</SessionContext.Provider>\n  );\n}\n\nexport function useSession(): SessionContextValue {\n  const ctx = useContext(SessionContext);\n  if (!ctx) {\n    throw new Error(\"useSession must be used within a SessionProvider\");\n  }\n  return ctx;\n}\n"],"names":["SessionContext","createContext","SessionProvider","initialSession","children","clientSession","isPending","authClient","serverSession","value","useMemo","jsx","useSession","ctx","useContext"],"mappings":"yFAWA,MAAMA,EAAiBC,EAAAA,cACrB,MACF,EAEO,SAASC,EAAgB,CAC9B,eAAAC,EACA,SAAAC,CACF,EAGG,CACD,KAAM,CAAE,KAAMC,EAAe,UAAAC,CAAA,EAAcC,EAAW,WAAA,EAChDC,EAAgBL,GAAkB,KAElCM,EAAQC,EAAAA,QAA6B,KAOlC,CAAE,KAHSJ,EACbE,GAAiBH,EACjBA,GAAiBG,EACI,UAAAF,CAAA,GACzB,CAACD,EAAeG,EAAeF,CAAS,CAAC,EAE5C,OACEK,EAAAA,IAACX,EAAe,SAAf,CAAwB,MAAAS,EAAe,SAAAL,CAAA,CAAS,CAErD,CAEO,SAASQ,GAAkC,CAChD,MAAMC,EAAMC,EAAAA,WAAWd,CAAc,EACrC,GAAI,CAACa,EACH,MAAM,IAAI,MAAM,kDAAkD,EAEpE,OAAOA,CACT"}