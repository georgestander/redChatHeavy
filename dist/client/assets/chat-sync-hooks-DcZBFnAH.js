import{c,u as v}from"./useQuery-DtNLQT6k.js";import{u as y}from"./QueryClientProvider-BboFp7b3.js";import{u as h}from"./useMutation-BU4p8oK4.js";import{r as S}from"./client-BXVv_YeC.js";import{t as C}from"./index-BMGOATel.js";import{A as I,a as K,g as w}from"./credits-C6GN1dxI.js";import{u as Q}from"./chat-id-provider-BiTIqLva.js";import{useSession as d}from"./session-provider-DBOweKPF.js";const l={allChats:e=>["chat","allChats",{projectId:e??null}],byId:e=>["chat","byId",e],messages:e=>["chat","messages",e],publicChat:e=>["chat","publicChat",e],publicMessages:e=>["chat","publicMessages",e]},p={byMessageId:e=>["document","byMessageId",e],publicByMessageId:e=>["document","publicByMessageId",e]},f={list:["project","list"],byId:e=>["project","byId",e]};let F=c("/src/server/actions/chat.ts","getAllChats"),P=c("/src/server/actions/chat.ts","getChatById"),_=c("/src/server/actions/chat.ts","getChatMessages"),E=c("/src/server/actions/chat.ts","renameChat");c("/src/server/actions/chat.ts","deleteTrailingMessages");let se=c("/src/server/actions/chat.ts","stopStream"),B=c("/src/server/actions/chat.ts","setVisibility"),j=c("/src/server/actions/chat.ts","setIsPinned"),k=c("/src/server/actions/chat.ts","deleteChat");c("/src/server/actions/chat.ts","generateTitle");let ae=c("/src/server/actions/chat.ts","getPublicChat"),T=c("/src/server/actions/chat.ts","getPublicChatMessages"),x=c("/src/server/actions/chat.ts","cloneSharedChat"),O=c("/src/server/actions/credits.ts","getAvailableCredits"),R=c("/src/server/actions/document.ts","getDocuments"),G=c("/src/server/actions/document.ts","getPublicDocuments"),N=c("/src/server/actions/document.ts","saveDocument"),re=c("/src/server/actions/project.ts","list"),ne=c("/src/server/actions/project.ts","create"),L=c("/src/server/actions/project.ts","getById"),U=c("/src/server/actions/project.ts","update"),ie=c("/src/server/actions/project.ts","setInstructions"),oe=c("/src/server/actions/project.ts","remove");const D=["anonymousCredits"];function M(e){return{...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}}function V(e){return{...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}}function Y(e){return{...e,metadata:{...e.metadata,createdAt:e.metadata.createdAt instanceof Date?e.metadata.createdAt:new Date(e.metadata.createdAt)}}}function b(e,s){return e.getQueriesData({queryKey:s})}function A(e,s){for(const[t,a]of s)e.setQueryData(t,a)}function q(e,s,t){const a=e.getQueriesData({queryKey:s});for(const[n]of a)e.setQueryData(n,t)}function ce(e,{enabled:s}={}){const{data:t}=d();return v({queryKey:f.byId(e??""),queryFn:async()=>{const a=await L({id:e??""});return V(a)},enabled:(s??!0)&&!!t?.user&&!!e})}function ue(){const{data:e}=d(),{id:s,isPersisted:t,source:a}=Q(),n=a==="share";return{queryKey:n?l.publicMessages(s||""):l.messages(s||""),queryFn:async()=>(n?await T({chatId:s||""}):await _({chatId:s||""})).map(Y),enabled:!!s&&t&&(n||!!e?.user)}}function le(){const{data:e}=d(),s=!!e?.user,t=y(),a=l.allChats(null).slice(0,2),n=h({mutationFn:({chatId:r})=>k({chatId:r}),onMutate:async({chatId:r})=>{if(!s)return{previousAllChats:void 0};const u=b(t,a);return await t.cancelQueries({queryKey:a,exact:!1}),q(t,a,i=>i?.filter(m=>m.id!==r)??i),{previousAllChats:u}},onError:(r,u,i)=>{i?.previousAllChats&&A(t,i.previousAllChats)},onSettled:()=>{t.invalidateQueries({queryKey:a,exact:!1})}});return{deleteChat:S.useCallback(async(r,u)=>{if(s)try{await n.mutateAsync({chatId:r}),u?.onSuccess?.()}catch(i){const m=i instanceof Error?i:new Error("Unknown error");throw u?.onError?.(m),m}},[n,s])}}function de(){const{data:e}=d(),s=!!e?.user,t=y(),a=l.allChats(null).slice(0,2);return h({mutationFn:({chatId:n,title:o})=>E({chatId:n,title:o}),onMutate:async({chatId:n,title:o})=>{if(!s)return{previousAllChats:void 0,previousChatById:void 0};const r=l.byId(n);await Promise.all([t.cancelQueries({queryKey:a,exact:!1}),t.cancelQueries({queryKey:r})]);const u=b(t,a),i=t.getQueryData(r);return q(t,a,m=>m?.map(g=>g.id===n?{...g,title:o}:g)??m),i&&t.setQueryData(r,{...i,title:o}),{previousAllChats:u,previousChatById:i}},onError:(n,{chatId:o},r)=>{r?.previousAllChats&&A(t,r.previousAllChats),r?.previousChatById!==void 0&&t.setQueryData(l.byId(o),r.previousChatById??void 0),C.error("Failed to rename chat")},onSettled:async(n,o,{chatId:r})=>{await Promise.all([t.invalidateQueries({queryKey:a,exact:!1}),t.invalidateQueries({queryKey:l.byId(r)})])}})}function ye(){const e=y();return h({mutationFn:s=>U({id:s.id,updates:s.updates}),onMutate:async s=>{const t=f.list;await e.cancelQueries({queryKey:t});const a=e.getQueryData(t),n=typeof s.updates.name=="string"?s.updates.name:void 0;return n&&e.setQueryData(t,o=>o?.map(r=>r.id===s.id?{...r,name:n}:r)),{previous:a}},onError:(s,t,a)=>{a?.previous&&e.setQueryData(f.list,a.previous),C.error("Failed to rename project")},onSuccess:()=>C.success("Project renamed"),onSettled:()=>e.invalidateQueries({queryKey:f.list})})}function he(){const{data:e}=d(),s=!!e?.user,t=y(),a=l.allChats(null).slice(0,2);return h({mutationFn:({chatId:n,isPinned:o})=>j({chatId:n,isPinned:o}),onMutate:async({chatId:n,isPinned:o})=>{if(!s)return{previousAllChats:void 0};const r=b(t,a);return await t.cancelQueries({queryKey:a,exact:!1}),q(t,a,u=>u?.map(i=>i.id===n?{...i,isPinned:o}:i)??u),{previousAllChats:r}},onError:(n,o,r)=>{r?.previousAllChats&&A(t,r.previousAllChats),C.error("Failed to pin chat")},onSettled:async(n,o,{chatId:r})=>{await Promise.all([t.invalidateQueries({queryKey:a,exact:!1}),t.invalidateQueries({queryKey:l.byId(r)})])}})}function me(){const e=y(),s=l.allChats(null).slice(0,2);return h({mutationFn:({chatId:t})=>x({chatId:t}),onSettled:()=>e.refetchQueries({queryKey:s,exact:!1}),onError:t=>console.error("Failed to copy chat:",t)})}function ve(){const{data:e}=d(),s=!!e?.user,t=y(),a=l.allChats(null).slice(0,2);return h({mutationFn:n=>Promise.resolve({success:!0}),onMutate:async({message:n,chatId:o})=>{const r=l.messages(o);await t.cancelQueries({queryKey:r});const u=t.getQueryData(r);return t.setQueryData(r,i=>i?[...i,n]:[n]),{previousMessages:u,chatId:o}},onSuccess:async(n,{message:o,chatId:r})=>{o.role==="assistant"&&(s?(t.invalidateQueries({queryKey:K.available}),await Promise.all([t.invalidateQueries({queryKey:a,exact:!1}),t.invalidateQueries({queryKey:l.byId(r)})])):t.invalidateQueries({queryKey:D}))}})}function Ce(){const e=y(),s=l.allChats(null).slice(0,2);return h({mutationFn:({chatId:t,visibility:a})=>B({chatId:t,visibility:a}),onError:()=>C.error("Failed to update chat visibility"),onSettled:()=>e.invalidateQueries({queryKey:s,exact:!1}),onSuccess:(t,{visibility:a})=>{C.success(a==="public"?"Chat is now public - anyone with the link can access it":"Chat is now private - only you can access it")}})}function pe(e,s,t){const a=y(),{data:n}=d(),o=n?.user?.id;return h({mutationFn:N,onMutate:async r=>{const u=p.byMessageId(r.id);await a.cancelQueries({queryKey:u});const i=a.getQueryData(u)??[];return a.setQueryData(u,[...i,{id:r.id,createdAt:new Date,title:r.title,content:r.content,kind:r.kind,userId:o||"",messageId:s}]),{previousDocuments:i}},onError:(r,u,i)=>{i?.previousDocuments&&a.setQueryData(p.byMessageId(u.id),i.previousDocuments)},onSettled:(r,u,i)=>{a.invalidateQueries({queryKey:p.byMessageId(i.id)}),t?.onSettled?.(r,u,i)}})}function fe(e,s){const{source:t}=Q(),a=t==="share",{data:n}=d();return v({queryKey:a?p.publicByMessageId(e):p.byMessageId(e),queryFn:()=>a?G({id:e}):R({id:e}),enabled:!s&&!!e&&(a||!!n?.user)})}function ge(e){const{data:s}=d(),{projectId:t,limit:a}=e??{};return v({queryKey:l.allChats(t??null),queryFn:async()=>(await F({projectId:t??null})).map(M),enabled:!!s?.user,select:a?n=>n.slice(0,a):void 0})}function H(e){const{data:s}=d();return{queryKey:l.byId(e),queryFn:async()=>{const t=await P({chatId:e});return M(t)},enabled:!!e&&!!s?.user}}function be(e,{enabled:s}={}){const t=H(e);return v({...t,enabled:(s??!0)&&(t.enabled??!0)})}function Ae(){const{data:e}=d(),s=!!e?.user,{data:t,isLoading:a}=v({queryKey:K.available,queryFn:O,enabled:s}),{data:n}=v({queryKey:D,queryFn:()=>w()?.remainingCredits??I.CREDITS,enabled:!s,staleTime:0});return s?{credits:t?.credits,isLoadingCredits:a}:{credits:n??I.CREDITS,isLoadingCredits:!1}}export{de as a,he as b,ye as c,ne as d,Ae as e,H as f,L as g,ue as h,ae as i,l as j,T as k,re as l,be as m,ce as n,me as o,f as p,_ as q,oe as r,fe as s,ve as t,ge as u,se as v,le as w,ie as x,pe as y,Ce as z};
//# sourceMappingURL=chat-sync-hooks-DcZBFnAH.js.map
