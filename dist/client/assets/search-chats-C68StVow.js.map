{"version":3,"file":"search-chats-C68StVow.js","sources":["../../../components/search-chats-dialog.tsx","../../../components/search-chats.tsx"],"sourcesContent":["\"use client\";\n\nimport { isToday, isYesterday, subMonths, subWeeks } from \"date-fns\";\nimport { MessageSquare } from \"lucide-react\";\nimport { memo, useCallback, useDeferredValue, useMemo, useState } from \"react\";\n\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useGetAllChats } from \"@/hooks/chat-sync-hooks\";\nimport type { UIChat } from \"@/lib/types/ui-chat\";\n\ntype GroupedChats = {\n  today: UIChat[];\n  yesterday: UIChat[];\n  lastWeek: UIChat[];\n  lastMonth: UIChat[];\n  older: UIChat[];\n};\n\nconst groupChatsByDate = (chats: UIChat[]): GroupedChats => {\n  const now = new Date();\n  const oneWeekAgo = subWeeks(now, 1);\n  const oneMonthAgo = subMonths(now, 1);\n\n  return chats.reduce(\n    (groups, chat) => {\n      const chatDate = new Date(chat.createdAt);\n\n      if (isToday(chatDate)) {\n        groups.today.push(chat);\n      } else if (isYesterday(chatDate)) {\n        groups.yesterday.push(chat);\n      } else if (chatDate > oneWeekAgo) {\n        groups.lastWeek.push(chat);\n      } else if (chatDate > oneMonthAgo) {\n        groups.lastMonth.push(chat);\n      } else {\n        groups.older.push(chat);\n      }\n\n      return groups;\n    },\n    {\n      today: [],\n      yesterday: [],\n      lastWeek: [],\n      lastMonth: [],\n      older: [],\n    } as GroupedChats\n  );\n};\n\nconst filterChats = (chats: UIChat[], query: string): UIChat[] => {\n  if (!query.trim()) {\n    return chats;\n  }\n  const lowerQuery = query.toLowerCase();\n  return chats.filter((chat) => chat.title.toLowerCase().includes(lowerQuery));\n};\n\ntype SearchChatsListProps = {\n  onSelectChat: (chatId: string) => void;\n  deferredQuery: string;\n};\n\nconst SearchChatsList = memo(function SearchChatsListInner({\n  onSelectChat,\n  deferredQuery,\n}: SearchChatsListProps) {\n  const { data: chats, isLoading } = useGetAllChats();\n\n  const groupedChats = useMemo(() => {\n    if (!chats) {\n      return null;\n    }\n    const filteredChats = filterChats(chats, deferredQuery);\n    return groupChatsByDate(filteredChats);\n  }, [chats, deferredQuery]);\n\n  const renderChatGroup = (\n    groupChats: UIChat[],\n    groupName: string,\n    key: string\n  ) => {\n    if (groupChats.length === 0) {\n      return null;\n    }\n\n    return (\n      <CommandGroup heading={groupName} key={key}>\n        {groupChats.map((chat) => (\n          <CommandItem\n            className=\"flex cursor-pointer items-center gap-2 p-2\"\n            key={chat.id}\n            onSelect={() => onSelectChat(chat.id)}\n            value={chat.id}\n          >\n            <MessageSquare className=\"h-4 w-4 text-muted-foreground\" />\n            <div className=\"flex min-w-0 flex-1 flex-col\">\n              <span className=\"truncate font-medium\">{chat.title}</span>\n            </div>\n          </CommandItem>\n        ))}\n      </CommandGroup>\n    );\n  };\n\n  const hasResults =\n    groupedChats &&\n    (groupedChats.today.length > 0 ||\n      groupedChats.yesterday.length > 0 ||\n      groupedChats.lastWeek.length > 0 ||\n      groupedChats.lastMonth.length > 0 ||\n      groupedChats.older.length > 0);\n\n  return (\n    <>\n      {!hasResults && (\n        <CommandEmpty>\n          {isLoading ? \"Loading chats...\" : \"No chats found.\"}\n        </CommandEmpty>\n      )}\n\n      {groupedChats && (\n        <>\n          {renderChatGroup(groupedChats.today, \"Today\", \"today\")}\n          {renderChatGroup(groupedChats.yesterday, \"Yesterday\", \"yesterday\")}\n          {renderChatGroup(groupedChats.lastWeek, \"Last 7 days\", \"lastWeek\")}\n          {renderChatGroup(groupedChats.lastMonth, \"Last 30 days\", \"lastMonth\")}\n          {renderChatGroup(groupedChats.older, \"Older\", \"older\")}\n        </>\n      )}\n    </>\n  );\n});\n\ntype SearchChatsDialogProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSelectChat: () => void;\n};\n\nexport function SearchChatsDialog({\n  open,\n  onOpenChange,\n  onSelectChat,\n}: SearchChatsDialogProps) {\n  const [query, setQuery] = useState(\"\");\n  const deferredQuery = useDeferredValue(query);\n\n  const handleSelectChat = useCallback(\n    (chatId: string) => {\n      onOpenChange(false);\n      onSelectChat();\n      setQuery(\"\");\n      window.history.pushState(null, \"\", `/chat/${chatId}`);\n    },\n    [onOpenChange, onSelectChat]\n  );\n\n  const handleOpenChange = useCallback(\n    (newOpen: boolean) => {\n      onOpenChange(newOpen);\n      if (!newOpen) {\n        setQuery(\"\");\n      }\n    },\n    [onOpenChange]\n  );\n\n  return (\n    <Dialog onOpenChange={handleOpenChange} open={open}>\n      <DialogHeader className=\"sr-only\">\n        <DialogTitle>Search Chats</DialogTitle>\n        <DialogDescription>Search through your chat history</DialogDescription>\n      </DialogHeader>\n      <DialogContent className=\"overflow-hidden p-0\" showCloseButton={false}>\n        <Command\n          className=\"**:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\"\n          shouldFilter={false}\n        >\n          <CommandInput\n            onValueChange={setQuery}\n            placeholder=\"Search your chats...\"\n            value={query}\n          />\n          <CommandList>\n            {open && (\n              <SearchChatsList\n                deferredQuery={deferredQuery}\n                onSelectChat={handleSelectChat}\n              />\n            )}\n          </CommandList>\n        </Command>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","\"use client\";\n\nimport { SearchIcon } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { useSidebar } from \"@/components/ui/sidebar\";\nimport { SearchChatsDialog } from \"./search-chats-dialog\";\nimport { SidebarMenuButton } from \"./ui/sidebar\";\n\n// Helper function to get platform-specific shortcut text\nfunction getSearchShortcutText() {\n  if (typeof window === \"undefined\") {\n    return \"Ctrl+K\";\n  }\n\n  const isMac = navigator.platform.toUpperCase().indexOf(\"MAC\") >= 0;\n  return isMac ? \"Cmd+K\" : \"Ctrl+K\";\n}\n\nexport function SearchChatsButton() {\n  const [open, setOpen] = useState(false);\n  const { setOpenMobile } = useSidebar();\n  const [shortcutText, setShortcutText] = useState(\"Ctrl+K\");\n\n  // Update shortcut text on mount\n  useEffect(() => {\n    setShortcutText(getSearchShortcutText());\n  }, []);\n\n  // Global keyboard shortcut\n  useEffect(() => {\n    const down = (e: KeyboardEvent) => {\n      if (e.key === \"k\" && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault();\n        setOpen((isOpen) => !isOpen);\n      }\n    };\n\n    document.addEventListener(\"keydown\", down);\n    return () => document.removeEventListener(\"keydown\", down);\n  }, []);\n\n  return (\n    <>\n      <SidebarMenuButton\n        className=\"w-full justify-start\"\n        onClick={() => setOpen(true)}\n        tooltip=\"Search chats\"\n      >\n        <SearchIcon className=\"h-4 w-4\" />\n        <span>Search chats</span>\n        <span className=\"ml-auto text-muted-foreground text-xs\">\n          {shortcutText}\n        </span>\n      </SidebarMenuButton>\n\n      {open && (\n        <SearchChatsDialog\n          onOpenChange={setOpen}\n          onSelectChat={() => setOpenMobile(false)}\n          open={open}\n        />\n      )}\n    </>\n  );\n}\n"],"names":["groupChatsByDate","chats","now","oneWeekAgo","subWeeks","oneMonthAgo","subMonths","groups","chat","chatDate","isToday","isYesterday","filterChats","query","lowerQuery","SearchChatsList","memo","onSelectChat","deferredQuery","isLoading","useGetAllChats","groupedChats","useMemo","filteredChats","renderChatGroup","groupChats","groupName","key","CommandGroup","jsxs","CommandItem","jsx","MessageSquare","hasResults","Fragment","CommandEmpty","SearchChatsDialog","open","onOpenChange","setQuery","useState","useDeferredValue","handleSelectChat","useCallback","chatId","handleOpenChange","newOpen","Dialog","DialogHeader","DialogTitle","DialogDescription","DialogContent","Command","CommandInput","CommandList","getSearchShortcutText","SearchChatsButton","setOpen","setOpenMobile","useSidebar","shortcutText","setShortcutText","useEffect","down","e","isOpen","SidebarMenuButton","SearchIcon"],"mappings":"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"}