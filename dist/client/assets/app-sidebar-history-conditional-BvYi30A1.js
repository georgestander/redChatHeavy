import{r as p,j as e}from"./client-BXVv_YeC.js";import k from"./link-WNlkKt4p.js";import{S as F,a as E,b as $,u as R,c as J,d as I,e as O,f as A,g as K}from"./sidebar-C0WHgcyX.js";import{useSession as z}from"./session-provider-DBOweKPF.js";import{u as U,a as X,b as ee,r as te,p as M,c as se,d as ne,l as re}from"./chat-sync-hooks-DcZBFnAH.js";import{a as w,b as L}from"./use-navigation-QuPGD7m8.js";import{p as q}from"./chat-id-provider-BiTIqLva.js";import{C as ie,S as ae,D as oe,A as le,a as de,b as ce,c as ue,d as me,e as he,f as pe,g as xe,P as fe,h as je,i as W}from"./project-details-dialog-CdFBmXpU.js";import{t as N}from"./index-BMGOATel.js";import{D as B,a as G,b as Q,c as H}from"./dropdown-menu-DLPkoSE_.js";import{I as ge}from"./input-CaNkDFJs.js";import{E as _}from"./ellipsis-jqpQO7ZS.js";import{s as ye,a as be,i as De,b as Ce}from"./subWeeks-Be4u23cY.js";import{u as Se}from"./useQuery-DtNLQT6k.js";import{u as Y}from"./QueryClientProvider-BboFp7b3.js";import{u as V}from"./useMutation-BU4p8oK4.js";import{T as ve}from"./trash-2-DP4m9RAL.js";import{c as Pe}from"./createLucideIcon-CqP9863P.js";import{B as we}from"./button-BvmNNHkl.js";import{c as S}from"./utils-D-FPgC8r.js";import{L as Ie}from"./log-in-D92fC-_M.js";import"./index-C-kxXg33.js";import"./index-C_VP89m5.js";import"./index-CWLAyDMs.js";import"./index-B4KKYCLu.js";import"./index-B4ZZijhN.js";import"./index-ClCXh67x.js";import"./auth-client-NCEzhzlD.js";import"./credits-C6GN1dxI.js";import"./config-DrLGYCgI.js";import"./dialog-BVCtBu-i.js";import"./zap-Ctw7Kofj.js";import"./index-DhI-dh9t.js";import"./startOfDay-DFs_GiEJ.js";import"./query-Cv3hDNY5.js";import"./mutation-DaBpc3iQ.js";const Ae=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Me=Pe("folder-plus",Ae),Ne=({chat:t,isActive:r,onDelete:x,onRename:c,onPin:l,setOpenMobile:m,prefetch:j=!1})=>{const d=t.projectId?`/project/${t.projectId}/chat/${t.id}`:`/chat/${t.id}`,y=w(),[h,u]=p.useState(!1),[a,i]=p.useState(t.title),[v,C]=p.useState(!1),g=async()=>{if(a.trim()===""||a===t.title){u(!1),i(t.title);return}try{await c(t.id,a.trim()),u(!1),N.success("Chat renamed successfully")}catch{i(t.title),u(!1)}},n=s=>{s.key==="Enter"?g():s.key==="Escape"&&(u(!1),i(t.title))};return e.jsxs(F,{children:[h?e.jsx("div",{className:"flex w-full items-center gap-2 overflow-hidden rounded-md bg-background p-2 text-left text-sm",children:e.jsx(ge,{autoFocus:!0,className:"h-auto border-0 bg-transparent p-0 text-sm focus-visible:ring-0 focus-visible:ring-offset-0",maxLength:255,onBlur:g,onChange:s=>i(s.target.value),onKeyDown:n,value:a})}):e.jsx(E,{asChild:!0,isActive:r,children:e.jsx(k,{href:d,onClick:s=>{s.button===1||s.ctrlKey||s.metaKey||(s.preventDefault(),y.push(d),m(!1))},prefetch:j,children:e.jsx("span",{children:t.title})})}),e.jsxs(B,{modal:!0,children:[e.jsx(G,{asChild:!0,children:e.jsxs($,{className:"mr-0.5 data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",showOnHover:!r,children:[e.jsx(_,{size:16}),e.jsx("span",{className:"sr-only",children:"More"})]})}),e.jsx(Q,{align:"end",side:"bottom",children:e.jsx(ie,{isPinned:t.isPinned,onDelete:()=>x(t.id),onRename:()=>{u(!0),i(t.title)},onShare:()=>C(!0),onTogglePin:()=>l(t.id,!t.isPinned)})})]}),v&&e.jsx(ae,{chatId:t.id,onOpenChange:C,open:v})]})},D=p.memo(Ne,(t,r)=>!(t.isActive!==r.isActive||t.prefetch!==r.prefetch||t.chat.id!==r.chat.id||t.chat.title!==r.chat.title||t.chat.isPinned!==r.chat.isPinned));function ke(){const t=L(),{data:r,isLoading:x}=U({limit:50}),{setOpenMobile:c}=R(),{mutate:l}=X(),{mutate:m}=ee(),[j,d]=p.useState(null),[y,h]=p.useState(!1),u=p.useMemo(()=>r?.filter(n=>n.projectId===null)??[],[r]),a=p.useMemo(()=>q(t).id,[t]),i=p.useMemo(()=>{const n=new Date,s=ye(n),o=be(n),Z=u.filter(f=>f.isPinned),T=u.filter(f=>!f.isPinned).reduce((f,b)=>{const P=new Date(b.updatedAt);return De(P)?f.today.push(b):Ce(P)?f.yesterday.push(b):P>s?f.lastWeek.push(b):P>o?f.lastMonth.push(b):f.older.push(b),f},{pinned:[],today:[],yesterday:[],lastWeek:[],lastMonth:[],older:[]});return T.pinned=Z.sort((f,b)=>new Date(b.updatedAt).getTime()-new Date(f.updatedAt).getTime()),T},[u]);if(x)return e.jsx("div",{className:"flex flex-col",children:[44,32,28,64,52].map(n=>e.jsx("div",{className:"flex h-8 items-center gap-2 rounded-md px-2",children:e.jsx(J,{className:"h-4 flex-1",style:{width:`${n}%`}})},n))});if(u.length===0)return e.jsx("div",{className:"flex w-full flex-row items-center justify-center gap-2 px-2 py-4 text-sm text-zinc-500",children:"Start chatting to see your conversation history!"});const v=10;let C=0;const g=()=>{const n=C<v;return C+=1,n};return e.jsxs(e.Fragment,{children:[i.pinned.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Pinned"}),i.pinned.map(n=>e.jsx(D,{chat:n,isActive:n.id===a,onDelete:s=>{d(s),h(!0)},onPin:(s,o)=>{m({chatId:s,isPinned:o})},onRename:(s,o)=>{l({chatId:s,title:o})},prefetch:g(),setOpenMobile:c},n.id))]}),i.today.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`px-2 py-1 text-sidebar-foreground/50 text-xs ${i.pinned.length>0?"mt-6":""}`,children:"Today"}),i.today.map(n=>e.jsx(D,{chat:n,isActive:n.id===a,onDelete:s=>{d(s),h(!0)},onPin:(s,o)=>{m({chatId:s,isPinned:o})},onRename:(s,o)=>{l({chatId:s,title:o})},prefetch:g(),setOpenMobile:c},n.id))]}),i.yesterday.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-6 px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Yesterday"}),i.yesterday.map(n=>e.jsx(D,{chat:n,isActive:n.id===a,onDelete:s=>{d(s),h(!0)},onPin:(s,o)=>{m({chatId:s,isPinned:o})},onRename:(s,o)=>{l({chatId:s,title:o})},prefetch:g(),setOpenMobile:c},n.id))]}),i.lastWeek.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-6 px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Last 7 days"}),i.lastWeek.map(n=>e.jsx(D,{chat:n,isActive:n.id===a,onDelete:s=>{d(s),h(!0)},onPin:(s,o)=>{m({chatId:s,isPinned:o})},onRename:(s,o)=>{l({chatId:s,title:o})},prefetch:g(),setOpenMobile:c},n.id))]}),i.lastMonth.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-6 px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Last 30 days"}),i.lastMonth.map(n=>e.jsx(D,{chat:n,isActive:n.id===a,onDelete:s=>{d(s),h(!0)},onPin:(s,o)=>{m({chatId:s,isPinned:o})},onRename:(s,o)=>{l({chatId:s,title:o})},prefetch:g(),setOpenMobile:c},n.id))]}),i.older.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-6 px-2 py-1 text-sidebar-foreground/50 text-xs",children:"Older"}),i.older.map(n=>e.jsx(D,{chat:n,isActive:n.id===a,onDelete:s=>{d(s),h(!0)},onPin:(s,o)=>{m({chatId:s,isPinned:o})},onRename:(s,o)=>{l({chatId:s,title:o})},prefetch:g(),setOpenMobile:c},n.id))]}),e.jsx(oe,{deleteId:j,setShowDeleteDialog:h,showDeleteDialog:y})]})}function Fe({deleteId:t,showDeleteDialog:r,setShowDeleteDialog:x}){const c=w(),l=L(),m=Y(),j=V({mutationFn:te,onSuccess:()=>{m.invalidateQueries({queryKey:M.list}),N.success("Project deleted")},onError:()=>{N.error("Failed to delete project")}}),d=p.useCallback(async()=>{if(!t)return;try{await j.mutateAsync({id:t})}catch{}x(!1),typeof l=="string"&&(l===`/project/${t}`||l.startsWith(`/project/${t}/`))&&c.push("/")},[t,j,l,c,x]);return e.jsx(le,{onOpenChange:x,open:r,children:e.jsxs(de,{children:[e.jsxs(ce,{children:[e.jsx(ue,{children:"Delete this project?"}),e.jsx(me,{children:"This action cannot be undone. This will permanently delete the project and its associations."})]}),e.jsxs(he,{children:[e.jsx(pe,{children:"Cancel"}),e.jsx(xe,{onClick:d,children:"Delete"})]})]})})}function Ee({onRename:t,onDelete:r}){return e.jsxs(e.Fragment,{children:[e.jsxs(H,{className:"cursor-pointer",onClick:t,children:[e.jsx(fe,{size:16}),e.jsx("span",{children:"Rename"})]}),e.jsxs(H,{className:"cursor-pointer text-destructive focus:bg-destructive/15 focus:text-destructive dark:text-red-500",onSelect:r,children:[e.jsx(ve,{size:16}),e.jsx("span",{children:"Delete"})]})]})}function Re({project:t,isActive:r,setOpenMobile:x}){const[c,l]=p.useState(!1),[m,j]=p.useState(!1),d=w(),{mutateAsync:y,isPending:h}=se(),u=`/project/${t.id}`,a=async i=>{await y({id:t.id,updates:{name:i.name,icon:i.icon,iconColor:i.color}})};return e.jsxs(F,{children:[e.jsx(E,{asChild:!0,className:"cursor-pointer",isActive:r,children:e.jsxs(k,{href:u,onClick:i=>{i.button===1||i.ctrlKey||i.metaKey||(i.preventDefault(),d.push(u),x(!1))},prefetch:!1,children:[e.jsx(je,{color:t.iconColor,icon:t.icon,size:16}),e.jsx("span",{children:t.name})]})}),e.jsxs(B,{modal:!0,children:[e.jsx(G,{asChild:!0,children:e.jsxs($,{className:"mr-0.5 data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",showOnHover:!r,children:[e.jsx(_,{size:16}),e.jsx("span",{className:"sr-only",children:"More"})]})}),e.jsx(Q,{align:"end",side:"bottom",children:e.jsx(Ee,{onDelete:()=>j(!0),onRename:()=>l(!0)})})]}),e.jsx(W,{initialColor:t.iconColor,initialIcon:t.icon,initialName:t.name,isLoading:h,mode:"edit",onOpenChange:l,onSubmit:a,open:c}),e.jsx(Fe,{deleteId:t.id,setShowDeleteDialog:j,showDeleteDialog:m})]})}function Le(){const t=L(),r=w(),x=Y(),{setOpenMobile:c}=R(),{data:l,isLoading:m}=Se({queryKey:M.list,queryFn:()=>re(),select:a=>a.map(i=>({...i,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt)}))}),[j,d]=p.useState(!1),y=p.useMemo(()=>q(t).projectId,[t]),h=V({mutationFn:ne,onSuccess:a=>{x.invalidateQueries({queryKey:M.list}),d(!1),c(!1),r.push(`/project/${a.id}`)}}),u=a=>{h.mutate({name:a.name,icon:a.icon,iconColor:a.color})};return e.jsxs(e.Fragment,{children:[e.jsx(F,{children:e.jsxs(E,{className:"cursor-pointer",onClick:()=>d(!0),children:[e.jsx(Me,{className:"size-4"}),e.jsx("span",{children:"New project"})]})}),!m&&l?.map(a=>{const i=y===a.id;return e.jsx(Re,{isActive:i,project:a,setOpenMobile:c},a.id)}),e.jsx(W,{isLoading:h.isPending,mode:"create",onOpenChange:d,onSubmit:u,open:j})]})}function Te(){const{data:t}=z(),r=!!t?.user;return e.jsxs(e.Fragment,{children:[r&&e.jsxs(I,{children:[e.jsx(O,{children:"Projects"}),e.jsx(A,{children:e.jsx(K,{children:e.jsx(Le,{})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:"Chats"}),e.jsx(A,{children:e.jsx(K,{children:e.jsx(ke,{})})})]})]})}function Oe({className:t,...r}){return e.jsx("div",{"data-slot":"empty",className:S("flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12",t),...r})}function Ke({className:t,...r}){return e.jsx("div",{"data-slot":"empty-header",className:S("flex max-w-sm flex-col items-center gap-2 text-center",t),...r})}function He({className:t,...r}){return e.jsx("div",{"data-slot":"empty-title",className:S("text-lg font-medium tracking-tight",t),...r})}function $e({className:t,...r}){return e.jsx("div",{"data-slot":"empty-description",className:S("text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4",t),...r})}function ze({className:t,...r}){return e.jsx("div",{"data-slot":"empty-content",className:S("flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm",t),...r})}function Pt(){const{open:t,openMobile:r}=R(),{data:x}=z();return t||r?x?.user?e.jsx(Te,{}):e.jsx(I,{children:e.jsx(A,{children:e.jsxs(Oe,{className:"h-full",children:[e.jsxs(Ke,{children:[e.jsx(He,{children:"Sign In"}),e.jsx($e,{children:"Sign in to save your chat history"})]}),e.jsx(ze,{children:e.jsx(we,{asChild:!0,size:"sm",variant:"outline",children:e.jsxs(k,{href:"/login",children:[e.jsx(Ie,{}),"Sign In"]})})})]})})}):null}export{Pt as AppSidebarHistoryConditional};
//# sourceMappingURL=app-sidebar-history-conditional-BvYi30A1.js.map
