{"version":3,"file":"chat-page-CvpI5gyh.js","sources":["../../../hooks/use-chat-system-initial-state.ts","../../../app/(chat)/chat/[id]/chat-page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo } from \"react\";\nimport type { ChatMessage, UiToolName } from \"@/lib/ai/types\";\nimport { getDefaultThread } from \"@/lib/thread-utils\";\n\ntype MessageWithNonStringId = Omit<ChatMessage, \"id\"> & {\n  id: string | number;\n};\n\nexport function useChatSystemInitialState(\n  messages: MessageWithNonStringId[] | null | undefined\n): {\n  initialMessages: ChatMessage[];\n  initialTool: UiToolName | null;\n} {\n  const initialMessages = useMemo<ChatMessage[]>(() => {\n    if (!messages) {\n      return [];\n    }\n\n    return getDefaultThread(\n      messages.map((msg) => ({\n        ...msg,\n        id: msg.id.toString(),\n      }))\n    );\n  }, [messages]);\n\n  const initialTool = useMemo<UiToolName | null>(() => {\n    const lastAssistantMessage = messages?.findLast(\n      (m) => m.role === \"assistant\"\n    );\n\n    if (!(lastAssistantMessage && Array.isArray(lastAssistantMessage.parts))) {\n      return null;\n    }\n\n    for (const part of lastAssistantMessage.parts) {\n      if (\n        part?.type === \"tool-deepResearch\" &&\n        part?.state === \"output-available\" &&\n        part?.output?.format === \"clarifying_questions\"\n      ) {\n        return \"deepResearch\";\n      }\n    }\n\n    return null;\n  }, [messages]);\n\n  return {\n    initialMessages,\n    initialTool,\n  };\n}\n","\"use client\";\nimport { useSuspenseQuery } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport { ChatSystem } from \"@/components/chat-system\";\nimport {\n  useGetChatByIdQueryOptions,\n  useGetChatMessagesQueryOptions,\n} from \"@/hooks/chat-sync-hooks\";\nimport { useChatSystemInitialState } from \"@/hooks/use-chat-system-initial-state\";\nimport { useRouter } from \"@/hooks/use-navigation\";\nimport { useChatId } from \"@/providers/chat-id-provider\";\nimport { useSession } from \"@/providers/session-provider\";\n\nfunction ChatPageContent({ chatId }: { chatId: string }) {\n  const getChatByIdQueryOptions = useGetChatByIdQueryOptions(chatId);\n  const { data: chat } = useSuspenseQuery(getChatByIdQueryOptions);\n  const getMessagesByChatIdQueryOptions = useGetChatMessagesQueryOptions();\n  const { data: messages } = useSuspenseQuery(getMessagesByChatIdQueryOptions);\n\n  const { initialMessages, initialTool } = useChatSystemInitialState(messages);\n\n  if (!chat) {\n    return (\n      <div className=\"flex h-dvh items-center justify-center\">\n        <div className=\"text-muted-foreground\">Chat not found.</div>\n      </div>\n    );\n  }\n\n  return (\n    <ChatSystem\n      id={chat.id}\n      initialMessages={initialMessages}\n      initialTool={initialTool}\n      isReadonly={false}\n    />\n  );\n}\n\nexport function ChatPage() {\n  const { id, isPersisted } = useChatId();\n  const { data: session, isPending } = useSession();\n  const router = useRouter();\n\n  // Anonymous users can't access persisted chat pages\n  useEffect(() => {\n    if (isPersisted && !isPending && !session?.user) {\n      router.replace(\"/\");\n    }\n  }, [isPersisted, isPending, router, session?.user]);\n\n  if (!isPersisted) {\n    return (\n      <div className=\"flex h-dvh items-center justify-center\">\n        <div className=\"text-muted-foreground\">Chat not found.</div>\n      </div>\n    );\n  }\n\n  return <ChatPageContent chatId={id} />;\n}\n"],"names":["useChatSystemInitialState","messages","initialMessages","useMemo","getDefaultThread","msg","initialTool","lastAssistantMessage","m","part","ChatPageContent","chatId","getChatByIdQueryOptions","useGetChatByIdQueryOptions","chat","useSuspenseQuery","getMessagesByChatIdQueryOptions","useGetChatMessagesQueryOptions","jsx","ChatSystem","ChatPage","id","isPersisted","useChatId","session","isPending","useSession","router","useRouter","useEffect"],"mappings":"kzDAUO,SAASA,EACdC,EAIA,CACA,MAAMC,EAAkBC,EAAAA,QAAuB,IACxCF,EAIEG,EACLH,EAAS,IAAKI,IAAS,CACrB,GAAGA,EACH,GAAIA,EAAI,GAAG,SAAA,CAAS,EACpB,CAAA,EAPK,CAAA,EASR,CAACJ,CAAQ,CAAC,EAEPK,EAAcH,EAAAA,QAA2B,IAAM,CACnD,MAAMI,EAAuBN,GAAU,SACpCO,GAAMA,EAAE,OAAS,WAAA,EAGpB,GAAI,EAAED,GAAwB,MAAM,QAAQA,EAAqB,KAAK,GACpE,OAAO,KAGT,UAAWE,KAAQF,EAAqB,MACtC,GACEE,GAAM,OAAS,qBACfA,GAAM,QAAU,oBAChBA,GAAM,QAAQ,SAAW,uBAEzB,MAAO,eAIX,OAAO,IACT,EAAG,CAACR,CAAQ,CAAC,EAEb,MAAO,CACL,gBAAAC,EACA,YAAAI,CAAA,CAEJ,CC1CA,SAASI,EAAgB,CAAE,OAAAC,GAA8B,CACvD,MAAMC,EAA0BC,EAA2BF,CAAM,EAC3D,CAAE,KAAMG,GAASC,EAAiBH,CAAuB,EACzDI,EAAkCC,EAAA,EAClC,CAAE,KAAMhB,GAAac,EAAiBC,CAA+B,EAErE,CAAE,gBAAAd,EAAiB,YAAAI,GAAgBN,EAA0BC,CAAQ,EAE3E,OAAKa,EASHI,EAAAA,IAACC,EAAA,CACC,GAAIL,EAAK,GACT,gBAAAZ,EACA,YAAAI,EACA,WAAY,EAAA,CAAA,EAXZY,EAAAA,IAAC,OAAI,UAAU,yCACb,eAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,iBAAA,CAAe,CAAA,CACxD,CAYN,CAEO,SAASE,IAAW,CACzB,KAAM,CAAE,GAAAC,EAAI,YAAAC,CAAA,EAAgBC,EAAA,EACtB,CAAE,KAAMC,EAAS,UAAAC,CAAA,EAAcC,EAAA,EAC/BC,EAASC,EAAA,EASf,OANAC,EAAAA,UAAU,IAAM,CACVP,GAAe,CAACG,GAAa,CAACD,GAAS,MACzCG,EAAO,QAAQ,GAAG,CAEtB,EAAG,CAACL,EAAaG,EAAWE,EAAQH,GAAS,IAAI,CAAC,EAE7CF,EAQEJ,EAAAA,IAACR,EAAA,CAAgB,OAAQW,CAAA,CAAI,EANhCH,EAAAA,IAAC,OAAI,UAAU,yCACb,eAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,iBAAA,CAAe,CAAA,CACxD,CAKN"}